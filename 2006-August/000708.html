<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r517 - in trunk/src/net/sf/plantlore/client: .	overview overview/search overview/tree
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-August/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r517%20-%20in%20trunk/src/net/sf/plantlore/client%3A%20.%0A%09overview%20overview/search%20overview/tree&In-Reply-To=%3C200608151248.k7FCmxE6015566%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000707.html">
   <LINK REL="Next"  HREF="000709.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r517 - in trunk/src/net/sf/plantlore/client: .	overview overview/search overview/tree</H1>
    <B>fraktalek at mail.berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r517%20-%20in%20trunk/src/net/sf/plantlore/client%3A%20.%0A%09overview%20overview/search%20overview/tree&In-Reply-To=%3C200608151248.k7FCmxE6015566%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r517 - in trunk/src/net/sf/plantlore/client: .	overview overview/search overview/tree">fraktalek at mail.berlios.de
       </A><BR>
    <I>Tue Aug 15 14:48:59 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000707.html">[Plantlore-dev] r516 - in trunk/src/net/sf/plantlore: common server
</A></li>
        <LI>Next message: <A HREF="000709.html">[Plantlore-dev] r518 - trunk/src/net/sf/plantlore/client/overview
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#708">[ date ]</a>
              <a href="thread.html#708">[ thread ]</a>
              <a href="subject.html#708">[ subject ]</a>
              <a href="author.html#708">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fraktalek
Date: 2006-08-15 14:48:52 +0200 (Tue, 15 Aug 2006)
New Revision: 517

Added:
   trunk/src/net/sf/plantlore/client/overview/tree/
   trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java
   trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeCtrl.java
   trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.form
   trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.java
   trunk/src/net/sf/plantlore/client/overview/tree/NodeInfo.java
Modified:
   trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
   trunk/src/net/sf/plantlore/client/AppCoreView.form
   trunk/src/net/sf/plantlore/client/AppCoreView.java
   trunk/src/net/sf/plantlore/client/overview/search/Search.java
Log:
Implementation of the navigational habitat tree.



Modified: trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-08-15 11:48:28 UTC (rev 516)
+++ trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-08-15 12:48:52 UTC (rev 517)
@@ -63,6 +63,10 @@
 import net.sf.plantlore.client.overview.search.Search;
 import net.sf.plantlore.client.overview.search.SearchCtrl;
 import net.sf.plantlore.client.overview.search.SearchView;
+import net.sf.plantlore.client.overview.tree.HabitatTree;
+import net.sf.plantlore.client.overview.tree.HabitatTreeCtrl;
+import net.sf.plantlore.client.overview.tree.HabitatTreeView;
+import net.sf.plantlore.client.overview.tree.NodeInfo;
 import net.sf.plantlore.client.print.Print;
 import net.sf.plantlore.client.print.PrintCtrl;
 import net.sf.plantlore.client.print.PrintView;
@@ -81,6 +85,8 @@
 import net.sf.plantlore.common.DefaultProgressBar;
 import net.sf.plantlore.common.DefaultProgressBarEx;
 import net.sf.plantlore.common.DefaultReconnectDialog;
+import net.sf.plantlore.common.DefaultReconnectDialog;
+import net.sf.plantlore.common.DefaultReconnectDialog;
 import net.sf.plantlore.common.PlantloreConstants;
 import net.sf.plantlore.common.ProgressBar;
 import net.sf.plantlore.common.Selection;
@@ -245,9 +251,15 @@
 	DetailView detailView;
 
 	DetailCtrl detailCtrl;
+        
+        //HabitatTree
+        HabitatTree habitatTreeModel;
+        HabitatTreeView habitatTreeView;
+        HabitatTreeCtrl habitatTreeCtrl;
 
 	// Bridges
 	ManagerBridge managerBridge = new ManagerBridge();
+        HabitatTreeBridge habitatTreeBridge = new HabitatTreeBridge();
 
 	// Actions
 	AbstractAction settingsAction = new SettingsAction();
@@ -281,6 +293,7 @@
 	AbstractAction schedaAction = new SchedaAction();
 
 	AbstractAction searchAction = new SearchAction();
+        AbstractAction habitatTreeAction = new HabitatTreeAction();
 
 	AbstractAction addAction = new AddAction();
 
@@ -329,6 +342,8 @@
 		view.addDataWholeHistoryAction(dataWholeHistoryAction);
 		view.addDataUserAction(dataUserAction);
 
+                view.habitatTreeButton.setAction(habitatTreeAction);
+                
 		view.setSearchAction(searchAction);
 		view.setAddAction(addAction);
 		view.setEditAction(editAction);
@@ -389,6 +404,12 @@
 		detailModel = new Detail(model);
 		detailView = new DetailView(detailModel, view, true);
 		detailCtrl = new DetailCtrl(detailModel, detailView);
+                
+                // --- HabitatTree ---
+                habitatTreeModel = new HabitatTree();
+                habitatTreeView = new HabitatTreeView(view,true,habitatTreeModel);
+                habitatTreeCtrl = new HabitatTreeCtrl(habitatTreeModel, habitatTreeView);
+                habitatTreeModel.addObserver(new HabitatTreeBridge());
 	}
 
 	private void setDatabaseDependentCommandsEnabled(boolean enabled) {
@@ -408,6 +429,7 @@
 		historyAction.setEnabled(enabled);
 		schedaAction.setEnabled(enabled);
 		searchAction.setEnabled(enabled);
+                habitatTreeAction.setEnabled(enabled);
 		addAction.setEnabled(enabled);
 		editAction.setEnabled(enabled);
 		deleteAction.setEnabled(enabled);
@@ -970,6 +992,34 @@
 		}
 	}
 
+	class HabitatTreeAction extends AbstractAction {
+		public HabitatTreeAction() {
+			if (showButtonText)
+				putValue(NAME, L10n.getString(&quot;Overview.HabitatTree&quot;));
+			putValue(SMALL_ICON, Resource.createIcon(&quot;/toolbarButtonGraphics/development/Application24.gif&quot;));
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.HabitatTreeTT&quot;));
+			//putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_S,
+			//		ActionEvent.CTRL_MASK));
+
+			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.Search&quot;));
+		}
+
+		public void actionPerformed(ActionEvent actionEvent) {
+                        habitatTreeModel.setDBLayer(model.getDatabase());
+                        try {
+                            habitatTreeModel.loadData();
+                            habitatTreeView.setVisible(true);
+                        } catch (Exception ex) {
+                            if (ex instanceof DBLayerException || ex instanceof RemoteException) {
+                                DefaultReconnectDialog.show(view,ex);
+                            } else {
+                                logger.error(&quot;Exception: &quot;+ex);
+                                ex.printStackTrace(); //FIXME
+                            }
+                        }
+		}
+	}
+
 	class SearchBridge implements Observer {
 		public void update(Observable o, Object arg) {
 			if (arg != null &amp;&amp; arg instanceof Integer) {
@@ -999,6 +1049,20 @@
 		}
 
 	}
+        
+        class HabitatTreeBridge implements Observer {
+            public void update(Observable o, Object arg) {
+                if (arg != null &amp;&amp; arg instanceof NodeInfo) {                    
+                    NodeInfo nodeInfo = (NodeInfo)arg;
+                    switch (nodeInfo.getType()) {
+                        case HABITAT:
+                            searchModel.clear();
+                            searchModel.setHabitatId(nodeInfo.getId());
+                            searchModel.constructQuery();
+                    }//switch
+                }//if
+            }//update
+        }//class HabitatTreeBridge
 
 	class SchedaAction extends AbstractAction {
 		public SchedaAction() {

Modified: trunk/src/net/sf/plantlore/client/AppCoreView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreView.form	2006-08-15 11:48:28 UTC (rev 516)
+++ trunk/src/net/sf/plantlore/client/AppCoreView.form	2006-08-15 12:48:52 UTC (rev 517)
@@ -219,6 +219,7 @@
   &lt;/SyntheticProperties&gt;
   &lt;AuxValues&gt;
     &lt;AuxValue name=&quot;FormSettings_generateMnemonicsCode&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
+    &lt;AuxValue name=&quot;FormSettings_layoutCodeTarget&quot; type=&quot;java.lang.Integer&quot; value=&quot;2&quot;/&gt;
     &lt;AuxValue name=&quot;FormSettings_listenerGenerationStyle&quot; type=&quot;java.lang.Integer&quot; value=&quot;0&quot;/&gt;
     &lt;AuxValue name=&quot;FormSettings_variablesLocal&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
     &lt;AuxValue name=&quot;FormSettings_variablesModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;2&quot;/&gt;
@@ -325,6 +326,16 @@
             &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
           &lt;/AuxValues&gt;
         &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;habitatTreeButton&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;icon&quot; type=&quot;javax.swing.Icon&quot; editor=&quot;org.netbeans.modules.form.editors2.IconEditor&quot;&gt;
+              &lt;Image iconType=&quot;3&quot; name=&quot;/toolbarButtonGraphics/development/Application24.gif&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
       &lt;/SubComponents&gt;
     &lt;/Container&gt;
     &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;jPanel1&quot;&gt;
@@ -485,7 +496,7 @@
         &lt;/DimensionLayout&gt;
         &lt;DimensionLayout dim=&quot;1&quot;&gt;
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;Component id=&quot;overviewScrollPane&quot; alignment=&quot;1&quot; pref=&quot;316&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;overviewScrollPane&quot; alignment=&quot;1&quot; pref=&quot;244&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
       &lt;/Layout&gt;

Modified: trunk/src/net/sf/plantlore/client/AppCoreView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreView.java	2006-08-15 11:48:28 UTC (rev 516)
+++ trunk/src/net/sf/plantlore/client/AppCoreView.java	2006-08-15 12:48:52 UTC (rev 517)
@@ -62,6 +62,7 @@
         searchButton = new javax.swing.JButton();
         schedaButton = new javax.swing.JButton();
         historyButton = new javax.swing.JButton();
+        habitatTreeButton = new javax.swing.JButton();
         jPanel1 = new javax.swing.JPanel();
         statusLabel = new javax.swing.JLabel();
         pageToolBar = new javax.swing.JToolBar();
@@ -135,6 +136,9 @@
         historyButton.setIcon(new javax.swing.ImageIcon(getClass().getResource(&quot;/toolbarButtonGraphics/general/History24.gif&quot;)));
         mainToolBar.add(historyButton);
 
+        habitatTreeButton.setIcon(new javax.swing.ImageIcon(getClass().getResource(&quot;/toolbarButtonGraphics/development/Application24.gif&quot;)));
+        mainToolBar.add(habitatTreeButton);
+
         jPanel1.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED));
         statusLabel.setText(L10n.getString(&quot;Overview.StatusReady&quot;));
 
@@ -227,7 +231,7 @@
         );
         overviewPanelLayout.setVerticalGroup(
             overviewPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-            .add(org.jdesktop.layout.GroupLayout.TRAILING, overviewScrollPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 316, Short.MAX_VALUE)
+            .add(org.jdesktop.layout.GroupLayout.TRAILING, overviewScrollPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 244, Short.MAX_VALUE)
         );
 
         recordsCount.setText(&quot;-&quot;);
@@ -703,6 +707,7 @@
     protected javax.swing.JMenu fileMenu;
     private javax.swing.JMenuItem filePrint;
     private javax.swing.JMenuItem fileSettings;
+    protected javax.swing.JButton habitatTreeButton;
     protected javax.swing.JMenuItem helpAbout;
     protected javax.swing.JMenuItem helpContents;
     protected javax.swing.JMenu helpMenu;

Modified: trunk/src/net/sf/plantlore/client/overview/search/Search.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/search/Search.java	2006-08-15 11:48:28 UTC (rev 516)
+++ trunk/src/net/sf/plantlore/client/overview/search/Search.java	2006-08-15 12:48:52 UTC (rev 517)
@@ -67,6 +67,7 @@
     private String localityDescription;
     private Integer year;
     private String habitatNote;
+    private Integer habitatId;
     private String occurrenceNote;
     private Pair&lt;String, Integer&gt; territoryName = new Pair&lt;String,Integer&gt;(&quot;&quot;,-1);
     private Pair&lt;String, Integer&gt; phytName = new Pair&lt;String,Integer&gt;(&quot;&quot;,-1);
@@ -159,6 +160,12 @@
         return year;
     }
 
+    /** Allows for special queries based only on habitat id.
+     *
+     */
+    public void setHabitatId(Integer id) {
+        this.habitatId = id;
+    }
 
     public String getHabitatNote() {
         return habitatNote;
@@ -745,6 +752,12 @@
                     restrictions.add(new Restriction(RESTR_LIKE, Occurrence.NOTE, &quot;%&quot;+occurrenceNote+&quot;%&quot;));
                 }
                 
+                if (isNotEmpty(habitatId)) {
+                    arg = dlu.getObjectFor(habitatId,Habitat.class);
+                    sq.addRestriction(PlantloreConstants.RESTR_EQ,&quot;occ.&quot;+Occurrence.HABITAT,null,arg,null);
+                    restrictions.add(new Restriction(RESTR_EQ, Occurrence.HABITAT, arg));                    
+                }
+                
                 if (isNotEmpty(habitatNote)) {
                     sq.addRestriction(PlantloreConstants.RESTR_LIKE,&quot;habitat.&quot;+Habitat.NOTE,null,&quot;%&quot;+habitatNote+&quot;%&quot;,null);
                     restrictions.add(new Restriction(RESTR_LIKE, habitatAlias+Habitat.NOTE, &quot;%&quot;+habitatNote+&quot;%&quot;));
@@ -862,6 +875,7 @@
         localityDescription = null;
         year = null;
         habitatNote = null;
+        habitatId = null;
         occurrenceNote = null;
         territoryName = null;
         phytName = null;

Added: trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java	2006-08-15 11:48:28 UTC (rev 516)
+++ trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java	2006-08-15 12:48:52 UTC (rev 517)
@@ -0,0 +1,187 @@
+/*
+ * HabitatTree.java
+ *
+ * Created on 7. srpen 2006, 12:50
+ *
+ * To change this template, choose Tools | Template Manager
+ * and open the template in the editor.
+ */
+
+package net.sf.plantlore.client.overview.tree;
+
+import java.rmi.RemoteException;
+import java.util.Observable;
+import javax.swing.JTree;
+import javax.swing.event.TreeExpansionEvent;
+import javax.swing.event.TreeExpansionListener;
+import javax.swing.event.TreeSelectionEvent;
+import javax.swing.event.TreeSelectionListener;
+import javax.swing.tree.DefaultMutableTreeNode;
+import javax.swing.tree.DefaultTreeModel;
+import net.sf.plantlore.common.DBLayerUtils;
+import net.sf.plantlore.common.PlantloreConstants;
+import net.sf.plantlore.common.exception.DBLayerException;
+import net.sf.plantlore.common.record.Habitat;
+import net.sf.plantlore.common.record.Phytochorion;
+import net.sf.plantlore.common.record.Territory;
+import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.l10n.L10n;
+import net.sf.plantlore.middleware.DBLayer;
+import net.sf.plantlore.middleware.SelectQuery;
+import org.apache.log4j.Logger;
+
+/**
+ *
+ * @author fraktalek
+ */
+public class HabitatTree extends Observable {
+    Logger logger = Logger.getLogger(HabitatTree.class.getPackage().getName());
+    
+    DefaultTreeModel treeModel;
+    DefaultMutableTreeNode rootNode;
+
+    DBLayer dblayer;
+    
+    private DefaultMutableTreeNode selectedNode;
+    
+    /** Creates a new instance of HabitatTree */
+    public HabitatTree() {
+        //even the rootNode must contain NodeInfo user object not only String so that we can rely on the fact that EACH node contains NodeInfo
+        rootNode = new DefaultMutableTreeNode(new NodeInfo(NodeInfo.NodeType.ROOT,L10n.getString(&quot;Overview.Tree.Habitats&quot;),-1,-1));
+        treeModel = new DefaultTreeModel(rootNode);
+    }
+    
+    
+    public void setDBLayer(DBLayer dblayer) {
+        this.dblayer = dblayer;
+    }
+    
+    public void loadData() throws DBLayerException, RemoteException {
+        SelectQuery subQuery = dblayer.createSubQuery(Habitat.class,&quot;h&quot;);
+        subQuery.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;h.&quot; + Habitat.TERRITORY);
+        
+        SelectQuery query = dblayer.createQuery(Territory.class);
+        query.addRestriction(PlantloreConstants.SUBQUERY_IN,Territory.ID,null,subQuery,null);
+        
+        int resultid = dblayer.executeQuery(query);
+        int resultsCount = dblayer.getNumRows(resultid);
+        Object[] records = (Object[]) dblayer.more(resultid, 0,resultsCount - 1);
+        dblayer.closeQuery(query);
+        Territory territory;
+        DefaultMutableTreeNode node;
+        for (Object record : records) {
+            territory = (Territory) ((Object [])record)[0];
+            node = new DefaultMutableTreeNode(new NodeInfo(NodeInfo.NodeType.TERRITORY,territory.getName(),territory.getId(),getPhythochoriaCount(territory)));
+            rootNode.add(node);
+            addPhythochoria(node,territory);
+        }
+        
+        setChanged();
+        notifyObservers(&quot;LOADED_DATA&quot;);
+    }
+    
+    public int getPhythochoriaCount(Territory t) throws RemoteException, DBLayerException {
+        SelectQuery query = dblayer.createQuery(Habitat.class);
+        query.addRestriction(PlantloreConstants.RESTR_EQ,Habitat.TERRITORY,null,t,null);
+        query.addProjection(PlantloreConstants.PROJ_COUNT_DISTINCT,Habitat.PHYTOCHORION);
+        int resultid = dblayer.executeQuery(query);
+        int rowCount = dblayer.getNumRows(resultid);
+        
+        assert rowCount == 1;
+        
+        Object[] o = dblayer.more(resultid, 0, 0);
+        dblayer.closeQuery(query);
+        return (Integer)((Object[])(o[0]))[0];
+    }
+    
+    protected void addPhythochoria(DefaultMutableTreeNode territoryNode, Territory t) throws DBLayerException, RemoteException {
+        SelectQuery query = dblayer.createQuery(Habitat.class);
+        query.addRestriction(PlantloreConstants.RESTR_EQ,Habitat.TERRITORY,null,t,null);
+        query.addProjection(PlantloreConstants.PROJ_DISTINCT,Habitat.PHYTOCHORION);
+        int resultid = dblayer.executeQuery(query);
+        int rowCount = dblayer.getNumRows(resultid);
+                
+        Object[] records = dblayer.more(resultid, 0, rowCount - 1);
+        dblayer.closeQuery(query);
+        DefaultMutableTreeNode node;
+        NodeInfo nodeInfo;
+        DefaultMutableTreeNode fakeNode;
+        for (Object record : records) {
+            Phytochorion phyt = (Phytochorion)((Object[])record)[0];
+            nodeInfo = new NodeInfo(NodeInfo.NodeType.PHYTOCHORION,phyt.getName(),phyt.getId(),-1);
+            node = new DefaultMutableTreeNode(nodeInfo);
+            treeModel.insertNodeInto(node,territoryNode,0);//territoryNode.add(node);
+            fakeNode = createFakeNode();
+            nodeInfo.setObject(fakeNode);
+            treeModel.insertNodeInto(fakeNode,node,0);//we want the phytochoria nodes displayed as having children
+        }
+        treeModel.nodeStructureChanged(territoryNode);
+    }
+    
+    /**We don't want to load habitats into each phytochorion node in advance we want to load them on demand
+      but we also want to display the phytochorion node as having children so we first put the fake node into
+      each phytochorion node and then on Expanded event remove it and load the habitats */
+    protected DefaultMutableTreeNode createFakeNode() {
+         return new DefaultMutableTreeNode(new NodeInfo(NodeInfo.NodeType.FAKE, &quot;&quot;, -256, -1));        
+    }
+    
+    protected void addHabitats(DefaultMutableTreeNode phytNode, int phytochorionId) throws DBLayerException, RemoteException {
+        DBLayerUtils dlu = new DBLayerUtils(dblayer);
+        
+        SelectQuery query = dblayer.createQuery(Habitat.class);
+        query.addRestriction(PlantloreConstants.RESTR_EQ, Habitat.PHYTOCHORION, null, dlu.getObjectFor(phytochorionId, Phytochorion.class),null);
+        query.addProjection(PlantloreConstants.PROJ_PROPERTY, Habitat.ID);
+        query.addProjection(PlantloreConstants.PROJ_PROPERTY, Habitat.DESCRIPTION);
+        query.addProjection(PlantloreConstants.PROJ_PROPERTY, Habitat.NEARESTVILLAGE);
+        query.addProjection(PlantloreConstants.PROJ_PROPERTY, Habitat.QUADRANT);
+
+        int resultid = dblayer.executeQuery(query);
+        int rowCount = dblayer.getNumRows(resultid);
+                
+        Object[] records = dblayer.more(resultid, 0, rowCount - 1);
+        dblayer.closeQuery(query);
+        DefaultMutableTreeNode node;
+        for (Object record : records) {
+            Object[] obj = (Object[])record;
+            String name = ((Village)obj[2]).getName() + &quot; - &quot; + obj[1] + &quot; (quadrant &quot; + obj[3] + &quot;)&quot;;
+            node = new DefaultMutableTreeNode(new NodeInfo(NodeInfo.NodeType.HABITAT,name,(Integer)obj[0],-1));
+            treeModel.insertNodeInto(node, phytNode,0);
+            //phytNode.add(node);
+        }
+    }
+    
+    public void setSelectedNode(DefaultMutableTreeNode node) {
+        this.selectedNode = node;
+        logger.debug(&quot;HabitatTree: selected node &quot;+(node==null ? &quot;null&quot; : node.getUserObject()));
+    }
+    
+    /** Notify observers about a new requirement for search (overview update).
+     *
+     * Sends the &lt;code&gt;NodeInfo&lt;/code&gt; object of the selected node to the observer.
+     *
+     */
+    public void search() {
+        if (selectedNode != null) {
+            setChanged();
+            notifyObservers((NodeInfo)selectedNode.getUserObject());
+        }
+    }
+    
+    /** Reloads the whole tree.
+     *
+     * Removes all children of the &lt;code&gt;rootNode&lt;/code&gt; and then calls &lt;code&gt;loadData()&lt;/code&gt;
+     *
+     */
+    public void reload() throws DBLayerException, RemoteException {
+        rootNode.removeAllChildren();
+        loadData();
+    }
+    
+    public DefaultTreeModel getTreeModel() {
+        return treeModel;
+    }
+
+
+
+}//class HabitatTree
+

Added: trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeCtrl.java	2006-08-15 11:48:28 UTC (rev 516)
+++ trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeCtrl.java	2006-08-15 12:48:52 UTC (rev 517)
@@ -0,0 +1,231 @@
+/*
+ * HabitatTreeCtrl.java
+ *
+ * Created on 12. srpen 2006, 13:53
+ *
+ * To change this template, choose Tools | Template Manager
+ * and open the template in the editor.
+ */
+
+package net.sf.plantlore.client.overview.tree;
+
+import java.awt.event.ActionEvent;
+import java.awt.event.MouseAdapter;
+import java.awt.event.MouseEvent;
+import java.rmi.RemoteException;
+import javax.swing.AbstractAction;
+import javax.swing.JOptionPane;
+import javax.swing.JTree;
+import javax.swing.event.TreeExpansionEvent;
+import javax.swing.event.TreeExpansionListener;
+import javax.swing.event.TreeSelectionEvent;
+import javax.swing.event.TreeSelectionListener;
+import javax.swing.tree.DefaultMutableTreeNode;
+import javax.swing.tree.TreePath;
+import net.sf.plantlore.client.resources.Resource;
+import net.sf.plantlore.common.DefaultProgressBar;
+import net.sf.plantlore.common.DefaultReconnectDialog;
+import net.sf.plantlore.common.Task;
+import net.sf.plantlore.common.exception.DBLayerException;
+import net.sf.plantlore.l10n.L10n;
+import org.apache.log4j.Logger;
+
+/** The HabitatTree Controller
+ *
+ * @author fraktalek
+ */
+public class HabitatTreeCtrl implements TreeExpansionListener, TreeSelectionListener {    
+    Logger logger = Logger.getLogger(HabitatTreeCtrl.class.getPackage().getName());
+    HabitatTree model;
+    HabitatTreeView view;
+    
+    private boolean showButtonText = false;
+    
+    /** Creates a new instance of HabitatTreeCtrl */
+    public HabitatTreeCtrl(HabitatTree model, HabitatTreeView view) {
+        this.model = model;
+        this.view = view;
+        view.habitatTree.addTreeExpansionListener(this);
+        view.habitatTree.addTreeSelectionListener(this);
+        view.habitatTree.addMouseListener(new PopupMouseAdapter());
+        view.searchButton.setAction(new SearchAction());
+        view.searchMenuItem.setAction(new SearchItemAction());
+        view.refreshButton.setAction(new RefreshAction());
+        view.refreshMenuItem.setAction(new RefreshItemAction());
+    }
+
+    /** Expansion event handler.
+     *
+     * If the node expanded is of type PHYTOCHORION then this method makes the model
+     * load habitats into the expanded node and removes the fake node.
+     *
+     */
+   public void treeExpanded(TreeExpansionEvent event) {
+        final DefaultMutableTreeNode node = (DefaultMutableTreeNode)event.getPath().getLastPathComponent();
+        final NodeInfo nodeInfo = (NodeInfo) node.getUserObject();
+        logger.debug(&quot;HabitatTree: EXPANDED: &quot;+nodeInfo+&quot; (&quot;+nodeInfo.getType()+&quot;)&quot;);
+        switch (nodeInfo.getType()) {
+            case PHYTOCHORION:
+                try {
+                    node.remove((DefaultMutableTreeNode)nodeInfo.getObject());
+                    nodeInfo.setObject(null);
+                } catch (IllegalArgumentException ex) {
+                    logger.error(&quot;HabitatTree node &quot;+node+&quot; didn't contain a fakeNode although it should have.&quot;);
+                    ex.printStackTrace();
+                }
+
+
+                Task task = new Task() {
+                    @Override
+                    public Object task() throws DBLayerException, RemoteException {
+                        model.addHabitats(node,nodeInfo.getId());
+                        return null;
+                    }
+                };
+                DefaultProgressBar dpb = new DefaultProgressBar(task,view,true) {
+                    @Override
+                    public void afterStopping() {
+                        model.getTreeModel().nodeStructureChanged(node);                        
+                    }
+                };
+                
+                task.start();
+        }
+    }
+
+   /** Collapsed event handler.
+    *
+    * If the collapsed node is of type PHYTOCHORION then removes all its child nodes and
+    * creates one child fake node (and stores the fake node also to the node's NodeInfo object).
+    *
+    */
+   public void treeCollapsed(TreeExpansionEvent event) {
+       DefaultMutableTreeNode node = (DefaultMutableTreeNode)event.getPath().getLastPathComponent();
+       NodeInfo nodeInfo = (NodeInfo) node.getUserObject();
+       logger.debug(&quot;HabitatTree: COLLAPSED: &quot;+nodeInfo+&quot; (&quot;+nodeInfo.getType()+&quot;)&quot;);
+       switch (nodeInfo.getType()) {
+           case PHYTOCHORION:
+               node.removeAllChildren();
+               model.getTreeModel().nodeStructureChanged(node);
+               DefaultMutableTreeNode fakeNode = model.createFakeNode();
+               nodeInfo.setObject(fakeNode);
+               model.getTreeModel().insertNodeInto(fakeNode, node, 0);
+       }
+   }
+    
+   /** Selection handler.
+    *
+    */
+   public void valueChanged(TreeSelectionEvent e) {
+       JTree tree = (JTree) e.getSource();
+       DefaultMutableTreeNode node = (DefaultMutableTreeNode) tree.getLastSelectedPathComponent();
+       
+       if (node == null) return;
+       
+       Object obj = node.getUserObject();
+       NodeInfo nodeInfo;
+       if (!(obj instanceof NodeInfo))
+           return;
+       nodeInfo = (NodeInfo) node.getUserObject();
+       logger.debug(&quot;HabitatTree: valueChanged event on node &quot;+nodeInfo+&quot; (&quot;+nodeInfo.getType()+&quot;) with &quot;+node.getChildCount()+&quot; children.&quot;);
+       switch (nodeInfo.getType()) {
+           case HABITAT:
+               model.setSelectedNode(node);
+               break;
+           default:
+               model.setSelectedNode(null);
+       }
+   }//valueChanged()
+   
+    class SearchAction extends AbstractAction {
+            public SearchAction() {
+                    if (showButtonText)
+                            putValue(NAME, L10n.getString(&quot;Overview.Tree.Search&quot;));
+                    putValue(SMALL_ICON, Resource.createIcon(&quot;/toolbarButtonGraphics/general/Search24.gif&quot;));
+                    putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.Tree.SearchTT&quot;));
+            }
+
+            public void actionPerformed(ActionEvent actionEvent) {
+                model.search();
+            }
+    }//SearchAction
+   
+    class RefreshAction extends AbstractAction {
+            public RefreshAction() {
+                    if (showButtonText)
+                            putValue(NAME, L10n.getString(&quot;Overview.Tree.Refresh&quot;));
+                    putValue(SMALL_ICON, Resource.createIcon(&quot;/toolbarButtonGraphics/general/Refresh24.gif&quot;));
+                    putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.Tree.RefreshTT&quot;));
+            }
+
+            public void actionPerformed(ActionEvent actionEvent) {
+                try {
+                    model.reload();
+                } catch (Exception ex) {
+                    if (ex instanceof DBLayerException || ex instanceof RemoteException)
+                        DefaultReconnectDialog.show(view,ex);
+                    else
+                        JOptionPane.showMessageDialog(view,L10n.getString(&quot;Error.General&quot;));//FIXME
+                }
+            }
+    }//RefreshAction
+   
+    class SearchItemAction extends AbstractAction {
+            public SearchItemAction() {
+                    putValue(NAME, L10n.getString(&quot;Overview.Tree.Search&quot;));
+//                    putValue(SMALL_ICON, Resource.createIcon(&quot;/toolbarButtonGraphics/general/Search24.gif&quot;));
+                    putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.Tree.SearchTT&quot;));
+            }
+
+            public void actionPerformed(ActionEvent actionEvent) {
+                model.search();
+            }
+    }//SearchAction
+   
+    class RefreshItemAction extends AbstractAction {
+            public RefreshItemAction() {
+                    putValue(NAME, L10n.getString(&quot;Overview.Tree.Refresh&quot;));
+//                    putValue(SMALL_ICON, Resource.createIcon(&quot;/toolbarButtonGraphics/general/Refresh24.gif&quot;));
+                    putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.Tree.RefreshTT&quot;));
+            }
+
+            public void actionPerformed(ActionEvent actionEvent) {
+                try {
+                    model.reload();
+                } catch (Exception ex) {
+                    if (ex instanceof DBLayerException || ex instanceof RemoteException)
+                        DefaultReconnectDialog.show(view,ex);
+                    else
+                        JOptionPane.showMessageDialog(view,L10n.getString(&quot;Error.General&quot;));//FIXME
+                }
+            }
+    }//RefreshAction
+
+    class PopupMouseAdapter extends MouseAdapter {
+         public void mousePressed(MouseEvent e) {
+             int selRow = view.habitatTree.getRowForLocation(e.getX(), e.getY());
+             TreePath selPath = view.habitatTree.getPathForLocation(e.getX(), e.getY());
+             DefaultMutableTreeNode node = selPath == null ? null : (DefaultMutableTreeNode)selPath.getLastPathComponent();
+             switch (e.getButton()) {
+                 case MouseEvent.BUTTON3: //right button
+                     //if(selRow != -1) {
+                         if (e.isPopupTrigger()) {
+                             view.popupMenu.show(view.habitatTree,e.getX(),e.getY());
+                         }
+                     //}
+                     break;
+                 case MouseEvent.BUTTON1://left button
+                     if (e.getClickCount() == 2) { //double-click
+                         if (node != null &amp;&amp; ((NodeInfo)node.getUserObject()).getType().equals(NodeInfo.NodeType.HABITAT))
+                             model.search();
+                     }
+                     break;
+             }//switch
+         }        
+    }//PopupMouseAdapter
+
+    
+}//class HabitatTreeCtrl
+
+
+

Added: trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.form	2006-08-15 11:48:28 UTC (rev 516)
+++ trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.form	2006-08-15 12:48:52 UTC (rev 517)
@@ -0,0 +1,114 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
+
+&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JDialogFormInfo&quot;&gt;
+  &lt;NonVisualComponents&gt;
+    &lt;Menu class=&quot;javax.swing.JPopupMenu&quot; name=&quot;popupMenu&quot;&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+      &lt;SubComponents&gt;
+        &lt;MenuItem class=&quot;javax.swing.JMenuItem&quot; name=&quot;searchMenuItem&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Search&quot;/&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/MenuItem&gt;
+        &lt;MenuItem class=&quot;javax.swing.JMenuItem&quot; name=&quot;refreshMenuItem&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Refresh&quot;/&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/MenuItem&gt;
+      &lt;/SubComponents&gt;
+    &lt;/Menu&gt;
+  &lt;/NonVisualComponents&gt;
+  &lt;SyntheticProperties&gt;
+    &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
+  &lt;/SyntheticProperties&gt;
+  &lt;AuxValues&gt;
+    &lt;AuxValue name=&quot;FormSettings_generateMnemonicsCode&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
+    &lt;AuxValue name=&quot;FormSettings_layoutCodeTarget&quot; type=&quot;java.lang.Integer&quot; value=&quot;2&quot;/&gt;
+    &lt;AuxValue name=&quot;FormSettings_listenerGenerationStyle&quot; type=&quot;java.lang.Integer&quot; value=&quot;0&quot;/&gt;
+    &lt;AuxValue name=&quot;FormSettings_variablesLocal&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
+    &lt;AuxValue name=&quot;FormSettings_variablesModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;2&quot;/&gt;
+  &lt;/AuxValues&gt;
+
+  &lt;Layout&gt;
+    &lt;DimensionLayout dim=&quot;0&quot;&gt;
+      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+          &lt;Component id=&quot;jPanel1&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+          &lt;Component id=&quot;jScrollPane1&quot; alignment=&quot;0&quot; pref=&quot;355&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+      &lt;/Group&gt;
+    &lt;/DimensionLayout&gt;
+    &lt;DimensionLayout dim=&quot;1&quot;&gt;
+      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+          &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+              &lt;Component id=&quot;jScrollPane1&quot; pref=&quot;375&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;jPanel1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+          &lt;/Group&gt;
+      &lt;/Group&gt;
+    &lt;/DimensionLayout&gt;
+  &lt;/Layout&gt;
+  &lt;SubComponents&gt;
+    &lt;Container class=&quot;javax.swing.JScrollPane&quot; name=&quot;jScrollPane1&quot;&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;autoScrollPane&quot; type=&quot;java.lang.Boolean&quot; value=&quot;true&quot;/&gt;
+      &lt;/AuxValues&gt;
+
+      &lt;Layout class=&quot;org.netbeans.modules.form.compat2.layouts.support.JScrollPaneSupportLayout&quot;/&gt;
+      &lt;SubComponents&gt;
+        &lt;Component class=&quot;javax.swing.JTree&quot; name=&quot;habitatTree&quot;&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_CreateCodeCustom&quot; type=&quot;java.lang.String&quot; value=&quot;new JTree(model.getTreeModel());&quot;/&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
+      &lt;/SubComponents&gt;
+    &lt;/Container&gt;
+    &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;jPanel1&quot;&gt;
+
+      &lt;Layout&gt;
+        &lt;DimensionLayout dim=&quot;0&quot;&gt;
+          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;searchButton&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace pref=&quot;179&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;refreshButton&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+          &lt;/Group&gt;
+        &lt;/DimensionLayout&gt;
+        &lt;DimensionLayout dim=&quot;1&quot;&gt;
+          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;searchButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;refreshButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+          &lt;/Group&gt;
+        &lt;/DimensionLayout&gt;
+      &lt;/Layout&gt;
+      &lt;SubComponents&gt;
+        &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;searchButton&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;jButton1&quot;/&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;refreshButton&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;jButton2&quot;/&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
+      &lt;/SubComponents&gt;
+    &lt;/Container&gt;
+  &lt;/SubComponents&gt;
+&lt;/Form&gt;

Added: trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.java	2006-08-15 11:48:28 UTC (rev 516)
+++ trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.java	2006-08-15 12:48:52 UTC (rev 517)
@@ -0,0 +1,123 @@
+/*
+ * HabitatTree.java
+ *
+ * Created on 7. srpen 2006, 12:36
+ */
+
+package net.sf.plantlore.client.overview.tree;
+
+import java.util.Observable;
+import java.util.Observer;
+import javax.swing.JTree;
+import net.sf.plantlore.l10n.L10n;
+
+/**
+ *
+ * @author  fraktalek
+ */
+public class HabitatTreeView extends javax.swing.JDialog implements Observer {
+    HabitatTree model;
+    
+    /** Creates new form HabitatTree */
+    public HabitatTreeView(java.awt.Frame parent, boolean modal, HabitatTree model) {
+        super(parent, modal);
+        this.model = model;
+        initComponents();
+        model.addObserver(this);
+        setLocationRelativeTo(parent);
+        searchMenuItem.setText(L10n.getString(&quot;Overview.Tree.SearchMenuItem&quot;));
+        refreshMenuItem.setText(L10n.getString(&quot;Overview.Tree.RefreschMenuItem&quot;));
+    }
+    
+    /** This method is called from within the constructor to
+     * initialize the form.
+     * WARNING: Do NOT modify this code. The content of this method is
+     * always regenerated by the Form Editor.
+     */
+    // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot; Generated Code &quot;&gt;//GEN-BEGIN:initComponents
+    private void initComponents() {
+        popupMenu = new javax.swing.JPopupMenu();
+        searchMenuItem = new javax.swing.JMenuItem();
+        refreshMenuItem = new javax.swing.JMenuItem();
+        jScrollPane1 = new javax.swing.JScrollPane();
+        habitatTree = new JTree(model.getTreeModel());
+        jPanel1 = new javax.swing.JPanel();
+        searchButton = new javax.swing.JButton();
+        refreshButton = new javax.swing.JButton();
+
+        searchMenuItem.setText(&quot;Search&quot;);
+        popupMenu.add(searchMenuItem);
+
+        refreshMenuItem.setText(&quot;Refresh&quot;);
+        popupMenu.add(refreshMenuItem);
+
+        jScrollPane1.setViewportView(habitatTree);
+
+        searchButton.setText(&quot;jButton1&quot;);
+
+        refreshButton.setText(&quot;jButton2&quot;);
+
+        org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
+        jPanel1.setLayout(jPanel1Layout);
+        jPanel1Layout.setHorizontalGroup(
+            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(jPanel1Layout.createSequentialGroup()
+                .add(searchButton)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 179, Short.MAX_VALUE)
+                .add(refreshButton))
+        );
+        jPanel1Layout.setVerticalGroup(
+            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                .add(searchButton)
+                .add(refreshButton))
+        );
+
+        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
+        getContentPane().setLayout(layout);
+        layout.setHorizontalGroup(
+            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+            .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 355, Short.MAX_VALUE)
+        );
+        layout.setVerticalGroup(
+            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
+                .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 375, Short.MAX_VALUE)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+        );
+        pack();
+    }// &lt;/editor-fold&gt;//GEN-END:initComponents
+    
+    /**
+     * @param args the command line arguments
+     */
+    public static void main(String args[]) {
+        java.awt.EventQueue.invokeLater(new Runnable() {
+            public void run() {
+                new HabitatTreeView(new javax.swing.JFrame(), true, null).setVisible(true);
+            }
+        });
+    }
+
+    public void update(Observable o, Object arg) {
+        if (arg != null &amp;&amp; arg instanceof String) {
+            if (arg.equals(&quot;LOADED_DATA&quot;)) {
+                habitatTree.expandRow(0);                
+            }
+        }
+    }
+    
+    // Variables declaration - do not modify//GEN-BEGIN:variables
+    protected javax.swing.JTree habitatTree;
+    private javax.swing.JPanel jPanel1;
+    private javax.swing.JScrollPane jScrollPane1;
+    protected javax.swing.JPopupMenu popupMenu;
+    protected javax.swing.JButton refreshButton;
+    protected javax.swing.JMenuItem refreshMenuItem;
+    protected javax.swing.JButton searchButton;
+    protected javax.swing.JMenuItem searchMenuItem;
+    // End of variables declaration//GEN-END:variables
+    
+}

Added: trunk/src/net/sf/plantlore/client/overview/tree/NodeInfo.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/tree/NodeInfo.java	2006-08-15 11:48:28 UTC (rev 516)
+++ trunk/src/net/sf/plantlore/client/overview/tree/NodeInfo.java	2006-08-15 12:48:52 UTC (rev 517)
@@ -0,0 +1,89 @@
+/*
+ * NodeInfo.java
+ *
+ * Created on 13. srpen 2006, 17:27
+ *
+ * To change this template, choose Tools | Template Manager
+ * and open the template in the editor.
+ */
+
+package net.sf.plantlore.client.overview.tree;
+
+/** Class for holding information about nodes.
+ *
+ * Each node is supposed to represent a row in a database table, the primary key cId is
+ * given to the constructor and can be retrieved using &lt;code&gt;getId()&lt;/code&gt; method.
+ *
+ * Each node has an associated type NodeType that informs the user about the node level.
+ * Because all the nodes on a given level are of the same type.
+ *
+ */
+public class NodeInfo {
+    public enum NodeType {TERRITORY, PHYTOCHORION, HABITAT, ROOT, FAKE};    
+    String name;
+    Integer id;
+    int childCount;
+    NodeType type;
+    Object object;
+    
+    /** Creates an instance of NodeInfo class.
+     *
+     * @param name used in &lt;code&gt;toString()&lt;/code&gt; method
+     * @param id cId of the represented database row / hibernate object
+     * @param childCount used in &lt;code&gt;toString()&lt;/code&gt; method to inform user about the number of descendants
+     *
+     */
+    public NodeInfo(NodeType type, String name, Integer id, int childCount) {
+        this.type = type;
+        this.name = name;
+        this.id = id;
+        this.childCount = childCount;        
+    }
+    
+    public String toString() {
+        if (childCount &gt; 0)
+            return name + &quot; (&quot;+childCount+&quot;)&quot;;
+        else
+            return name;
+    }
+    
+    public Integer getId() {
+        return id;
+    }
+    
+    public NodeType getType() {
+        return type;
+    }
+    
+    public int getChildCount() {
+        return childCount;
+    }
+    
+    /** The NodeInfo object can hold some arbitrary object using this method.
+     *
+     */
+    public void setObject(Object obj) {
+        this.object = obj;
+    }
+    
+    /** Returns the object previously set by &lt;code&gt;setObject()&lt;/code&gt; method.
+     *
+     */
+    public Object getObject() {
+        return object;
+    }
+    
+    /** Two NodeInfo objects are equal iff they are of the same type
+     * and their ids are equal.
+     *
+     * Instances of other classes than NodeInfo are never equal to NodeInfo.
+     *
+     */
+    public boolean equals(Object obj) {
+        if (!(obj instanceof NodeInfo))
+            return false;
+        NodeInfo ni = (NodeInfo) obj;
+        return ni.getType().equals(getType()) &amp;&amp; ni.getId().equals(getId());
+    }
+}
+


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000707.html">[Plantlore-dev] r516 - in trunk/src/net/sf/plantlore: common server
</A></li>
	<LI>Next message: <A HREF="000709.html">[Plantlore-dev] r518 - trunk/src/net/sf/plantlore/client/overview
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#708">[ date ]</a>
              <a href="thread.html#708">[ thread ]</a>
              <a href="subject.html#708">[ subject ]</a>
              <a href="author.html#708">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
