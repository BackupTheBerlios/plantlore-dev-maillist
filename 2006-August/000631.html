<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r483 - in trunk/src/net/sf/plantlore: client	client/history client/metadata common l10n
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-August/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r483%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%0A%09client/history%20client/metadata%20common%20l10n&In-Reply-To=%3C200608030849.k738niut021278%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000630.html">
   <LINK REL="Next"  HREF="000632.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r483 - in trunk/src/net/sf/plantlore: client	client/history client/metadata common l10n</H1>
    <B>lada at mail.berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r483%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%0A%09client/history%20client/metadata%20common%20l10n&In-Reply-To=%3C200608030849.k738niut021278%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r483 - in trunk/src/net/sf/plantlore: client	client/history client/metadata common l10n">lada at mail.berlios.de
       </A><BR>
    <I>Thu Aug  3 10:49:44 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000630.html">[Plantlore-dev] Logout &amp; Database reconnect
</A></li>
        <LI>Next message: <A HREF="000632.html">[Plantlore-dev] r484 - trunk/src/net/sf/plantlore/client/user
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#631">[ date ]</a>
              <a href="thread.html#631">[ thread ]</a>
              <a href="subject.html#631">[ subject ]</a>
              <a href="author.html#631">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: lada
Date: 2006-08-03 10:49:39 +0200 (Thu, 03 Aug 2006)
New Revision: 483

Modified:
   trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
   trunk/src/net/sf/plantlore/client/history/History.java
   trunk/src/net/sf/plantlore/client/history/HistoryCtrl.java
   trunk/src/net/sf/plantlore/client/history/HistoryView.form
   trunk/src/net/sf/plantlore/client/history/HistoryView.java
   trunk/src/net/sf/plantlore/client/history/WholeHistoryCtrl.java
   trunk/src/net/sf/plantlore/client/history/WholeHistoryView.form
   trunk/src/net/sf/plantlore/client/history/WholeHistoryView.java
   trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataCtrl.java
   trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.form
   trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.java
   trunk/src/net/sf/plantlore/client/metadata/MetadataManager.java
   trunk/src/net/sf/plantlore/client/metadata/MetadataManagerCtrl.java
   trunk/src/net/sf/plantlore/client/metadata/MetadataManagerTableModel.java
   trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.form
   trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.java
   trunk/src/net/sf/plantlore/common/PlantloreHelp.java
   trunk/src/net/sf/plantlore/l10n/Plantlore.properties
   trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties
Log:
MetadataManager - uses Task, progress bar. Fix GUI, L10n, comments, catch exceptions. Fix bugs - showing help, sorting in table, set count rows in page (table). Check whether it is ok to delete the metadat.Check whether dataSetTitle is unique during ADD METADATA.

AppCoreCtrl - update DataHistoryAction, DataWholeHistoryAction and DataMetadataAction. Dialog is created only one times, then is called setVisible(true). Check error during creating of dialog.

KEY PRESSED:

SPACE - call function of active button ( TAB change active button )
ENTER - call function of main button in dialog ( getRootPane().setDefaultButton(closeButton); )
ECAPE - close dialog ( use keyListener for components )

Modified: trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -1201,15 +1201,19 @@
 		public void actionPerformed(ActionEvent e) {
 			System.out.println(&quot;History od record: &quot;+ model.getDatabase());	
 			
-			historyModel = new History(model.getDatabase(), model.getSelectedOccurrence());
-			if (historyModel.isError()) {				
-				JOptionPane.showMessageDialog(view, historyModel.getError(), L10n.getString(&quot;Error.HistorySearchTitle&quot;),
-						JOptionPane.WARNING_MESSAGE);				
-			} else {	
-			historyView = new HistoryView(historyModel, view, true);
-			historyCtrl = new HistoryCtrl(historyModel, historyView);
-			historyModel.addObserver(managerBridge);
-			historyView.setVisible(true);
+			if (historyModel == null) {
+				historyModel = new History(model.getDatabase(), model.getSelectedOccurrence());
+				if (historyModel.isError()) {				
+					JOptionPane.showMessageDialog(view, historyModel.getError(), L10n.getString(&quot;Error.HistoryCreateDialog&quot;),
+							JOptionPane.WARNING_MESSAGE);				
+				} else {					
+				historyView = new HistoryView(historyModel, view, true);
+				historyCtrl = new HistoryCtrl(historyModel, historyView);
+				historyModel.addObserver(managerBridge);
+				historyView.setVisible(true);
+				}
+			} else {
+				historyView.setVisible(true);
 			}
 		}
 	}
@@ -1222,18 +1226,21 @@
 		public void actionPerformed(ActionEvent actionEvent) {
 			System.out.println(&quot;Whole history&quot;);
 
-			wholeHistoryModel = new History(model.getDatabase());
-			if (wholeHistoryModel.isError()) {
-				//TODO: zjistit nejdrive o jakou chybu jde
-				JOptionPane.showMessageDialog(view, wholeHistoryModel.getError(), L10n.getString(&quot;Error.HistorySearchTitle&quot;),
-						JOptionPane.WARNING_MESSAGE);				
-				logger.error(&quot;&quot;);
-			} else {			
-				wholeHistoryView = new WholeHistoryView(wholeHistoryModel, view,
-						true);
-				wholeHistoryCtrl = new WholeHistoryCtrl(wholeHistoryModel,
-						wholeHistoryView);
-				wholeHistoryModel.addObserver(managerBridge);
+			if (wholeHistoryModel == null) {
+				wholeHistoryModel = new History(model.getDatabase());
+				if (wholeHistoryModel.isError()) {
+					//TODO: zjistit presneji o jakou chybu jde
+					JOptionPane.showMessageDialog(view, wholeHistoryModel.getError(), L10n.getString(&quot;Error.HistoryCreateDialog&quot;),
+							JOptionPane.WARNING_MESSAGE);									
+				} else {			
+					wholeHistoryView = new WholeHistoryView(wholeHistoryModel, view,
+							true);
+					wholeHistoryCtrl = new WholeHistoryCtrl(wholeHistoryModel,
+							wholeHistoryView);
+					wholeHistoryModel.addObserver(managerBridge);
+					wholeHistoryView.setVisible(true);
+				}
+			} else {
 				wholeHistoryView.setVisible(true);
 			}
 		}
@@ -1252,13 +1259,22 @@
 		public void actionPerformed(ActionEvent actionEvent) {
 			System.out.println(&quot;Metadata Manager&quot;);
 
-			metadataManagerModel = new MetadataManager(model.getDatabase());
-			metadataManagerView = new MetadataManagerView(metadataManagerModel,
-					view, true);
-			metadataManagerCtrl = new MetadataManagerCtrl(metadataManagerModel,
-					metadataManagerView);
-			metadataManagerModel.addObserver(managerBridge);
-			metadataManagerView.setVisible(true);
+			if (metadataManagerModel == null) {
+				metadataManagerModel = new MetadataManager(model.getDatabase());
+				if (metadataManagerModel.isError()) {
+					JOptionPane.showMessageDialog(view, metadataManagerModel.getError(), L10n.getString(&quot;Error.MetadataCreateDialog&quot;),
+							JOptionPane.WARNING_MESSAGE);									
+				} else {					
+					metadataManagerView = new MetadataManagerView(metadataManagerModel,
+							view, true);
+					metadataManagerCtrl = new MetadataManagerCtrl(metadataManagerModel,
+							metadataManagerView);
+					metadataManagerModel.addObserver(managerBridge);
+					metadataManagerView.setVisible(true);
+				}
+			} else {
+				metadataManagerView.setVisible(true);
+			}
 		}
 	}
 

Modified: trunk/src/net/sf/plantlore/client/history/History.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/History.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/history/History.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -113,8 +113,7 @@
     private Object data;        
     private HistoryRecord historyRecord;
     private HistoryChange historyChange;
-         
-    /** */    
+                
     private Hashtable&lt;String, Integer&gt; authorsOccurrenceHash;
     private Hashtable&lt;String, Integer&gt; occurrenceHash; 
     private Hashtable&lt;String, Integer&gt; authorHash;
@@ -369,7 +368,7 @@
              		objectHistory = database.more(this.resultId, 0, to-1);  
              	} catch(RemoteException e) {
              		logger.error(&quot;Remote exception caught in History (processResult). Details: &quot;+e.getMessage());
-        			setError(ERROR_SEARCH_DATA);
+        			setError(ERROR_PROCESS);
         			setChanged();
                     notifyObservers();
                  	return;                                                                                       
@@ -2145,16 +2144,16 @@
 	} 
 	
 	/**
-	 * Get information about current display rows
-	 * @return information about current display rows
+	 * Get information about current display rows (from - to)
+	 * @return information about current display rows (from - to)
 	 */
 	public String getCurrentDisplayRows() {
 		  return this.displayRow;		  
 	  }
 	
 	/**
-	 * Set information about current display rows
-	 * @param displayRow information about current display rows
+	 * Set information about current display rows (from - to)
+	 * @param displayRow information about current display rows (from - to)
 	 */
 	public void setCurrentDisplayRows(String displayRow) {
 	         this.displayRow = displayRow;		  

Modified: trunk/src/net/sf/plantlore/client/history/HistoryCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/HistoryCtrl.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/history/HistoryCtrl.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -3,10 +3,10 @@
 
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
+import java.awt.event.KeyEvent;
+import java.awt.event.KeyListener;
 import java.rmi.RemoteException;
-
 import javax.swing.JOptionPane;
-
 import net.sf.plantlore.common.ProgressBar;
 import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.exception.DBLayerException;
@@ -42,34 +42,46 @@
         this.model = model;        
         this.view = view;
              
-        //Add action listeners to buttons
-        view.okButton.addActionListener(new okButtonListener());
-        view.closeButton.addActionListener(new closeButtonListener());
+        //Add action listeners to buttons        
+        view.closeButton.addActionListener(new closeButtonListener());        
         view.previousButton.addActionListener(new previousButtonListener());
         view.nextButton.addActionListener(new nextButtonListener());
         view.selectAllButton.addActionListener(new selectAllButtonListener());
         view.unselectAllButton.addActionListener(new unselectAllButtonListener());
         view.undoButton.addActionListener(new undoSelectedButtonListener());
-        view.toDisplayValueTextField.addActionListener(new rowSetDisplayChangeListener());           
+        view.toDisplayValueTextField.addActionListener(new rowSetDisplayChangeListener());
+        //Add key listeners
+        view.closeButton.addKeyListener(new escapeKeyPressed());
+        view.previousButton.addKeyListener(new escapeKeyPressed());
+        view.nextButton.addKeyListener(new escapeKeyPressed());
+        view.selectAllButton.addKeyListener(new escapeKeyPressed());
+        view.unselectAllButton.addKeyListener(new escapeKeyPressed());
+        view.undoButton.addKeyListener(new escapeKeyPressed());
+        view.toDisplayValueTextField.addKeyListener(new escapeKeyPressed());
+        view.helpButton.addKeyListener(new escapeKeyPressed());
+        view.getTable().addKeyListener(new escapeKeyPressed());
     }
     
-   /** 
-    * ActionListener class controlling the &lt;b&gt;OK&lt;/b&gt; button on the form.
-    * On Ok makes the model store() the preferences and hides the view.     
-    */
-   class okButtonListener implements ActionListener {
-       public void actionPerformed(ActionEvent actionEvent)
-       {       
-           view.close();           
-       }
-   }
-  
-   /**
+    /**     
+     * KeyListener class controlling the pressing key ESCAPE.
+     * On key ESCAPE hides the view.     
+     */
+    public class escapeKeyPressed implements KeyListener {
+    	 	 public void keyPressed(KeyEvent evt){
+    	 		if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) {
+    	 			view.close();
+    	 		}    	 		     	 		 
+    	 	 }
+    	      public void keyReleased(KeyEvent evt) {}    	     
+    	      public void keyTyped(KeyEvent evt) {}    	         
+    }
+    
+    /**
     * ActionListener class controlling the &lt;b&gt;CLOSE&lt;/b&gt; button on the form.
     * On Close hides the view.
     */
    class closeButtonListener implements ActionListener {
-       public void actionPerformed(ActionEvent actionEvent)
+	    public void actionPerformed(ActionEvent actionEvent)
        {
     	   view.close();
        }
@@ -206,19 +218,18 @@
            model.undoSelected();  
            // Check whether an error flag after processing selected records is set
            if (!model.isError()) {
-        	   int okCancle = view.messageUndo(model.getMessageUndo());
-               logger.debug(&quot;button &quot;+okCancle);
+        	   int okCancle = view.messageUndo(model.getMessageUndo());               
                if (okCancle == 0){
             	   //Button OK was press
             	   logger.debug(&quot;Button OK was press.&quot;);
             	   Task task = model.commitUpdate(model.getResultRows(), true);  
             	   
             	   ProgressBar progressBar = new ProgressBar(task, view, true) {		   				
-						private static final long serialVersionUID = -6065695152319199854L;
+					  private static final long serialVersionUID = 1967781832827332268L;
 							public void exceptionHandler(Exception e) {
 		   						if (e instanceof DBLayerException) {	   									   							
 		   							DBLayerException dbex = (DBLayerException) e;		   							
-									JOptionPane.showMessageDialog(view, L10n.getString(&quot;Error.HistoryDBLayerException&quot;)+ &quot;\n&quot; + dbex.getErrorInfo(),
+									JOptionPane.showMessageDialog(view, L10n.getString(&quot;Error.HistoryDBLayerException&quot;)+ &quot;\n&quot; + dbex.getMessage(),
 		 							   L10n.getString(&quot;Error.HistoryDBLayerExceptionTitle&quot;), JOptionPane.WARNING_MESSAGE);																						
 									logger.error(dbex + &quot;: &quot; + dbex.getErrorInfo());
 		   							getTask().stop();
@@ -280,16 +291,14 @@
            if (view.getDisplayRows() &lt; 1) {
                view.setDisplayRows(oldValue);
                return;
-           }
-           if (view.getDisplayRows() &gt; model.getResultRows()){
-        	   view.setDisplayRows(model.getResultRows());
-           }            
+           }           
            // Set new value in the model
            model.setDisplayRows(view.getDisplayRows());
            logger.debug(&quot;New display rows: &quot;+view.getDisplayRows());
            // If neccessary reload search results
-           if ((oldValue != view.getDisplayRows()) &amp;&amp; (model.getDisplayRows() &lt;= model.getResultRows())) {
-               model.processResult(model.getCurrentFirstRow(), view.getDisplayRows());
+           if (oldValue != view.getDisplayRows()) {
+               logger.debug(&quot;OK&quot;+ model.getCurrentFirstRow() + &quot; &quot; + view.getDisplayRows());
+        	   model.processResult(model.getCurrentFirstRow(), view.getDisplayRows());
                if (model.isError()) return;
                view.getTable().setModel(new HistoryTableModel(model));
                int from = model.getCurrentFirstRow();

Modified: trunk/src/net/sf/plantlore/client/history/HistoryView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/history/HistoryView.form	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/history/HistoryView.form	2006-08-03 08:49:39 UTC (rev 483)
@@ -22,9 +22,7 @@
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                   &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Component id=&quot;helpButton&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace pref=&quot;472&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Component id=&quot;okButton&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;538&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;closeButton&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;EmptySpace min=&quot;-2&quot; pref=&quot;30&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
@@ -53,7 +51,6 @@
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                   &lt;Component id=&quot;helpButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Component id=&quot;closeButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;okButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
               &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
@@ -82,13 +79,13 @@
                       &lt;Component id=&quot;locationLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;taxonLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace pref=&quot;57&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace pref=&quot;274&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Component id=&quot;taxonValueLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;authorValueLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;locationValueLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace pref=&quot;10&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace pref=&quot;228&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
@@ -192,7 +189,7 @@
                       &lt;Component id=&quot;whenInsertValueLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;whoInsertValueLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace pref=&quot;10&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace pref=&quot;462&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
@@ -464,15 +461,5 @@
         &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
       &lt;/AuxValues&gt;
     &lt;/Component&gt;
-    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;okButton&quot;&gt;
-      &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
-          &lt;Connection code=&quot;L10n.getString(&quot;History.ButtonOk&quot;)&quot; type=&quot;code&quot;/&gt;
-        &lt;/Property&gt;
-      &lt;/Properties&gt;
-      &lt;AuxValues&gt;
-        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
-      &lt;/AuxValues&gt;
-    &lt;/Component&gt;
   &lt;/SubComponents&gt;
 &lt;/Form&gt;

Modified: trunk/src/net/sf/plantlore/client/history/HistoryView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/HistoryView.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/history/HistoryView.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -40,8 +40,9 @@
         this.model = model;
         // Register observer
         model.addObserver(this);
-        setDefaultCloseOperation(JDialog.HIDE_ON_CLOSE);
+        setDefaultCloseOperation(JDialog.HIDE_ON_CLOSE);        
         initComponents();
+        getRootPane().setDefaultButton(closeButton);        
         //Init Help
         PlantloreHelp.addKeyHelp(PlantloreHelp.HISTORY_MANAGER, this.getRootPane());
         PlantloreHelp.addButtonHelp(PlantloreHelp.HISTORY_MANAGER, this.helpButton);        
@@ -99,7 +100,6 @@
         displayedValueLabel = new javax.swing.JLabel();
         helpButton = new javax.swing.JButton();
         closeButton = new javax.swing.JButton();
-        okButton = new javax.swing.JButton();
 
         setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
         jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(L10n.getString(&quot;History.DetailsRecordPanel&quot;)));
@@ -123,17 +123,17 @@
         jPanel1Layout.setHorizontalGroup(
             jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(jPanel1Layout.createSequentialGroup()
-                .add(20, 20, 20)
+                .add(19, 19, 19)
                 .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(authorLabel)
                     .add(locationLabel)
                     .add(taxonLabel))
-                .add(39, 39, 39)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 274, Short.MAX_VALUE)
                 .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(taxonValueLabel)
                     .add(authorValueLabel)
                     .add(locationValueLabel))
-                .addContainerGap(10, Short.MAX_VALUE))
+                .addContainerGap(228, Short.MAX_VALUE))
         );
         jPanel1Layout.setVerticalGroup(
             jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -175,7 +175,7 @@
                 .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(whenInsertValueLabel)
                     .add(whoInsertValueLabel))
-                .addContainerGap(10, Short.MAX_VALUE))
+                .addContainerGap(462, Short.MAX_VALUE))
         );
         jPanel2Layout.setVerticalGroup(
             jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -234,7 +234,7 @@
             .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel3Layout.createSequentialGroup()
                 .addContainerGap()
                 .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
-                    .add(org.jdesktop.layout.GroupLayout.LEADING, jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 688, Short.MAX_VALUE)
+                    .add(org.jdesktop.layout.GroupLayout.LEADING, jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 642, Short.MAX_VALUE)
                     .add(jPanel3Layout.createSequentialGroup()
                         .add(undoButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 90, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
@@ -255,7 +255,7 @@
                         .add(displayedLabel)
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(displayedValueLabel)
-                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 50, Short.MAX_VALUE)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                         .add(nextButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                 .addContainerGap())
         );
@@ -285,8 +285,6 @@
 
         closeButton.setText(L10n.getString(&quot;History.ButtonClose&quot;));
 
-        okButton.setText(L10n.getString(&quot;History.ButtonOk&quot;));
-
         org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
         getContentPane().setLayout(layout);
         layout.setHorizontalGroup(
@@ -296,9 +294,7 @@
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(layout.createSequentialGroup()
                         .add(helpButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 518, Short.MAX_VALUE)
-                        .add(okButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 538, Short.MAX_VALUE)
                         .add(closeButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                         .add(30, 30, 30))
                     .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
@@ -320,15 +316,14 @@
                 .add(14, 14, 14)
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(helpButton)
-                    .add(closeButton)
-                    .add(okButton))
+                    .add(closeButton))
                 .addContainerGap())
         );
         pack();
     }// &lt;/editor-fold&gt;//GEN-END:initComponents
     
        
-        /**
+    /**
      *  Display generic error message.
      *  @param message Message we want to display
      */
@@ -421,7 +416,6 @@
     private javax.swing.JLabel locationLabel;
     private javax.swing.JLabel locationValueLabel;
     protected javax.swing.JButton nextButton;
-    protected javax.swing.JButton okButton;
     protected javax.swing.JButton previousButton;
     protected javax.swing.JButton selectAllButton;
     private javax.swing.JTable tableEditList;

Modified: trunk/src/net/sf/plantlore/client/history/WholeHistoryCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/WholeHistoryCtrl.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/history/WholeHistoryCtrl.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -11,10 +11,13 @@
 
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
+import java.awt.event.KeyEvent;
+import java.awt.event.KeyListener;
 import java.rmi.RemoteException;
 
 import javax.swing.JOptionPane;
 
+import net.sf.plantlore.client.history.HistoryCtrl.escapeKeyPressed;
 import net.sf.plantlore.common.ProgressBar;
 import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.exception.DBLayerException;
@@ -48,8 +51,7 @@
         this.model = model;
         this.view = view;
           
-        // Add action listeners to buttons
-        view.okButton.addActionListener(new okButtonListener());
+        // Add action listeners to buttons        
         view.closeButton.addActionListener(new closeButtonListener());
         view.previousButton.addActionListener(new previousButtonListener());
         view.nextButton.addActionListener(new nextButtonListener());     
@@ -57,19 +59,32 @@
         view.detailsButton.addActionListener(new detailsHistoryListener());
         view.toDisplayValueTextField.addActionListener(new rowSetDisplayChangeListener()); 
         view.clearHistoryButton.addActionListener(new clearHistoryListener());
+        // Add key listeners
+        view.closeButton.addKeyListener(new escapeKeyPressed());
+        view.previousButton.addKeyListener(new escapeKeyPressed());
+        view.nextButton.addKeyListener(new escapeKeyPressed());
+        view.undoToDateButton.addKeyListener(new escapeKeyPressed());
+        view.toDisplayValueTextField.addKeyListener(new escapeKeyPressed());
+        view.helpButton.addKeyListener(new escapeKeyPressed());
+        view.tableHistoryList.addKeyListener(new escapeKeyPressed());
+        view.clearHistoryButton.addKeyListener(new escapeKeyPressed());
+        view.detailsButton.addKeyListener(new escapeKeyPressed());
     }
     
-    /** 
-     * ActionListener class controlling the &lt;b&gt;OK&lt;/b&gt; button on the form.
-     * On Ok makes the model store() the preferences and hides the view.     
-     */  
-   class okButtonListener implements ActionListener {
-       public void actionPerformed(ActionEvent actionEvent)
-       {       
-           view.close();           
-       }
-   }
-  
+    /**     
+     * KeyListener class controlling the pressing key ESCAPE.
+     * On key ESCAPE hides the view.     
+     */
+    public class escapeKeyPressed implements KeyListener {
+    	 	 public void keyPressed(KeyEvent evt){
+    	 		if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) {
+    	 			view.close();
+    	 		}    	 		     	 		 
+    	 	 }
+    	      public void keyReleased(KeyEvent evt) {}    	     
+    	      public void keyTyped(KeyEvent evt) {}    	         
+    }
+    
    /**
     * ActionListener class controlling the &lt;b&gt;CLOSE&lt;/b&gt; button on the form.
     * On Close hides the view.
@@ -176,15 +191,12 @@
            if (view.getDisplayRows() &lt; 1) {
                view.setDisplayRows(oldValue);
                return;
-           }
-           if (view.getDisplayRows() &gt; model.getResultRows()){
-        	   view.setDisplayRows(model.getResultRows());
-           }            
+           }          
            // Set new value in the model
            model.setDisplayRows(view.getDisplayRows());
            logger.debug(&quot;New display rows: &quot;+view.getDisplayRows());
            // If neccessary reload search results
-           if ((oldValue != view.getDisplayRows()) &amp;&amp; (model.getDisplayRows() &lt;= model.getResultRows())) {
+           if (oldValue != view.getDisplayRows()) {
                model.processResult(model.getCurrentFirstRow(), view.getDisplayRows());
                if (model.isError()) return;
                view.tableHistoryList.setModel(new HistoryTableModel(model));
@@ -236,8 +248,8 @@
 	                   logger.debug(&quot;Button OK was press.&quot;);    
 	                   Task task = model.commitUpdate(toResult, false);
 	                   
-	                   ProgressBar progressBar = new ProgressBar(task, view, true) {		   				
-						private static final long serialVersionUID = -6065695152319199854L;
+	                   ProgressBar progressBar = new ProgressBar(task, view, true) {		   										
+						  private static final long serialVersionUID = -6065695152319199854L;
 							public void exceptionHandler(Exception e) {
 		   						if (e instanceof DBLayerException) {	   									   							
 		   							DBLayerException dbex = (DBLayerException) e;

Modified: trunk/src/net/sf/plantlore/client/history/WholeHistoryView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/history/WholeHistoryView.form	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/history/WholeHistoryView.form	2006-08-03 08:49:39 UTC (rev 483)
@@ -25,9 +25,7 @@
           &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;EmptySpace min=&quot;-2&quot; pref=&quot;30&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Component id=&quot;helpButton&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace pref=&quot;565&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;okButton&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace pref=&quot;631&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
               &lt;Component id=&quot;closeButton&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;EmptySpace min=&quot;-2&quot; pref=&quot;27&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
@@ -42,7 +40,6 @@
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                   &lt;Component id=&quot;helpButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Component id=&quot;closeButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;okButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
               &lt;EmptySpace min=&quot;-2&quot; pref=&quot;20&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
@@ -277,15 +274,5 @@
         &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
       &lt;/AuxValues&gt;
     &lt;/Component&gt;
-    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;okButton&quot;&gt;
-      &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
-          &lt;Connection code=&quot;L10n.getString(&quot;History.ButtonOk&quot;)&quot; type=&quot;code&quot;/&gt;
-        &lt;/Property&gt;
-      &lt;/Properties&gt;
-      &lt;AuxValues&gt;
-        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
-      &lt;/AuxValues&gt;
-    &lt;/Component&gt;
   &lt;/SubComponents&gt;
 &lt;/Form&gt;

Modified: trunk/src/net/sf/plantlore/client/history/WholeHistoryView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/WholeHistoryView.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/history/WholeHistoryView.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -40,8 +40,7 @@
         model.addObserver(this);
         setDefaultCloseOperation(JDialog.HIDE_ON_CLOSE);
         initComponents();        
-        getRootPane().setDefaultButton(okButton);    
-        //TODO doresit ENTER
+        getRootPane().setDefaultButton(closeButton);            
         // Init Help
         PlantloreHelp.addKeyHelp(PlantloreHelp.HISTORY_MANAGER, this.getRootPane());
         PlantloreHelp.addButtonHelp(PlantloreHelp.HISTORY_MANAGER, this.helpButton);        
@@ -89,7 +88,6 @@
         displayedValueLabel = new javax.swing.JLabel();
         helpButton = new javax.swing.JButton();
         closeButton = new javax.swing.JButton();
-        okButton = new javax.swing.JButton();
 
         setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
         jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(L10n.getString(&quot;History.Whole.Panel&quot;)));
@@ -189,8 +187,6 @@
 
         closeButton.setText(L10n.getString(&quot;History.ButtonClose&quot;));
 
-        okButton.setText(L10n.getString(&quot;History.ButtonOk&quot;));
-
         org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
         getContentPane().setLayout(layout);
         layout.setHorizontalGroup(
@@ -202,9 +198,7 @@
             .add(layout.createSequentialGroup()
                 .add(30, 30, 30)
                 .add(helpButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 565, Short.MAX_VALUE)
-                .add(okButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 631, Short.MAX_VALUE)
                 .add(closeButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                 .add(27, 27, 27))
         );
@@ -216,8 +210,7 @@
                 .add(15, 15, 15)
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(helpButton)
-                    .add(closeButton)
-                    .add(okButton))
+                    .add(closeButton))
                 .add(20, 20, 20))
         );
         pack();
@@ -304,7 +297,6 @@
     private javax.swing.JPanel jPanel1;
     private javax.swing.JScrollPane jScrollPane1;
     protected javax.swing.JButton nextButton;
-    protected javax.swing.JButton okButton;
     protected javax.swing.JButton previousButton;
     protected javax.swing.JTable tableHistoryList;
     private javax.swing.JLabel toDisplayLabel;

Modified: trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataCtrl.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataCtrl.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -11,56 +11,107 @@
 
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
+import java.awt.event.KeyEvent;
+import java.awt.event.KeyListener;
 import java.util.Date;
-import net.sf.plantlore.common.PlantloreHelp;
+
+import net.sf.plantlore.client.history.WholeHistoryCtrl.escapeKeyPressed;
 import net.sf.plantlore.common.record.Metadata;
 import org.apache.log4j.Logger;
 
 /**
+ * Controller for the Add/Edit metadata dialog in the MetadataManager MVC.
  *
- * @author Lada
+ * @author Lada Oberreiterova
+ * @version 1.0
  */
 public class AddEditMetadataCtrl {
         
+	/** Instance of a logger */
     private Logger logger;
+    /** Model of MetadataManager MVC */
     private MetadataManager model;
+    /** View of AddEditMetadata */ 
     private AddEditMetadataView view;
     
-    /** Creates a new instance of AddEditMetadataCtrl */
+    /** 
+     * Creates a new instance of AddEditMetadataCtrl
+     * @param view View of AddEditMetadata
+     * @param model Model of MetadataManager MVC
+     */ 
     public AddEditMetadataCtrl(AddEditMetadataView view, MetadataManager model) {
         
         logger = Logger.getLogger(this.getClass().getPackage().getName());        
         this.model = model;
         this.view = view;
         
+        // Add action listener
         view.closeButton.addActionListener(new closeButtonListener());
         view.operationButton.addActionListener(new operationButtonListener());
+        // Add key listener
+        view.closeButton.addKeyListener(new escapeKeyPressed());
+        view.operationButton.addKeyListener(new escapeKeyPressed());
+        view.technicalContactNameText.addKeyListener(new escapeKeyPressed());
+        view.technicalContactEmailText.addKeyListener(new escapeKeyPressed());
+        view.technicalContactAddressText.addKeyListener(new escapeKeyPressed());
+        view.contentContactNameText.addKeyListener(new escapeKeyPressed());
+        view.contentContactEmailText.addKeyListener(new escapeKeyPressed());
+        view.contectContactAddressText.addKeyListener(new escapeKeyPressed());
+        view.dataSetTitleText.addKeyListener(new escapeKeyPressed());
+        view.dataSetDetailsText.addKeyListener(new escapeKeyPressed());
+        view.sourceInstirutionIdText.addKeyListener(new escapeKeyPressed());
+        view.sourceIdText.addKeyListener(new escapeKeyPressed());
+        view.abbrevText.addKeyListener(new escapeKeyPressed());
+        view.recordbasisText.addKeyListener(new escapeKeyPressed());
+        view.biotopetextText.addKeyListener(new escapeKeyPressed());
+        view.createDateChooser.addKeyListener(new escapeKeyPressed());
+        view.helpButton.addKeyListener(new escapeKeyPressed());
+      }
+    
+    /**     
+     * KeyListener class controlling the pressing key ESCAPE.
+     * On key ESCAPE hides the view.     
+     */
+    public class escapeKeyPressed implements KeyListener {
+    	 	 public void keyPressed(KeyEvent evt){
+    	 		if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) {
+    	 			view.close();
+    	 		}    	 		     	 		 
+    	 	 }
+    	      public void keyReleased(KeyEvent evt) {}    	     
+    	      public void keyTyped(KeyEvent evt) {}    	         
     }
     
    /**
-    * On Cancel just hides the view.
-    *
+    * ActionListener class controlling the &lt;b&gt;CLOSE&lt;/b&gt; button on the form.
+    * On Close hides the view.
     */
    class closeButtonListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
        {
+    	   model.setUsedClose(true);
     	   view.close();
        }
    }
      
-   /*
-    *
+   /**
+    * ActionListener class controlling the &lt;b&gt;ADD&lt;/b&gt;, &lt;b&gt;EDIT&lt;/b&gt; and &lt;b&gt;OK&lt;/b&gt; buttons on the form.   
     */
    class operationButtonListener implements ActionListener {
         public void actionPerformed(ActionEvent actionEvent)
        {    	  
-    	   // zeptame se modelu, co je treba provest za akci DETEIL, ADD, EDIT
-            logger.debug(model.getOperation());
+    	   // Get information about operation - ADD, EDIT, DETAILS
+           logger.debug(&quot;Operation &quot; + model.getOperation() + &quot;was called&quot;);
            if (model.getOperation().equals(&quot;ADD&quot;)) {
                logger.debug(&quot;Add of Metadata.&quot;);
-               //otestovani, zda jsou vyplneny povinne polozky
+               //check wether all obligatory fields were filled 
                 if (view.checkNotNull()) {
-                    //vytvorime novy rekord a ulozime do nej nactene hodnoty
+                        //Check if new name of project (dataSetTitle) already exist
+                	if (!model.uniqueDatasetTitle(view.dataSetTitleText.getText())){                		
+                		view.showErrorMessage(MetadataManager.ERROR_TITLE, MetadataManager.ERROR_DATASETTITLE);
+                		return;
+                	}
+                    //create new instance of Metadata and save filed values
                     Metadata metadata = new Metadata();
                     metadata.setTechnicalContactName(view.technicalContactNameText.getText());
                     metadata.setTechnicalContactEmail(view.technicalContactEmailText.getText());
@@ -77,43 +128,37 @@
                     metadata.setDateModified(new Date());                                               
                     metadata.setRecordBasis(view.recordbasisText.getText());
                     metadata.setBiotopeText(view.biotopetextText.getText());
-                    metadata.setDeleted(0);
-                    //metadata.setVersionPlantsFile(Integer.parseInt(view.versionPlantsFileText.getText())); 
-                    //mela by se tu vypsat nejaka informace pro uzivatele
-                    //pridani metadat
-                    model.addMetedataRecord(metadata);                                                           
-                    view.close(); 
+                    metadata.setDeleted(0);                   
+                    //Save new Metadata into model
+                    model.setNewMetadataRecord(metadata);
+                    view.close();    
                 }
            } else if (model.getOperation().equals(&quot;EDIT&quot;)) {  
                logger.debug(&quot;Edit of Metadata.&quot;);
-                //otestovani, zda jsou vyplneny povinne polozky
+                //check wether all obligatory fields were filled 
                 if (view.checkNotNull()) {
-                    //nacteni hodnot
-                    model.getSelectedRecord().setTechnicalContactName(view.technicalContactNameText.getText());
-                    model.getSelectedRecord().setTechnicalContactEmail(view.technicalContactEmailText.getText());
-                    model.getSelectedRecord().setTechnicalContactAddress(view.technicalContactAddressText.getText());
-                    model.getSelectedRecord().setContentContactName(view.contentContactNameText.getText());
-                    model.getSelectedRecord().setContentContactEmail(view.contentContactEmailText.getText());
-                    model.getSelectedRecord().setContentContactAddress(view.contectContactAddressText.getText());
-                    model.getSelectedRecord().setDataSetTitle(view.dataSetTitleText.getText());
-                    model.getSelectedRecord().setDataSetDetails(view.dataSetDetailsText.getText());
-                    model.getSelectedRecord().setSourceInstitutionId(view.sourceInstirutionIdText.getText());
-                    model.getSelectedRecord().setSourceId(view.sourceIdText.getText());
-                    model.getSelectedRecord().setOwnerOrganizationAbbrev(view.abbrevText.getText());
-                    model.getSelectedRecord().setRecordBasis(view.recordbasisText.getText());
-                    model.getSelectedRecord().setBiotopeText(view.biotopetextText.getText());
-                    model.getSelectedRecord().setDeleted(0);
-                   // model.getSelectedRecord().setVersionPlantsFile(Integer.parseInt(view.versionPlantsFileText.getText()));                
-                   //mela by se tu vypsat nejaka informace pro uzivatele
-                   //editace vybraneho zaznamu
-                   model.editMetadataRecord(); 
-                   view.close(); 
+                    //load data
+                    model.getMetadataRecord().setTechnicalContactName(view.technicalContactNameText.getText());
+                    model.getMetadataRecord().setTechnicalContactEmail(view.technicalContactEmailText.getText());
+                    model.getMetadataRecord().setTechnicalContactAddress(view.technicalContactAddressText.getText());
+                    model.getMetadataRecord().setContentContactName(view.contentContactNameText.getText());
+                    model.getMetadataRecord().setContentContactEmail(view.contentContactEmailText.getText());
+                    model.getMetadataRecord().setContentContactAddress(view.contectContactAddressText.getText());
+                    model.getMetadataRecord().setDataSetTitle(view.dataSetTitleText.getText());
+                    model.getMetadataRecord().setDataSetDetails(view.dataSetDetailsText.getText());
+                    model.getMetadataRecord().setSourceInstitutionId(view.sourceInstirutionIdText.getText());
+                    model.getMetadataRecord().setSourceId(view.sourceIdText.getText());
+                    model.getMetadataRecord().setOwnerOrganizationAbbrev(view.abbrevText.getText());
+                    model.getMetadataRecord().setRecordBasis(view.recordbasisText.getText());
+                    model.getMetadataRecord().setBiotopeText(view.biotopetextText.getText());
+                    model.getMetadataRecord().setDeleted(0);                 
+                    view.close(); 
                 }
            } else if (model.getOperation().equals(&quot;DETAILS&quot;)) {
                 logger.debug(&quot;Details of Metadata.&quot;);
                 view.close();
            } else {
-               logger.error(&quot;MetadataManager - Incorect operation. Some from ADD, EDIT, DETAILS is excepted.&quot;);
+               logger.error(&quot;MetadataManager - Incorect operation. Some operation ADD, EDIT, DETAILS is excepted.&quot;);
            }           
         }
    }

Modified: trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.form	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.form	2006-08-03 08:49:39 UTC (rev 483)
@@ -18,33 +18,33 @@
     &lt;DimensionLayout dim=&quot;0&quot;&gt;
       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
           &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                  &lt;Component id=&quot;jPanel1&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;jPanel1&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;1&quot;&gt;
                       &lt;Component id=&quot;helpButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;360&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;operationButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;closeButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
               &lt;/Group&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
       &lt;/Group&gt;
     &lt;/DimensionLayout&gt;
     &lt;DimensionLayout dim=&quot;1&quot;&gt;
       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
           &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;jPanel1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;jPanel1&quot; pref=&quot;525&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                   &lt;Component id=&quot;helpButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Component id=&quot;closeButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Component id=&quot;operationButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
-              &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
       &lt;/Group&gt;
     &lt;/DimensionLayout&gt;
@@ -65,21 +65,21 @@
         &lt;DimensionLayout dim=&quot;0&quot;&gt;
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                      &lt;Component id=&quot;jPanel4&quot; alignment=&quot;0&quot; pref=&quot;636&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;jPanel4&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                       &lt;Component id=&quot;jPanel5&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
         &lt;DimensionLayout dim=&quot;1&quot;&gt;
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                  &lt;Component id=&quot;jPanel4&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;jPanel5&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;jPanel4&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;jPanel5&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
@@ -107,17 +107,18 @@
                                   &lt;Component id=&quot;sourceInstitutionIdLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;abbrevLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;/Group&gt;
-                              &lt;EmptySpace min=&quot;-2&quot; pref=&quot;63&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                                  &lt;Component id=&quot;abbrevText&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                                  &lt;Component id=&quot;sourceInstirutionIdText&quot; alignment=&quot;1&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                              &lt;EmptySpace min=&quot;-2&quot; pref=&quot;21&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                                  &lt;Component id=&quot;abbrevText&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                                  &lt;Component id=&quot;sourceInstirutionIdText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                               &lt;/Group&gt;
+                              &lt;EmptySpace min=&quot;-2&quot; pref=&quot;335&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
                           &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                               &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Component id=&quot;jPanel2&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;jPanel2&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                               &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Component id=&quot;jPanel3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;jPanel3&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                           &lt;/Group&gt;
                       &lt;/Group&gt;
                       &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -139,10 +140,10 @@
                       &lt;/Group&gt;
                       &lt;EmptySpace min=&quot;-2&quot; pref=&quot;19&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                          &lt;Component id=&quot;jPanel2&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;2&quot;/&gt;
-                          &lt;Component id=&quot;jPanel3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;2&quot;/&gt;
+                          &lt;Component id=&quot;jPanel2&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                          &lt;Component id=&quot;jPanel3&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                       &lt;/Group&gt;
-                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;
@@ -170,12 +171,12 @@
                               &lt;Component id=&quot;technicalContactNameLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
                           &lt;EmptySpace min=&quot;-2&quot; pref=&quot;23&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                              &lt;Component id=&quot;technicalContactAddressText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;3&quot;/&gt;
-                              &lt;Component id=&quot;technicalContactNameText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;3&quot;/&gt;
-                              &lt;Component id=&quot;technicalContactEmailText&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;3&quot;/&gt;
+                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;technicalContactAddressText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;technicalContactNameText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;technicalContactEmailText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
                 &lt;/DimensionLayout&gt;
@@ -256,19 +257,19 @@
                 &lt;DimensionLayout dim=&quot;0&quot;&gt;
                   &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
-                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                               &lt;Component id=&quot;contentContactNameLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;contentContactEmail&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;contectContactAddressLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                              &lt;Component id=&quot;contentContactNameText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;contentContactEmailText&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;contectContactAddressText&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;contentContactNameText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;contentContactEmailText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;contectContactAddressText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace pref=&quot;47&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; pref=&quot;47&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
                 &lt;/DimensionLayout&gt;
@@ -383,8 +384,8 @@
                               &lt;Component id=&quot;jPanel7&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
                           &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Component id=&quot;jPanel8&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;Component id=&quot;jPanel8&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                           &lt;/Group&gt;
                       &lt;/Group&gt;
                       &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -395,12 +396,12 @@
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                   &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                          &lt;Component id=&quot;jPanel6&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
-                          &lt;Component id=&quot;jPanel7&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
+                          &lt;Component id=&quot;jPanel6&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                          &lt;Component id=&quot;jPanel7&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
                       &lt;/Group&gt;
-                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Component id=&quot;jPanel8&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jPanel8&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;
@@ -426,12 +427,12 @@
                               &lt;Component id=&quot;sourceIdLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
                           &lt;EmptySpace min=&quot;-2&quot; pref=&quot;24&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                              &lt;Component id=&quot;sourceIdText&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;dataSetDetailsText&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;dataSetTitleText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;3&quot;/&gt;
+                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;sourceIdText&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;dataSetDetailsText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;dataSetTitleText&quot; alignment=&quot;0&quot; pref=&quot;165&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace pref=&quot;21&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; pref=&quot;21&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
                 &lt;/DimensionLayout&gt;
@@ -510,17 +511,17 @@
                 &lt;DimensionLayout dim=&quot;0&quot;&gt;
                   &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
-                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                               &lt;Component id=&quot;recordbasisLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;biotopetextLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
                           &lt;EmptySpace min=&quot;-2&quot; pref=&quot;14&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                              &lt;Component id=&quot;biotopetextText&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;recordbasisText&quot; alignment=&quot;0&quot; pref=&quot;146&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;biotopetextText&quot; pref=&quot;146&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;recordbasisText&quot; alignment=&quot;0&quot; pref=&quot;146&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace pref=&quot;66&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; pref=&quot;66&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
                 &lt;/DimensionLayout&gt;
@@ -582,27 +583,27 @@
                 &lt;DimensionLayout dim=&quot;0&quot;&gt;
                   &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
-                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                               &lt;Component id=&quot;dateCreateLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;dateModifiedLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
                           &lt;EmptySpace min=&quot;-2&quot; pref=&quot;63&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                              &lt;Component id=&quot;dateModifiedText&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;dateCreateText&quot; alignment=&quot;0&quot; pref=&quot;117&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;dateModifiedText&quot; pref=&quot;117&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;dateCreateText&quot; alignment=&quot;0&quot; pref=&quot;117&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                           &lt;/Group&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                               &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
                                   &lt;EmptySpace min=&quot;-2&quot; pref=&quot;25&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                                  &lt;Component id=&quot;createDateChooser&quot; min=&quot;-2&quot; pref=&quot;117&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;createDateChooser&quot; pref=&quot;117&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                               &lt;/Group&gt;
                               &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                                   &lt;EmptySpace min=&quot;-2&quot; pref=&quot;57&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;dateModifiedEmptyLable&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;/Group&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace pref=&quot;202&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; pref=&quot;202&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
                 &lt;/DimensionLayout&gt;

Modified: trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -10,6 +10,7 @@
 import java.util.Date;
 import java.util.Observable;
 import java.util.Observer;
+
 import javax.swing.JDialog;
 import javax.swing.JFormattedTextField;
 import javax.swing.JOptionPane;
@@ -18,8 +19,10 @@
 import net.sf.plantlore.l10n.L10n;
 
 /**
+ * View for the Add/Edit metadata dialog in the MetadataManager MVC.
  *
- * @author  Lada
+ * @author  Lada Oberreiterova
+ * @version 1.0
  */
 public class AddEditMetadataView extends javax.swing.JDialog  implements Observer {
     
@@ -28,11 +31,16 @@
     
     /**
      * Creates new form AddEditMetadataView
+     * @param model model of MetadataManager MVC     
+     * @param parent parent of this dialog
+     * @param modal boolean flag whether the dialog should be modal or not
      */
     public AddEditMetadataView(MetadataManager model, javax.swing.JDialog parent, boolean modal) {
         super(parent, modal);
         this.model = model;
+        setDefaultCloseOperation(JDialog.HIDE_ON_CLOSE);
         initComponents();        
+        //getRootPane().setDefaultButton(closeButton); 
         PlantloreHelp.addKeyHelp(PlantloreHelp.METDATA_ADD, this.getRootPane());
         PlantloreHelp.addButtonHelp(PlantloreHelp.METDATA_ADD, this.helpButton);        
     }
@@ -41,25 +49,32 @@
     {
     }
     
-     /*
-      * nastaveni formulare pro add
+     /**
+      * Set add form. 
       */
      public void setAddForm() {
-         operationButton.setText(&quot;MetadataManager.ButtonAdd&quot;);         
+         operationButton.setText(L10n.getString(&quot;MetadataManager.ButtonAdd&quot;));         
          dateCreateText.setVisible(false);
          dateModifiedText.setVisible(false);         
      }
      
+     /**
+      * Set edit form.      
+      */
       public void setEditForm() {
-         operationButton.setText(&quot;MetadataManager.ButtonEdit&quot;);
+         operationButton.setText(L10n.getString(&quot;MetadataManager.ButtonEdit&quot;));
          dateCreateText.setEditable(false);
          dateModifiedText.setEditable(false);
          dateModifiedEmptyLable.setVisible(false);
          createDateChooser.setVisible(false);
      }
      
+     /**
+      * Set details form.      
+      */ 
      public void setDetailsForm() {
-       operationButton.setText(&quot;MetadataManager.ButtonOk&quot;);
+       operationButton.setText(L10n.getString(&quot;MetadataManager.ButtonOk&quot;));
+       operationButton.setVisible(false);
        technicalContactNameText.setEditable(false);
        technicalContactEmailText.setEditable(false);
        technicalContactAddressText.setEditable(false);
@@ -80,11 +95,11 @@
      }
      
      /**
-      * Nacteni dat do dialogu pro DETAILs, EDIT
+      * Load data to edit or details dialog
       */     
      public void loadData() {
-           //nacteni dat do dialogu
-           Metadata metadata = model.getSelectedRecord();  
+           //load data
+           Metadata metadata = model.getMetadataRecord();  
            technicalContactNameText.setText(metadata.getTechnicalContactName());
            technicalContactEmailText.setText(metadata.getTechnicalContactEmail());
            technicalContactAddressText.setText(metadata.getTechnicalContactAddress());
@@ -97,23 +112,22 @@
            sourceIdText.setText(metadata.getSourceId());
            abbrevText.setText(metadata.getOwnerOrganizationAbbrev());
            dateCreateText.setValue(metadata.getDateCreate());
-           createDateChooser.setDate(new Date());
-           
+           createDateChooser.setDate(new Date());           
            dateModifiedText.setValue(metadata.getDateModified());
            recordbasisText.setText(metadata.getRecordBasis());
            biotopetextText.setText(metadata.getBiotopeText());            
-           //FIXME: vsechny Integery v DB nastavit defautlne na nulu,aby to pri prevodech na string nedelalo neplechu           
-     }
+        }
      
      /**
-     *
+     * Close this dialog.
      */
     public void close() {
         dispose();
     }
     
-    /*
-     *
+    /**
+     *  Check whether the given field is empty or not. This is used for validating user input when 
+     *  add or edit metadata.
      */
     public boolean checkNotNull() {
         if (this.sourceInstirutionIdText.getText().equals(&quot;&quot;)) {
@@ -138,6 +152,14 @@
         return true;
     }
     
+    /**
+     *  Display generic error message.
+     *  @param title title of error message
+     *  @param message error message we want to display
+     */
+    public void showErrorMessage(String title, String message) {
+        JOptionPane.showMessageDialog(this, message, title, JOptionPane.ERROR_MESSAGE);               
+    }
     
     /** This method is called from within the constructor to
      * initialize the form.
@@ -211,11 +233,11 @@
                     .add(technicalContactEmailLabel)
                     .add(technicalContactNameLabel))
                 .add(23, 23, 23)
-                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
+                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(technicalContactAddressText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE)
                     .add(technicalContactNameText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE)
-                    .add(technicalContactEmailText))
-                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                    .add(technicalContactEmailText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE))
+                .addContainerGap())
         );
         jPanel2Layout.setVerticalGroup(
             jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -253,11 +275,11 @@
                     .add(contentContactEmail)
                     .add(contectContactAddressLabel))
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
+                .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(contentContactNameText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE)
-                    .add(contentContactEmailText)
-                    .add(contectContactAddressText))
-                .addContainerGap(47, Short.MAX_VALUE))
+                    .add(contentContactEmailText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE)
+                    .add(contectContactAddressText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE))
+                .add(47, 47, 47))
         );
         jPanel3Layout.setVerticalGroup(
             jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -292,15 +314,16 @@
                         .add(jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                             .add(sourceInstitutionIdLabel)
                             .add(abbrevLabel))
-                        .add(63, 63, 63)
-                        .add(jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
-                            .add(abbrevText)
-                            .add(sourceInstirutionIdText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE)))
+                        .add(21, 21, 21)
+                        .add(jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                            .add(abbrevText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE)
+                            .add(sourceInstirutionIdText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE))
+                        .add(335, 335, 335))
                     .add(jPanel4Layout.createSequentialGroup()
                         .addContainerGap()
-                        .add(jPanel2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                        .add(jPanel2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                        .add(jPanel3, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
+                        .add(jPanel3, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                 .addContainerGap())
         );
         jPanel4Layout.setVerticalGroup(
@@ -316,8 +339,8 @@
                     .add(abbrevText, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                 .add(19, 19, 19)
                 .add(jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                    .add(jPanel2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                    .add(jPanel3, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                    .add(jPanel2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                    .add(jPanel3, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                 .addContainerGap())
         );
 
@@ -340,11 +363,11 @@
                     .add(dataSetDetailsLabel)
                     .add(sourceIdLabel))
                 .add(24, 24, 24)
-                .add(jPanel6Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
-                    .add(sourceIdText)
-                    .add(dataSetDetailsText)
+                .add(jPanel6Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                    .add(sourceIdText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE)
+                    .add(dataSetDetailsText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE)
                     .add(dataSetTitleText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE))
-                .addContainerGap(21, Short.MAX_VALUE))
+                .add(21, 21, 21))
         );
         jPanel6Layout.setVerticalGroup(
             jPanel6Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -379,10 +402,10 @@
                     .add(recordbasisLabel)
                     .add(biotopetextLabel))
                 .add(14, 14, 14)
-                .add(jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
-                    .add(biotopetextText)
+                .add(jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                    .add(biotopetextText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 146, Short.MAX_VALUE)
                     .add(recordbasisText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 146, Short.MAX_VALUE))
-                .addContainerGap(66, Short.MAX_VALUE))
+                .add(66, 66, 66))
         );
         jPanel7Layout.setVerticalGroup(
             jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -415,17 +438,17 @@
                     .add(dateCreateLabel)
                     .add(dateModifiedLabel))
                 .add(63, 63, 63)
-                .add(jPanel8Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
-                    .add(dateModifiedText)
+                .add(jPanel8Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                    .add(dateModifiedText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 117, Short.MAX_VALUE)
                     .add(dateCreateText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 117, Short.MAX_VALUE))
                 .add(jPanel8Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(jPanel8Layout.createSequentialGroup()
                         .add(25, 25, 25)
-                        .add(createDateChooser, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 117, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                        .add(createDateChooser, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 117, Short.MAX_VALUE))
                     .add(jPanel8Layout.createSequentialGroup()
                         .add(57, 57, 57)
                         .add(dateModifiedEmptyLable)))
-                .addContainerGap(202, Short.MAX_VALUE))
+                .add(202, 202, 202))
         );
         jPanel8Layout.setVerticalGroup(
             jPanel8Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -464,11 +487,11 @@
             jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(jPanel5Layout.createSequentialGroup()
                 .add(jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                    .add(jPanel6, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                    .add(jPanel7, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                    .add(jPanel6, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                    .add(jPanel7, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                .add(jPanel8, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                .add(jPanel8, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                .addContainerGap())
         );
 
         org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
@@ -476,17 +499,17 @@
         jPanel1Layout.setHorizontalGroup(
             jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(jPanel1Layout.createSequentialGroup()
-                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
+                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                     .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel4, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                     .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel5, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
-                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                .addContainerGap())
         );
         jPanel1Layout.setVerticalGroup(
             jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(jPanel1Layout.createSequentialGroup()
-                .add(jPanel4, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                .add(jPanel4, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                .add(jPanel5, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                .add(jPanel5, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                 .addContainerGap())
         );
 
@@ -502,11 +525,11 @@
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(layout.createSequentialGroup()
                 .addContainerGap()
-                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
-                    .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                    .add(jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                     .add(layout.createSequentialGroup()
                         .add(helpButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 360, Short.MAX_VALUE)
                         .add(operationButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(closeButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
@@ -516,13 +539,13 @@
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(layout.createSequentialGroup()
                 .addContainerGap()
-                .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                .add(jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 525, Short.MAX_VALUE)
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(helpButton)
                     .add(closeButton)
                     .add(operationButton))
-                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                .addContainerGap())
         );
         pack();
     }// &lt;/editor-fold&gt;//GEN-END:initComponents

Modified: trunk/src/net/sf/plantlore/client/metadata/MetadataManager.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/MetadataManager.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/metadata/MetadataManager.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -13,15 +13,22 @@
 import java.util.ArrayList;
 import java.util.Observable;
 import net.sf.plantlore.common.PlantloreConstants;
+import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.record.Metadata;
+import net.sf.plantlore.common.record.Occurrence;
+import net.sf.plantlore.common.record.User;
+import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.middleware.SelectQuery;
 import net.sf.plantlore.common.exception.DBLayerException;
 import org.apache.log4j.Logger;
 
 /**
- *
- * @author Lada
+ * MetadataManager model. Contains bussines logic and data fields of the MetadataManager. Implements
+ * operations including add metadata, edit metadata, delete metadata and search metadata. 
+ * 
+ * @author Lada Oberreiterova
+ * @version 1.0
  */
 public class MetadataManager  extends Observable {
     
@@ -29,6 +36,8 @@
     private Logger logger;      
     /** Instance of a database management object */
     private DBLayer database;   
+    /** Exception with details about an error */
+    private String error = null;
     /** Constant with default number of rows to display */
     public static final int DEFAULT_DISPLAY_ROWS = 6;    
     /** Actual number of rows to display */
@@ -36,257 +45,556 @@
     /** Index of the first record shown in the table */
     private int currentFirstRow;
     /** Information about current display rows*/
-    private String displayRow;    
-    
-     //*******Informations about searching Result from database*****//
+    private String displayRow;           
     /** Result of the search query */
     private int resultId = 0;
     /** List of data (results of a search query) displayed in the table */
-    private ArrayList&lt;Metadata&gt; metadataList = new ArrayList();         
-    // informace pro uzivatele o zmenach v tabulce metadata
-    private String messageMetadata;
-    
-    //Informace o operaci, ktera se bude provadet - ADD, EDIT, DELETE, DETAIL
+    private ArrayList&lt;Metadata&gt; metadataList = new ArrayList&lt;Metadata&gt;();         
+    /** Message containing information about changes in metadata*/
+    private String messageMetadata;    
+    /** Type of operation - ADD, EDIT, DELETE, DETAIL*/
     private String operation = &quot;&quot;;
-    //Vyvrany zaznam v tabulce s metadaty
-    private Metadata selectedRecord;
-    
-    private Enum[] editTypeArray = new PlantloreConstants.Table[]{PlantloreConstants.Table.METADATA};
-    
-    //*********************Search************//
+    /** Containing information about closing the addEdit dialog*/
+    private boolean usedClose = false;
+    /** Record for add, update or delete*/
+    private Metadata metadataRecord;
+    /** Identifier of record for add, update or delete*/
+    private int idRecord;
+    /** Array of type object */
+    private Enum[] editTypeArray = new PlantloreConstants.Table[]{PlantloreConstants.Table.METADATA};        
     /** Field to be used for sorting search query results */
     private int sortField = 0;
     /** Direction of sorting. 0 = ASC, 1 = DESC. Default is ASC */
-    private int sortDirection = 0;
-    
-    //***********Metadata*******************//
-    private String dataSetTitle;    
+    private int sortDirection = 0;    
+    /**Metadata - project title*/
+    private String dataSetTitle;
+    /**Metadata - istitution*/
     private String sourceInstitutionId;
-    private String sourceId;        
+    /**Metadata - data source*/
+    private String sourceId;    
     
+    /** Constants with error descriptions */
+    public static final String ERROR_SEARCH = L10n.getString(&quot;Error.MetadataSearchFailed&quot;);        
+    public static final String ERROR_PROCESS = L10n.getString(&quot;Error.MetadataProcessResultsFailed&quot;);    
+    public static final String ERROR_NUMBER_ROWS = L10n.getString(&quot;Error.GetNumberRows&quot;);
+    public static final String ERROR_ADD = L10n.getString(&quot;Error.MetadataAddFailed&quot;);
+    public static final String ERROR_EDIT = L10n.getString(&quot;Error.MetadataEditFailed&quot;);
+    public static final String ERROR_DELETE = L10n.getString(&quot;Error.MetadataDeleteFailed&quot;);    
+    public static final String ERROR_DBLAYER_TITLE = L10n.getString(&quot;Error.DBLayerExceptionTitle&quot;);
+    public static final String ERROR_DBLAYER = L10n.getString(&quot;Error.DBLayerException&quot;);
+    public static final String ERROR_REMOTE_TITLE = L10n.getString(&quot;Error.RemoteExceptionTitle&quot;);
+    public static final String ERROR_REMOTE = L10n.getString(&quot;Error.RemoteException&quot;);
+    public static final String ERROR_UNKNOWEN_TITLE = L10n.getString(&quot;Error.UnknownExceptionTitle&quot;);
+    public static final String ERROR_UNKNOWEN = L10n.getString(&quot;Error.UnknownException&quot;);
+    public static final String ERROR_TITLE = L10n.getString(&quot;Error.MetadataMessageTitle&quot;);
+    public static final String ERROR_CHECK_DELETE = L10n.getString(&quot;Error.MetadataCheckDelete&quot;);
+    public static final String ERROR_DATASETTITLE = L10n.getString(&quot;Error.MetadataUniqueDatasetTitle&quot;);    
+    
+    public static final String QUESTION_DELETE_TITLE = L10n.getString(&quot;Question.DeleteMetadataTitle&quot;);
+    public static final String QUESTION_DELETE = L10n.getString(&quot;Question.DeleteMetadata&quot;);
+    
+    public static final String PROGRESS_SEARCH = L10n.getString(&quot;Metadata.Search.ProgressTitle&quot;);
+    public static final String PROGRESS_ADD = L10n.getString(&quot;Metadata.Add.ProgressTitle&quot;);
+    public static final String PROGRESS_EDIT = L10n.getString(&quot;Metadata.Edit.ProgressTitle&quot;);
+    public static final String PROGRESS_DELETE = L10n.getString(&quot;Metadata.Delete.ProgressTitle&quot;);
+    
+    public static final String WARNING_SELECTION_TITLE = L10n.getString(&quot;Warning.EmptySelectionTitle&quot;);
+    public static final String WARNING_SELECTION = L10n.getString(&quot;Warning.EmptySelection&quot;);
+    
+    public static final String INFORMATION_RESULT_TITLE = L10n.getString(&quot;Information.NoMetadataInResultTitle&quot;);
+    public static final String INFORMATION_RESULT = L10n.getString(&quot;Information.NoMetadataInResult&quot;);
+    public static final String INFORMATION_SEARCH_TITLE = L10n.getString(&quot;Information.SearchMetadataTitle&quot;);
+    public static final String INFORMATION_SEARCH = L10n.getString(&quot;Information.SearchMetadata&quot;);
     /**
      * Creates a new instance of MetadataManager
+     * @param database Instance of a database management object
      */
     public MetadataManager(DBLayer database) {
         
        logger = Logger.getLogger(this.getClass().getPackage().getName());	 
-       this.database = database;
-       
-       //nacteni metadat
-       searchMetadata();
-       //opet funkci pro vyzadani si dat postupne
-       processResult(1, displayRows);
+       this.database = database;             
     }
     
      /**
+     *  Search for metadata in the database. Operation might be executed in a separate thread using the Task class (depends
+     *  on the input parameters). The reason for this is that we are sometimes executing search from
+     *  another long running operation, teherefore we do not need a new thread.
      *
-     *
+     *  @param createTask tells whether to execute search in a separate thread
+     *  @return instance of the Task with the long running operation (searching data)
+     */    
+    public Task searchMetadata(boolean createTask) {
+       
+    	if (createTask) {
+	    	final Task task = new Task() {    		    		
+	    		public Object task() throws DBLayerException, RemoteException {
+	  		       int resultIdent;
+	    			try {
+	  		    	    resultIdent = search();
+	  		    	    setResultId(resultIdent);
+		    	   } catch (RemoteException e) {	            
+			            logger.error(&quot;Searching metada failed. Remote exception caught in Metadata. Details: &quot;+e.getMessage());			        	
+		                RemoteException remex = new RemoteException(ERROR_SEARCH + e);
+		                remex.setStackTrace(e.getStackTrace());
+		                throw remex; 		           
+			        } catch (DBLayerException e) {
+			        	logger.error(&quot;Searching metada failed. DBLayer exception caught in Metadata. Details: &quot;+e.getMessage());       	                                                   			        
+		                DBLayerException dbex = new DBLayerException(ERROR_SEARCH + e);
+		                dbex.setStackTrace(e.getStackTrace());
+		                throw dbex; 		           
+			        }					       
+                    return null;			        
+				}
+		    };
+		    return task;
+    	} else {
+    		try {
+    			int resultIdent = search();
+    			setResultId(resultIdent);
+			} catch (DBLayerException e) {
+				logger.error(&quot;Searching metada failed. Remote exception caught in Metadata. Details: &quot;+e.getMessage());
+				setError(ERROR_SEARCH);
+				setChanged();
+                notifyObservers();                
+			} catch (RemoteException e) {
+				logger.error(&quot;Searching metada failed. DBLayer exception caught in Metadata. Details: &quot;+e.getMessage());
+				setError(ERROR_SEARCH);
+				setChanged();
+                notifyObservers();                
+			}
+			return null;
+    	}
+  }
+    
+    /**
+     *  Method to construct and execute the search query.
+     *  Save identifier of the search result     
+     *  @return id identifying the search result
+     *  @throws DBLayerException in case search failed
+     *  @throws RemoteException in case network communication failed
      */
-    public void searchMetadata() {
+    private int search() throws DBLayerException, RemoteException {
+    	// Create new Select query
+        SelectQuery query = null;
         
-        //Create new Select query
-        SelectQuery query = null;       
+        query = database.createQuery(Metadata.class);    
+        //Add restrictions
+        query.addRestriction(PlantloreConstants.RESTR_EQ, Metadata.DELETED, null, 0, null);                    
+        if (sourceInstitutionId != null &amp;&amp; !sourceInstitutionId.equals(&quot;&quot;)) {
+            query.addRestriction(PlantloreConstants.RESTR_LIKE, Metadata.SOURCEINSTITUTIONID, null, &quot;%&quot; + sourceInstitutionId + &quot;%&quot;, null);
+        }
+        if (sourceId != null &amp;&amp; !sourceId.equals(&quot;&quot;)) {
+            query.addRestriction(PlantloreConstants.RESTR_LIKE, Metadata.SOURCEID, null, &quot;%&quot; + sourceId + &quot;%&quot;, null);
+        }
+        if (dataSetTitle != null &amp;&amp; !dataSetTitle.equals(&quot;&quot;)) {
+            query.addRestriction(PlantloreConstants.RESTR_LIKE, Metadata.DATASETTITLE, null, &quot;%&quot; + dataSetTitle + &quot;%&quot;, null);
+        }
+       
+        // Add orderBy clause
+        String field;                
+        switch (sortField) {
+        case 0:
+                field = Metadata.SOURCEINSTITUTIONID;
+                logger.debug(&quot;0&quot;);
+                break;
+        case 1:
+                field = Metadata.SOURCEID;
+                logger.debug(&quot;1&quot;);
+                break;
+        case 2:
+                field = Metadata.DATASETTITLE;
+                logger.debug(&quot;2&quot;);
+                break;
+        case 3:
+                field = Metadata.TECHNICALCONTACTNAME;
+                logger.debug(&quot;3&quot;);
+                break;                
+        case 4:
+                field = Metadata.CONTENTCONTACTNAME;
+                logger.debug(&quot;4&quot;);
+                break;
+        case 5:
+                field = Metadata.DATECREATE;
+                logger.debug(&quot;5&quot;);
+                break;
+        case 6:
+                field = Metadata.DATEMODIFIED;
+                logger.debug(&quot;6&quot;);
+                break;
+        default:
+                field = Metadata.SOURCEINSTITUTIONID;
+                logger.debug(&quot;Default&quot;);
+        }
 
-    	//  Select data from tMetadata table
-        try {
-                query = database.createQuery(Metadata.class);     
-                query.addRestriction(PlantloreConstants.RESTR_EQ, Metadata.DELETED, null, 0, null);
-                
-                if (sourceInstitutionId != null &amp;&amp; !sourceInstitutionId.equals(&quot;&quot;)) {
-                    query.addRestriction(PlantloreConstants.RESTR_LIKE, Metadata.SOURCEINSTITUTIONID, null, &quot;%&quot; + sourceInstitutionId + &quot;%&quot;, null);
-                }
-                if (sourceId != null &amp;&amp; !sourceId.equals(&quot;&quot;)) {
-                    query.addRestriction(PlantloreConstants.RESTR_LIKE, Metadata.SOURCEID, null, &quot;%&quot; + sourceId + &quot;%&quot;, null);
-                }
-                if (dataSetTitle != null &amp;&amp; !dataSetTitle.equals(&quot;&quot;)) {
-                    query.addRestriction(PlantloreConstants.RESTR_LIKE, Metadata.DATASETTITLE, null, &quot;%&quot; + dataSetTitle + &quot;%&quot;, null);
-                }
-               
-                
-                String field;                
-                switch (sortField) {
-                case 0:
-                        field = Metadata.SOURCEINSTITUTIONID;
-                        break;
-                case 1:
-                        field = Metadata.SOURCEID;
-                        break;
-                case 2:
-                        field = Metadata.DATASETTITLE;
-                        break;
-                case 3:
-                        field = Metadata.TECHNICALCONTACTNAME;
-                        break;                
-                case 4:
-                        field = Metadata.CONTENTCONTACTNAME;
-                        break;
-                case 5:
-                        field = Metadata.DATECREATE;
-                        break;
-                case 6:
-                        field = Metadata.DATEMODIFIED;
-                        break;
-                default:
-                        field = Metadata.SOURCEINSTITUTIONID;
-                }
-
-                if (sortDirection == 0) {
-                        query.addOrder(PlantloreConstants.DIRECT_ASC, field);
-                } else {
-                        query.addOrder(PlantloreConstants.DIRECT_DESC, field);
-                }
-                
-                
-        } catch (RemoteException e) {
-            System.err.println(&quot;RemoteException - searchMetadataData(), createQuery&quot;);
-        } catch (DBLayerException e) {
-            System.err.println(&quot;DBLayerException - searchMetadataData(), createQuery&quot;);
+        if (sortDirection == 0) {
+                query.addOrder(PlantloreConstants.DIRECT_ASC, field);
+        } else {
+                query.addOrder(PlantloreConstants.DIRECT_DESC, field);
         }
-                
-        int resultId = 0;
-        try {
-            // Execute query                    
-            resultId = database.executeQuery(query);
-            // Save &quot;edit&quot; metadata data
-            setResultId(resultId);    
-        } catch (DBLayerException e) {                            
-            logger.error(&quot;Searching metada failed. Unable to execute search query.&quot;);           
-        } catch (RemoteException e) { 		   
-     	   System.err.println(&quot;RemoteException- searchMetada(), executeQuery&quot;);
-        }          
-    }
+        //Execute query                    
+        resultId = database.executeQuery(query);                    
+        return resultId;
+    }  
     
    /**
      * Process results of a search query. Retrieves results using the database management object (DBLayer) and stores them in the data field of the class. 
-     * @param fromTable number of the first row to show in table. Number of the first row to retraieve is 1.
+     * @param from number of the first row to show in table. 
      * @param count number of rows to retrieve 
      */
-    public void processResult(int fromTable, int count) {
+    public void processResult(int from, int count) {
         
-        if (this.resultId != 0) {
+    	if (this.resultId != 0) {    		
             int currentRow = getResultRows();
             logger.debug(&quot;Rows in the result: &quot;+currentRow);
-            logger.debug(&quot;Max available rows: &quot;+(fromTable+count-1));
+            logger.debug(&quot;Max available rows: &quot;+(from+count-1));            
            
             // Find out how many rows we can retrieve - it cannot be more than number of rows in the result
-            int to = Math.min(currentRow, fromTable+count-1);           
+            int to = Math.min(currentRow, from+count-1);             
             if (to &lt;= 0) {
             	metadataList = new ArrayList&lt;Metadata&gt;(); 
             	setDisplayRows(0);
-            	setCurrentDisplayRows(&quot;0-0&quot;);
+            	setCurrentDisplayRows(&quot;0-0&quot;);       
             } else {
-                logger.debug(&quot;Retrieving query results: 1 - &quot;+to);
-                setCurrentDisplayRows(fromTable+ &quot;-&quot; + to);
-                try {                	 
-                     // Retrieve selected row interval 
-                	Object[] objectMetadata;
-                 	try {
-                 		objectMetadata = database.more(this.resultId, 0, to-1);  
-                 	} catch(RemoteException e) {
-                     	System.err.println(&quot;RemoteException- processEditResult, more&quot;);
-                     	logger.debug(&quot;RemoteException- processEditResult, more&quot;);
-                     	return;
-                     }                   
-                    int countResult = objectMetadata.length;  
-                    logger.debug(&quot;Results retrieved. Count: &quot;+ countResult);
-                    // Create storage for the results
-                    this.metadataList = new ArrayList&lt;Metadata&gt;();
-                    // Cast the results to the Metadata objects
-                    for (int i=0; i&lt;countResult; i++ ) {                    							
-						Object[] objHis = (Object[])objectMetadata[i];
-                        this.metadataList.add((Metadata)objHis[0]);
-                    }           
-                    //Update current first displayed row (only if data retrieval was successful)
-                    setCurrentFirstRow(fromTable); 
+                logger.debug(&quot;Retrieving query results: 1 -&quot; + to);
+                setCurrentDisplayRows(from+ &quot;-&quot; + to);                              	 
+                // Retrieve selected row interval 
+                Object[] objectMetadata;
+             	try {
+             		objectMetadata = database.more(this.resultId, 0, to-1);  
+             	} catch(RemoteException e) {
+             		logger.error(&quot;Remote exception caught in MetadataManager (processResult). Details: &quot;+e.getMessage());
+        			setError(ERROR_PROCESS);
+        			setChanged();
+                    notifyObservers();
+                 	return;                                                                                       
                 } catch (DBLayerException e) {                  
-                    logger.error(&quot;Processing search results failed: &quot;+e.toString());            
-                }             
-            }
-        }         
+                    logger.error(&quot;Processing search results failed: &quot; + e.getMessage());   
+                    setError(ERROR_PROCESS);
+                    setChanged();
+                    notifyObservers();
+                    return;
+                }  
+                if (objectMetadata == null) {
+                	logger.error(&quot;tMetadata doesn`t contain required data&quot;);
+                	setError(ERROR_PROCESS);
+                    setChanged();
+                    notifyObservers();
+                    return;
+                }
+                int countResult = objectMetadata.length;  
+                logger.debug(&quot;Results retrieved. Count: &quot;+ countResult);                
+                this.metadataList = new ArrayList&lt;Metadata&gt;();
+                // Cast the results to the Metadata objects
+                for (int i=0; i&lt;countResult; i++ ) {                    							
+                	Object[] objHis = (Object[])objectMetadata[i];
+                    this.metadataList.add((Metadata)objHis[0]);
+                    logger.debug(&quot;Proccess: &quot;+ i + &quot;: &quot; + (Metadata)objHis[0]);
+                }               
+                // Update current first displayed row                
+                logger.info(&quot;Results successfuly retrieved&quot;);                   
+                setCurrentFirstRow(from);
+            }                        
+         }         
     }
     
-    public void addMetedataRecord (Metadata metadata) {
+    /**
+     *  Method used to check whether it is ok to delete the metadat. If there is an occurrence
+     *  linked to this metadata, metadata cannot be deleted.
+     *
+     *  @param index index of the selected metadata in the list of metadata
+     *  @return true if metadata can be deleted, false otherwise
+     */
+    public boolean checkDelete(int index) {
+        SelectQuery sq;
+        int resId;
+        
+        // Get the selected metadata
+        Metadata metadata = (Metadata)metadataList.get(index);        
         try {
-            database.executeInsert(metadata);
-        } catch (RemoteException ex) {
-            ex.printStackTrace();
-        } catch (DBLayerException ex) {
-            ex.printStackTrace();
-        }
-        setChanged(); 
-        notifyObservers(editTypeArray);
+            sq = database.createQuery(Occurrence.class);
+            sq.addRestriction(PlantloreConstants.RESTR_EQ, Occurrence.METADATA, null, metadata, null);
+            sq.addRestriction(PlantloreConstants.RESTR_EQ, Occurrence.DELETED, null, 0, null);
+            resId = database.executeQuery(sq);
+            if (database.getNumRows(resId)&gt;0) {
+                database.closeQuery(sq);
+                return false;
+            }
+            database.closeQuery(sq);
+        } catch (RemoteException e) {
+            logger.error(&quot;Remote exception caught in Metadata. Details: &quot;+e.getMessage());
+            setError(ERROR_DELETE);
+            return false;
+        } catch (DBLayerException e) {
+            logger.error(&quot;Loading metadata failed. Cannot determine whether metadata can be deleted&quot;);
+            setError(ERROR_DELETE);
+            return false;
+        }        
+        return true;
     }
     
-    public void editMetadataRecord() {       
-        try {
-            database.executeUpdate(selectedRecord);
-        } catch (RemoteException ex) {
-            ex.printStackTrace();
-        } catch (DBLayerException ex) {
-            ex.printStackTrace();
-        }
-        setChanged(); 
-        notifyObservers(editTypeArray);
+    /**
+     *  Method used to check whether it is already exiting some metadata record with same datasetTitle.
+     *  If there is metadata record with the same datasetTitle, the new datasetTitle must be changed.
+     *
+     *  @param datasetTitle new name of project fill in add form
+     *  @return true if datasetTile already exist, false otherwise 
+     */
+    public boolean uniqueDatasetTitle(String datasetTitle) {
+    	SelectQuery sq;
+        int resId;
+        
+    	try {
+    		sq = database.createQuery(Metadata.class);
+    		sq.addProjection(PlantloreConstants.PROJ_PROPERTY, Metadata.DATASETTITLE);
+    		sq.addRestriction(PlantloreConstants.RESTR_EQ, Metadata.DATASETDETAILS, null, datasetTitle, null);
+    		resId = database.executeQuery(sq);
+    		if (database.getNumRows(resId)&gt;0) {
+                database.closeQuery(sq);
+                return false;
+            }
+            database.closeQuery(sq);
+    	} catch (RemoteException e) {
+            logger.error(&quot;Remote exception caught in Metadata. Details: &quot;+e.getMessage());
+            setError(ERROR_DATASETTITLE);
+        } catch (DBLayerException e) {
+            logger.error(&quot;Check unique datasetTitle failed. Cannot determine whether some name of project equals new datasetTitle.&quot;);
+            setError(ERROR_DATASETTITLE);
+        }        
+    	return true;
     }
     
-    public void deleteMetadataRecord() {
-        try {
-            selectedRecord.setDeleted(1);
-            database.executeUpdate(selectedRecord);
-        } catch (RemoteException ex) {
-            ex.printStackTrace();
-        } catch (DBLayerException ex) {
-            ex.printStackTrace();
-        }
-        setChanged(); 
-        notifyObservers(editTypeArray);
-    }
+    /**
+     * Save new metadata record into the database. 
+     * Operation is executed in a separate thread using Task class.
+     *      
+     * @return instance of the Task with the long running operation (executeInsert)   
+     */
+    public Task addMetedataRecord () {
+    	    	
+    	final Task task = new Task() {    		    		
+    		public Object task() throws DBLayerException, RemoteException {
+    			try {
+		            database.executeInsert(metadataRecord);		            		            
+		        }catch (RemoteException e) {
+		        	logger.error(&quot;Process add metadata failed. Remote exception caught in MetadataManager. Details: &quot;+e.getMessage());
+		        	database.rollbackTransaction();
+                    RemoteException remex = new RemoteException(ERROR_ADD + e);
+                    remex.setStackTrace(e.getStackTrace());
+                    throw remex; 		           		       	    
+		        } catch (DBLayerException e) {
+		        	logger.error(&quot;Process add metadata failed. DBLayer exception caught in MetadataManager. Details: &quot;+e.getMessage());       	                                                   
+		        	database.rollbackTransaction();
+                    DBLayerException dbex = new DBLayerException(ERROR_ADD + e);
+                    dbex.setStackTrace(e.getStackTrace());
+                    throw dbex; 		            
+		        } 		       
+		        //Tell AppCore observerber
+		        setChanged(); 
+		        notifyObservers(editTypeArray);			        
+		        return null;
+    		}
+	    };
+	    return task;
+    } 		  
     
-           
+    /**
+     *  Update metadata in the database. To-be-updated metadata is stored in &lt;code&gt;metadataRecord&lt;/code&gt;. 
+     *  Operation is executed in a separate thread using Task class.
+     *  
+     *  @return instance of the Task with the long running operation (executeUpdate)
+     */
+    public Task editMetadataRecord() {       
+        
+    	final Task task = new Task() {    		    		
+    		public Object task() throws DBLayerException, RemoteException {
+    			try {
+		        	database.executeUpdate(metadataRecord);
+		        	metadataList.set(idRecord, metadataRecord);
+		        }catch (RemoteException e) {
+		        	logger.error(&quot;Process update metadata failed. Remote exception caught in MetadataManager. Details: &quot;+e.getMessage());
+		        	database.rollbackTransaction();
+                    RemoteException remex = new RemoteException(ERROR_EDIT + e);
+                    remex.setStackTrace(e.getStackTrace());
+                    throw remex; 		           		       	    
+		        } catch (DBLayerException e) {
+		        	logger.error(&quot;Process update metadata failed. DBLayer exception caught in MetadataManager. Details: &quot;+e.getMessage());       	                                                   
+		        	database.rollbackTransaction();
+                    DBLayerException dbex = new DBLayerException(ERROR_EDIT + e);
+                    dbex.setStackTrace(e.getStackTrace());
+                    throw dbex; 		            
+		        } 		        
+		        //Tell AppCore observerber
+		        setChanged(); 
+		        notifyObservers(editTypeArray);		    		    		    	       
+		        return null;
+    		}
+	    };
+	    return task;
+    } 
+    	    	    	
+    /**     
+     *  Update metadata in the database. To-be-updated metadata is stored in &lt;code&gt;metadataRecord&lt;/code&gt; field.
+     *  Operation is executed in a separate thread using Task class.
+     *  
+     *  @return instance of the Task with the long running operation (executeDelete) 
+     */
+    public Task deleteMetadataRecord() {
+    	
+    	final Task task = new Task() {    		    		
+    		public Object task() throws DBLayerException, RemoteException {
+    			try {
+		        	metadataRecord.setDeleted(1);
+		                database.executeUpdate(metadataRecord);		            
+		        }catch (RemoteException e) {
+		        	logger.error(&quot;Process delete metadata failed. Remote exception caught in MetadataManager. Details: &quot;+e.getMessage());
+		        	database.rollbackTransaction();
+                    RemoteException remex = new RemoteException(ERROR_DELETE + e);
+                    remex.setStackTrace(e.getStackTrace());
+                    throw remex; 		           		       	    
+		        } catch (DBLayerException e) {
+		        	logger.error(&quot;Process delete metadata failed. DBLayer exception caught in MetadataManager. Details: &quot;+e.getMessage());       	                                                   
+		        	database.rollbackTransaction();
+                    DBLayerException dbex = new DBLayerException(ERROR_DELETE + e);
+                    dbex.setStackTrace(e.getStackTrace());
+                    throw dbex; 		            
+		        } 			        
+		        //Tell AppCore observerber
+		        setChanged(); 
+		        notifyObservers(editTypeArray);		    		    		    	       
+		        return null;
+    		}
+	    };
+	    return task;
+    } 
+    	
     //****************************//
     //****Get and set metods*****//
     //**************************//
     
+    /**
+     *  Set an error flag.
+     *  @param msg  message explaining the error which occured
+     */
+    public void setError(String msg) {
+        this.error = msg;
+    }
     
-    //id vysledku po vyhledavani v db
+    /**
+     *  Checks whether an error flag is set.
+     *  @return true if an error occured and error message is available, false otherwise
+     */
+    public boolean isError() {    	
+        if (this.error != null) {
+            return true;
+        } else {
+            return false;
+        }
+    }
+    
+    /**
+     *  Get error message for the error that occured
+     *  @return message explaining the error which occured
+     */
+    public String getError() {
+        return this.error;
+    }    
+    
+    /**
+     * Set true if addEdit dialog was closed by CLOSE button
+     * @param usedClose containing information about closing the addEdit dialog
+     */
+    public void setUsedClose(boolean usedClose) {
+    	this.usedClose = usedClose;
+    }
+    
+    /**
+     * Get information about closing the addEdit dialog
+     * @return true if addEdit dialog was closed by CLOSE button
+     */
+    public boolean usedClose() {
+    	if (this.usedClose == true) {
+    		usedClose = false;
+    		return true;
+    	}
+    	return false;
+    }
+    
+    
+    /**
+	  * Set result of a database operation. This is used only for search operations.
+     * @param resultId id of the SelectQuery result	  
+	  */
     public void setResultId(int resultId) {
         this.resultId = resultId;
     }
     
+    /**
+     *  Get results of last database operation. This is used only for search operations.
+     *  @return resultId identifying the SelectQuery result
+     */
     public int getResultId() {
         return this.resultId;
     }
     
+    /**
+     * Get the number of results for the current SelectQuery
+     * @return number of results for the current SelectQuery
+     */
     public int getResultRows() {
         int resultCount = 0;
         if (resultId != 0) try {
                 resultCount = database.getNumRows(resultId);        	
         } catch(RemoteException e) {
-                System.err.println(&quot;Kdykoliv se pracuje s DBLayer nebo SelectQuery, musite hendlovat RemoteException&quot;);
+        	logger.error(&quot;Get number of results failed.Remote exception caught in History. Details: &quot;+e.getMessage());  
+        	setError(ERROR_NUMBER_ROWS);
         }
         return resultCount;
     }
 
+    /**
+	  * Get results of a search query for dislpaying in metadata dialog
+	  * @return results of a search query for dislpaying in metadata dialog
+	  */
     public ArrayList&lt;Metadata&gt; getMetadataList() {
               return this.metadataList;		  
        }
 
+    /**
+	  * Set results of a search query for dislpaying in metadata dialog
+	  * @param metadataList results of a search query for dislpaying in metadata dialog
+	  */
      public void setMetadataList(ArrayList&lt;Metadata&gt; metadataList) {
               this.metadataList = metadataList;		  
      } 
     
+ 	 /**
+ 	 * Get information about current display rows (from - to)
+ 	 * @return information about current display rows (from - to)
+ 	 */
      public String getCurrentDisplayRows() {
 		  return this.displayRow;		  
 	   }
 
+     /**
+ 	 * Set information about current display rows (from - to)
+ 	 * @param displayRow information about current display rows (from - to)
+ 	 */
      public void setCurrentDisplayRows(String displayRow) {
               this.displayRow = displayRow;		  
      } 
      
+     /**
+ 	 * Get message with information for user
+ 	 * @return message with information for user
+ 	 */
      public String getMessageMetadata() {
 		  return this.messageMetadata;		  
 	   }
 
+     /**
+ 	 * Set message with information for user
+ 	 * @param messageMetadata message with information for user
+ 	 */
      public void setMessageMetadata(String messageMetadata) {
               this.messageMetadata= messageMetadata;		  
      } 
@@ -322,24 +630,46 @@
     public void setDisplayRows(int rows) {
         this.displayRows = rows;
     }
-    
-    // predani informace o operaci, ktera byla zavolana - ADD, EDIT, DELETE, DETAIL
-     public String getOperation() {
-                  logger.debug(&quot;Operation: &quot;+operation);
+       
+    /**
+     * Get information about selected operation (ADD, EDIT, DELETE, DETAIL)
+     * @return information about selected operation (ADD, EDIT, DELETE, DETAIL)
+     */
+     public String getOperation() {                  
 		  return this.operation;		  
 	   }
 
+     /**
+      * Set information about selected operation (ADD, EDIT, DELETE, DETAIL)
+      * @param operation information about selected operation (ADD, EDIT, DELETE, DETAIL)
+      */
      public void setOperation(String operation) {
               this.operation = operation;		  
      } 
-    
-    //Vraci metadata objekt vybraneho zaznam pro nasledny EDIT, DELETE ci zobrazeni DETAILU 
-    public void setSelectedRecord(int selectedRecordId) {
-        this.selectedRecord = (Metadata)(metadataList.get(selectedRecordId));
+       
+     /**
+      *  Set selected Metadata 
+      *  @param metadataRecordId index of the selected metadata in the list of metadata
+      */
+    public void setMetadataRecord(int metadataRecordId) {
+        this.metadataRecord = (Metadata)(metadataList.get(metadataRecordId));
+        this.idRecord = metadataRecordId;
     }
     
-    public Metadata getSelectedRecord() {
-        return this.selectedRecord;
+    /**
+     *  Set new Metadata 
+     *  @param metadataRecord new instantce of Metadata
+     */
+   public void setNewMetadataRecord(Metadata metadataRecord) {
+       this.metadataRecord = metadataRecord;
+   }
+    
+    /**
+     * Get selected Metadata
+     * @return selected Metadata
+     */
+    public Metadata getMetadataRecord() {
+        return this.metadataRecord;
     }
     
         /**
@@ -396,7 +726,7 @@
         this.sourceId = sourceId;
     }
     
-          /**
+     /**
      *  Set field used for sorting results of the search query.
      *  @param field numeric identificator of the field used for sorting
      */

Modified: trunk/src/net/sf/plantlore/client/metadata/MetadataManagerCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/MetadataManagerCtrl.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/metadata/MetadataManagerCtrl.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -13,26 +13,40 @@
 import java.awt.event.ActionListener;
 import java.awt.event.FocusEvent;
 import java.awt.event.FocusListener;
-import net.sf.plantlore.common.PlantloreHelp;
-import net.sf.plantlore.common.record.Metadata;
+import java.awt.event.KeyEvent;
+import java.awt.event.KeyListener;
+import java.rmi.RemoteException;
+
+import net.sf.plantlore.client.history.WholeHistoryCtrl.escapeKeyPressed;
+import net.sf.plantlore.common.ProgressBar;
+import net.sf.plantlore.common.Task;
+import net.sf.plantlore.common.exception.DBLayerException;
 import org.apache.log4j.Logger;
 
 /**
- *
- * @author Lada
+ * Controller for the main MetadataManager dialog (part of the MetadataManager MVC).
+ * 
+ * @author Lada Oberreiterova
+ * @version 1.0
  */
 public class MetadataManagerCtrl {
     
+	/** Instance of a logger */
     private Logger logger;
+    /** Model of MetadataManager MVC */
     private MetadataManager model;
+    /** View of MetadataManager MVC */
     private MetadataManagerView view;
     
-    /** Creates a new instance of MetadataManagerCtrl */
-    public MetadataManagerCtrl(MetadataManager model, MetadataManagerView view) {
+    /** Creates a new instance of MetadataManagerCtrl 
+     *  @param model model of the MetadataManager MVC
+     *  @param view  view of the MetadataManager MVC 
+     */
+    public MetadataManagerCtrl(MetadataManager modelPar, MetadataManagerView viewPar) {
         
         logger = Logger.getLogger(this.getClass().getPackage().getName());        
-        this.model = model;
-        this.view = view;
+        this.model = modelPar;
+        this.view = viewPar;
           
         view.closeButton.addActionListener(new closeButtonListener());
         view.previousButton.addActionListener(new previousButtonListener());
@@ -45,11 +59,83 @@
         view.searchButton.addActionListener(new searchUserListener());
         view.sortAscendingRadioButton.addFocusListener(new SortDirectionRadioFocusListener());
         view.sortDescendingRadioButton.addFocusListener(new SortDirectionRadioFocusListener());
+        view.sortField.addFocusListener(new SortComboFocusListener());
+        
+        // Add key listeners
+        view.closeButton.addKeyListener(new escapeKeyPressed());
+        view.previousButton.addKeyListener(new escapeKeyPressed());
+        view.nextButton.addKeyListener(new escapeKeyPressed());
+        view.addButtons.addKeyListener(new escapeKeyPressed());
+        view.toDisplayValueTextField.addKeyListener(new escapeKeyPressed());
+        view.helpButton.addKeyListener(new escapeKeyPressed());
+        view.editButtons.addKeyListener(new escapeKeyPressed());
+        view.deleteButton.addKeyListener(new escapeKeyPressed());
+        view.detailsButton.addKeyListener(new escapeKeyPressed());
+        view.searchButton.addKeyListener(new escapeKeyPressed());
+        view.sortField.addKeyListener(new escapeKeyPressed());
+        view.tableMetadataList.addKeyListener(new escapeKeyPressed());
+        view.sortAscendingRadioButton.addKeyListener(new escapeKeyPressed());
+        view.sortDescendingRadioButton.addKeyListener(new escapeKeyPressed());
+        view.sourceInstitutionIdText.addKeyListener(new escapeKeyPressed());           
+        view.sourceIdText.addKeyListener(new escapeKeyPressed());
+        view.dataSetTitleText.addKeyListener(new escapeKeyPressed());
+        view.addKeyListener(new escapeKeyPressed());        
+        
+        //Search metadata
+        Task task = model.searchMetadata(true);
+        
+        ProgressBar progressBar = new ProgressBar(task, view, true) {		   							 			
+			private static final long serialVersionUID = -3944058265290571972L;
+			public void exceptionHandler(Exception e) {
+				if (e instanceof DBLayerException) {	   									   							
+   					DBLayerException dbex = (DBLayerException) e;	
+   					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE,MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
+   					getTask().stop();
+   					return;
+   				}
+   				if (e instanceof RemoteException) {	 
+   					RemoteException remex = (RemoteException) e;		
+   					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE, MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
+   					getTask().stop();
+   					return;
+   				}
+   				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
+   				logger.error(e);
+   			}
+
+			public void afterStopping() {
+				//Process result
+		        model.processResult(1, model.getDisplayRows());
+		        //Update view dialog
+		        view.tableMetadataList.setModel(new MetadataManagerTableModel(model));
+		        int from = model.getCurrentFirstRow();
+                int to = from + view.tableMetadataList.getRowCount() - 1;
+                view.displayedValueLabel.setText(from + &quot;-&quot; + to);
+                view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());
+           } 		   					
+		};
+		progressBar.setTitle(MetadataManager.PROGRESS_SEARCH);	                   	                   
+        task.start();                                       
     }
     
-       /**
-    * On Cancel just hides the view.
-    *
+    /**     
+     * KeyListener class controlling the pressing key ESCAPE.
+     * On key ESCAPE hides the view.     
+     */
+    public class escapeKeyPressed implements KeyListener {
+    	 	 public void keyPressed(KeyEvent evt){
+    	 		if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) {
+    	 			logger.debug(&quot;ESCAPE: &quot; + view.getFocusOwner());
+    	 			view.close();
+    	 		}    	 		     	 		 
+    	 	 }
+    	      public void keyReleased(KeyEvent evt) {}    	     
+    	      public void keyTyped(KeyEvent evt) {}    	         
+    }
+    
+    /**
+    * ActionListener class controlling the &lt;b&gt;CLOSE&lt;/b&gt; button on the form.
+    * On Close hides the view.
     */
    class closeButtonListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
@@ -59,45 +145,61 @@
    }
      
    /**
-    * 
-    *
+    *  ActionListener class controlling the &lt;b&gt;PREV&lt;/b&gt; button on the form.
+    *  The button PREV is used for browsing the search results.
     */
    class previousButtonListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
        {
-    	   //   Call processResults only if we don't see the first page (should not happen, button should be disabled)
-    	   logger.debug(&quot;FIRST&quot;);
-    	   logger.debug(&quot;current first row: &quot;+model.getCurrentFirstRow());
-           logger.debug(&quot;num rows in the result: &quot;+ model.getResultRows());            
-           logger.debug(&quot;display rows: &quot;+ view.tableMetadataList.getRowCount());      
+    	   // Check whether an error flag is set
+           if (model.isError()) {
+        	   view.showErrorMessage(MetadataManager.ERROR_TITLE, model.getError());
+        	   return;
+           }
+           // Get previous page of results
            if (model.getCurrentFirstRow() &gt; 1) {
                int firstRow = Math.max(model.getCurrentFirstRow()- model.getDisplayRows(), 1);
                model.processResult(firstRow, model.getDisplayRows()); 
+               if (model.isError()) return;
                if (model.getCurrentFirstRow() &gt; 1){
                }
                view.tableMetadataList.setModel(new MetadataManagerTableModel(model));
                int from = model.getCurrentFirstRow();
                int to = from + view.tableMetadataList.getRowCount() - 1;
                view.displayedValueLabel.setText(from + &quot;-&quot; + to);
-           }                           
+           }      
+           //Set button prev active if we see the first page, in other way set it inactive
+           if (model.getCurrentFirstRow() &gt; 1) {
+        	   view.previousButton.setEnabled(true);
+           } else {
+        	   view.previousButton.setEnabled(false);
+           }
+           //Set button next inactive if we see the last page, in other way set it active
+           if (model.getCurrentFirstRow()+ view.tableMetadataList.getRowCount() - 1 &lt; model.getResultRows()) {
+        	   view.nextButton.setEnabled(true);
+           } else {
+        	   view.nextButton.setEnabled(false);
+           }
        }
    }
    
+   
    /**
-    * 
-    *
+    * ActionListener class controlling the &lt;b&gt;NEXT&lt;/b&gt; button on the form.
+    * The button NEXT is used for browsing the search results.    
     */
    class nextButtonListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
        {
-    	   //Call processResults only if we don't see the last page
-    	   logger.debug(&quot;NEXT&quot;);
-           logger.debug(&quot;current first row: &quot;+model.getCurrentFirstRow());
-           logger.debug(&quot;num rows in the result: &quot;+ model.getResultRows());            
-           logger.debug(&quot;display rows: &quot;+ model.getDisplayRows());
-           logger.debug(&quot;num rows in table (view) &quot;+ view.tableMetadataList.getRowCount());              
+    	   //Check whether an error flag is set 
+           if (model.isError()) {
+        	   view.showErrorMessage(MetadataManager.ERROR_TITLE, model.getError());
+        	   return;
+           }
+           // Get next page of result
            if (model.getCurrentFirstRow()+ view.tableMetadataList.getRowCount()&lt;=model.getResultRows()) {
                model.processResult(model.getCurrentFirstRow()+ model.getDisplayRows(), view.tableMetadataList.getRowCount());
+               if (model.isError()) return;
                view.tableMetadataList.setModel(new MetadataManagerTableModel(model));             
                int from = model.getCurrentFirstRow();
                int to = from + view.tableMetadataList.getRowCount() - 1;
@@ -106,177 +208,362 @@
                }else {
             	   view.displayedValueLabel.setText(from + &quot;-&quot; + to);
                }               
-           }                       
+           }  
+           //Set button prev active if we see the first page, in other way set it inactive
+           if (model.getCurrentFirstRow() &gt; 1) {
+        	   view.previousButton.setEnabled(true);
+           } else {
+        	   view.previousButton.setEnabled(false);
+           }
+           //Set button next inactive if we see the last page, in other way set it active
+           if (model.getCurrentFirstRow()+ view.tableMetadataList.getRowCount() - 1 &lt; model.getResultRows()) {
+        	   view.nextButton.setEnabled(true);
+           } else {
+        	   view.nextButton.setEnabled(false);
+           }
        }
    }
    
     /**
-    * 
+    *  ActionListener class controlling the text field on the form for set number of rows to displayed.
     */
      class rowSetDisplayChangeListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent) {
-           // Save old value
+    	   // Check whether an error flag is set
+    	   if (model.isError()) {
+        	   view.showErrorMessage(MetadataManager.ERROR_TITLE, model.getError());
+        	   return;
+           }
+           // Save old value 
            int oldValue = model.getDisplayRows();           
            // Check whether new value &gt; 0
            if (view.getDisplayRows() &lt; 1) {
                view.setDisplayRows(oldValue);
                return;
-           }
-           if (view.getDisplayRows() &gt; model.getResultRows()){
-        	   view.setDisplayRows(model.getResultRows());
-           } 
-           
+           }           
            // Set new value in the model
            model.setDisplayRows(view.getDisplayRows());
            logger.debug(&quot;New display rows: &quot;+view.getDisplayRows());
            // If neccessary reload search results
-           if ((oldValue != view.getDisplayRows()) &amp;&amp; (model.getDisplayRows() &lt;= model.getResultRows())) {
+           if (oldValue != view.getDisplayRows()) {
                model.processResult(model.getCurrentFirstRow(), view.getDisplayRows());
+               if (model.isError()) return;
                view.tableMetadataList.setModel(new MetadataManagerTableModel(model));
                int from = model.getCurrentFirstRow();
                int to = from + view.tableMetadataList.getRowCount() - 1;
                view.displayedValueLabel.setText(from + &quot;-&quot; + to);               
            }
+           // Set button prev active if we see the first page, in other way set it inactive
+           if (model.getCurrentFirstRow() &gt; 1) {
+        	   view.previousButton.setEnabled(true);
+           } else {
+        	   view.previousButton.setEnabled(false);
+           }
+           //Set button next inactive if we see the last page, in other way set it active
+           if (model.getCurrentFirstRow()+ view.tableMetadataList.getRowCount() - 1 &lt; model.getResultRows()) {
+        	   view.nextButton.setEnabled(true);
+           } else {
+        	   view.nextButton.setEnabled(false);
+           }
        }        	   
-   }
-   
+   }  
  
     /**
-    *
+    * ActionListener class controlling the &lt;b&gt;Add metadata&lt;/b&gt; button on the form.
     */  
     class addMetadataListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
        {
-           //v modelu nastavim informaci o tom, ze jde o ADD
+    	   //Check whether an error flag is set
+    	   if (model.isError()) {
+        	   view.showErrorMessage(MetadataManager.ERROR_TITLE, model.getError());
+        	   return;
+           }
+           //set information abut selected operation ADD
            model.setOperation(&quot;ADD&quot;);           
-           //otevre se dialog addEdit s tim, ze mu rekneme, ze jde o ADD
-           //pozor: pri add se musi ohlidat, zda byly vyplneny povinne polozky
+           //create and open Add dialog
            AddEditMetadataView addView = new AddEditMetadataView(model, view,true);
-           AddEditMetadataCtrl addCtrl = new AddEditMetadataCtrl(addView, model);
+           new AddEditMetadataCtrl(addView, model);
            addView.setAddForm();
-           addView.setVisible(true);
-           //pokud bude pridan zaznam,je potreba ho zobrazit v tabulce = provest znovu dotaz nebo pridat do datalistu, ale tam
-           //nezarucim spravne setrizeni,takze novy dotaz bude lepsi....
-           //bylo by dobre si nekde drzet query (kdyby pouzil uzivatel search)
-           //nacteni metadat
-           model.searchMetadata();
-           //opet funkci pro vyzadani si dat postupne
-           model.processResult(1, model.getDisplayRows());
-           view.tableMetadataList.setModel(new MetadataManagerTableModel(model));                      
-           view.displayedValueLabel.setText(1 + &quot;-&quot; + view.tableMetadataList.getRowCount());  
+           addView.setVisible(true); 
+           //User press button close
+           if (model.usedClose()) return;
+           //save new record Metadata into database
+           Task task = model.addMetedataRecord();
+           
+           ProgressBar progressBar = new ProgressBar(task, view, true) {		   							 
+   			public void exceptionHandler(Exception e) {
+   				if (e instanceof DBLayerException) {	   									   							
+   					DBLayerException dbex = (DBLayerException) e;	
+   					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE,MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
+   					getTask().stop();
+   					return;
+   				}
+   				if (e instanceof RemoteException) {	 
+   					RemoteException remex = (RemoteException) e;		
+   					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE,MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
+   					getTask().stop();
+   					return;
+   				}
+   				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
+   				logger.error(e);
+   			}
+   			
+   			public void afterStopping() {
+    			   //load metadata
+    	           model.searchMetadata(false);           
+    	           model.processResult(1, model.getDisplayRows());
+    	           if (model.isError()) return;
+    	           view.tableMetadataList.setModel(new MetadataManagerTableModel(model));                      
+    	           view.displayedValueLabel.setText(1 + &quot;-&quot; + view.tableMetadataList.getRowCount());
+    	           view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());    	           
+               } 		   		
+   		};
+   		progressBar.setTitle(MetadataManager.PROGRESS_ADD);	                   	                   
+        task.start();                                       
        }
     }
     
      /**
-    *
+    * ActionListener class controlling the &lt;b&gt;Edit metadata&lt;/b&gt; button on the form.
     */  
     class editMetadataListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
        {
-           if (view.tableMetadataList.getSelectedRow() &lt; 0) {    
-               view.selectRowMessage();
+    	   //  whether an error flag is set
+    	   if (model.isError()) {
+        	   view.showErrorMessage(MetadataManager.ERROR_TITLE, model.getError());
+        	   return;
+           }
+           if (view.tableMetadataList.getSelectedRow() &lt; 0) {
+        	   // Display warning message saying that no row of table has been selected.
+               view.showWarningMessage(MetadataManager.WARNING_SELECTION_TITLE, MetadataManager.WARNING_SELECTION);
            } else {
-               //v modelu nastavim informaci o tom, ze jde o EDIT
+               //Set information about selected operation - EDIT
                model.setOperation(&quot;EDIT&quot;);
-               //poznaceni si do modelu inforamce o vybranem radku pro dalsi praci
+               //Set information about selected row
                int resultNumber = view.tableMetadataList.getSelectedRow() + model.getCurrentFirstRow()-1;  
-               model.setSelectedRecord(resultNumber);
-               //vytvoreni dialogu
+               model.setMetadataRecord(resultNumber);
+               //Create edit dialog
                AddEditMetadataView editView = new AddEditMetadataView(model, view,true);
-               AddEditMetadataCtrl editCtrl = new AddEditMetadataCtrl(editView, model);
-               //nacteni dat
-               editView.loadData();               
-               //nastaveni dialogu
+               new AddEditMetadataCtrl(editView, model);
+               //Load data and setting of edit dialog
+               editView.loadData();                              
                editView.setEditForm();               
-               editView.setVisible(true);    
-               //po editaci zaznamu se musi zobrazit zmena i v tabulce
-              //nacteni metadat
-               model.searchMetadata();
-               //opet funkci pro vyzadani si dat postupne
-               model.processResult(1, model.getDisplayRows());
-               view.tableMetadataList.setModel(new MetadataManagerTableModel(model));                      
-               view.displayedValueLabel.setText(1 + &quot;-&quot; + view.tableMetadataList.getRowCount());  
-           }          
+               editView.setVisible(true); 
+               // User press button close
+               if (model.usedClose()) return;
+               //Update metadata               
+               Task task = model.editMetadataRecord();
+               
+               ProgressBar progressBar = new ProgressBar(task, view, true) {		   							 
+          			public void exceptionHandler(Exception e) {
+          				if (e instanceof DBLayerException) {	   									   							
+           					DBLayerException dbex = (DBLayerException) e;	
+           					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE,MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
+           					getTask().stop();
+           					return;
+           				}
+           				if (e instanceof RemoteException) {	 
+           					RemoteException remex = (RemoteException) e;		
+           					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE,MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
+           					getTask().stop();
+           					return;
+           				}
+           				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
+           				logger.error(e);
+           			}
+
+          			public void afterStopping() {
+          			   //load metadata          				
+                        if (model.isError()) return;
+                        view.tableMetadataList.setModel(new MetadataManagerTableModel(model));                         
+                     } 		   					
+          		};
+          		progressBar.setTitle(MetadataManager.PROGRESS_EDIT);	                   	                   
+                task.start();                                       
+              }
        }
     }
     
     /**
-    *
+    * ActionListener class controlling the &lt;b&gt;Details&lt;/b&gt; button on the form.
     */  
     class detailsMetadataListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
        {
+    	   // Check whether an error flag is set
+    	   if (model.isError()) {
+        	   view.showErrorMessage(MetadataManager.ERROR_TITLE, model.getError());
+        	   return;
+           }
            if (view.tableMetadataList.getSelectedRow() &lt; 0) {    
-               view.selectRowMessage();
+               // Display warning message saying that no row of table has been selected.
+               view.showWarningMessage(MetadataManager.WARNING_SELECTION_TITLE, MetadataManager.WARNING_SELECTION);
            } else {
-               //v modelu nastavim informaci o tom, ze jde o DETAILS
+               //Set information about selected operation - DETAILS
                 model.setOperation(&quot;DETAILS&quot;);
-               //poznaceni si do modelu inforamce o vybranem radku pro dalsi praci
+               //Set information about selected row
                int resultNumber = view.tableMetadataList.getSelectedRow() + model.getCurrentFirstRow()-1;  
-               model.setSelectedRecord(resultNumber);
-               //vytvoreni dialogu
+               model.setMetadataRecord(resultNumber);
+               //Create detail dialog
                AddEditMetadataView detailsView = new AddEditMetadataView(model, view,true);
-               AddEditMetadataCtrl detailsCtrl = new AddEditMetadataCtrl(detailsView, model);
-               //nacteni dat
-               detailsView.loadData();
-               //nastaveni dialogu
+               new AddEditMetadataCtrl(detailsView, model);
+               //Load data and setting of detail dialog
+               detailsView.loadData();               
                detailsView.setDetailsForm();
                detailsView.setVisible(true); 
+               model.setUsedClose(false);
            }          
        }
     }
     
      /**
-    *
+    * ActionListener class controlling the &lt;b&gt;Delete metadata&lt;/b&gt; button on the form.
     */  
     class deleteMetadataListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
        {
+    	   // Check whether an error flag is set
+    	   if (model.isError()) {
+        	   view.showErrorMessage(MetadataManager.ERROR_TITLE, model.getError());
+        	   return;
+           }
            if (view.tableMetadataList.getSelectedRow() &lt; 0) {    
-               view.selectRowMessage();
+               // Display warning message saying that no row of table has been selected.
+               view.showWarningMessage(MetadataManager.WARNING_SELECTION_TITLE, MetadataManager.WARNING_SELECTION);
            } else {
-               //smazani zaznamu
+               //Set information about selected row
                int resultNumber = view.tableMetadataList.getSelectedRow() + model.getCurrentFirstRow()-1; 
-               model.setSelectedRecord(resultNumber);
-               model.deleteMetadataRecord();        
-               //nacteni metadat
-               model.searchMetadata();
-               //opet funkci pro vyzadani si dat postupne
-               model.processResult(1, model.getDisplayRows());
-               view.tableMetadataList.setModel(new MetadataManagerTableModel(model));                      
-               view.displayedValueLabel.setText(1 + &quot;-&quot; + view.tableMetadataList.getRowCount());  
-           }          
+               model.setMetadataRecord(resultNumber);
+               //Test if record can be deleted
+               if (!model.checkDelete(resultNumber)) {
+                   view.showErrorMessage(MetadataManager.ERROR_TITLE, MetadataManager.ERROR_CHECK_DELETE);
+               } else {
+            	   int okCancle = view.showQuestionMessage(MetadataManager.QUESTION_DELETE_TITLE, MetadataManager.QUESTION_DELETE);               
+                   if (okCancle == 0){
+                	   //Button OK was press
+                	   logger.debug(&quot;Button OK was press.&quot;);
+		               //delete selected record
+		               Task task = model.deleteMetadataRecord();
+		               
+		               ProgressBar progressBar = new ProgressBar(task, view, true) {		   								  		   				
+						private static final long serialVersionUID = -6156468821508998437L;
+						public void exceptionHandler(Exception e) {
+							if (e instanceof DBLayerException) {	   									   							
+			   					DBLayerException dbex = (DBLayerException) e;	
+			   					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE,MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
+			   					getTask().stop();
+			   					return;
+			   				}
+			   				if (e instanceof RemoteException) {	 
+			   					RemoteException remex = (RemoteException) e;		
+			   					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE,MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
+			   					getTask().stop();
+			   					return;
+			   				}
+			   				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
+			   				logger.error(e);
+			   			}
+		
+                                    public void afterStopping() {
+                                       // load metadata
+		   	               model.searchMetadata(false);               
+		   	               model.processResult(1, model.getDisplayRows());
+		   	               if (model.isError()) return;
+		   	               view.tableMetadataList.setModel(new MetadataManagerTableModel(model));                      
+		   	               view.displayedValueLabel.setText(1 + &quot;-&quot; + view.tableMetadataList.getRowCount());
+		   	               view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());		   	               
+		                } 		   					
+		   			};
+		   			progressBar.setTitle(MetadataManager.PROGRESS_DELETE);	                   	                   
+		            task.start();                                                                  
+		          }else {
+		        	  logger.debug(&quot;Button Cancle was press.&quot;);
+		          }
+	           }
+           }
        }
-    }
+   }       
     
-        class searchUserListener implements ActionListener {
+   /**
+    * * ActionListener class controlling the &lt;b&gt;Search/Sort&lt;/b&gt; button on the form.    
+    */
+    class searchUserListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
        {
+    	   // Check whether an error flag is set
+    	   if (model.isError()) {
+        	   view.showErrorMessage(MetadataManager.ERROR_TITLE, model.getError());
+        	   return;
+           }
            model.setSourceInstitutionId(view.sourceInstitutionIdText.getText());           
            model.setSourceId(view.sourceIdText.getText());
            model.setDataSetTitle(view.dataSetTitleText.getText());
             if (!(view.checkNonEmpty(&quot;sourceInstitutionId&quot;) || view.checkNonEmpty(&quot;sourceId&quot;) ||
                view.checkNonEmpty(&quot;dataSetTitle&quot;))) {
-               view.showSearchInfoFillMessage();
+                //Display info message  saying that no search field has been filled in.
+               view.showInfoMessage(MetadataManager.INFORMATION_SEARCH_TITLE, MetadataManager.INFORMATION_SEARCH);
                model.setSourceInstitutionId(&quot;%&quot;);
            }          
-           //opet funkci pro vyzadani si dat postupne
-           model.searchMetadata();
-           //pokud je pocet radku pro zobrazeni roven 0, tak se nastavi defaultni hodnota
-           if (model.getDisplayRows() &lt;= 0) {
-               model.setDisplayRows(MetadataManager.DEFAULT_DISPLAY_ROWS);
-           }
-           if (model.getResultRows() &lt; 1) {
-               view.showSearchInfoMessage();
-           }
-           model.processResult(1, model.getDisplayRows());
-           view.tableMetadataList.setModel(new MetadataManagerTableModel(model));                      
-           view.displayedValueLabel.setText(model.getCurrentDisplayRows());  
-           view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());                      
+           //Load metadata with specific conditions
+           Task task = model.searchMetadata(true);   
+           
+           ProgressBar progressBar = new ProgressBar(task, view, true) {		   								  			
+			    private static final long serialVersionUID = -7147752276335991652L; 
+				public void exceptionHandler(Exception e) {
+					if (e instanceof DBLayerException) {	   									   							
+	   					DBLayerException dbex = (DBLayerException) e;	
+	   					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE, MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
+	   					getTask().stop();
+	   					return;
+	   				}
+	   				if (e instanceof RemoteException) {	 
+	   					RemoteException remex = (RemoteException) e;		
+	   					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE,MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
+	   					getTask().stop();
+	   					return;
+	   				}
+	   				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
+	   				logger.error(e);
+	   			}
+
+				public void afterStopping() {
+					if (model.getDisplayRows() &lt;= 0) {
+		               model.setDisplayRows(MetadataManager.DEFAULT_DISPLAY_ROWS);
+		           }
+		           //No record in result - show message to user
+		           if (model.getResultRows() &lt; 1) {
+		               view.showInfoMessage(MetadataManager.INFORMATION_RESULT_TITLE,MetadataManager.INFORMATION_RESULT);
+		           }
+		           model.processResult(1, model.getDisplayRows());
+		           if (model.isError()) return;		           
+		           view.tableMetadataList.setModel(new MetadataManagerTableModel(model)); 		           
+		           view.displayedValueLabel.setText(model.getCurrentDisplayRows());  
+		           view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString()); 		           
+               } 		   					
+			};
+			progressBar.setTitle(MetadataManager.PROGRESS_SEARCH);	                   	                   
+            task.start();                                                                  
        }
     }
     
     /**
+     *  Focus listener for the &lt;strong&gt;sort combobox&lt;/strong&gt; at the search panel. After losing focus 
+     *  automaticaly stores value of the field to model.
+     */
+    class SortComboFocusListener implements FocusListener {
+        public void focusLost(FocusEvent e) {
+            model.setSortField(view.sortField.getSelectedIndex());
+        }        
+
+        public void focusGained(FocusEvent e) {
+            // Empty, no action when focus gained
+        }
+    }    
+    
+    
+    /**
      *  Focus listener for the &lt;strong&gt;sort combobox&lt;/strong&gt; at the search panel. After losing focus automaticaly 
      *  stores value of the field to model.
      */

Modified: trunk/src/net/sf/plantlore/client/metadata/MetadataManagerTableModel.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/MetadataManagerTableModel.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/metadata/MetadataManagerTableModel.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -18,23 +18,26 @@
 import org.apache.log4j.Logger;
 
 /**
- *
- * @author Lada
+ * Implements a table model for the MetadataManage
+ * 
+ * @author Lada Oberreiterova
+ * @version 1.0
  */
 public class MetadataManagerTableModel  extends AbstractTableModel  {
-    
-  
-        //Logger
+     
+	private static final long serialVersionUID = 5504730682131771632L;
+	/** Instance of a logger */
     private Logger logger;
-    // MetadataManager model
-    private MetadataManager model; 
-    private ArrayList&lt;Metadata&gt; metadataDataList;
-    
+    /** Model of MetadataManager */
+    private MetadataManager model;
+    /** Results of a search query for displaying */
+    private ArrayList&lt;Metadata&gt; metadataDataList;    
     /** Names of the columns */
     private String[] columnNames;
     /** Data values displayed in the table*/
     private Object[][] data;
 
+    /** Constants used for identification of columns of table */
     public final static int SOURCEINSTITUTIONID = 0;
     public final static int SOURCEID = 1;
     public final static int DATASETTITLE = 2; 
@@ -43,7 +46,10 @@
     public final static int DATECREATE = 5;
     public final static int DATEMODIFIED = 6;    
     
-    /** Creates a new instance of MetadataManagerTableModel */
+    /** 
+     * Creates a new instance of MetadataManagerTableModel 
+     * @param model model of MetadataManager MVC     
+     */
     public MetadataManagerTableModel(MetadataManager model) {
         logger = Logger.getLogger(this.getClass().getPackage().getName());
     	this.model = model;        
@@ -51,6 +57,9 @@
     	initData();    	
     }  
    
+    /**
+     * Init names of columns.     
+     */
     private void initColumns() {
         columnNames = new String[7];                  
         columnNames[0] = L10n.getString(&quot;MetadataManager.SourceInstitutionId&quot;);   
@@ -68,7 +77,7 @@
     public void initData() {
     	
     	logger.debug(&quot;Metadata - Init data.&quot;);
-    	
+    	//For no record in result return empty object
     	metadataDataList = model.getMetadataList();
     	if (metadataDataList.size()==0 ){
     		this.data = new Object[0][];
@@ -78,9 +87,9 @@
     	int countResult = Math.min(metadataDataList.size(), firstRow+ model.getDisplayRows()-1);
     	int countRow = countResult - firstRow + 1;   
         int ii = 0;
-    	//loud data for view
-        Object[][] metadataData = new Object[countRow][7];   
-    	for (int i=firstRow-1; i &lt; countResult; i++) {     
+    	//load data for view
+        Object[][] metadataData = new Object[countRow][7];
+        for (int i=firstRow-1; i &lt; countResult; i++) {    	       		                    
             metadataData[ii][0] = ((Metadata)metadataDataList.get(i)).getSourceInstitutionId();  
             metadataData[ii][1] = ((Metadata)metadataDataList.get(i)).getSourceId();  
             metadataData[ii][2] = ((Metadata)metadataDataList.get(i)).getDataSetTitle();

Modified: trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.form	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.form	2006-08-03 08:49:39 UTC (rev 483)
@@ -22,17 +22,17 @@
     &lt;DimensionLayout dim=&quot;0&quot;&gt;
       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
           &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
                   &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;1&quot;&gt;
-                      &lt;Component id=&quot;helpButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Component id=&quot;closeButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;helpButton&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;685&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;closeButton&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;Component id=&quot;jPanel2&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                  &lt;Component id=&quot;jPanel1&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                  &lt;Component id=&quot;jPanel2&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                  &lt;Component id=&quot;jPanel1&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
               &lt;/Group&gt;
-              &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
       &lt;/Group&gt;
     &lt;/DimensionLayout&gt;
@@ -70,23 +70,24 @@
               &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                   &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                      &lt;Component id=&quot;jScrollPane1&quot; alignment=&quot;0&quot; pref=&quot;775&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jScrollPane1&quot; alignment=&quot;0&quot; pref=&quot;779&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
                               &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
-                                  &lt;Component id=&quot;previousButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                                  &lt;EmptySpace pref=&quot;12&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;previousButton&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;EmptySpace min=&quot;-2&quot; pref=&quot;56&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;totalResultLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;totalResultValueLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;EmptySpace min=&quot;-2&quot; pref=&quot;37&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;toDisplayedLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;toDisplayValueTextField&quot; min=&quot;-2&quot; pref=&quot;33&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;EmptySpace min=&quot;-2&quot; pref=&quot;25&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;displayedLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;displayedValueLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;EmptySpace min=&quot;0&quot; pref=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                               &lt;/Group&gt;
                               &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
                                   &lt;Component id=&quot;detailsButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
@@ -101,7 +102,7 @@
                                   &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;deleteButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
                               &lt;/Group&gt;
-                              &lt;Component id=&quot;nextButton&quot; alignment=&quot;1&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
+                              &lt;Component id=&quot;nextButton&quot; alignment=&quot;1&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
                           &lt;/Group&gt;
                           &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
@@ -139,6 +140,9 @@
       &lt;/Layout&gt;
       &lt;SubComponents&gt;
         &lt;Container class=&quot;javax.swing.JScrollPane&quot; name=&quot;jScrollPane1&quot;&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_InitCodePost&quot; type=&quot;java.lang.String&quot; value=&quot;jScrollPane1.getViewport().setBackground(Color.WHITE);&quot;/&gt;
+          &lt;/AuxValues&gt;
 
           &lt;Layout class=&quot;org.netbeans.modules.form.compat2.layouts.support.JScrollPaneSupportLayout&quot;/&gt;
           &lt;SubComponents&gt;
@@ -154,6 +158,7 @@
                 &lt;/Property&gt;
               &lt;/Properties&gt;
               &lt;AuxValues&gt;
+                &lt;AuxValue name=&quot;JavaCodeGenerator_InitCodePost&quot; type=&quot;java.lang.String&quot; value=&quot;TransferFocus.patch(tableMetadataList);&quot;/&gt;
                 &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
               &lt;/AuxValues&gt;
             &lt;/Component&gt;
@@ -316,13 +321,13 @@
                           &lt;/Group&gt;
                           &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                              &lt;Component id=&quot;sourceInstitutionIdText&quot; pref=&quot;103&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;sourceIdText&quot; alignment=&quot;0&quot; pref=&quot;103&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                              &lt;Component id=&quot;sourceInstitutionIdText&quot; pref=&quot;124&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                              &lt;Component id=&quot;sourceIdText&quot; alignment=&quot;0&quot; pref=&quot;124&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
                           &lt;/Group&gt;
                           &lt;EmptySpace min=&quot;-2&quot; pref=&quot;15&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Component id=&quot;dataSetTitleLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;dataSetTitleText&quot; min=&quot;-2&quot; pref=&quot;145&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
+                          &lt;Component id=&quot;dataSetTitleText&quot; pref=&quot;124&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
                       &lt;/Group&gt;
                       &lt;Component id=&quot;searchButton&quot; min=&quot;-2&quot; pref=&quot;120&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
                   &lt;/Group&gt;
@@ -405,7 +410,7 @@
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                           &lt;Component id=&quot;sortDescendingRadioButton&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Component id=&quot;sortAscendingRadioButton&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;jComboBox1&quot; alignment=&quot;0&quot; min=&quot;-2&quot; pref=&quot;199&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;sortField&quot; alignment=&quot;0&quot; min=&quot;-2&quot; pref=&quot;199&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                       &lt;EmptySpace pref=&quot;25&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
@@ -416,7 +421,7 @@
                   &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                           &lt;Component id=&quot;dataSortLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;jComboBox1&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;sortField&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                       &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;sortAscendingRadioButton&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -471,12 +476,15 @@
                 &lt;/Property&gt;
               &lt;/Properties&gt;
             &lt;/Component&gt;
-            &lt;Component class=&quot;javax.swing.JComboBox&quot; name=&quot;jComboBox1&quot;&gt;
+            &lt;Component class=&quot;javax.swing.JComboBox&quot; name=&quot;sortField&quot;&gt;
               &lt;Properties&gt;
                 &lt;Property name=&quot;model&quot; type=&quot;javax.swing.ComboBoxModel&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
                   &lt;Connection code=&quot;new javax.swing.DefaultComboBoxModel(new String[] { L10n.getString(&quot;MetadataManager.SourceInstitutionId&quot;), L10n.getString(&quot;MetadataManager.SourceId&quot;), L10n.getString(&quot;MetadataManager.DataSetTitle&quot;), L10n.getString(&quot;MetadataManager.TechnicalContactName&quot;),L10n.getString(&quot;MetadataManager.ContentContactName&quot;), L10n.getString(&quot;MetadataManager.DateCreate&quot;), L10n.getString(&quot;MetadataManager.DateModified&quot;)})&quot; type=&quot;code&quot;/&gt;
                 &lt;/Property&gt;
               &lt;/Properties&gt;
+              &lt;AuxValues&gt;
+                &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+              &lt;/AuxValues&gt;
             &lt;/Component&gt;
           &lt;/SubComponents&gt;
         &lt;/Container&gt;

Modified: trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -6,31 +6,45 @@
 
 package net.sf.plantlore.client.metadata;
 
+import java.awt.Color;
 import java.util.Observable;
 import java.util.Observer;
 import javax.swing.DefaultListSelectionModel;
+import javax.swing.JDialog;
 import javax.swing.JOptionPane;
 import net.sf.plantlore.common.PlantloreHelp;
+import net.sf.plantlore.common.TransferFocus;
 import net.sf.plantlore.l10n.L10n;
 
 /**
- *
- * @author  Lada
+ * View for the main MetadataManager dialog (part of the History MVC). Used for displaying the search results.
+ * 
+ * @author  Lada Oberreiterova
+ * @version 1.0
  */
 public class MetadataManagerView extends javax.swing.JDialog implements Observer{
     
-    //Whole MetadataManager model
+	private static final long serialVersionUID = 251086612790983605L;
+	/** Model of the MetadataManager MVC*/
     private MetadataManager model;  
-    //data
-    private Object[][] data;
-    
-    /** Creates new form MetadataManagerView */
+ 
+    /** Creates new form MetadataManagerView
+     * 
+     * @param model model of the MetadataManager MVC
+     * @param parent parent of this dialog
+     * @param modal boolean flag whether the dialog should be modal or not
+     */
     public MetadataManagerView(MetadataManager model, java.awt.Frame parent, boolean modal) {
         super(parent, modal);
         this.model = model;
+        model.addObserver(this);
+        setDefaultCloseOperation(JDialog.HIDE_ON_CLOSE);
         initComponents();
+        getRootPane().setDefaultButton(closeButton);
+        //Init Help
         PlantloreHelp.addKeyHelp(PlantloreHelp.METDATA_MANAGER, this.getRootPane());
-        PlantloreHelp.addButtonHelp(PlantloreHelp.METDATA_MANAGER, this.helpButton);        
+        PlantloreHelp.addButtonHelp(PlantloreHelp.METDATA_MANAGER, this.helpButton); 
+        
         sortButtonGroup.add(sortAscendingRadioButton);
         sortButtonGroup.add(sortDescendingRadioButton);
         sortButtonGroup.setSelected(sortAscendingRadioButton.getModel(), true);
@@ -40,18 +54,29 @@
        
     }
     
-    public void update(Observable observable, Object object)
-    {
-    }
+    /**
+     * Reload the view dialog or display some kind of error.
+     */
+      public void update(Observable observable, Object object)
+    {                                
+    	  //Check whether we have some kind of error to display
+          if (model.isError()) {
+              showErrorMessage(L10n.getString(&quot;Common.ErrorMessageTitle&quot;), model.getError());                          
+              return;
+          } 
+    }      
     
      /**
-     *
+     *  Close this dialog.
      */
     public void close() {
         dispose();
     }
     
-    /**Rows to display */
+    /**
+     *  Get the number of rows to display per page
+     *  @return number of rows to display per page
+     */
     public Integer getDisplayRows() { 
         Integer countRows;
         try {
@@ -62,12 +87,19 @@
         return countRows;
     }
     
-    /**Rows to display*/
+    /**
+     *  Set the number of rows to display per page
+     *  @param value number of rows to display per page
+     */  
     public void setDisplayRows(Integer value) {
         this.toDisplayValueTextField.setText(value.toString());
     }  
     
-     public int getSortDirection() {
+    /**
+     *  Get the direction of sorting.
+     *  @return direction of sorting. 0 is ASCENDING, 1 is DESCENDING
+     */
+    int getSortDirection() {
         if (this.sortButtonGroup.isSelected(this.sortAscendingRadioButton.getModel()) == true) {
             return 0;
         } else {
@@ -75,7 +107,7 @@
         }
     }
      
-         /**
+     /**
      *  Check whether the given field is emty or not. This is used for validating user input when searching
      *  user.
      *
@@ -95,29 +127,44 @@
         return true;
     }
     
+    /**
+     *  Display generic error message.
+     *  @param title title of error message
+     *  @param message error message we want to display
+     */
+    public void showErrorMessage(String title, String message) {
+        JOptionPane.showMessageDialog(this, message, title, JOptionPane.ERROR_MESSAGE);               
+    }
+    
       /**
-     * Display warning message saying that no row of table has been selected.
+     * Display warning message.
+     * @param title title of warning message
+     * @param message warning message we want to display
      */
-    public void selectRowMessage() {    	
-        JOptionPane.showMessageDialog(this, L10n.getString(&quot;Warning.EmptySelection&quot;), L10n.getString(&quot;Warning.EmptySelectionTitle&quot;), JOptionPane.WARNING_MESSAGE);               
+    public void showWarningMessage(String title, String message) {    	
+        JOptionPane.showMessageDialog(this, message, title, JOptionPane.WARNING_MESSAGE);               
     }             
     
-     public int messageDelete(String message) {
-    	int okCancle = JOptionPane.showConfirmDialog(this, L10n.getString(&quot;Question.DeleteMetadata&quot;), L10n.getString(&quot;Question.DeleteMetadataTitle&quot;), JOptionPane.OK_CANCEL_OPTION);
+    /**
+     * Display OK_CANCLE message
+     * @param title title of question message
+     * @param message message containing same question for user
+     * @return information which button was selected - OK or Cancle 
+     */
+     public int showQuestionMessage(String title, String message) {
+    	int okCancle = JOptionPane.showConfirmDialog(this, message, title, JOptionPane.OK_CANCEL_OPTION);
     	return okCancle;
     }          
     
      /**
-     *  Display info message saying that no search field has been filled in.
+     *  Display info message 
+     *  @param title title of info message
+     *  @param message information message we want to display
      */
-    public void showSearchInfoFillMessage() {
-         JOptionPane.showMessageDialog(this, L10n.getString(&quot;Information.SearchMetadata&quot;), L10n.getString(&quot;Information.SearchMetadataTitle&quot;), JOptionPane.INFORMATION_MESSAGE);       
+    public void showInfoMessage(String title, String message) {
+         JOptionPane.showMessageDialog(this, message, title, JOptionPane.INFORMATION_MESSAGE);       
     }
     
-    public void showSearchInfoMessage() {
-        JOptionPane.showMessageDialog(this, L10n.getString(&quot;Information.NoMetadataInResult&quot;), L10n.getString(&quot;Information.NoMetadataInResultTitle&quot;), JOptionPane.INFORMATION_MESSAGE);                
-    }
-    
     /** This method is called from within the constructor to
      * initialize the form.
      * WARNING: Do NOT modify this code. The content of this method is
@@ -152,13 +199,14 @@
         sortDescendingRadioButton = new javax.swing.JRadioButton();
         sortAscendingRadioButton = new javax.swing.JRadioButton();
         dataSortLabel = new javax.swing.JLabel();
-        jComboBox1 = new javax.swing.JComboBox();
+        sortField = new javax.swing.JComboBox();
         dataSetTitleLabel = new javax.swing.JLabel();
         dataSetTitleText = new javax.swing.JTextField();
         searchButton = new javax.swing.JButton();
 
         setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
         jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(L10n.getString(&quot;MetadataManager.ListPanel&quot;)));
+        jScrollPane1.getViewport().setBackground(Color.WHITE);
         tableMetadataList.setModel(new javax.swing.table.DefaultTableModel(
             new Object [][] {
                 {null, null, null, null},
@@ -170,6 +218,7 @@
                 &quot;Title 1&quot;, &quot;Title 2&quot;, &quot;Title 3&quot;, &quot;Title 4&quot;
             }
         ));
+        TransferFocus.patch(tableMetadataList);
         jScrollPane1.setViewportView(tableMetadataList);
 
         previousButton.setText(L10n.getString(&quot;MetadataManager.ButtonPrev&quot;));
@@ -203,12 +252,12 @@
             .add(jPanel1Layout.createSequentialGroup()
                 .addContainerGap()
                 .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                    .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 775, Short.MAX_VALUE)
+                    .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 779, Short.MAX_VALUE)
                     .add(jPanel1Layout.createSequentialGroup()
                         .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                             .add(jPanel1Layout.createSequentialGroup()
-                                .add(previousButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 12, Short.MAX_VALUE)
+                                .add(previousButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                                .add(56, 56, 56)
                                 .add(totalResultLabel)
                                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                 .add(totalResultValueLabel)
@@ -219,7 +268,8 @@
                                 .add(25, 25, 25)
                                 .add(displayedLabel)
                                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                                .add(displayedValueLabel))
+                                .add(displayedValueLabel)
+                                .add(0, 0, Short.MAX_VALUE))
                             .add(jPanel1Layout.createSequentialGroup()
                                 .add(detailsButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
@@ -230,7 +280,7 @@
                                 .add(editButtons, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                 .add(deleteButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
-                            .add(nextButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                            .add(nextButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                         .addContainerGap())))
         );
         jPanel1Layout.setVerticalGroup(
@@ -278,7 +328,7 @@
 
         dataSortLabel.setText(L10n.getString(&quot;MetadataManager.DataSort&quot;));
 
-        jComboBox1.setModel(new javax.swing.DefaultComboBoxModel(new String[] { L10n.getString(&quot;MetadataManager.SourceInstitutionId&quot;), L10n.getString(&quot;MetadataManager.SourceId&quot;), L10n.getString(&quot;MetadataManager.DataSetTitle&quot;), L10n.getString(&quot;MetadataManager.TechnicalContactName&quot;),L10n.getString(&quot;MetadataManager.ContentContactName&quot;), L10n.getString(&quot;MetadataManager.DateCreate&quot;), L10n.getString(&quot;MetadataManager.DateModified&quot;)}));
+        sortField.setModel(new javax.swing.DefaultComboBoxModel(new String[] { L10n.getString(&quot;MetadataManager.SourceInstitutionId&quot;), L10n.getString(&quot;MetadataManager.SourceId&quot;), L10n.getString(&quot;MetadataManager.DataSetTitle&quot;), L10n.getString(&quot;MetadataManager.TechnicalContactName&quot;),L10n.getString(&quot;MetadataManager.ContentContactName&quot;), L10n.getString(&quot;MetadataManager.DateCreate&quot;), L10n.getString(&quot;MetadataManager.DateModified&quot;)}));
 
         org.jdesktop.layout.GroupLayout jPanel3Layout = new org.jdesktop.layout.GroupLayout(jPanel3);
         jPanel3.setLayout(jPanel3Layout);
@@ -291,7 +341,7 @@
                 .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(sortDescendingRadioButton)
                     .add(sortAscendingRadioButton)
-                    .add(jComboBox1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 199, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                    .add(sortField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 199, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                 .addContainerGap(25, Short.MAX_VALUE))
         );
         jPanel3Layout.setVerticalGroup(
@@ -299,7 +349,7 @@
             .add(jPanel3Layout.createSequentialGroup()
                 .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(dataSortLabel)
-                    .add(jComboBox1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                    .add(sortField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(sortAscendingRadioButton)
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
@@ -324,12 +374,12 @@
                             .add(sourceLabel))
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                            .add(sourceInstitutionIdText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 99, Short.MAX_VALUE)
-                            .add(sourceIdText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 99, Short.MAX_VALUE))
+                            .add(sourceInstitutionIdText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 124, Short.MAX_VALUE)
+                            .add(sourceIdText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 124, Short.MAX_VALUE))
                         .add(15, 15, 15)
                         .add(dataSetTitleLabel)
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                        .add(dataSetTitleText, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 145, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                        .add(dataSetTitleText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 124, Short.MAX_VALUE))
                     .add(searchButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 120, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                 .add(31, 31, 31)
                 .add(jPanel3, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
@@ -362,14 +412,14 @@
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(layout.createSequentialGroup()
                 .addContainerGap()
-                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                     .add(org.jdesktop.layout.GroupLayout.LEADING, layout.createSequentialGroup()
-                        .add(helpButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
-                        .add(closeButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                        .add(helpButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 685, Short.MAX_VALUE)
+                        .add(closeButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                     .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                     .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
-                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                .addContainerGap())
         );
         layout.setVerticalGroup(
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -409,7 +459,6 @@
     protected javax.swing.JLabel displayedValueLabel;
     protected javax.swing.JButton editButtons;
     protected javax.swing.JButton helpButton;
-    private javax.swing.JComboBox jComboBox1;
     private javax.swing.JPanel jPanel1;
     private javax.swing.JPanel jPanel2;
     private javax.swing.JPanel jPanel3;
@@ -420,6 +469,7 @@
     protected javax.swing.JRadioButton sortAscendingRadioButton;
     private javax.swing.ButtonGroup sortButtonGroup;
     protected javax.swing.JRadioButton sortDescendingRadioButton;
+    protected javax.swing.JComboBox sortField;
     protected javax.swing.JTextField sourceIdText;
     private javax.swing.JLabel sourceInstitutionIdLabel;
     protected javax.swing.JTextField sourceInstitutionIdText;

Modified: trunk/src/net/sf/plantlore/common/PlantloreHelp.java
===================================================================
--- trunk/src/net/sf/plantlore/common/PlantloreHelp.java	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/common/PlantloreHelp.java	2006-08-03 08:49:39 UTC (rev 483)
@@ -66,9 +66,9 @@
     // Add/edit publication dialog
     public static final String PUBLICATION_ADD          = &quot;publication.add&quot;;        
     // Description of metadata manager
-    public static final String METDATA_MANAGER          = &quot;metdata&quot;;    
+    public static final String METDATA_MANAGER          = &quot;metadata&quot;;    
     // Add/edit metadata dialog
-    public static final String METDATA_ADD              = &quot;metdata.add&quot;;        
+    public static final String METDATA_ADD              = &quot;metadata.add&quot;;        
     // Description of history manager
     public static final String HISTORY_MANAGER          = &quot;history&quot;;
     // Desctripton of user manager

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-08-03 08:49:39 UTC (rev 483)
@@ -266,7 +266,7 @@
 UserManager.ButtonDrop = Drop User
 UserManager.ButtonAdd = Add User
 UserManager.ButtonEdit = Edit User
-UserManager.ButtonDetails = Details of User
+UserManager.ButtonDetails = Details
 UserManager.ButtonPrev = Previous
 UserManager.ButtonNext = Next
 UserManager.ButtonSearch = Search/Sort
@@ -328,13 +328,13 @@
 MetadataManager.OwnerOrganizationAbbrev = Organization
 MetadataManager.DateCreate = Created on
 MetadataManager.DateModified = Modified on
-MetadataManager.RecordBasis = Basis
-MetadataManager.BiotopeText = BiotopeText
+MetadataManager.Recordbasis = Basis
+MetadataManager.Biotopetext = BiotopeText
 
 MetadataManager.ButtonDelete = Delete Metadata
 MetadataManager.ButtonAdd = Add Metadata
 MetadataManager.ButtonEdit = Edit Metadata
-MetadataManager.ButtonDetails = Details of Metadata
+MetadataManager.ButtonDetails = Details
 MetadataManager.ButtonPrev = Previous
 MetadataManager.ButtonNext = Next
 MetadataManager.ButtonSearch = Search/Sort
@@ -344,7 +344,7 @@
 
 MetadataManager.DisplayRows = Rows to display
 MetadataManager.TotalResult = Total results:
-MetadataManager.RowsToDisplay = Rows to display:
+MetadataManager.RowToDisplay = Rows to display:
 MetadataManager.Displayed = Displayed rows:
 MetadataManager.DataSort = Sort by
 MetadataManager.SortAscending = Ascending
@@ -629,7 +629,6 @@
 warningNoUsername = No username has been entered.\n Please select or type a username and try again.
 warningNoUsernameTitle = Missing username...
 
-
 #=============================================================
 # LIST OF INFORMATIONS
 #=============================================================
@@ -661,8 +660,6 @@
 errorCertificationException = The certification failed - the password is incorrect.\n Please type the password again.
 errorCertificationExceptionTitle = Certification failure!
 
-
-
 Error.InvalidDBLayer = The database layer is not valid! 
 Error.InvalidBuilder = The supplied Builder is not valid!
 Error.InvalidResultset = The supplied result set identifier is not valid!
@@ -701,10 +698,10 @@
 Error.UnableToProcess = The record No. {0} cannot be processed; 
 Error.MissingUpdateRecord = The update is not defined! 
 
-Error.HistoryRecordSearchFailed = Connection to the database failed.\n The record was not found.\n Contact administrator.
-Error.HistoryDataSearchFailed = Connection to the database failed.\n The history data were not found.\n \n Contact administrator.
-Error.HistoryObjectSearchFailed = Work with data failed. \n Some data were not found in database.
-Error.HistoryAuthorSearchFailed = Work with data failed. \n Some data were not found in database.
+Error.HistoryRecordSearchFailed = Connection to the database failed.\n The record was not found.\n Contact administrator. \n
+Error.HistoryDataSearchFailed = Connection to the database failed.\n The history data were not found.\n Contact administrator. \n
+Error.HistoryObjectSearchFailed = Work with data failed. \n Some data were not found in database. \n
+Error.HistoryAuthorSearchFailed = Work with data failed. \n Some data were not found in database. \n
 Error.HistoryProcessResultsFailed = Processing search results failed.
 Error.HistoryUpdateResultsFailed = Update data in the database failed.
 Error.HistoryDeleteResultsFailed = Update data in the database failed.  
@@ -716,10 +713,23 @@
 Error.HistoryDBLayerException=Connection to the database failed.\n Data were not found.
 Error.HistoryDBLayerExceptionTitle=Database problem.
 
+Error.MetadataSearchFailed =  The metadata was not found.\n        
+Error.MetadataProcessResultsFailed = Processing search results failed. \n 
+Error.MetadataAddFailed = Additing metadata failed. \n
+Error.MetadataEditFailed = Updating metadata failed. \n
+Error.MetadataDeleteFailed = Deleting metadata failed. \n
+Error.MetadataMessageTitle = Error
+Error.MetadataCheckDelete = The Metadata record cannot be deleted.\n Some Occurrence linked to this metadata. \n
+Error.MetadataUniqueDatasetTitle = DataSetTitle already exists    
+
+Error.GetNumberRows = Get the number of rows returned in the result failed. \n
 Error.DBLayerException=Connection to the database failed\:
 Error.DBLayerExceptionTitle=Database connection problem
 Error.RemoteException=Please make sure the network connection is working.
 Error.RemoteExceptionTitle=Network problem
+Error.UnknownExceptionTitle = Error
+Error.UnknownException = 
+
 Delete.Message.UnknownException=Some problem occurred during deletion\:
 authorSearchFailed=Searching authors failed
 authorSaveFailed=Saving author failed
@@ -755,8 +765,19 @@
 questionAlreadyBoundException = Another server is already running on the selected port.\n Maybe you wanted to connect to it. Shall I do it for you?
 questionAlreadyBoundExceptionTitle = Server collision!
 
+#=============================================================
+# Listo of Progress Title
+#=============================================================
 
+Metadata.Search.ProgressTitle = Loading metadata
+Metadata.Add.ProgressTitle = Adding Metadata 
+Metadata.Edit.ProgressTitle = Editing Metadata
+Metadata.Delete.ProgressTitle = Deleting Metadata
 
+#=============================================================
+#
+#=============================================================
+
 Author.list=List of authors
 #Add author button
 Author.AddButton=Add author

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties	2006-08-01 10:17:21 UTC (rev 482)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties	2006-08-03 08:49:39 UTC (rev 483)
@@ -344,7 +344,7 @@
 MetadataManager.ButtonDelete = Delete Metadata
 MetadataManager.ButtonAdd = Add Metadata
 MetadataManager.ButtonEdit = Edit Metadata
-MetadataManager.ButtonDetails = Details of Metadata
+MetadataManager.ButtonDetails = Details
 MetadataManager.ButtonPrev = Previous
 MetadataManager.ButtonNext = Next
 MetadataManager.ButtonSearch = Search/Sort


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000630.html">[Plantlore-dev] Logout &amp; Database reconnect
</A></li>
	<LI>Next message: <A HREF="000632.html">[Plantlore-dev] r484 - trunk/src/net/sf/plantlore/client/user
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#631">[ date ]</a>
              <a href="thread.html#631">[ thread ]</a>
              <a href="subject.html#631">[ subject ]</a>
              <a href="author.html#631">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
