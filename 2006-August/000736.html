<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r539 - in trunk/src/net/sf/plantlore: client	client/export client/export/builders common
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-August/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r539%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%0A%09client/export%20client/export/builders%20common&In-Reply-To=%3C200608211045.k7LAj0d2015712%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000735.html">
   <LINK REL="Next"  HREF="000737.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r539 - in trunk/src/net/sf/plantlore: client	client/export client/export/builders common</H1>
    <B>krater at mail.berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r539%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%0A%09client/export%20client/export/builders%20common&In-Reply-To=%3C200608211045.k7LAj0d2015712%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r539 - in trunk/src/net/sf/plantlore: client	client/export client/export/builders common">krater at mail.berlios.de
       </A><BR>
    <I>Mon Aug 21 12:45:00 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000735.html">[Plantlore-dev] r537 - in trunk/analysis/database: . Old DB model
</A></li>
        <LI>Next message: <A HREF="000737.html">[Plantlore-dev] r540 - trunk/src/net/sf/plantlore/client/imports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#736">[ date ]</a>
              <a href="thread.html#736">[ thread ]</a>
              <a href="subject.html#736">[ subject ]</a>
              <a href="author.html#736">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: krater
Date: 2006-08-21 12:44:56 +0200 (Mon, 21 Aug 2006)
New Revision: 539

Removed:
   trunk/src/net/sf/plantlore/client/export/ExportMng.java
   trunk/src/net/sf/plantlore/client/export/ExportMngCtrlA.java
   trunk/src/net/sf/plantlore/client/export/ExportMngCtrlB.java
   trunk/src/net/sf/plantlore/client/export/ExportProgressCtrl.java
   trunk/src/net/sf/plantlore/client/export/ExportProgressView.form
   trunk/src/net/sf/plantlore/client/export/ExportProgressView.java
   trunk/src/net/sf/plantlore/client/export/ExportTask.java
   trunk/src/net/sf/plantlore/client/export/builders/XMLBuilder.java
Modified:
   trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
   trunk/src/net/sf/plantlore/common/AutoComboBoxNG3.java
Log:
Remnants of old export removed throughout the code and repository.

New Occurrence import bound to the AppCoreCtrl (removal of deprecated client.imports will follow).

AutoComboBoxNG3 gives some credit to Jakub (for solving several bugs).

Modified: trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-08-21 08:32:21 UTC (rev 538)
+++ trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-08-21 10:44:56 UTC (rev 539)
@@ -46,16 +46,14 @@
 import net.sf.jasperreports.engine.JasperPrint;
 import net.sf.jasperreports.engine.JasperReport;
 
-import net.sf.plantlore.client.export.ExportMng;
-import net.sf.plantlore.client.export.ExportMngCtrlA;
-import net.sf.plantlore.client.export.ExportProgressCtrl;
-import net.sf.plantlore.client.export.ExportProgressView;
 import net.sf.plantlore.client.history.History;
 import net.sf.plantlore.client.history.WholeHistoryCtrl;
 import net.sf.plantlore.client.history.WholeHistoryView;
 import net.sf.plantlore.client.metadata.MetadataManager;
 import net.sf.plantlore.client.metadata.MetadataManagerCtrl;
 import net.sf.plantlore.client.metadata.MetadataManagerView;
+import net.sf.plantlore.client.occurrenceimport.OccurrenceImportMng;
+import net.sf.plantlore.client.occurrenceimport.OccurrenceImportMngCtrl;
 import net.sf.plantlore.client.overview.*;
 import net.sf.plantlore.client.overview.detail.Detail;
 import net.sf.plantlore.client.overview.detail.DetailCtrl;
@@ -104,12 +102,6 @@
 import net.sf.plantlore.client.export.ExportMngCtrl2;
 import net.sf.plantlore.client.history.HistoryCtrl;
 import net.sf.plantlore.client.history.HistoryView;
-import net.sf.plantlore.client.imports.DecisionCtrl;
-import net.sf.plantlore.client.imports.DecisionView;
-import net.sf.plantlore.client.imports.ImportMng;
-import net.sf.plantlore.client.imports.ImportMngCtrl;
-import net.sf.plantlore.client.imports.ImportProgressCtrl;
-import net.sf.plantlore.client.imports.ImportProgressView;
 import net.sf.plantlore.client.login.Login;
 import net.sf.plantlore.client.login.LoginCtrl;
 import net.sf.plantlore.client.login.LoginView;
@@ -215,32 +207,16 @@
 	LoginCtrl loginCtrl;
 
 	// Export
-	ExportMng exportModel;
+	ExportMng2 exportModel;
 
-	ExportMngCtrlA exportCtrl;
+	ExportMngCtrl2 exportCtrl;
 
-	ExportProgressView exportProgressView;
-
-	ExportProgressCtrl exportProgressCtrl;
-
-	// Export2
-	ExportMng2 exportModel2;
-
-	ExportMngCtrl2 exportCtrl2;
-
 	// Import
-	ImportMng importModel;
+	OccurrenceImportMng importModel;
 
-	ImportMngCtrl importCtrl;
+	OccurrenceImportMngCtrl importCtrl;
 
-	ImportProgressView importProgressView;
 
-	ImportProgressCtrl importProgressCtrl;
-
-	DecisionView importDecisionView;
-
-	DecisionCtrl importDecisionCtrl;
-
 	// Immutable Table Import
 	TableImportMng tableImportModel;
 
@@ -590,30 +566,10 @@
 
 		public void actionPerformed(ActionEvent actionEvent) {
 			if (importModel == null) {
-				try {
-					importModel = new ImportMng(model.getDatabase());
-					importProgressView = new ImportProgressView(importModel);
-					importProgressCtrl = new ImportProgressCtrl(importModel,
-							importProgressView);
-
-					importCtrl = new ImportMngCtrl(importModel, view,
-							importProgressView);
-
-					importDecisionView = new DecisionView(importModel);
-					importDecisionCtrl = new DecisionCtrl(importModel,
-							importDecisionView);
-				} catch (ImportException e) {
-					logger.error(&quot;Import MVC cannot be created. &quot;
-							+ e.getMessage());
-					return;
-				}
+					importModel = new OccurrenceImportMng(model.getDatabase(), managerBridge);
+					importCtrl = new OccurrenceImportMngCtrl(importModel, view);
 			}
-
-			if (importModel.isImportInProgress())
-				importProgressView.setVisible(true);
-			else
-				importCtrl.setVisible(true);
-
+			importCtrl.setVisible(true);
 		}
 	}
 
@@ -627,87 +583,14 @@
 
 		public void actionPerformed(ActionEvent actionEvent) {
 			if (tableImportModel == null) {
-				try {
 					tableImportModel = new TableImportMng(model.getDatabase(), managerBridge);
 					tableImportCtrl = new TableImportMngCtrl(tableImportModel, view);
-				} catch (Exception e) {
-					logger.error(&quot;Import MVC cannot be created. &quot;
-							+ e.getMessage());
-					return;
-				}
 			}
-
 			tableImportCtrl.setVisible(true);
 		}
 	}
 
-	class ExportAction extends AbstractAction {
-		public ExportAction() {
-			putValue(NAME, L10n.getString(&quot;dataExport&quot;));
-			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;dataExportTooltip&quot;));
-			putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;dataExport&quot;));
-		}
 
-		public void actionPerformed(ActionEvent actionEvent) {
-			// Create a new dialog if it already doesn't exist.
-			if (exportModel == null) {
-				try {
-					exportModel = new ExportMng(model.getDatabase());
-					exportProgressView = new ExportProgressView(null);
-					exportProgressCtrl = new ExportProgressCtrl(null,
-							exportProgressView);
-					exportCtrl = new ExportMngCtrlA(exportModel, view,
-							exportProgressView, exportProgressCtrl);
-				} catch (ExportException e) {
-					logger.error(&quot;Export MVC cannot be created. &quot;
-							+ e.getMessage());
-					return;
-				}
-			}
-			// Display the progress view if an export is already running.
-			if (exportModel.isAnExportInProgress())
-				exportProgressView.setVisible(true);
-			// Display the Export dialog.
-			else {
-				try {
-					/*
-					 * ==============================================================
-					 * Right after the startup the searchModel may not be
-					 * initialized! (if Export is called prior to Search...)
-					 * 
-					 * FIXME: Solve this with Jakub.
-					 * ==============================================================
-					 */
-					SelectQuery query;
-					if (searchModel == null) {
-						System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; CREATING A FAKE QUERY&quot;);
-						query = model.getDatabase().createQuery(
-								Occurrence.class); // fake the query
-					} else {
-						Object[] queryParam = searchModel
-								.constructExportQuery();
-						query = (SelectQuery) queryParam[0];
-						if ((Boolean) queryParam[1]) { // use projections
-							exportModel.useProjections(true);
-							exportModel.setRootTable((Class) queryParam[2]);
-						}
-					}
-					exportModel.setSelectQuery(query);
-					exportModel.setSelection(model.getTableModel()
-							.getSelection());
-				} catch (DBLayerException e) {
-					JOptionPane.showMessageDialog(view, &quot;DBLayer Exception: &quot;
-							+ e);
-					return;
-				} catch (RemoteException e) {
-					JOptionPane.showMessageDialog(view, &quot;Remote Exception: &quot;
-							+ e);
-					return;
-				}
-				exportCtrl.setVisible(true);
-			}
-		}
-	}
 
 	class ExportAction2 extends AbstractAction {
 
@@ -719,21 +602,21 @@
 
 		public void actionPerformed(ActionEvent actionEvent) {
 			// Create a new dialog if it already doesn't exist.
-			if (exportModel2 == null) {
-				exportModel2 = new ExportMng2(model.getDatabase());
-				exportCtrl2 = new ExportMngCtrl2(exportModel2, view);
+			if (exportModel == null) {
+				exportModel = new ExportMng2(model.getDatabase());
+				exportCtrl = new ExportMngCtrl2(exportModel, view);
 			}
 			try {
 				SelectQuery query;
 				Object[] queryParam = searchModel.constructExportQuery();
 				query = (SelectQuery) queryParam[0];
 				if ((Boolean) queryParam[1]) { // use projections
-					exportModel2.useProjections(true);
-					exportModel2.setRootTable((Class) queryParam[2]);
+					exportModel.useProjections(true);
+					exportModel.setRootTable((Class) queryParam[2]);
 				}
 
-				exportModel2.setSelectQuery(query);
-				exportModel2.setSelection(model.getTableModel().getSelection());
+				exportModel.setSelectQuery(query);
+				exportModel.setSelection(model.getTableModel().getSelection());
 			} catch (DBLayerException e) {
 				// TODO: Some errors may lead to ReconnectDialog.show()!
 				JOptionPane.showMessageDialog(view, &quot;DBLayer Exception: &quot;
@@ -744,7 +627,7 @@
 				return;
 			}
 
-			exportCtrl2.setVisible(true);
+			exportCtrl.setVisible(true);
 		}
 	}
 
@@ -1759,8 +1642,8 @@
 				/*-------------------------------------------------------------------
 				     Distribute the database layer among existing models.
 				  -------------------------------------------------------------------*/
-				if( exportModel2 != null )
-					exportModel2.setDBLayer( dblayer );
+				if( exportModel != null )
+					exportModel.setDBLayer( dblayer );
 				if (historyModel != null ) 
 					historyModel.setDBLayer( dblayer );			
 				if (wholeHistoryModel != null ) 

Deleted: trunk/src/net/sf/plantlore/client/export/ExportMng.java
===================================================================
--- trunk/src/net/sf/plantlore/client/export/ExportMng.java	2006-08-21 08:32:21 UTC (rev 538)
+++ trunk/src/net/sf/plantlore/client/export/ExportMng.java	2006-08-21 10:44:56 UTC (rev 539)
@@ -1,380 +0,0 @@
-package net.sf.plantlore.client.export;
-
-import java.io.BufferedWriter;
-import java.io.FileOutputStream;
-import java.io.IOException;
-import java.io.OutputStreamWriter;
-import java.io.Writer;
-import java.rmi.RemoteException;
-import java.util.HashSet;
-import java.util.Observable;
-import java.util.Observer;
-import java.util.Set;
-
-import net.sf.plantlore.client.export.builders.*;
-import net.sf.plantlore.client.export.component.FileFormat;
-import net.sf.plantlore.common.Selection;
-import net.sf.plantlore.common.exception.ExportException;
-import net.sf.plantlore.l10n.L10n;
-import net.sf.plantlore.middleware.DBLayer;
-import net.sf.plantlore.middleware.SelectQuery;
-import net.sf.plantlore.common.exception.DBLayerException;
-import net.sf.plantlore.common.record.*;
-
-import org.apache.log4j.Logger;
-
-/**
- * The Export Manager. This class controls the whole process of export -
- * starting with creation of all necessary participants
- * and ending with the final cleanup. 
- * &lt;br/&gt;
- * There are several entities involved in the export:
- * &lt;ul&gt;
- * &lt;li&gt;&lt;b&gt;DBLayer&lt;/b&gt; the database layer that will carry out the requests.
- * 					Mustn't be null!&lt;/li&gt;
- * &lt;li&gt;&lt;b&gt;Director&lt;/b&gt; iterates over the &lt;i&gt;result set&lt;/i&gt; 
- * 					and &lt;i&gt;selected records&lt;/i&gt; passes to the &lt;i&gt;builder&lt;/i&gt;,&lt;/li&gt;
- * &lt;li&gt;&lt;b&gt;Builder&lt;/b&gt; writes the records to the &lt;i&gt;output&lt;/i&gt;.&lt;/li&gt;
- * &lt;li&gt;&lt;b&gt;Selection&lt;/b&gt; stores the list of all selected records 
- * 					(&lt;i&gt;restriction&lt;/i&gt; in the database terminology).&lt;/li&gt;
- * &lt;li&gt;&lt;b&gt;SelectQuery&lt;/b&gt; identifies the result set as well (in fact the resultId is derived from it).&lt;/li&gt;
- * &lt;li&gt;&lt;b&gt;Projection&lt;/b&gt; stores the list of all selected columns that should be 
- * 					exported (&lt;i&gt;projection&lt;/i&gt; in the database terminology).&lt;/li&gt;
- * &lt;li&gt;&lt;b&gt;File&lt;/b&gt; stores the name of file as the user has suggested it.&lt;/li&gt;
- * &lt;li&gt;&lt;b&gt;XFilter&lt;/b&gt; suggests the final name of the &lt;i&gt;file&lt;/i&gt;
- * 					and is used to determine which &lt;i&gt;builder&lt;/i&gt; will be used
- * 					to produce the output.&lt;/li&gt;
- * &lt;/ul&gt;
- * 
- * @author Erik Kratochv&#237;l (<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">discontinuum at gmail.com</A>)
- * @since 2006-04-29 
- * @version 2.0
- * @see net.sf.plantlore.client.export.DefaultDirector
- * @see net.sf.plantlore.client.export.Builder
- */
<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">- at Deprecated</A>
-public class ExportMng implements Observer {
-	
-	
-	public static final String ENCODING = &quot;UTF-8&quot;;
-	
-	
-	/**
-	 * List of all filters the Export Manager is capable to handle.
-	 */
-	protected FileFormat[] filters = new FileFormat[] {
-			new FileFormat(L10n.getString(&quot;Format.PlantloreNative&quot;), false, false, &quot;.xml&quot;, &quot;.pln&quot;),
-			new FileFormat(L10n.getString(&quot;Format.XML&quot;), true, true, &quot;.xml&quot;),
-			new FileFormat(L10n.getString(&quot;Format.CSV&quot;), true, true, &quot;.txt&quot;, &quot;.csv&quot;),	
-			new FileFormat(L10n.getString(&quot;Format.ABCD&quot;), &quot;.xml&quot;),	
-			new FileFormat(L10n.getString(&quot;Format.DC&quot;), &quot;.xml&quot;),
-			new FileFormat(L10n.getString(&quot;Format.StdOut&quot;), true, false, &quot;.out&quot;)
-	};
-	
-	
-	private Logger logger = Logger.getLogger(this.getClass().getPackage().getName());
-	private DBLayer db ;
-	private Projection template;
-	private Selection selection;
-	private FileFormat filter;
-	private String filename;
-	private SelectQuery query = null;
-	private boolean useProjections = false;
-	private Class rootTable = Occurrence.class;
-	
-	
-	/**
-	 * Create a new Export Manager.
-	 * 
-	 * @param dblayer The database layer mediating the access to the database.
-	 * @param query	The query defining the result set which is to be iterated over.
-	 * @param selection	The list of selected records. 
-	 * @param template	The list of selected columns. &lt;b&gt;Null means everything is selected.&lt;/b&gt;
-	 */
-	public ExportMng(DBLayer dblayer, SelectQuery query, Selection selection, Projection template) 
-	throws ExportException, DBLayerException, RemoteException {
-		this(dblayer, query, selection, template, null, null, false, null);
-	}
-
-	
-	/**
-	 * Create a new Export manager.
-	 * &lt;b&gt;Mark all records AND columns as selected&lt;/b&gt;.
-	 * &lt;b&gt;You will have to specify the SelectQuery&lt;/b&gt;
-	 * before you call &lt;code&gt;start()&lt;/code&gt;. 
-	 * 
-	 * @param dblayer	The database layer mediating the access to the database.
-	 */
-	public ExportMng(DBLayer dblayer) 
-	throws ExportException {
-		setDBLayer(dblayer);
-		setSelection(null);
-	}
-	
-	/**
-	 * Create a new Export manager and &lt;b&gt;mark all records AND columns as selected&lt;/b&gt;.
-	 * 
-	 * @param dblayer	The database layer mediating the access to the database.
-	 * @param query	The query defining the result set which is to be iterated over.
-	 */
-	public ExportMng(DBLayer dblayer, SelectQuery query) 
-	throws ExportException, DBLayerException, RemoteException {
-		this(dblayer, query, null, null, null, null, false, null);
-	}
-	
-	
-	/**
-	 * Create a new Export manager.
-	 * 
-	 * @param dblayer	The database layer mediating the access to the database. Shouldn't be empty.
-	 * @param query	The query defining the result set which is to be iterated over. Shouldn't be empty.
-	 * @param selection	The list of selected records. Shouldn't be empty.
-	 * @param template	The list of selected columns. &lt;b&gt;Null means everything is selected.&lt;/b&gt;
-	 * @param filter	The filter which will be used to determine the appropriate builder of the output.
-	 * @param file	The name of the file where the output will be written.
-	 * @param useProjections	Should projections be used.
-	 * @param rootTable	The root table (only if projections are used).
-	 */
-	public ExportMng(
-			DBLayer dblayer, 
-			SelectQuery query, 
-			Selection selection, 
-			Projection template, 
-			FileFormat filter, 
-			String filename,
-			boolean useProjections,
-			Class rootTable) 
-	throws ExportException, DBLayerException, RemoteException  {
-		useProjections( useProjections );
-		setRootTable( rootTable );
-		setDBLayer(dblayer);
-		setSelectQuery(query);
-		setSelection(selection);
-		setTemplate(template);
-		setSelectedFile(filename);
-		setActiveFileFilter(filter);
-	}
-	
-	
-	/**
-	 * @param useProjections	True if the Export manager shall use projections instead of regular records.
-	 */
-	synchronized public void useProjections(boolean useProjections) {
-		this.useProjections = useProjections;
-	}
-	
-	/**
-	 * If projections are used, the root table must be specified explicitely.
-	 * The default root table is the Occurrence table.
-	 * 
-	 * @param rootTable	The root table (the table the query started with). 
-	 */
-	synchronized public void setRootTable(Class rootTable) {
-		this.rootTable = rootTable;
-	}
-	
-	/**
-	 * Set a new DBLayer.
-	 */
-	synchronized public void setDBLayer(DBLayer dblayer) {
-		if(query != null) try {
-			db.closeQuery(query);
-		} catch(RemoteException e) {
-			// Never mind.
-		}
-		db = dblayer;
-	}
-	
-	/**
-	 * Store a copy of the &lt;code&gt;template&lt;/code&gt;. 
-	 * Null means all columns are selected.
-	 */
-	synchronized public void setTemplate(Projection template) {
-		if(template == null)
-			this.template = null;
-		else 
-			this.template = template.clone();
-	}
-	
-	/**
-	 * Store a copy of the &lt;code&gt;selection&lt;/code&gt;.
-	 * Null means all rows are selected.
-	 */
-	synchronized public void setSelection(Selection selection) {
-		if(selection == null)
-			this.selection = null;
-		else 
-			this.selection = selection.clone();
-	}
-	
-	/**
-	 * Set the active filter. The type of the filter will be used 
-	 * to determine the appropriate extension of the file
-	 * and to create a correct Builder (for the format this
-	 * filter represents). 
-	 */
-	synchronized public void setActiveFileFilter(FileFormat filter) {
-		this.filter = filter; 
-	}
-	
-	/**
-	 * Set the selected file. Into this file the builder will 
-	 * spit its output. 
-	 */
-	synchronized public void setSelectedFile(String filename) { 
-		this.filename = filename; 
-	}
-	
-	
-	/**
-	 * Set a particular select query. The manager will execute this select query
-	 * and update the &lt;code&gt;resultId&lt;/code&gt; if Projections are not used.
-	 * On the other hand, if Projections are used, it is the &lt;code&gt;setTemplate()&lt;/code&gt;
-	 * that executes the query after it adds desired projections.
-	 */
-	synchronized public void setSelectQuery(SelectQuery query) { 
-		// Close the previous query!
-		if(this.query != null) try {
-			db.closeQuery(this.query);  // This must go here because of the RMI!
-		} catch (RemoteException e) {
-			// Never mind.
-		}
-		this.query = query;
-	}
-	
-	
-	
-	
-	
-	private Set&lt;ExportTask&gt; exportTasks = new HashSet&lt;ExportTask&gt;(8);
-	
-	
-	/**
-	 * Start the export procedure. The export will run in its own thread.
-	 * 
-	 * @throws ExportException	If information provided is not complete.
-	 * @throws IOException	If anything with the file goes wrong (insufficient disk space, insufficient permissions).
-	 */
-	synchronized public ExportTask createExportTask() 
-	throws ExportException, IOException, DBLayerException {
-		if( exportTasks.size() &gt; 4 )
-			throw new ExportException(L10n.getString(&quot;Error.TooManyTasks&quot;));
-		// Check if all necessary components are valid.
-		if( db == null )
-			throw new ExportException(L10n.getString(&quot;Error.InvalidDBLayer&quot;));
-		if( query == null)
-			throw new ExportException(L10n.getString(&quot;Error.InvalidQuery&quot;));
-		if( filter == null ) 
-			throw new ExportException(L10n.getString(&quot;Error.InvalidFilter&quot;));
-		if( filename == null || filename.length() == 0 ) 
-			throw new ExportException(L10n.getString(&quot;Error.MissingFileName&quot;));
-		if( useProjections &amp;&amp; rootTable == null)
-			throw new ExportException(L10n.getString(&quot;Error.InvalidRootTable&quot;));
-		if(template == null || template.isEmpty())
-			template = new Projection().setEverything();
-		if(selection == null || selection.isEmpty())
-			selection = new Selection().all();
-			
-		
-		logger.debug(&quot;Initializing the export environment.&quot;);
-		
-		// Prepare the query for projections.
-		if(useProjections) {
-			if( rootTable == AuthorOccurrence.class || rootTable == Author.class )
-				template.addProjections( query, AuthorOccurrence.class, Author.class );
-			else
-				template.addProjections( query, 
-					Occurrence.class, Plant.class, Metadata.class, Publication.class, 
-					Habitat.class, Territory.class, Village.class, Phytochorion.class );
-		}
-		
-		// Execute the query.
-		Integer resultId = db.executeQuery( query );
-		int results  = db.getNumRows( resultId );
-		
-		// Create a new file and writer (wrapper).
-		Writer writer = new BufferedWriter(
-					new OutputStreamWriter(new FileOutputStream(filter.suggestName(filename)),
-					ENCODING));
-		if(writer == null) {
-			logger.fatal(&quot;Unable to create a new Writer.&quot;);
-			throw new ExportException(L10n.getString(&quot;Error.WriterNotCreated&quot;));
-		}
-		
-		logger.debug(&quot;Filename: &quot;+ filename);
-		
-		// Create a new builder according to the selected format. 
-		Builder builder;
-		if(filter.getDescription().equals(L10n.getString(&quot;Format.CSV&quot;)))
-			builder = new CSVBuilder(writer, template);
-		else if(filter.getDescription().equals(L10n.getString(&quot;Format.DC&quot;)))                        
-			builder = new DarwinCoreBuilder(writer);
-		else if(filter.getDescription().equals(L10n.getString(&quot;Format.ABCD&quot;))) 
-			builder = new ABCDBuilder(writer);
-		else if(filter.getDescription().equals(L10n.getString(&quot;Format.XML&quot;)))                        
-			builder = new XMLBuilder2(template, writer);                       
-		else if(filter.getDescription().equals(L10n.getString(&quot;Format.PlantloreNative&quot;)))                        
-			builder = new XMLBuilder(writer);                       
-		else {
-			builder = new TrainingBuilder(template);
-		}
-
-		// Create a new Director and run it in a separate thread.
-		DefaultDirector director = new DefaultDirector(
-				builder, resultId, db, selection, useProjections, 
-				template.getDescription(), rootTable);
-		director.ignoreDead( filter.ignoreDead() );
-		if( selection.size(results) &gt; 0 ) 
-			director.setExpectedNumberOfRecords( selection.size(results) );
-		
-		// Start a new task.
-		ExportTask t = new ExportTask(db, query, director, writer, selection.size(results));
-		exportTasks.add(t);
-		t.addObserver(this);
-		
-		// Reset variables.
-		query = null;
-		template = null;
-		selection = null;
-		filter = null;
-		filename = null;
-		useProjections = false;
-		rootTable = Occurrence.class;
-		
-		return t;
-	}
-	
-	
-		
-	/**
-	 * Abort every running Export. 
-	 */
-	synchronized public void abortAllTasks() {
-		for(ExportTask task : exportTasks) {
-			task.abort();
-			task.deleteObserver(this);
-		}
-		exportTasks.clear();
-	}
-	
-	
-	synchronized public boolean isAnExportInProgress() {
-		return exportTasks.size() != 0;
-	}
-	
-	/**
-	 * @return The list of filters describing formats this Export Manager can handle.
-	 */
-	public FileFormat[] getFilters() {
-		return filters.clone();
-	}
-
-
-	synchronized public void update(Observable source, Object arg) {
-		if( !((ExportTask)source).isExportInProgress() ) {
-			exportTasks.remove( source );
-			source.deleteObserver(this);
-		}
-	}
-	
-}

Deleted: trunk/src/net/sf/plantlore/client/export/ExportMngCtrlA.java
===================================================================
--- trunk/src/net/sf/plantlore/client/export/ExportMngCtrlA.java	2006-08-21 08:32:21 UTC (rev 538)
+++ trunk/src/net/sf/plantlore/client/export/ExportMngCtrlA.java	2006-08-21 10:44:56 UTC (rev 539)
@@ -1,76 +0,0 @@
-package net.sf.plantlore.client.export;
-
-import javax.swing.JFileChooser;
-import javax.swing.JOptionPane;
-import javax.swing.filechooser.FileFilter;
-
-import net.sf.plantlore.client.AppCoreView;
-import net.sf.plantlore.client.export.component.FileFormat;
-import net.sf.plantlore.l10n.L10n;
-
<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">- at Deprecated</A>
-public class ExportMngCtrlA {
-	
-	
-	private ExportMng model;
-	private AppCoreView view;
-	private JFileChooser choice;
-	
-	private ExportMngViewB viewB;
-	//private ExportMngCtrlB ctrlB;
-
-	private ExportProgressView progressView;
-	private ExportProgressCtrl progressCtrl;
-	
-	public ExportMngCtrlA(ExportMng model, AppCoreView view, 
-			ExportProgressView progressView, ExportProgressCtrl progressCtrl) {
-		this.model = model; this.view = view; 
-		this.progressView = progressView; this.progressCtrl = progressCtrl;
-		viewB = new ExportMngViewB(view);
-		/*ctrlB = */new ExportMngCtrlB(model, viewB, progressView, progressCtrl);
-		
-		choice = new JFileChooser();
-		choice.setAcceptAllFileFilterUsed(false);
-		for( FileFilter filter: model.getFilters() )
-			choice.addChoosableFileFilter(filter);
-	}
-	
-	public void setVisible(boolean visible) {
-		if(visible) {
-			// The dialog must have a parent so that it is displayed correctly above it after ALT+TAB is pressed.
-			int result = choice.showDialog(view, L10n.getString(&quot;Export.Title&quot;));
-			if( result == JFileChooser.APPROVE_OPTION ) {
-				
-				if(choice.getSelectedFile() == null) {
-//					JOptionPane.showMessageDialog(null,
-//							L10n.getString(&quot;Error.MissingFileName&quot;),
-//							L10n.getString(&quot;Error.NothingSelected&quot;),
-//						    JOptionPane.WARNING_MESSAGE);
-					return;
-				}
-				
-				model.setSelectedFile( choice.getSelectedFile().getAbsolutePath() );
-				FileFormat filter = (FileFormat) choice.getFileFilter();
-				model.setActiveFileFilter( filter );
-				
-				if( filter.isColumnSelectionEnabled() )
-					viewB.setVisible(true);
-				else try {
-					ExportTask task = model.createExportTask();
-					progressCtrl.setModel(task); 
-					progressView.setModel(task);
-					
-					task.execute();
-					
-					progressView.setVisible(true);
-				} catch(Exception e) {
-					JOptionPane.showMessageDialog(null,
-							L10n.getString(&quot;Error.ExportFailed&quot;) + e.getMessage(),
-							L10n.getString(&quot;Export.Failed&quot;),
-						    JOptionPane.WARNING_MESSAGE);
-				}
-			}
-		}
-	}
-
-}

Deleted: trunk/src/net/sf/plantlore/client/export/ExportMngCtrlB.java
===================================================================
--- trunk/src/net/sf/plantlore/client/export/ExportMngCtrlB.java	2006-08-21 08:32:21 UTC (rev 538)
+++ trunk/src/net/sf/plantlore/client/export/ExportMngCtrlB.java	2006-08-21 10:44:56 UTC (rev 539)
@@ -1,56 +0,0 @@
-package net.sf.plantlore.client.export;
-
-import java.awt.event.ActionEvent;
-
-import javax.swing.AbstractAction;
-import javax.swing.JOptionPane;
-
-import net.sf.plantlore.l10n.L10n;
-
-
-//import net.sf.plantlore.l10n.L10n;
<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">- at Deprecated</A>
-public class ExportMngCtrlB {
-	
-	private ExportMng model;
-	private ExportMngViewB view;
-	private ExportProgressView progressView;
-	private ExportProgressCtrl progressCtrl;
-	
-	public ExportMngCtrlB(ExportMng model, ExportMngViewB view, 
-			ExportProgressView progressView,  ExportProgressCtrl progressCtrl) {
-		this.model = model; this.view = view; 
-		this.progressView = progressView; this.progressCtrl = progressCtrl;
-		view.next.setAction( new Next() );
-	}
-	
-	
-	class Next extends AbstractAction {
-		public void actionPerformed(ActionEvent arg0) {
-			Projection t = view.tsm.getTemplate();
-			view.setVisible(false);
-			
-			
-			try {
-				model.setTemplate( t ); // Set the new template.
-				
-				ExportTask task = model.createExportTask();
-				progressCtrl.setModel(task); 
-				progressView.setModel(task);
-				
-				task.execute();
-				
-				progressView.setVisible(true);
-				
-				view.tsm.clearSelection();
-			}
-			catch(Exception e) {
-				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;Error.ExportFailed&quot;) + e.getMessage(),
-						L10n.getString(&quot;Export.Failed&quot;),
-						JOptionPane.WARNING_MESSAGE);
-			}
-		}
-	}
-
-}

Deleted: trunk/src/net/sf/plantlore/client/export/ExportProgressCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/export/ExportProgressCtrl.java	2006-08-21 08:32:21 UTC (rev 538)
+++ trunk/src/net/sf/plantlore/client/export/ExportProgressCtrl.java	2006-08-21 10:44:56 UTC (rev 539)
@@ -1,51 +0,0 @@
-package net.sf.plantlore.client.export;
-
-import java.awt.event.ActionEvent;
-
-import javax.swing.AbstractAction;
-import javax.swing.JOptionPane;
-
-import net.sf.plantlore.l10n.L10n;
-
-//import net.sf.plantlore.l10n.L10n;
-
<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">- at Deprecated</A>
-public class ExportProgressCtrl {
-	
-	private ExportTask model;
-	private ExportProgressView view;
-	
-	
-	public void setModel(ExportTask newModel) {
-		model = newModel;
-	}
-		
-	
-	public ExportProgressCtrl(ExportTask model, ExportProgressView view) {
-		setModel(model); this.view = view;
-		view.abort.setAction( new Abort() );
-	}
-	
-	class Abort extends AbstractAction {
-		public void actionPerformed(ActionEvent arg0) {
-			if(model != null &amp;&amp; model.isExportInProgress()) {
-				int response =
-					JOptionPane.showOptionDialog(view,
-							L10n.getString(&quot;Question.AbortExport&quot;),
-							L10n.getString(&quot;Export.Aborted&quot;),
-							JOptionPane.OK_CANCEL_OPTION,
-							JOptionPane.WARNING_MESSAGE,
-							null,
-							null,
-							null);
-				if(response == JOptionPane.OK_OPTION) {
-					model.abort();
-				}
-			}
-			else
-				view.setVisible(false);
-		}
-	}
-	
-
-}

Deleted: trunk/src/net/sf/plantlore/client/export/ExportProgressView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/export/ExportProgressView.form	2006-08-21 08:32:21 UTC (rev 538)
+++ trunk/src/net/sf/plantlore/client/export/ExportProgressView.form	2006-08-21 10:44:56 UTC (rev 539)
@@ -1,69 +0,0 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
-
-&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JFrameFormInfo&quot;&gt;
-  &lt;Properties&gt;
-    &lt;Property name=&quot;defaultCloseOperation&quot; type=&quot;int&quot; value=&quot;3&quot;/&gt;
-  &lt;/Properties&gt;
-  &lt;SyntheticProperties&gt;
-    &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
-  &lt;/SyntheticProperties&gt;
-  &lt;AuxValues&gt;
-    &lt;AuxValue name=&quot;FormSettings_generateMnemonicsCode&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
-    &lt;AuxValue name=&quot;FormSettings_listenerGenerationStyle&quot; type=&quot;java.lang.Integer&quot; value=&quot;0&quot;/&gt;
-    &lt;AuxValue name=&quot;FormSettings_variablesLocal&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
-    &lt;AuxValue name=&quot;FormSettings_variablesModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;2&quot;/&gt;
-  &lt;/AuxValues&gt;
-
-  &lt;Layout&gt;
-    &lt;DimensionLayout dim=&quot;0&quot;&gt;
-      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-          &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;Component id=&quot;progress&quot; alignment=&quot;0&quot; pref=&quot;380&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;status&quot; alignment=&quot;0&quot; pref=&quot;380&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;abort&quot; alignment=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;/Group&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-          &lt;/Group&gt;
-      &lt;/Group&gt;
-    &lt;/DimensionLayout&gt;
-    &lt;DimensionLayout dim=&quot;1&quot;&gt;
-      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;status&quot; min=&quot;-2&quot; pref=&quot;84&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;progress&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;abort&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-          &lt;/Group&gt;
-      &lt;/Group&gt;
-    &lt;/DimensionLayout&gt;
-  &lt;/Layout&gt;
-  &lt;SubComponents&gt;
-    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;status&quot;&gt;
-      &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;asdf&quot;/&gt;
-        &lt;Property name=&quot;verticalAlignment&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
-      &lt;/Properties&gt;
-      &lt;AuxValues&gt;
-        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
-      &lt;/AuxValues&gt;
-    &lt;/Component&gt;
-    &lt;Component class=&quot;javax.swing.JProgressBar&quot; name=&quot;progress&quot;&gt;
-      &lt;AuxValues&gt;
-        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
-      &lt;/AuxValues&gt;
-    &lt;/Component&gt;
-    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;abort&quot;&gt;
-      &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Abort&quot;/&gt;
-      &lt;/Properties&gt;
-      &lt;AuxValues&gt;
-        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
-      &lt;/AuxValues&gt;
-    &lt;/Component&gt;
-  &lt;/SubComponents&gt;
-&lt;/Form&gt;

Deleted: trunk/src/net/sf/plantlore/client/export/ExportProgressView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/export/ExportProgressView.java	2006-08-21 08:32:21 UTC (rev 538)
+++ trunk/src/net/sf/plantlore/client/export/ExportProgressView.java	2006-08-21 10:44:56 UTC (rev 539)
@@ -1,183 +0,0 @@
-/*
- * ExportProgressView.java
- *
- * Created on 29. duben 2006, 22:01
- */
-
-package net.sf.plantlore.client.export;
-
-import java.awt.EventQueue;
-import java.util.Observable;
-import java.util.Observer;
-
-import net.sf.plantlore.l10n.L10n;
-
-/**
- *
- * @author  Erik Kratochv&#237;l
- */
<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">- at Deprecated</A>
-public class ExportProgressView extends javax.swing.JFrame implements Observer {
-	
-	private ExportTask model;
-	private int total, count;
-	
-	
-	public void setModel(ExportTask newModel) {
-		if(model != null) 
-			model.deleteObserver(this);
-		model = newModel;
-		if(model != null)
-			model.addObserver(this);
-		
-		exceptionOccured = false;
-	}
-	
-    
-    /** Creates new form ExportProgressView */
-    public ExportProgressView(ExportTask model) {
-    	setModel(model);
-        initComponents();
-        setLocationRelativeTo(null); // center of the screen
-    }
-    
-    /** This method is called from within the constructor to
-     * initialize the form.
-     * WARNING: Do NOT modify this code. The content of this method is
-     * always regenerated by the Form Editor.
-     */
-    // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot; Generated Code &quot;&gt;//GEN-BEGIN:initComponents
-    private void initComponents() {
-        status = new javax.swing.JLabel();
-        progress = new javax.swing.JProgressBar();
-        abort = new javax.swing.JButton();
-
-        setDefaultCloseOperation(javax.swing.WindowConstants.HIDE_ON_CLOSE);
-        status.setText(&quot;Erised stra ehru oyt ube cafru oyt on wohsi&quot;);
-        status.setVerticalAlignment(javax.swing.SwingConstants.TOP);
-
-        abort.setText(&quot;Abort&quot;);
-        
-        progress.setMinimum(0);
-
-        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
-        getContentPane().setLayout(layout);
-        layout.setHorizontalGroup(
-            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-            .add(layout.createSequentialGroup()
-                .addContainerGap()
-                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                    .add(progress, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 380, Short.MAX_VALUE)
-                    .add(status, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 380, Short.MAX_VALUE)
-                    .add(org.jdesktop.layout.GroupLayout.TRAILING, abort))
-                .addContainerGap())
-        );
-        layout.setVerticalGroup(
-            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-            .add(layout.createSequentialGroup()
-                .addContainerGap()
-                .add(status, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 84, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                .add(progress, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
-                .add(abort)
-                .addContainerGap())
-        );
-        pack();
-    }// &lt;/editor-fold&gt;//GEN-END:initComponents
-    
-    
-    
-    // Variables declaration - do not modify//GEN-BEGIN:variables
-    protected javax.swing.JButton abort;
-    protected javax.swing.JProgressBar progress;
-    protected javax.swing.JLabel status;
-    // End of variables declaration//GEN-END:variables
-    
-    
-    @Override
-    public void setVisible(boolean visible) {
-    	status.setText(L10n.getString(&quot;Export.Initializing&quot;));
-    	total = (model == null) ? 0 : model.getNumberOfResults();
-    	if(total &gt; 0) {
-    		progress.setIndeterminate(false);
-    		progress.setMaximum( total );
-    		progress.setStringPainted(true);
-    	}
-    	else {
-    		progress.setIndeterminate(true);
-    		progress.setStringPainted(false);
-    	}
-    	
-    	abort.setText(L10n.getString(&quot;Export.Abort&quot;));
-    	super.setVisible(visible);
-    	update(null, null);
-    }
-    
-    
-    private boolean exceptionOccured = false;
-    
-	public void update(Observable source, final Object parameter) {
-		// The final cleanup may overwrite the exception! 
-		if(exceptionOccured)
-			return;
-		
-		EventQueue.invokeLater(new Runnable(){
-			public void run() {
-				if( parameter != null &amp;&amp; parameter instanceof Exception ) {
-					Exception e = (Exception) parameter;
-					setTitle(L10n.getString(&quot;Export.Failed&quot;));
-					progress.setIndeterminate(false);
-					progress.setStringPainted(true);
-					status.setText(e.getMessage());
-					progress.setValue(0);
-					progress.setString(&quot;&quot;);
-					abort.setText(L10n.getString(&quot;Export.Hide&quot;));
-					exceptionOccured = true;
-				}
-				else if(model == null) {
-					return;
-				}
-				else if(model.isAborted()) {
-					setTitle(L10n.getString(&quot;Export.Aborted&quot;));
-					if(total &gt; 0)
-						status.setText(count +&quot;/&quot; + total + &quot; &quot; + L10n.getString(&quot;Export.RecordsExported&quot;));
-					else
-						status.setText(count + &quot; &quot; + L10n.getString(&quot;Export.RecordsExported&quot;));
-					progress.setIndeterminate(false);
-					progress.setStringPainted(true);
-					progress.setValue(0);
-					progress.setString(&quot;&quot;);
-					abort.setText(L10n.getString(&quot;Export.Hide&quot;));
-				} 
-				else if(!model.isExportInProgress()) {
-					setTitle(L10n.getString(&quot;Export.Completed&quot;));
-					progress.setIndeterminate(false);
-					progress.setStringPainted(true);
-					status.setText(count + &quot; &quot; + L10n.getString(&quot;Export.RecordsExported&quot;));
-					progress.setMaximum(100);
-					progress.setValue(100);
-					progress.setString(&quot;100%&quot;);
-					abort.setText(L10n.getString(&quot;Export.Hide&quot;));
-				}
-				else if( isVisible() ) {
-					count = model.getNumberOfExported();
-					if(count &gt;= 0) {
-						progress.setValue( count );
-						if(total &gt; 0) {
-							String percent = Integer.toString(100*count / total) + &quot;%&quot;;
-							progress.setString( percent );
-							status.setText(count +&quot;/&quot; + total + &quot; &quot; + L10n.getString(&quot;Export.RecordsExported&quot;));
-							setTitle(percent + L10n.getString(&quot;Export.Progress&quot;));
-						}
-						else {
-							status.setText(count + &quot; &quot; + L10n.getString(&quot;Export.RecordsExported&quot;));
-							setTitle(count + &quot; &quot; + L10n.getString(&quot;Export.RecordsExported&quot;));
-						}
-						
-					}
-				}
-			}
-		});
-	}
-}

Deleted: trunk/src/net/sf/plantlore/client/export/ExportTask.java
===================================================================
--- trunk/src/net/sf/plantlore/client/export/ExportTask.java	2006-08-21 08:32:21 UTC (rev 538)
+++ trunk/src/net/sf/plantlore/client/export/ExportTask.java	2006-08-21 10:44:56 UTC (rev 539)
@@ -1,87 +0,0 @@
-package net.sf.plantlore.client.export;
-
-import java.io.Writer;
-import java.util.Observable;
-import java.util.Observer;
-
-import org.apache.log4j.Logger;
-
-import net.sf.plantlore.middleware.DBLayer;
-import net.sf.plantlore.middleware.SelectQuery;
-
<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">- at Deprecated</A>
-public class ExportTask extends Observable implements Observer {
-	
-	private Logger logger = Logger.getLogger(this.getClass().getPackage().getName());
-	private DBLayer dblayer;
-	private SelectQuery exportQuery;
-	private DefaultDirector director;
-	private Writer writer;
-	private Thread execution, monitor;
-	private boolean exportInProgress = false, aborted = false;
-	private int results;
-	
-	
-	public ExportTask(DBLayer dblayer, SelectQuery query, DefaultDirector director, Writer writer, int results) {
-		this.dblayer = dblayer; this.exportQuery = query; this.director = director; this.writer = writer; this.results = results;
-		director.addObserver(this);
-	}
-	
-	public boolean isExportInProgress() {
-		return exportInProgress;
-	}
-	
-	public boolean isAborted() {
-		return aborted;
-	}
-	
-	public int getNumberOfExported() {
-		return director.exportedRecords();
-	}
-	
-	public int getNumberOfResults() {
-		return results;
-	}
-	
-	public void abort() {
-		aborted = true; exportInProgress = false;
-		director.abort();
-		setChanged(); notifyObservers(this);
-	}
-	
-	public void execute() {
-		if(execution == null) {
-			execution = new Thread( director, &quot;Export&quot; );
-			exportInProgress = true;
-			execution.start();
-			
-			monitor = new Thread(new Runnable() {
-				public void run() {
-					// Sleep until the thread is really dead.
-					while( true ) try {
-						execution.join(); 
-						break;
-					} catch(InterruptedException e) { /* Do nothing...  */ }
-					// Perform the final cleanup.
-					exportInProgress = false;
-					try {
-						writer.close();
-					} catch(Exception e) { /* Never mind. */ }
-					try {
-						dblayer.closeQuery( exportQuery );
-					} catch(Exception e) {/* Never mind. */}
-					
-					logger.debug(&quot;Environment cleaned up.&quot;);
-					setChanged(); notifyObservers(this);
-					deleteObservers();
-				}
-			}, &quot;ExportMonitor&quot;);
-			monitor.start();
-		}
-	}
-
-	// Re-send notifications.
-	public void update(Observable source, Object arg) {
-		setChanged(); notifyObservers(arg);
-	}
-}
\ No newline at end of file

Deleted: trunk/src/net/sf/plantlore/client/export/builders/XMLBuilder.java
===================================================================
--- trunk/src/net/sf/plantlore/client/export/builders/XMLBuilder.java	2006-08-21 08:32:21 UTC (rev 538)
+++ trunk/src/net/sf/plantlore/client/export/builders/XMLBuilder.java	2006-08-21 10:44:56 UTC (rev 539)
@@ -1,128 +0,0 @@
-package net.sf.plantlore.client.export.builders;
-
-import java.io.IOException;
-import java.io.Writer;
-
-import net.sf.plantlore.client.export.AbstractBuilder;
-import net.sf.plantlore.client.export.Projection;
-import net.sf.plantlore.common.record.*;
-import org.dom4j.Document;
-import org.dom4j.DocumentHelper;
-import org.dom4j.Element;
-import org.dom4j.io.OutputFormat;
-import org.dom4j.io.XMLWriter;
-
-
-/**
- * XML Builder.
- *
- * @author Lada Oberreiterov&#225;
- * @author Erik Kratochv&#237;l
- */
-public class XMLBuilder extends AbstractBuilder {
-
-    private Document document;
-    private Writer outputWriter;
-    private Element occurrence;
-    
-    /**
-     * Create a new XML Builder.
-     * The builder receives records (holder objects from the database)
-     * decomposes them, creates an XML tree, and stores it in the specified
-     * file.
-     * &lt;br/&gt;
-     * The template holds the set of important attributes (columns) of the record
-     * that will be exported.
-     * 
-     * @param template	Description of important attributes of  the whole record. 
-     * @param writer	The writer that will create the file.
-     * @see net.sf.plantlore.client.export.Projection
-     */
-    public XMLBuilder(Projection template, Writer writer) {
-    	super(template);
-        document = DocumentHelper.createDocument();
-        document.addElement(&quot;occurrences&quot;);
-        this.outputWriter = writer;
-        this.template = template;
-    }
-    
-    /**
-     * Create a new XML Builder.
-     * The builder receives records (holder objects from the database)
-     * decomposes them, creates an XML tree, and stores it in the specified
-     * file.
-     * &lt;br/&gt;
-     * Every attribute (column) of the whole record will be exported.
-     * 
-     * @param writer	The writer that will create the file.
-     * @see net.sf.plantlore.client.export.Projection
-     */
-    public XMLBuilder(Writer writer) {
-    	this(new Projection().setEverything(), writer);
-    }
-    
-    /**
-     * Generate the footer of this format.
-     */
-    @Override
-    public void footer() throws IOException {
-        OutputFormat format = OutputFormat.createPrettyPrint();
-        XMLWriter xmlwriter = new XMLWriter( outputWriter, format );
-        xmlwriter.write( document );
-        xmlwriter.close();
-    }
-
-    /**
-     * Build part of the whole record.
-     */
-    @Override
-    public void part(Record record) 
-    throws IOException {
-    	// One Occurrence can have many AuthorOccurrences [AOs]. 
-    	// All those AOs are in their own special node &lt;authors&gt;&lt;/authors&gt;.
-    	decompose( (record instanceof AuthorOccurrence) ? occurrence : document.getRootElement(), record);
-    }
-    
-    /**
-     * Decompose the given &lt;code&gt;record&lt;/code&gt; and build the XML tree appropriately.
-     *  
-     * @param father	Father element of the currently processed &lt;code&gt;record&lt;/code&gt;.
-     * @param record	Part of the whole record corresponding to a certain table in the database.
-     */
-    protected boolean decompose(Element father, Record record) 
-    throws IOException {
-    	if(record == null) 
-    		return false;
-    	
-    	Class table = record.getClass();
-    	Element current = father.addElement(table.getSimpleName().toLowerCase());
-    	// Every occurrence may have 0..N associated AuthorOccurrences.
-    	if(record instanceof Occurrence) 
-    		occurrence = current;
-    	
-    	boolean hasAtLeastOneProperty = false;
-    	
-    	for( String property : record.getProperties() )
-    		if( template.isSet(table, property) ) {
-    			Object value = record.getValue(property);
-    			current.addElement(property.toLowerCase()).setText(value == null ? &quot;&quot; : value.toString());
-    			hasAtLeastOneProperty = true;
-    		}
-    	
-    	// Decompose all subrecords of this record.
-    	for(String key : record.getForeignKeys()) {
-    		hasAtLeastOneProperty =  decompose( current, (Record) record.getValue(key) ) || hasAtLeastOneProperty;
-    	}
-    	
-    	if( !hasAtLeastOneProperty )
-    		current.detach();
-    	
-    	return hasAtLeastOneProperty;
-    }
-
-	@Override
-	protected void output(Class table, String column, Object value) throws IOException {
-		// I do not need this method.
-	}
-
-}

Modified: trunk/src/net/sf/plantlore/common/AutoComboBoxNG3.java
===================================================================
--- trunk/src/net/sf/plantlore/common/AutoComboBoxNG3.java	2006-08-21 08:32:21 UTC (rev 538)
+++ trunk/src/net/sf/plantlore/common/AutoComboBoxNG3.java	2006-08-21 10:44:56 UTC (rev 539)
@@ -61,7 +61,8 @@
  *		});
  *&lt;/pre&gt;
  * 
- * @author Erik Kratochv&#237;l (<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">discontinuum at gmail.com</A>)
+ * @author Erik Kratochv&#237;l
+ * @author Jakub Kotowski (several bugfixes: MetalComboBoxEditor, ...)
  * @version 3.0
  */
 public class AutoComboBoxNG3 extends JComboBox {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000735.html">[Plantlore-dev] r537 - in trunk/analysis/database: . Old DB model
</A></li>
	<LI>Next message: <A HREF="000737.html">[Plantlore-dev] r540 - trunk/src/net/sf/plantlore/client/imports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#736">[ date ]</a>
              <a href="thread.html#736">[ thread ]</a>
              <a href="subject.html#736">[ subject ]</a>
              <a href="author.html#736">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
