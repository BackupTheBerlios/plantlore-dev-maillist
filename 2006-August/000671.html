<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r496 - in trunk/src/net/sf/plantlore: client	client/history client/metadata client/user common
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-August/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r496%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%0A%09client/history%20client/metadata%20client/user%20common&In-Reply-To=%3C200608081612.k78GCFwx006701%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000670.html">
   <LINK REL="Next"  HREF="000672.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r496 - in trunk/src/net/sf/plantlore: client	client/history client/metadata client/user common</H1>
    <B>lada at mail.berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r496%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%0A%09client/history%20client/metadata%20client/user%20common&In-Reply-To=%3C200608081612.k78GCFwx006701%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r496 - in trunk/src/net/sf/plantlore: client	client/history client/metadata client/user common">lada at mail.berlios.de
       </A><BR>
    <I>Tue Aug  8 18:12:15 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000670.html">[Plantlore-dev] r495 - trunk/src/net/sf/plantlore/common
</A></li>
        <LI>Next message: <A HREF="000672.html">[Plantlore-dev] r497 - in trunk/src/net/sf/plantlore: common server	server/manager server/tools
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#671">[ date ]</a>
              <a href="thread.html#671">[ thread ]</a>
              <a href="subject.html#671">[ subject ]</a>
              <a href="author.html#671">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: lada
Date: 2006-08-08 18:12:12 +0200 (Tue, 08 Aug 2006)
New Revision: 496

Added:
   trunk/src/net/sf/plantlore/common/DefaultEscapeKeyPressed.java
Modified:
   trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
   trunk/src/net/sf/plantlore/client/history/DetailsHistoryCtrl.java
   trunk/src/net/sf/plantlore/client/history/History.java
   trunk/src/net/sf/plantlore/client/history/HistoryCtrl.java
   trunk/src/net/sf/plantlore/client/history/HistoryView.form
   trunk/src/net/sf/plantlore/client/history/HistoryView.java
   trunk/src/net/sf/plantlore/client/history/WholeHistoryCtrl.java
   trunk/src/net/sf/plantlore/client/history/WholeHistoryView.java
   trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataCtrl.java
   trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.java
   trunk/src/net/sf/plantlore/client/metadata/MetadataManager.java
   trunk/src/net/sf/plantlore/client/metadata/MetadataManagerCtrl.java
   trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.java
   trunk/src/net/sf/plantlore/client/user/AddEditUserCtrl.java
   trunk/src/net/sf/plantlore/client/user/AddEditUserView.form
   trunk/src/net/sf/plantlore/client/user/AddEditUserView.java
   trunk/src/net/sf/plantlore/client/user/UserManager.java
   trunk/src/net/sf/plantlore/client/user/UserManagerCtrl.java
   trunk/src/net/sf/plantlore/client/user/UserManagerTableModel.java
   trunk/src/net/sf/plantlore/client/user/UserManagerView.form
   trunk/src/net/sf/plantlore/client/user/UserManagerView.java
Log:
DefaultEscapeKeyPressed.java - KeyListener class controlling the pressing key ESCAPE.
Use: myView.myButton.addKeyListener( new DefaultEscapeKeyPressed( myView ) );

AppCoreCtrl.java - change class DataWholeHistoryAction and DataHistoryAction, create history dialog only one times, use Task.

UseManager, MetadataManager, History - Add Task, DefaultProgressBar, DefaultRemoteException, comment, GUI, ...



Modified: trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -78,6 +78,7 @@
 import net.sf.plantlore.client.user.UserManager;
 import net.sf.plantlore.client.user.UserManagerCtrl;
 import net.sf.plantlore.client.user.UserManagerView;
+import net.sf.plantlore.common.DefaultProgressBar;
 import net.sf.plantlore.common.DefaultProgressBarEx;
 import net.sf.plantlore.common.DefaultReconnectDialog;
 import net.sf.plantlore.common.PlantloreConstants;
@@ -1259,19 +1260,19 @@
 			System.out.println(&quot;History od record: &quot;+ model.getDatabase());	
 			
 			if (historyModel == null) {
-				historyModel = new History(model.getDatabase(), model.getSelectedOccurrence());
-				if (historyModel.isError()) {				
-					JOptionPane.showMessageDialog(view, historyModel.getError(), L10n.getString(&quot;Error.HistoryCreateDialog&quot;),
-							JOptionPane.WARNING_MESSAGE);				
-				} else {					
+				historyModel = new History(model.getDatabase(), model.getSelectedOccurrence());								
 				historyView = new HistoryView(historyModel, view, true);
 				historyCtrl = new HistoryCtrl(historyModel, historyView);
 				historyModel.addObserver(managerBridge);
-				historyView.setVisible(true);
-				}
-			} else {
-				historyView.setVisible(true);
 			}
+			Task task = historyModel.initialize(model.getSelectedOccurrence());
+			new DefaultProgressBar(task, historyView, true) {
+				@Override
+	 	    	public void afterStopping() {
+					historyView.setVisible(true);						
+	 	    	}
+			};			
+			task.start();							
 		}
 	}
 
@@ -1284,22 +1285,19 @@
 			System.out.println(&quot;Whole history&quot;);
 
 			if (wholeHistoryModel == null) {
-				wholeHistoryModel = new History(model.getDatabase());
-				if (wholeHistoryModel.isError()) {
-					//TODO: zjistit presneji o jakou chybu jde
-					JOptionPane.showMessageDialog(view, wholeHistoryModel.getError(), L10n.getString(&quot;Error.HistoryCreateDialog&quot;),
-							JOptionPane.WARNING_MESSAGE);									
-				} else {			
-					wholeHistoryView = new WholeHistoryView(wholeHistoryModel, view,
-							true);
-					wholeHistoryCtrl = new WholeHistoryCtrl(wholeHistoryModel,
-							wholeHistoryView);
-					wholeHistoryModel.addObserver(managerBridge);
-					wholeHistoryView.setVisible(true);
-				}
-			} else {
-				wholeHistoryView.setVisible(true);
+				wholeHistoryModel = new History(model.getDatabase());				
+			    wholeHistoryView = new WholeHistoryView(wholeHistoryModel, view,true);
+				wholeHistoryCtrl = new WholeHistoryCtrl(wholeHistoryModel, wholeHistoryView);
+				wholeHistoryModel.addObserver(managerBridge);
 			}
+			Task task = wholeHistoryModel.initializeWH();
+			new DefaultProgressBar(task, wholeHistoryView, true) {
+				@Override
+	 	    	public void afterStopping() {						
+					wholeHistoryView.setVisible(true);
+	 	    	}
+			};			
+			task.start();							
 		}
 	}
 
@@ -1319,6 +1317,7 @@
 			if (metadataManagerModel == null) {
 				metadataManagerModel = new MetadataManager(model.getDatabase());
 				if (metadataManagerModel.isError()) {
+					//DefaultReconnectDialog.show(view, metadataManagerModel.getError());
 					JOptionPane.showMessageDialog(view, metadataManagerModel.getError(), L10n.getString(&quot;Error.MetadataCreateDialog&quot;),
 							JOptionPane.WARNING_MESSAGE);									
 				} else {					

Modified: trunk/src/net/sf/plantlore/client/history/DetailsHistoryCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/DetailsHistoryCtrl.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/history/DetailsHistoryCtrl.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -11,6 +11,8 @@
 
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
+import net.sf.plantlore.common.DefaultCancelAction;
+import net.sf.plantlore.common.DefaultEscapeKeyPressed;
 
 /**
  * Controller for the DetailsHistory dialog (part of the DetailsHistory MVC).
@@ -27,33 +29,26 @@
      * Creates a new instance of DetailsHistoryCtrl
      * @param view View of the DerailsHistory MVC 
      */
-    public DetailsHistoryCtrl(DetailsHistoryView view) {
+    public DetailsHistoryCtrl(DetailsHistoryView viewDialog) {
                           
-        this.view = view;
+        this.view = viewDialog;
+        DefaultEscapeKeyPressed escapeKeyPressed = new DefaultEscapeKeyPressed(view);
         // Add action listeners to buttons
-        view.closeButton.addActionListener(new closeButtonListener());
+        view.closeButton.setAction(new DefaultCancelAction(view));
         view.helpButton.addActionListener(new helpButtonListener());
+        // Add key listeners
+        view.closeButton.addKeyListener(escapeKeyPressed);
+        view.helpButton.addKeyListener(escapeKeyPressed);
+        view.detailsTextArea.addKeyListener(escapeKeyPressed);
     }
        
-    /** 
-     * ActionListener class controlling the &lt;b&gt;OK&lt;/b&gt; button on the form.
-     * On Ok makes the model store() the preferences and hides the view.     
-     */
-   class closeButtonListener implements ActionListener {
-       public void actionPerformed(ActionEvent actionEvent)
-       {
-    	   view.close();
-       }
-   }
-   
    /**
     * ActionListener class controlling the &lt;b&gt;HELP&lt;/b&gt; button on the form.
     * Display help viewer
     */
    class helpButtonListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
-       {    	      	           
-    	   System.out.println(&quot;Tady se bude volat Help!&quot;);
+       {    	      	               	   
        }
    }
 }

Modified: trunk/src/net/sf/plantlore/client/history/History.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/History.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/history/History.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -56,14 +56,16 @@
     private DBLayer database;   
     /** Exception with details about an error */
     private String error = null;
+    /** Remote exception (network communication failed)*/
+    private RemoteException remoteEx;
     /** Constant with default number of rows to display */
-    private static final int DEFAULT_DISPLAY_ROWS = 12;    
+    public static final int DEFAULT_DISPLAY_ROWS = 12;    
     /** Actual number of rows to display */
     private int displayRows = DEFAULT_DISPLAY_ROWS;   
     /** Index of the first record shown in the table */
     private int currentFirstRow;
     /** Information about current display rows*/
-    private String displayRow;          
+    private String displayRow;              
     /** Result of the search query */
     private int resultId = 0;
     /** List of data (results of a search query) displayed in the view dialog */
@@ -110,7 +112,8 @@
     private String location;    
     
     /** Instances of Record */
-    private Object data;        
+    private Object data;   
+    private int dataId;
     private HistoryRecord historyRecord;
     private HistoryChange historyChange;
                 
@@ -136,6 +139,7 @@
     public static final String ERROR_NUMBER_ROWS = L10n.getString(&quot;Error.HistoryGetNumberRows&quot;);
     public static final String ERROR_NO_RIGHTS = L10n.getString(&quot;Error.HistoryNoRights&quot;); 
     public static final String ERROR_TRANSACTION = L10n.getString(&quot;Error.TransactionRaceConditions&quot;);    
+    public static final String ERROR_REMOTE_EXCEPTION = &quot;REMOTE_EXCEPTION&quot;;   
     /**
      * Creates a new instance of History - history of Occurrences, Habitats, Authors, 
      * Publications, Metadata, Territories, Phytochorions, Villages
@@ -144,12 +148,7 @@
     public History(DBLayer database){
           
        logger = Logger.getLogger(this.getClass().getPackage().getName());	 
-       this.database = database;
-       
-       //Search history data (without condition, order by date)
-       searchWholeHistoryData();
-       //Process results 
-       processResult(1, displayRows);
+       this.database = database;             
     }
     
     /**  
@@ -160,149 +159,158 @@
     public History(DBLayer database, int idObj)
     {
        logger = Logger.getLogger(this.getClass().getPackage().getName());	 
-       this.database = database;                     
-       
-       SelectQuery query = null;
-       int resultIdRecord = 0;
-       Object[] object = null;      
-       
-       try {    	  
-		    query = database.createQuery(Occurrence.class);
-      	    query.addRestriction(PlantloreConstants.RESTR_EQ, Occurrence.ID, null, idObj, null);
-      	    query.addRestriction(PlantloreConstants.RESTR_EQ, Occurrence.DELETED, null, 0, null);    	                   
-            resultIdRecord = database.executeQuery(query);
-            object = database.next(resultIdRecord);                    
-            database.closeQuery(query);
-       } catch(RemoteException e) {
-       	    logger.error(&quot;Remote exception caught in History. Details: &quot;+e.getMessage());
-       	    setError(ERROR_SEARCH_RECORD);
-       	    return;
-       } catch(DBLayerException e) {
-    	    logger.error(&quot;Search selected occurrence failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                   
-            setError(ERROR_SEARCH_RECORD);             
-            return;
-       }                                          
-       if (object == null) {
-    	   logger.error(&quot;tOccurrence doesn't contain required data&quot;);  
-    	   setError(ERROR_SEARCH_RECORD); 
-       } else {
-    	   
-    	   Occurrence occurrence = (Occurrence)object[0];    	   
-    	   setData(occurrence);
-    	   
-    	   //Check rights
-    	   if(! hasRights(occurrence.getCreatedWho().getId())) {
-    		   setError(ERROR_NO_RIGHTS);
-    		   return;
-    	   }
-    	   
-	       //Save basic information about specific occurrence 
-	       setNameAuthor(getAllNameOfAuthors(getAllAuthors(occurrence, 0)));
-	       setNamePlant(occurrence.getPlant().getTaxon());       
-	       setLocation(occurrence.getHabitat().getNearestVillage().getName());	            
-	       
-	       //Save information about data entries concerned with specific occurrence
-	       setWhen(occurrence.getCreatedWhen());
-	       setNameUser(occurrence.getCreatedWho().getWholeName());
-	       
-	       //Searching for information about data editing concerned with specific occurrence
-	       searchEditHistory(occurrence);
-	       
-	       //Process results of a search &quot;edit&quot; query 
-	       processResult(1,displayRows);
-       }
+       this.database = database;   
+       dataId = idObj;
     }	
 
-    /**  
-     *  Creates a new instance of History - history of specific habitat 
-     *  @param database Instance of a database management object
-     *  @param idObj integer containing identifier of specific habitat
-     *  @param innfoHabitat 
-     * */
-    public History(DBLayer database, int idObj, String infoHabitat)
-    {
-       logger = Logger.getLogger(this.getClass().getPackage().getName());	 
-       this.database = database;       
-       
-       SelectQuery query = null;
-       int resultIdRecord = 0;
-       Object[] object = null;      
-       
-       try {    	  
-		    query = database.createQuery(Habitat.class);
-      	    query.addRestriction(PlantloreConstants.RESTR_EQ, Habitat.ID, null, idObj, null);
-      	    query.addRestriction(PlantloreConstants.RESTR_EQ, Habitat.DELETED, null, 0, null);    	                   
-            resultIdRecord = database.executeQuery(query);
-            object = database.next(resultIdRecord);                    
-            database.closeQuery(query);
-       } catch(RemoteException e) {
-       	    logger.error(&quot;Remote exception caught in History. Details: &quot;+e.getMessage());
-       	    setError(ERROR_SEARCH_RECORD);
-       	    return;
-       } catch(DBLayerException e) {
-    	    logger.error(&quot;Search selected habitat failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                   
-            setError(ERROR_SEARCH_RECORD);             
-            return;
-       }                                          
-       if (object == null) {
-    	   logger.error(&quot;tHabitat doesn't contain required data&quot;);  
-    	   setError(ERROR_SEARCH_RECORD); 
-       } else {
-    	   
-    	   Habitat habitat = (Habitat)object[0];    	   
-    	   setData(habitat);
-
-    	   //Check rights
-    	   if(! hasRights(habitat.getCreatedWho().getId())) {
-    		   setError(ERROR_NO_RIGHTS);
-    		   return;
-    	   }
-    	   
-    	   //TODO
-	       //Save basic information about specific habitat	             	      	  
-	       setLocation(habitat.getNearestVillage().getName());	            	       	       
-	       
-	       //Searching for information about data editing concerned with specific habitat
-	       searchEditHistory(habitat);
-	       
-	       //Process results of a search &quot;edit&quot; query 
-	       processResult(1,displayRows);
-       }
-    }	
+    /**
+     * Initialize actual data for History of specific occurrence. This function shall process before showing view dialog.
+     * @param idObj identifier of specific Occurrence
+     * @return instance of the Task with the long running operation (searching data)
+     */
+    public Task initialize(int idObj) {
+    	dataId = idObj;
+    	final Task task = new Task() {    		    		
+    		public Object task() throws Exception {
+    			
+    			try {
+		           //Save basic data
+		           initOccHistoryData(dataId);
+			       //Searching for information about data editing concerned with specific habitat
+			       searchEditHistory(getData());	       
+			       //Process results of a search &quot;edit&quot; query 
+			       processResult(1,DEFAULT_DISPLAY_ROWS);			       		      
+    			}catch (Exception e) {
+    				logger.error(&quot;Initialize of Record History failed. caught in History. Details: &quot;+e.getMessage());
+    				throw e;
+    			}    			
+    			return null;
+    		}
+	    };
+	    return task;
+    }
     
+    /**
+     * Initialize actual data for Whole History. This function shall process before showing view dialog.
+     * @return instance of the Task with the long running operation (searching data)
+     */
+    public Task initializeWH(){
+    	final Task task = new Task() {    		    		
+    		public Object task() throws Exception {
+    		   try {
+    			   //Search history data (without condition, order by date)
+    		       searchWholeHistoryData();
+    		       //Process results 
+    		       processResult(1, DEFAULT_DISPLAY_ROWS);
+    		   } catch (Exception e) {
+    			   logger.error(&quot;Initialize of Whole History failed. caught in History. Details: &quot;+e.getMessage());
+   				   throw e;
+    		   }
+    			return null;
+    		}
+    	};
+	    return task;
+    }
     
+    /**
+     * Set basic data about selected occurrence
+     * @param idOcc identifier of selected occurrence
+     *  @throws DBLayerException in case search failed
+     *  @throws RemoteException in case network communication failed
+     */   
+    public void initOccHistoryData(int idOcc) throws RemoteException, DBLayerException {
+    	SelectQuery query = null;
+        int resultIdRecord = 0;
+        Object[] object = null;      
+        
+        try {    	  
+ 		    query = database.createQuery(Occurrence.class);
+       	    query.addRestriction(PlantloreConstants.RESTR_EQ, Occurrence.ID, null, idOcc, null);
+       	    query.addRestriction(PlantloreConstants.RESTR_EQ, Occurrence.DELETED, null, 0, null);    	                   
+             resultIdRecord = database.executeQuery(query);
+             object = database.next(resultIdRecord);                    
+             database.closeQuery(query);            
+        } catch(RemoteException e) {
+        	    logger.error(&quot;Remote exception caught in History. Details: &quot;+e.getMessage());       	            	     
+        	     RemoteException remex = new RemoteException(e.getMessage());
+                 remex.setStackTrace(e.getStackTrace());
+                 throw remex; 		           		           	   
+        } catch(DBLayerException e) {
+     	    logger.error(&quot;Search selected occurrence failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                                
+             DBLayerException dbex = new DBLayerException(ERROR_SEARCH_RECORD + e.getMessage());
+             dbex.setStackTrace(e.getStackTrace());
+             throw dbex; 		           
+        }                                          
+        if (object == null) {
+     	   logger.error(&quot;tOccurrence doesn't contain required data&quot;);  
+     	   DBLayerException dbex = new DBLayerException(ERROR_SEARCH_RECORD + &quot;tOccurrence doesn't contain required data&quot;);                      
+     	   throw dbex; 		            
+        } else {
+     	   
+     	   Occurrence occurrence = (Occurrence)object[0];    	   
+     	   setData(occurrence);
+     	        	 
+     	   //Check rights
+     	   if(! hasRights(occurrence.getCreatedWho().getId())) {
+     		   DBLayerException dbex = new DBLayerException();
+     		   dbex.setError(DBLayerException.ERROR_RIGHTS, ERROR_NO_RIGHTS);
+        	   throw dbex; 		            
+     	   }   
+     	   if (isError()) {
+     		  RemoteException remoteEx = new RemoteException(getRemoteEx().getMessage());
+     		  setError(null);
+     		  setRemoteEx(null);
+     		  throw remoteEx;
+     	   }
+     	   
+ 	       //Save basic information about specific occurrence 
+ 	       setNameAuthor(getAllNameOfAuthors(getAllAuthors(occurrence, 0))); 	       
+ 	       setNamePlant(occurrence.getPlant().getTaxon());       
+ 	       setLocation(occurrence.getHabitat().getNearestVillage().getName());	            
+ 	       
+ 	       //Save information about data entries concerned with specific occurrence
+ 	       setWhen(occurrence.getCreatedWhen());
+ 	       setNameUser(occurrence.getCreatedWho().getWholeName());	
+        }
+    }
+    
     /**     
      * Searches for information about data editing concerned with specific occurrence or habitat. 
      * @param data object containing specific occurrence or habitat
+     * @throws DBLayerException in case search failed
+     *  @throws RemoteException in case network communication failed
      */     
-    public void searchEditHistory(Object data)
+    public void searchEditHistory(Object data) throws RemoteException, DBLayerException
     {    
     	//Cleare historyDataList
-    	historyDataList.clear();
-        //Create new Select query
-        SelectQuery query = null; 
+    	historyDataList.clear(); 
+    	SelectQuery queryData = null;
         int resultIdEdit = 0;
 
     	//  Select data from tHistory table
-        try {
-		    query = database.createQuery(HistoryRecord.class);
+        try {        	
+		    queryData = database.createQuery(HistoryRecord.class);
 		    // Create aliases for table tHistoryChange.      
-	        query.createAlias(&quot;historyChange&quot;, &quot;hc&quot;);        
+	        queryData.createAlias(&quot;historyChange&quot;, &quot;hc&quot;);        
 	        // Add restriction to COPERATION column of tHistoryChange table
 	        if (data instanceof Occurrence) {	        	       
-		        query.addRestriction(PlantloreConstants.RESTR_EQ, &quot;hc.recordId&quot;, null, ((Occurrence)data).getId(), null);  
+		        queryData.addRestriction(PlantloreConstants.RESTR_EQ, &quot;hc.recordId&quot;, null, ((Occurrence)data).getId(), null);  
 	        } else if (data instanceof Habitat) {	        	        
-		        query.addRestriction(PlantloreConstants.RESTR_EQ, &quot;hc.recordId&quot;, null, ((Habitat)data).getId(), null);  
+		        queryData.addRestriction(PlantloreConstants.RESTR_EQ, &quot;hc.recordId&quot;, null, ((Habitat)data).getId(), null);  
 	        }	
-	        query.addRestriction(PlantloreConstants.RESTR_EQ, &quot;hc.operation&quot;, null, HistoryChange.HISTORYCHANGE_EDIT, null);
-	        query.addOrder(PlantloreConstants.DIRECT_DESC, &quot;hc.when&quot;);
-	        resultIdEdit = database.executeQuery(query); 
+	        queryData.addRestriction(PlantloreConstants.RESTR_EQ, &quot;hc.operation&quot;, null, HistoryChange.HISTORYCHANGE_EDIT, null);
+	        queryData.addOrder(PlantloreConstants.DIRECT_DESC, &quot;hc.when&quot;);
+	        resultIdEdit = database.executeQuery(queryData); 
 		} catch (RemoteException e) {
-			logger.error(&quot;Remote exception caught in History (searchEditHistory). Details: &quot;+e.getMessage());
-			setError(ERROR_SEARCH_DATA);
+			logger.error(&quot;Remote exception caught in History (searchEditHistory). Details: &quot;+e.getMessage());			
+			RemoteException remex = new RemoteException(e.getMessage());
+            remex.setStackTrace(e.getStackTrace());
+            throw remex; 		
 		} catch (DBLayerException e) {
 			logger.error(&quot;DBLayer exception caught in History (searchEditHistory). Details: &quot;+e.getMessage());
-			setError(ERROR_SEARCH_DATA);            
+			DBLayerException dbex = new DBLayerException(ERROR_SEARCH_DATA + e.getMessage());
+            dbex.setStackTrace(e.getStackTrace());
+            throw dbex; 	            
 		}                
 		setResultId(resultIdEdit);                
     }
@@ -311,28 +319,33 @@
     /**
      * Searches for information about data concerned with occurrence, habitat, author, metadata, publication,
      * territory, village and phytochorion.
+     * @throws DBLayerException in case search failed
+     *  @throws RemoteException in case network communication failed
      */
-    public void searchWholeHistoryData() {
+    public void searchWholeHistoryData() throws RemoteException, DBLayerException {
         
     	// Cleare historyDataList
     	historyDataList.clear();
-        //Create new Select query
-        SelectQuery query = null;
+    	SelectQuery queryData = null;
         int resultIdWHistory = 0;
 
     	//  Select data from tHistory table
-        try {
-			query = database.createQuery(HistoryRecord.class);
+        try {        	
+			queryData = database.createQuery(HistoryRecord.class);
 			// Create aliases for table tHistoryChange.
-			query.createAlias(&quot;historyChange&quot;, &quot;hc&quot;);			
-			query.addOrder(PlantloreConstants.DIRECT_DESC, &quot;hc.when&quot;);
-			resultIdWHistory = database.executeQuery(query);
+			queryData.createAlias(&quot;historyChange&quot;, &quot;hc&quot;);			
+			queryData.addOrder(PlantloreConstants.DIRECT_DESC, &quot;hc.when&quot;);
+			resultIdWHistory = database.executeQuery(queryData);
 		} catch (RemoteException e) {
 			logger.error(&quot;Remote exception caught in History (searchWholeHistoryData). Details: &quot;+e.getMessage());
-			setError(ERROR_SEARCH_DATA);
+			RemoteException remex = new RemoteException(e.getMessage());
+            remex.setStackTrace(e.getStackTrace());
+            throw remex; 		
 		} catch (DBLayerException e) {
-			logger.error(&quot;DBLayer exception caught in History (searchWholeHistoryData). Details: &quot;+e.getMessage());
-			setError(ERROR_SEARCH_DATA);
+			logger.error(&quot;DBLayer exception caught in History (searchWholeHistoryData). Details: &quot;+e.getMessage());			
+			DBLayerException dbex = new DBLayerException(ERROR_SEARCH_DATA + e.getMessage());
+            dbex.setStackTrace(e.getStackTrace());
+            throw dbex; 	            
 	    }
 		setResultId(resultIdWHistory);                 
     }
@@ -342,7 +355,7 @@
      * @param from number of the first row to show in table. Number of the first row to retraieve is 1.
      * @param count number of rows to retrieve 
      */
-    public void processResult(int from, int count) {
+    public void processResult(int from, int count) throws RemoteException, DBLayerException{
         
         if (this.resultId != 0) {
             int currentRow = getResultRows();
@@ -368,23 +381,19 @@
              		objectHistory = database.more(this.resultId, 0, to-1);  
              	} catch(RemoteException e) {
              		logger.error(&quot;Remote exception caught in History (processResult). Details: &quot;+e.getMessage());
-        			setError(ERROR_PROCESS);
-        			setChanged();
-                    notifyObservers();
-                 	return;                                                                                       
+             		RemoteException remex = new RemoteException(e.getMessage());
+                    remex.setStackTrace(e.getStackTrace());
+                    throw remex; 		                                                                                 
                 } catch (DBLayerException e) {                  
-                    logger.error(&quot;Processing search results failed: &quot; + e.getMessage());   
-                    setError(ERROR_PROCESS);
-                    setChanged();
-                    notifyObservers();
-                    return;
+                    logger.error(&quot;Processing search results failed: &quot; + e.getMessage());                       
+                    DBLayerException dbex = new DBLayerException(ERROR_PROCESS + e.getMessage());
+                    dbex.setStackTrace(e.getStackTrace());
+                    throw dbex; 
                 }  
                 if (objectHistory == null) {
                 	logger.error(&quot;tHistoryChange doesn`t contain required data&quot;);
-                	setError(ERROR_PROCESS);
-                    setChanged();
-                    notifyObservers();
-                    return;
+                	DBLayerException dbex = new DBLayerException(ERROR_PROCESS + &quot;tHistoryChange doesn`t contain required data&quot;);                   
+                    throw dbex; 
                 }
                 int countResult = objectHistory.length;  
                 logger.debug(&quot;Results retrieved. Count: &quot;+ countResult);                
@@ -486,6 +495,7 @@
              //Update author of specific occurrence
              isDelete = (isDelete == 1) ? 2 : isDelete;
              Object[] objects = getAllAuthors(occurrence, 2-isDelete);
+             if (isError()) return; //Search authors failed
              int countResult = objects.length;               
              for (int i=0; i&lt;countResult; i++ ) {                    							
                 Object[] autOcc = (Object[])objects[i];          
@@ -738,6 +748,7 @@
                 } catch (ParseException e) {
                         logger.error(&quot;Parse time failed. &quot;+ e);
                         setError(ERROR_PARSE_DATE);
+                        return;
                 }
                 occ.setTimeCollected(time);
                 logger.debug(&quot;Set selected value for update of attribute Time.&quot;);
@@ -1381,24 +1392,19 @@
             database.closeQuery(query);
         } catch(RemoteException e) {
         	logger.error(&quot;Remote exception caught in History. Details: &quot;+e.getMessage());
-       	    setError(ERROR_SEARCH_OBJECT);
-	       	 //Tell observers to update
-	         setChanged();
-	         notifyObservers();
+       	    setError(ERROR_REMOTE_EXCEPTION);
+       	    setRemoteEx(e);	    
+       	    return null;
         } catch(DBLayerException e) {
         	logger.error(&quot;Search selected &quot; + typeObject  +&quot; failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                   
-            setError(ERROR_SEARCH_OBJECT);   
-            //Tell observers to update
-            setChanged();
-            notifyObservers();
+            setError(ERROR_SEARCH_OBJECT); 
+            return null;
         }
               
 	   if (object == null) {
 		   logger.error(&quot;t&quot;+typeObject+ &quot; doesn't contain required data&quot;);  
 		   setError(ERROR_SEARCH_OBJECT);		   
-		   //Tell observers to update
-           setChanged();
-           notifyObservers();           
+		   return null;           
 	   } 	 
        return object; 	       	          	              	        
     }
@@ -1429,23 +1435,16 @@
             database.closeQuery(query);
         } catch(RemoteException e) {
         	logger.error(&quot;Remote exception caught in History. Details: &quot;+e.getMessage());
-       	    setError(ERROR_SEARCH_AUTHOR);
-       	    //Tell observers to update
-            setChanged();
-            notifyObservers();
+       	    setError(ERROR_REMOTE_EXCEPTION);
+       	    setRemoteEx(e);       	    
         } catch(DBLayerException e) {
         	logger.error(&quot;Search authors failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                   
-            setError(ERROR_SEARCH_AUTHOR); 
-            //Tell observers to update
-            setChanged();
-            notifyObservers();
+            setError(ERROR_SEARCH_AUTHOR);            
         }     
           
         if (objects == null) {
         	logger.error(&quot;tAuthors doesn't contain required data&quot;);  
- 		    setError(ERROR_SEARCH_AUTHOR);		    		   
-            setChanged();
-            notifyObservers();
+ 		    setError(ERROR_SEARCH_AUTHOR);		    		             
         }
         
        return objects;
@@ -1457,8 +1456,10 @@
      *  @return String containing names of authors for specific occurrence
      */
     public String getAllNameOfAuthors(Object[] objects) {
-        if (objects == null)
-            return &quot;&quot;;
+        if (objects == null || isError()) {
+        	setError(null);
+        	return &quot;&quot;;	
+        }            
         String allAuthor = &quot;&quot;;
         int countResult = objects.length;  
         logger.debug(&quot;Authos of occurrence. Results retrieved. Count: &quot;+ countResult);        
@@ -1484,7 +1485,7 @@
     	this.typeHistory = typeHistory;
     	
     	final Task task = new Task() {    		    		
-    		public Object task() throws DBLayerException, RemoteException {
+    		public Object task() throws Exception {
     	
 		        ArrayList&lt;Enum&gt; editType = new ArrayList&lt;Enum&gt;();
 		        int count = editObjectList.size();
@@ -1513,19 +1514,11 @@
 			    		}
 			    	//Delete selected data from history tables 
 			    	deleteHistory();
-		        } catch (RemoteException e) {
-		        	logger.error(&quot;Process UNDO failed. Remote exception caught in History. Details: &quot;+e.getMessage());
-		        	database.rollbackTransaction();
-                    RemoteException remex = new RemoteException(ERROR_UPDATE + e);
-                    remex.setStackTrace(e.getStackTrace());
-                    throw remex; 		           
+		        } catch (Exception e) {
+		        	logger.error(&quot;Process UNDO failed. Exception caught in History. Details: &quot;+e.getMessage());
+		        	database.rollbackTransaction();                    
+                    throw e; 		           
 		       	    
-		        } catch (DBLayerException e) {
-		        	logger.error(&quot;Process UNDO failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                   
-		        	database.rollbackTransaction();
-                    DBLayerException dbex = new DBLayerException(ERROR_UPDATE + e);
-                    dbex.setStackTrace(e.getStackTrace());
-                    throw dbex; 		            
 		        } 
 		        database.commitTransaction();	    	
 		    	//Create array of editing object and call notifyObservers
@@ -1563,7 +1556,7 @@
      * During delete data from table tHistoryChange verify foring key from table tHistory. 
      * Operation is executed in a separate thread using Task class.   
      */
-    public void deleteHistory() throws DBLayerException, RemoteException {
+    public void deleteHistory() throws Exception {
    	
     	//take from younger record to older record
     	for( int i=0; i &lt; toResult; i++) {
@@ -1577,38 +1570,22 @@
 	    	try {
 				database.executeDeleteHistory(historyRecord);
 				logger.debug(&quot;Deleting historyRecord successfully. Number of result: &quot;+i);
-			} catch (RemoteException e) {								
-				logger.error(&quot;Process UNDO failed. Deleting historyRecord failed. Remote exception caught in History. Details: &quot;+e.getMessage());	        	
-                RemoteException remex = new RemoteException(ERROR_DELETE + e);
-                remex.setStackTrace(e.getStackTrace());
-                throw remex; 		           
-			} catch (DBLayerException e) {								
-				logger.error(&quot;Process UNDO failed. Deleting historyRecord failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                   
-	        	database.rollbackTransaction();
-                DBLayerException dbex = new DBLayerException(ERROR_DELETE + e);
-                dbex.setStackTrace(e.getStackTrace());
-                throw dbex; 		           	          
-			}
-			int countResult = getRelationshipHistoryChange(historyChange.getId());			
-			if (countResult == 0) {				
-				try {
+			} catch (Exception e) {								
+				logger.error(&quot;Process UNDO failed. Deleting historyRecord failed. Exception caught in History. Details: &quot;+e.getMessage());	        	                
+                throw e; 		           
+			} 						
+			try {
+				int countResult = getRelationshipHistoryChange(historyChange.getId());				
+				if (countResult == 0) {	
 					database.executeDeleteHistory(historyChange);
 					logger.debug(&quot;Deleting historyChange successfully.&quot;);
-				} catch (RemoteException e) {
-					logger.error(&quot;Process UNDO failed. Deleting historyChange failed. Remote exception caught in History. Details: &quot;+e.getMessage());	        	
-	                RemoteException remex = new RemoteException(ERROR_DELETE + e);
-	                remex.setStackTrace(e.getStackTrace());
-	                throw remex; 		           
-				} catch (DBLayerException e) {
-					logger.error(&quot;Process UNDO failed. Deleting historyChange failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                   
-		        	database.rollbackTransaction();
-	                DBLayerException dbex = new DBLayerException(ERROR_DELETE + e);
-	                dbex.setStackTrace(e.getStackTrace());
-	                throw dbex; 		           
+				} else {
+					logger.debug(&quot;Exist other record in the table tHistory, whitch has the same value of attribute cChangeId.&quot;);
 				}
-			} else {
-				logger.debug(&quot;Exist other record in the table tHistory, whitch has the same value of attribute cChangeId.&quot;);
-			}
+			} catch (Exception e) {
+				logger.error(&quot;Process UNDO failed. Deleting historyChange failed. Exception caught in History. Details: &quot;+e.getMessage());	        		                
+                throw e; 		           
+			} 		 
     	}    	
 		//Clear lists 
     	markListId.clear();
@@ -1620,7 +1597,7 @@
      * @param id identifier of historyChange record 
      * @return int number of record from tHistory, where attribute cChangeId is equaled prameter &quot;id&quot;
      */
-    public int getRelationshipHistoryChange(int id){    	
+    public int getRelationshipHistoryChange(int id) throws Exception {    	
     	SelectQuery query = null;
     	int resultIdChange = 0;
     	int countResult = 100;
@@ -1635,14 +1612,10 @@
                 database.closeQuery(query);
         } catch(RemoteException e) {
         	logger.error(&quot;Searching historyChange failed.Remote exception caught in History. Details: &quot;+e.getMessage());
-       	    setError(ERROR_SEARCH_RECORD);       	   
-            setChanged();
-            notifyObservers();       	  
+       	    throw e;       	  
         } catch(DBLayerException e) {
         	logger.error(&quot;Searching historyChange failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                   
-            setError(ERROR_SEARCH_RECORD);            
-            setChanged();
-            notifyObservers();       	  
+            throw e;       	  
         }        
        	return countResult;
     }
@@ -1806,27 +1779,18 @@
      *  Delete all date from tables tHistory and tHistoryChange
      *  Operation is executed in a separate thread using Task class.
      */
-    public void clearHistory() throws RemoteException, DBLayerException {        
+    public void clearHistory() throws Exception {        
             	
         try {
             //delete data from table tHistory
             database.conditionDelete(HistoryRecord.class, HistoryRecord.ID, &quot;&gt;&quot;, 0);
             //delete data from  table tHistoryChange
             database.conditionDelete(HistoryChange.class, HistoryChange.ID, &quot;&gt;&quot;, 0);
-        } catch (RemoteException e) {
-        	logger.error(&quot;Process cleare database failed. Remote exception caught in History. Details: &quot;+e.getMessage());
-        	database.rollbackTransaction();
-            RemoteException remex = new RemoteException(ERROR_CLEAR_HISTORY + e);
-            remex.setStackTrace(e.getStackTrace());
-            throw remex; 		           
-       	    
-        } catch (DBLayerException e) {
-        	logger.error(&quot;Process cleare database failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                   
-        	database.rollbackTransaction();
-            DBLayerException dbex = new DBLayerException(ERROR_CLEAR_HISTORY + e);
-            dbex.setStackTrace(e.getStackTrace());
-            throw dbex; 		            
-        }       
+        } catch (Exception e) {
+        	logger.error(&quot;Process cleare database failed. Exception caught in History. Details: &quot;+e.getMessage());
+        	database.rollbackTransaction();           
+            throw e; 		                  	    
+        }  
     }
     
     /**
@@ -1840,7 +1804,7 @@
     	//TODO - osetrit proti smazani zaznamu na ktery existuje FK
     	
     	final Task task = new Task() {    		    		
-    		public Object task() throws DBLayerException, RemoteException {
+    		public Object task() throws Exception {
     			boolean ok = false;
     			
     			ok = database.beginTransaction();
@@ -1862,19 +1826,11 @@
 		            database.conditionDelete(Publication.class, Publication.DELETED, &quot;=&quot;, 1);
 		            //Delete all date from tables tHistory and tHistoryChange
 		            clearHistory();
-		        } catch (RemoteException e) {
-		        	logger.error(&quot;Process cleare database failed. Remote exception caught in History. Details: &quot;+e.getMessage());
-		        	database.rollbackTransaction();
-                    RemoteException remex = new RemoteException(ERROR_CLEAR_DATABASE + e);
-                    remex.setStackTrace(e.getStackTrace());
-                    throw remex; 		           
+		        } catch (Exception e) {
+		        	logger.error(&quot;Process cleare database failed. Exception caught in History. Details: &quot;+e.getMessage());
+		        	database.rollbackTransaction();                   
+                    throw e;                     
 		       	    
-		        } catch (DBLayerException e) {
-		        	logger.error(&quot;Process cleare database failed. DBLayer exception caught in History. Details: &quot;+e.getMessage());       	                                                   
-		        	database.rollbackTransaction();
-                    DBLayerException dbex = new DBLayerException(ERROR_CLEAR_DATABASE + e);
-                    dbex.setStackTrace(e.getStackTrace());
-                    throw dbex; 		            
 		        } 
 		        database.commitTransaction(); 
 		        return null;
@@ -1911,11 +1867,13 @@
                 return false;
             }
         } catch (RemoteException e) {
-        	logger.error(&quot;GetUserRight() failed. Remote exception caught in History. Details: &quot;+e.getMessage());       	                
-        }
+        	logger.error(&quot;GetUserRight() failed. Remote exception caught in History. Details: &quot;+e.getMessage());
+        	setError(ERROR_REMOTE_EXCEPTION);
+        	setRemoteEx(e);
+        }   
         return false;
     }
-    
+            
      //***************************//
     //****Init Hashtable*********//
     //**************************//
@@ -2045,9 +2003,25 @@
      */
     public String getError() {
         return this.error;
-    }    
+    }  
     
     /**
+     *  Set an remote exception (network communication failed)
+     *  @param ex  RemoteException (network communication failed)
+     */
+    public void setRemoteEx(RemoteException ex) {
+        this.remoteEx = ex;
+    }
+    
+    /**
+     *  Get remote exception (network communication failed)
+     *  @return remote exception (network communication failed)
+     */
+    public RemoteException getRemoteEx() {
+        return this.remoteEx;
+    }  
+    
+    /**
      * Get information about selecting of all record
      * @return true if all recorda were selected.
      */
@@ -2080,21 +2054,29 @@
 	 } 
 	 
 	/**
-	 * Get object whitch history of changes is displayed (Habitat or Occurrence) 
-	 * @return object whitch history of changes is displayed (Habitat or Occurrence)
+	 * Get object whitch history of changes is displayed (Occurrence) 
+	 * @return object whitch history of changes is displayed (Occurrence)
 	 */ 
     public Object getData() {
     	return data;
     }
        
     /**
-     * Set object whitch history of changes is displayed (Habitat or Occurrence)
-     * @param data object whitch history of changes is displayed (Habitat or Occurrence)
+     * Set object whitch history of changes is displayed (Occurrence)
+     * @param data object whitch history of changes is displayed (Occurrence)
      */
     public void setData(Object data) {
     	this.data = data;
-    }	
+    }
     
+    /** 
+     * Get id of object whitch history of changes is displayed (Occurrence)     
+     * @return identifier of object whitch history of changes is displayed (Occurrence)
+     */
+    public int getOccId(){
+    	return this.dataId; 
+    }
+    
     /**
      * Get list of identifiers of selected items (history of record)
      * @return list of identifiers of selected items (history of record)

Modified: trunk/src/net/sf/plantlore/client/history/HistoryCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/HistoryCtrl.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/history/HistoryCtrl.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -3,14 +3,14 @@
 
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
-import java.awt.event.KeyEvent;
-import java.awt.event.KeyListener;
 import java.rmi.RemoteException;
-import javax.swing.JOptionPane;
-import net.sf.plantlore.common.ProgressBar;
+
+import net.sf.plantlore.common.DefaultCancelAction;
+import net.sf.plantlore.common.DefaultEscapeKeyPressed;
+import net.sf.plantlore.common.DefaultProgressBar;
+import net.sf.plantlore.common.DefaultReconnectDialog;
 import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.exception.DBLayerException;
-import net.sf.plantlore.l10n.L10n;
 
 import org.apache.log4j.Logger;
 
@@ -34,16 +34,18 @@
      *  Creates a new instance of HistoryCtrl 
      *  @param model model of the History MVC
      *  @param view  view of the History MVC
+     *  @param occId identifier of selected occurrence
      * 
      */
-    public HistoryCtrl(History model, HistoryView view)
+    public HistoryCtrl(History modelH, HistoryView viewH)
     {    	
         logger = Logger.getLogger(this.getClass().getPackage().getName());        
-        this.model = model;        
-        this.view = view;
+        this.model = modelH;        
+        this.view = viewH;
+        DefaultEscapeKeyPressed escapeKeyPressed = new DefaultEscapeKeyPressed(view);
              
         //Add action listeners to buttons        
-        view.closeButton.addActionListener(new closeButtonListener());        
+        view.closeButton.setAction(new DefaultCancelAction(view));        
         view.previousButton.addActionListener(new previousButtonListener());
         view.nextButton.addActionListener(new nextButtonListener());
         view.selectAllButton.addActionListener(new selectAllButtonListener());
@@ -51,42 +53,41 @@
         view.undoButton.addActionListener(new undoSelectedButtonListener());
         view.toDisplayValueTextField.addActionListener(new rowSetDisplayChangeListener());
         //Add key listeners
-        view.closeButton.addKeyListener(new escapeKeyPressed());
-        view.previousButton.addKeyListener(new escapeKeyPressed());
-        view.nextButton.addKeyListener(new escapeKeyPressed());
-        view.selectAllButton.addKeyListener(new escapeKeyPressed());
-        view.unselectAllButton.addKeyListener(new escapeKeyPressed());
-        view.undoButton.addKeyListener(new escapeKeyPressed());
-        view.toDisplayValueTextField.addKeyListener(new escapeKeyPressed());
-        view.helpButton.addKeyListener(new escapeKeyPressed());
-        view.getTable().addKeyListener(new escapeKeyPressed());
+        view.closeButton.addKeyListener(escapeKeyPressed);
+        view.previousButton.addKeyListener(escapeKeyPressed);
+        view.nextButton.addKeyListener(escapeKeyPressed);
+        view.selectAllButton.addKeyListener(escapeKeyPressed);
+        view.unselectAllButton.addKeyListener(escapeKeyPressed);
+        view.undoButton.addKeyListener(escapeKeyPressed);
+        view.toDisplayValueTextField.addKeyListener(escapeKeyPressed);
+        view.helpButton.addKeyListener(escapeKeyPressed);
+        view.getTable().addKeyListener(escapeKeyPressed);                                
     }
     
-    /**     
-     * KeyListener class controlling the pressing key ESCAPE.
-     * On key ESCAPE hides the view.     
+    /**
+     * Reload new data for displaying in view dialog.
+     * @param fromRow number of the first row to show in table
+     * @param countRow number of rows to retrieve 
      */
-    public class escapeKeyPressed implements KeyListener {
-    	 	 public void keyPressed(KeyEvent evt){
-    	 		if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) {
-    	 			view.close();
-    	 		}    	 		     	 		 
-    	 	 }
-    	      public void keyReleased(KeyEvent evt) {}    	     
-    	      public void keyTyped(KeyEvent evt) {}    	         
+    public void reloadData(int fromRow, int countRow) {
+    	try {
+    		model.processResult(fromRow, countRow);        
+            view.getTable().setModel(new HistoryTableModel(model));             
+            int from = model.getCurrentFirstRow();
+            int to = from + view.getTable().getRowCount() - 1;
+            if (to &lt;= 0){
+         	   view.setCurrentRowsInfo(&quot;0-0&quot;);
+            }else {
+         	   view.setCurrentRowsInfo(from + &quot;-&quot; + to);
+            }    
+    	} catch (RemoteException e) {
+    		DefaultReconnectDialog.show(view, e);
+    	} catch (DBLayerException e) {
+    		view.showErrorMessage(e.getMessage());
+    	}
+    	           
     }
     
-    /**
-    * ActionListener class controlling the &lt;b&gt;CLOSE&lt;/b&gt; button on the form.
-    * On Close hides the view.
-    */
-   class closeButtonListener implements ActionListener {
-	    public void actionPerformed(ActionEvent actionEvent)
-       {
-    	   view.close();
-       }
-   }
-   
    /**
     *  ActionListener class controlling the &lt;b&gt;PREV&lt;/b&gt; button on the form.
     *  The button PREV is used for browsing the search results.
@@ -102,14 +103,7 @@
            // Get previous page of results
            if (model.getCurrentFirstRow() &gt; 1) {
                int firstRow = Math.max(model.getCurrentFirstRow()- model.getDisplayRows(), 1);
-               model.processResult(firstRow, model.getDisplayRows()); 
-               if (model.isError()) return;
-               if (model.getCurrentFirstRow() &gt; 1){
-               }
-               view.getTable().setModel(new HistoryTableModel(model));
-               int from = model.getCurrentFirstRow();
-               int to = from + view.getTable().getRowCount() - 1;
-               view.setCurrentRowsInfo(from + &quot;-&quot; + to);
+               reloadData(firstRow, model.getDisplayRows());               
            }      
            //Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -140,16 +134,7 @@
            }
            // Get next page of result
            if (model.getCurrentFirstRow()+ view.getTable().getRowCount()&lt;=model.getResultRows()) {
-               model.processResult(model.getCurrentFirstRow()+ model.getDisplayRows(), view.getTable().getRowCount());
-               if (model.isError()) return;
-               view.getTable().setModel(new HistoryTableModel(model));             
-               int from = model.getCurrentFirstRow();
-               int to = from + view.getTable().getRowCount() - 1;
-               if (to &lt;= 0){
-            	   view.setCurrentRowsInfo(&quot;0-0&quot;);
-               }else {
-            	   view.setCurrentRowsInfo(from + &quot;-&quot; + to);
-               }               
+        	   reloadData(model.getCurrentFirstRow()+ model.getDisplayRows(), view.getTable().getRowCount());               
            }  
            //Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -224,51 +209,30 @@
             	   logger.debug(&quot;Button OK was press.&quot;);
             	   Task task = model.commitUpdate(model.getResultRows(), true);  
             	   
-            	   ProgressBar progressBar = new ProgressBar(task, view, true) {		   				
-					  private static final long serialVersionUID = 1967781832827332268L;
-							public void exceptionHandler(Exception e) {
-		   						if (e instanceof DBLayerException) {	   									   							
-		   							DBLayerException dbex = (DBLayerException) e;		   							
-									JOptionPane.showMessageDialog(view, L10n.getString(&quot;Error.HistoryDBLayerException&quot;)+ &quot;\n&quot; + dbex.getMessage(),
-		 							   L10n.getString(&quot;Error.HistoryDBLayerExceptionTitle&quot;), JOptionPane.WARNING_MESSAGE);																						
-									logger.error(dbex + &quot;: &quot; + dbex.getErrorInfo());
-		   							getTask().stop();
-		   							return;
-		   						}
-		   						if (e instanceof RemoteException) {	 
-		   							RemoteException remex = (RemoteException) e;		   							
-		   							JOptionPane.showMessageDialog(view, L10n.getString(&quot;Error.RemoteException&quot;)+ &quot;\n&quot; + remex.getMessage(),
-		 							   L10n.getString(&quot;Error.RemoteExceptionTitle&quot;), JOptionPane.WARNING_MESSAGE);																						
-									logger.error(remex + &quot;: &quot; + remex.getMessage());
-		   							getTask().stop();
-		   							return;
-		   						}
-		   						JOptionPane.showMessageDialog(view, L10n.getString(&quot;Delete.Message.UnknownException&quot;)+ &quot;\n&quot; + e.getMessage(),
-			 					    L10n.getString(&quot;Delete.Message.UnknownExceptionTitle&quot;), JOptionPane.WARNING_MESSAGE);							
-		   						logger.error(e);
-		   					}
-	
+            	   new DefaultProgressBar(task, view, true) {		   									
+							@Override
 		   					public void afterStopping() {
-		   					   model.searchEditHistory(model.getData());
-		   	            	   model.processResult(1,model.getDisplayRows());
-		   	            	   view.getTable().setModel(new HistoryTableModel(model));
-		   	            	   int resultRows = model.getResultRows();
-		   	            	   if (resultRows == 0) {
-		   	            		   view.setCurrentRowsInfo(&quot;0-0&quot;); 
-		   	            	   } else {
-		   	            		   int from = model.getCurrentFirstRow();
-		   	                       int to = from + view.getTable().getRowCount() - 1;               
-		   	                       view.setCurrentRowsInfo(from + &quot;-&quot; + to);    
-		   	            	   }               
-		   	                       view.setCountResutl(resultRows);   
+								try {
+			   					   model.searchEditHistory(model.getData());
+			   					   reloadData(1,model.getDisplayRows());			   	            	          
+			   	                   view.setCountResutl(model.getResultRows());
+								} catch (RemoteException e) {
+									DefaultReconnectDialog.show(view, e);
+						    	} catch (DBLayerException e) {
+						    		view.showErrorMessage(e.getMessage());
+						    	}
 		   	               } 		   					
-		   				};
-		   				progressBar.setTitle(L10n.getString(&quot;History.Undo.ProgressTitle&quot;));	                   	                   
-	                    task.start();            	               	   
+		   				};		   					                   	                   
+	                    task.start();     	                   
                } else {            	  
             	   logger.debug(&quot;Button Cancle was press.&quot;); 
                }  
            } else {
+        	   if (model.getError().equals(History.ERROR_REMOTE_EXCEPTION)) {
+        		   DefaultReconnectDialog.show(view, model.getRemoteEx());
+        	   } else {
+        		   view.showErrorMessage(model.getError());
+        	   }
         	   model.setError(null);        	           	  
            }
        }
@@ -298,12 +262,7 @@
            // If neccessary reload search results
            if (oldValue != view.getDisplayRows()) {
                logger.debug(&quot;OK&quot;+ model.getCurrentFirstRow() + &quot; &quot; + view.getDisplayRows());
-        	   model.processResult(model.getCurrentFirstRow(), view.getDisplayRows());
-               if (model.isError()) return;
-               view.getTable().setModel(new HistoryTableModel(model));
-               int from = model.getCurrentFirstRow();
-               int to = from + view.getTable().getRowCount() - 1;
-               view.setCurrentRowsInfo(from + &quot;-&quot; + to);               
+        	   reloadData(model.getCurrentFirstRow(), view.getDisplayRows());                      
            }
            // Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {

Modified: trunk/src/net/sf/plantlore/client/history/HistoryView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/history/HistoryView.form	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/history/HistoryView.form	2006-08-08 16:12:12 UTC (rev 496)
@@ -73,19 +73,19 @@
         &lt;DimensionLayout dim=&quot;0&quot;&gt;
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;EmptySpace min=&quot;-2&quot; pref=&quot;19&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;taxonLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;authorLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;locationLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Component id=&quot;taxonLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace pref=&quot;274&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                      &lt;Component id=&quot;taxonValueLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Component id=&quot;authorValueLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Component id=&quot;locationValueLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; pref=&quot;52&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;taxonValueLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
+                      &lt;Component id=&quot;locationValueLabel&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                      &lt;Component id=&quot;authorValueLabel&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace pref=&quot;228&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace pref=&quot;488&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
@@ -143,23 +143,17 @@
         &lt;/Component&gt;
         &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;taxonValueLabel&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
-              &lt;Connection code=&quot;model.getNamePlant()&quot; type=&quot;code&quot;/&gt;
-            &lt;/Property&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;taxon&quot;/&gt;
           &lt;/Properties&gt;
         &lt;/Component&gt;
         &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;authorValueLabel&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
-              &lt;Connection code=&quot;model.getNameAuthor()&quot; type=&quot;code&quot;/&gt;
-            &lt;/Property&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;author&quot;/&gt;
           &lt;/Properties&gt;
         &lt;/Component&gt;
         &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;locationValueLabel&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
-              &lt;Connection code=&quot;model.getLocation()&quot; type=&quot;code&quot;/&gt;
-            &lt;/Property&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;location&quot;/&gt;
           &lt;/Properties&gt;
         &lt;/Component&gt;
       &lt;/SubComponents&gt;
@@ -189,7 +183,7 @@
                       &lt;Component id=&quot;whenInsertValueLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;whoInsertValueLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace pref=&quot;462&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace pref=&quot;502&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
@@ -232,16 +226,12 @@
         &lt;/Component&gt;
         &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;whenInsertValueLabel&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
-              &lt;Connection code=&quot;DateFormat.getDateTimeInstance(DateFormat.MEDIUM, DateFormat.SHORT,L10n.getCurrentLocale()).format(model.getWhen()) &quot; type=&quot;code&quot;/&gt;
-            &lt;/Property&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;when&quot;/&gt;
           &lt;/Properties&gt;
         &lt;/Component&gt;
         &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;whoInsertValueLabel&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
-              &lt;Connection code=&quot;model.getNameUser()&quot; type=&quot;code&quot;/&gt;
-            &lt;/Property&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;who&quot;/&gt;
           &lt;/Properties&gt;
         &lt;/Component&gt;
       &lt;/SubComponents&gt;
@@ -285,7 +275,7 @@
                           &lt;Component id=&quot;displayedLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Component id=&quot;displayedValueLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace pref=&quot;69&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Component id=&quot;nextButton&quot; min=&quot;-2&quot; pref=&quot;60&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
@@ -403,9 +393,7 @@
         &lt;/Component&gt;
         &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;totalResultValueLabel&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
-              &lt;Connection code=&quot;((Integer)model.getResultRows()).toString()&quot; type=&quot;code&quot;/&gt;
-            &lt;/Property&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;total&quot;/&gt;
           &lt;/Properties&gt;
         &lt;/Component&gt;
         &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;toDisplayLabel&quot;&gt;
@@ -417,9 +405,7 @@
         &lt;/Component&gt;
         &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;toDisplayValueTextField&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
-              &lt;Connection code=&quot;((Integer)model.getDisplayRows()).toString()&quot; type=&quot;code&quot;/&gt;
-            &lt;/Property&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;rows&quot;/&gt;
           &lt;/Properties&gt;
           &lt;AuxValues&gt;
             &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
@@ -434,9 +420,7 @@
         &lt;/Component&gt;
         &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;displayedValueLabel&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
-              &lt;Connection code=&quot;model.getCurrentDisplayRows()&quot; type=&quot;code&quot;/&gt;
-            &lt;/Property&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;displayed&quot;/&gt;
           &lt;/Properties&gt;
         &lt;/Component&gt;
       &lt;/SubComponents&gt;

Modified: trunk/src/net/sf/plantlore/client/history/HistoryView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/HistoryView.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/history/HistoryView.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -45,26 +45,59 @@
         getRootPane().setDefaultButton(closeButton);        
         //Init Help
         PlantloreHelp.addKeyHelp(PlantloreHelp.HISTORY_MANAGER, this.getRootPane());
-        PlantloreHelp.addButtonHelp(PlantloreHelp.HISTORY_MANAGER, this.helpButton);        
-        getTable().setModel(new HistoryTableModel(model));         
-        previousButton.setEnabled(false);
-        if (getTable().getRowCount() &lt;= model.getDisplayRows()) {
+        PlantloreHelp.addButtonHelp(PlantloreHelp.HISTORY_MANAGER, this.helpButton);                
+    }
+    
+    /**
+     * Initialize actual data for displaying in view dialog.     
+     */
+    public void initialize() {    	         
+        previousButton.setEnabled(false);             
+        model.setDisplayRows(History.DEFAULT_DISPLAY_ROWS);
+        model.setCurrentFirstRow(1);
+        model.getMarkItem().clear();
+        model.getMarkListId().clear();
+        model.setSelectAll(false);
+        model.setUnselectedAll(false);
+        if (History.DEFAULT_DISPLAY_ROWS &gt;= model.getResultRows()) {
         	nextButton.setEnabled(false);
+        }else{
+        	nextButton.setEnabled(true);
         }
+        getTable().setModel(new HistoryTableModel(model));
+        taxonValueLabel.setText(model.getNamePlant());
+        authorValueLabel.setText(model.getNameAuthor());
+        locationValueLabel.setText(model.getLocation());
+        if (model.getWhen() != null)
+        	whenInsertValueLabel.setText(DateFormat.getDateTimeInstance(DateFormat.MEDIUM, DateFormat.SHORT,L10n.getCurrentLocale()).format(model.getWhen()) );
+        whoInsertValueLabel.setText(model.getNameUser());
+        totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());
+        toDisplayValueTextField.setText(((Integer)model.getDisplayRows()).toString());
+        displayedValueLabel.setText(model.getCurrentDisplayRows());
     }
     
     /**
+     *  Shows and inicialize actual data or hides this dialog depending on the value of parameter visible. 
+     *  @param visible if true, shows this component and initialize actual data; otherwise, hides this component
+     */
+    public void setVisible(boolean visible) {
+    	if (visible) initialize();
+    	super.setVisible(visible);
+    }
+    
+    /**
      * Reload the view dialog or display some kind of error.
      */
       public void update(Observable observable, Object object)
     {                                
     	  //Check whether we have some kind of error to display
-          if (model.isError()) {
+          if (model.isError()) {        	  
               showErrorMessage(model.getError());                          
               return;
           } 
     } 
     
+     
     /** This method is called from within the constructor to
      * initialize the form.
      * WARNING: Do NOT modify this code. The content of this method is
@@ -112,28 +145,28 @@
         locationLabel.setFont(new java.awt.Font(&quot;Tahoma&quot;, 1, 11));
         locationLabel.setText(L10n.getString(&quot;History.Location&quot;));
 
-        taxonValueLabel.setText(model.getNamePlant());
+        taxonValueLabel.setText(&quot;taxon&quot;);
 
-        authorValueLabel.setText(model.getNameAuthor());
+        authorValueLabel.setText(&quot;author&quot;);
 
-        locationValueLabel.setText(model.getLocation());
+        locationValueLabel.setText(&quot;location&quot;);
 
         org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
         jPanel1.setLayout(jPanel1Layout);
         jPanel1Layout.setHorizontalGroup(
             jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(jPanel1Layout.createSequentialGroup()
-                .add(19, 19, 19)
+                .addContainerGap()
                 .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                    .add(taxonLabel)
                     .add(authorLabel)
-                    .add(locationLabel)
-                    .add(taxonLabel))
-                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 274, Short.MAX_VALUE)
-                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                    .add(locationLabel))
+                .add(52, 52, 52)
+                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                     .add(taxonValueLabel)
-                    .add(authorValueLabel)
-                    .add(locationValueLabel))
-                .addContainerGap(228, Short.MAX_VALUE))
+                    .add(locationValueLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                    .add(authorValueLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                .addContainerGap(488, Short.MAX_VALUE))
         );
         jPanel1Layout.setVerticalGroup(
             jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -158,9 +191,9 @@
         whoInsertLabel.setFont(new java.awt.Font(&quot;Tahoma&quot;, 1, 11));
         whoInsertLabel.setText(L10n.getString(&quot;History.WhoInsert&quot;));
 
-        whenInsertValueLabel.setText(DateFormat.getDateTimeInstance(DateFormat.MEDIUM, DateFormat.SHORT,L10n.getCurrentLocale()).format(model.getWhen()) );
+        whenInsertValueLabel.setText(&quot;when&quot;);
 
-        whoInsertValueLabel.setText(model.getNameUser());
+        whoInsertValueLabel.setText(&quot;who&quot;);
 
         org.jdesktop.layout.GroupLayout jPanel2Layout = new org.jdesktop.layout.GroupLayout(jPanel2);
         jPanel2.setLayout(jPanel2Layout);
@@ -175,7 +208,7 @@
                 .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(whenInsertValueLabel)
                     .add(whoInsertValueLabel))
-                .addContainerGap(462, Short.MAX_VALUE))
+                .addContainerGap(502, Short.MAX_VALUE))
         );
         jPanel2Layout.setVerticalGroup(
             jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -217,15 +250,15 @@
 
         totalResultLabel.setText(L10n.getString(&quot;History.TotalResult&quot;));
 
-        totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());
+        totalResultValueLabel.setText(&quot;total&quot;);
 
         toDisplayLabel.setText(L10n.getString(&quot;History.RowsToDisplay&quot;));
 
-        toDisplayValueTextField.setText(((Integer)model.getDisplayRows()).toString());
+        toDisplayValueTextField.setText(&quot;rows&quot;);
 
         displayedLabel.setText(L10n.getString(&quot;History.Displayed&quot;));
 
-        displayedValueLabel.setText(model.getCurrentDisplayRows());
+        displayedValueLabel.setText(&quot;displayed&quot;);
 
         org.jdesktop.layout.GroupLayout jPanel3Layout = new org.jdesktop.layout.GroupLayout(jPanel3);
         jPanel3.setLayout(jPanel3Layout);
@@ -255,7 +288,7 @@
                         .add(displayedLabel)
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(displayedValueLabel)
-                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 69, Short.MAX_VALUE)
                         .add(nextButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 60, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                 .addContainerGap())
         );
@@ -368,7 +401,8 @@
      */
     public void setCountResutl(Integer resultRows)
     {
-    	this.totalResultValueLabel.setText(resultRows.toString());
+    	if (resultRows != null)
+    		this.totalResultValueLabel.setText(resultRows.toString());
     }
     
     /**

Modified: trunk/src/net/sf/plantlore/client/history/WholeHistoryCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/WholeHistoryCtrl.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/history/WholeHistoryCtrl.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -11,17 +11,14 @@
 
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
-import java.awt.event.KeyEvent;
-import java.awt.event.KeyListener;
 import java.rmi.RemoteException;
 
-import javax.swing.JOptionPane;
-
-import net.sf.plantlore.client.history.HistoryCtrl.escapeKeyPressed;
-import net.sf.plantlore.common.ProgressBar;
+import net.sf.plantlore.common.DefaultCancelAction;
+import net.sf.plantlore.common.DefaultEscapeKeyPressed;
+import net.sf.plantlore.common.DefaultProgressBar;
+import net.sf.plantlore.common.DefaultReconnectDialog;
 import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.exception.DBLayerException;
-import net.sf.plantlore.l10n.L10n;
 
 import org.apache.log4j.Logger;
 
@@ -50,9 +47,10 @@
         logger = Logger.getLogger(this.getClass().getPackage().getName());        
         this.model = model;
         this.view = view;
+        DefaultEscapeKeyPressed escapeKeyPressed = new DefaultEscapeKeyPressed(view);
           
         // Add action listeners to buttons        
-        view.closeButton.addActionListener(new closeButtonListener());
+        view.closeButton.setAction(new DefaultCancelAction(view)); 
         view.previousButton.addActionListener(new previousButtonListener());
         view.nextButton.addActionListener(new nextButtonListener());     
         view.undoToDateButton.addActionListener(new undoToDateButtonListener());
@@ -60,43 +58,41 @@
         view.toDisplayValueTextField.addActionListener(new rowSetDisplayChangeListener()); 
         view.clearHistoryButton.addActionListener(new clearHistoryListener());
         // Add key listeners
-        view.closeButton.addKeyListener(new escapeKeyPressed());
-        view.previousButton.addKeyListener(new escapeKeyPressed());
-        view.nextButton.addKeyListener(new escapeKeyPressed());
-        view.undoToDateButton.addKeyListener(new escapeKeyPressed());
-        view.toDisplayValueTextField.addKeyListener(new escapeKeyPressed());
-        view.helpButton.addKeyListener(new escapeKeyPressed());
-        view.tableHistoryList.addKeyListener(new escapeKeyPressed());
-        view.clearHistoryButton.addKeyListener(new escapeKeyPressed());
-        view.detailsButton.addKeyListener(new escapeKeyPressed());
+        view.closeButton.addKeyListener(escapeKeyPressed);
+        view.previousButton.addKeyListener(escapeKeyPressed);
+        view.nextButton.addKeyListener(escapeKeyPressed);
+        view.undoToDateButton.addKeyListener(escapeKeyPressed);
+        view.toDisplayValueTextField.addKeyListener(escapeKeyPressed);
+        view.helpButton.addKeyListener(escapeKeyPressed);
+        view.tableHistoryList.addKeyListener(escapeKeyPressed);
+        view.clearHistoryButton.addKeyListener(escapeKeyPressed);
+        view.detailsButton.addKeyListener(escapeKeyPressed);
     }
-    
-    /**     
-     * KeyListener class controlling the pressing key ESCAPE.
-     * On key ESCAPE hides the view.     
+ 
+    /**
+     * Reload new data for displaying in view dialog.
+     * @param fromRow number of the first row to show in table. Number of the first row to retraieve is 1.
+     * @param countRow number of rows to retrieve 
      */
-    public class escapeKeyPressed implements KeyListener {
-    	 	 public void keyPressed(KeyEvent evt){
-    	 		if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) {
-    	 			view.close();
-    	 		}    	 		     	 		 
-    	 	 }
-    	      public void keyReleased(KeyEvent evt) {}    	     
-    	      public void keyTyped(KeyEvent evt) {}    	         
+    public void reloadData(int fromRow, int countRow) {
+    	try {
+    		model.processResult(fromRow, countRow);                   
+            view.tableHistoryList.setModel(new WholeHistoryTableModel(model));
+            int from = model.getCurrentFirstRow();
+            int to = from + view.tableHistoryList.getRowCount() - 1;
+            if (to &lt;= 0){
+         	   view.displayedValueLabel.setText(&quot;0-0&quot;);
+            }else {
+         	   view.displayedValueLabel.setText(from + &quot;-&quot; + to);
+            }    
+    	} catch (RemoteException e) {
+    		DefaultReconnectDialog.show(view, e);
+    	} catch (DBLayerException e) {
+    		view.showErrorMessage(e.getMessage());
+    	}    	        	         
     }
     
    /**
-    * ActionListener class controlling the &lt;b&gt;CLOSE&lt;/b&gt; button on the form.
-    * On Close hides the view.
-    */
-   class closeButtonListener implements ActionListener {
-       public void actionPerformed(ActionEvent actionEvent)
-       {
-    	   view.close();
-       }
-   }
-   
-   /**
     *  ActionListener class controlling the &lt;b&gt;PREV&lt;/b&gt; button on the form.
     *  The button PREV is used for browsing the search results.
     */
@@ -111,14 +107,7 @@
            // Get previous page of results
            if (model.getCurrentFirstRow() &gt; 1) {
                int firstRow = Math.max(model.getCurrentFirstRow()- model.getDisplayRows(), 1);
-               model.processResult(firstRow, model.getDisplayRows()); 
-               if (model.isError()) return;
-               if (model.getCurrentFirstRow() &gt; 1){
-               }
-               view.tableHistoryList.setModel(new WholeHistoryTableModel(model));
-               int from = model.getCurrentFirstRow();
-               int to = from + view.tableHistoryList.getRowCount() - 1;
-               view.displayedValueLabel.setText(from + &quot;-&quot; + to);
+               reloadData(firstRow, model.getDisplayRows());                
            }      
            //Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -149,16 +138,7 @@
            }
            // Get next page of result
            if (model.getCurrentFirstRow()+ view.tableHistoryList.getRowCount()&lt;=model.getResultRows()) {
-               model.processResult(model.getCurrentFirstRow()+ model.getDisplayRows(), view.tableHistoryList.getRowCount());
-               if (model.isError()) return;
-               view.tableHistoryList.setModel(new HistoryTableModel(model));             
-               int from = model.getCurrentFirstRow();
-               int to = from + view.tableHistoryList.getRowCount() - 1;
-               if (to &lt;= 0){
-            	   view.displayedValueLabel.setText(&quot;0-0&quot;);
-               }else {
-            	   view.displayedValueLabel.setText(from + &quot;-&quot; + to);
-               }               
+               reloadData(model.getCurrentFirstRow()+ model.getDisplayRows(), view.tableHistoryList.getRowCount());                       
            }  
            //Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -197,12 +177,7 @@
            logger.debug(&quot;New display rows: &quot;+view.getDisplayRows());
            // If neccessary reload search results
            if (oldValue != view.getDisplayRows()) {
-               model.processResult(model.getCurrentFirstRow(), view.getDisplayRows());
-               if (model.isError()) return;
-               view.tableHistoryList.setModel(new HistoryTableModel(model));
-               int from = model.getCurrentFirstRow();
-               int to = from + view.tableHistoryList.getRowCount() - 1;
-               view.displayedValueLabel.setText(from + &quot;-&quot; + to);               
+               reloadData(model.getCurrentFirstRow(), view.getDisplayRows());                              
            }
            // Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -248,55 +223,33 @@
 	                   logger.debug(&quot;Button OK was press.&quot;);    
 	                   Task task = model.commitUpdate(toResult, false);
 	                   
-	                   ProgressBar progressBar = new ProgressBar(task, view, true) {		   										
-						  private static final long serialVersionUID = -6065695152319199854L;
-							public void exceptionHandler(Exception e) {
-		   						if (e instanceof DBLayerException) {	   									   							
-		   							DBLayerException dbex = (DBLayerException) e;
-									JOptionPane.showMessageDialog(view, L10n.getString(&quot;Error.HistoryDBLayerException&quot;)+ &quot;\n&quot; + dbex.getErrorInfo(),
-		 							   L10n.getString(&quot;Error.HistoryDBLayerExceptionTitle&quot;), JOptionPane.WARNING_MESSAGE);																						
-									logger.error(dbex + &quot;: &quot; + dbex.getErrorInfo());
-		   							getTask().stop();
-		   							return;
-		   						}
-		   						if (e instanceof RemoteException) {	 
-		   							RemoteException remex = (RemoteException) e;
-		   							//TODO zobrazit vlastni message - nemusi byt vzdy byt poskozene pripojeni k DB, nekdo mohl smazat data, atd..
-		   							JOptionPane.showMessageDialog(view, L10n.getString(&quot;Error.RemoteException&quot;)+ &quot;\n&quot; + remex.getMessage(),
-		 							   L10n.getString(&quot;Error.RemoteExceptionTitle&quot;), JOptionPane.WARNING_MESSAGE);																						
-									logger.error(remex + &quot;: &quot; + remex.getMessage());
-		   							getTask().stop();
-		   							return;
-		   						}
-		   						JOptionPane.showMessageDialog(view, L10n.getString(&quot;Delete.Message.UnknownException&quot;)+ &quot;\n&quot; + e.getMessage(),
-			 					    L10n.getString(&quot;Delete.Message.UnknownExceptionTitle&quot;), JOptionPane.WARNING_MESSAGE);							
-		   						logger.error(e);
-		   					}
-	
+	                   new DefaultProgressBar(task, view, true) {		   										
+						    @Override
 		   					public void afterStopping() {
-		   						logger.debug(&quot;Load Data&quot;);	                   
-		 	                    model.searchWholeHistoryData();        	
-		 	                    model.processResult(1,model.getDisplayRows());
-		 	                    view.tableHistoryList.setModel(new WholeHistoryTableModel(model));
-		 	                    Integer resultRows = model.getResultRows();
-		 	                    if (resultRows == 0) {
-		 	                            view.displayedValueLabel.setText(&quot;0-0&quot;); 
-		 	                    } else {
-		 	                            int from = model.getCurrentFirstRow();
-		 	                    int to = from + view.tableHistoryList.getRowCount() - 1;               
-		 	                    view.displayedValueLabel.setText(from + &quot;-&quot; + to);    
-		 	                    }               
-		 	                    view.totalResultValueLabel.setText(resultRows.toString());
+		   						logger.debug(&quot;Load Data&quot;);	   
+		   						try {
+		   						   model.searchWholeHistoryData();
+		   						   reloadData(1,model.getDisplayRows());
+		   						   view.setCountResult(model.getResultRows());
+		   						} catch (RemoteException e) {
+									DefaultReconnectDialog.show(view, e);
+						    	} catch (DBLayerException e) {
+						    		view.showErrorMessage(e.getMessage());
+						    	}
 		   					}
-		   				};
-		   				progressBar.setTitle(L10n.getString(&quot;History.Undo.ProgressTitle&quot;));	                   	                   
+		   				};		   					                   	                  
 	                    task.start();
 	                   
 	               } else {	                       	                     
 	                       logger.debug(&quot;Button Cancle was press.&quot;);
 	               } 
                 } else {
-                	model.setError(null);
+                	if (model.getError().equals(History.ERROR_REMOTE_EXCEPTION)) {
+             		   DefaultReconnectDialog.show(view, model.getRemoteEx());
+             	   } else {
+             		   view.showErrorMessage(model.getError());
+             	   }
+             	   model.setError(null); 
                 }
             }
          }
@@ -322,11 +275,16 @@
                int resultNumber = view.tableHistoryList.getSelectedRow() + model.getCurrentFirstRow()-1;             
                String detailsMessage = model.getDetailsMessage(resultNumber);
                DetailsHistoryView detailsView = new DetailsHistoryView(view, true);
-               DetailsHistoryCtrl detailsCtrl = new DetailsHistoryCtrl(detailsView);
+               new DetailsHistoryCtrl(detailsView);
                detailsView.setDetailsMessage(detailsMessage);
                detailsView.setVisible(true);               
            }    
-           model.setError(null);
+           if (model.getError().equals(History.ERROR_REMOTE_EXCEPTION)) {
+    		   DefaultReconnectDialog.show(view, model.getRemoteEx());
+    	   } else {
+    		   view.showErrorMessage(model.getError());
+    	   }
+    	   model.setError(null); 
        }
     }
     
@@ -353,42 +311,21 @@
                    // delete records whit contition cdelete &gt; 0
                    Task task = model.clearDatabase();
                    
-                   ProgressBar progressBar = new ProgressBar(task, view, true) {		   				
-						private static final long serialVersionUID = -6065695152319199854L;
-							public void exceptionHandler(Exception e) {
-		   						if (e instanceof DBLayerException) {	   									   							
-		   							DBLayerException dbex = (DBLayerException) e;		   							
-									JOptionPane.showMessageDialog(view, L10n.getString(&quot;Error.HistoryDBLayerException&quot;)+ &quot;\n&quot; + dbex.getErrorInfo(),
-		 							   L10n.getString(&quot;Error.HistoryDBLayerExceptionTitle&quot;), JOptionPane.WARNING_MESSAGE);																						
-									logger.error(dbex + &quot;: &quot; + dbex.getErrorInfo());
-		   							getTask().stop();
-		   							return;
-		   						}
-		   						if (e instanceof RemoteException) {	 
-		   							RemoteException remex = (RemoteException) e;
-		   							//TODO zobrazit vlastni message - nemusi vzdy byt poskozene pripojeni k DB, nekdo mohl smazat data, atd..
-		   							JOptionPane.showMessageDialog(view, L10n.getString(&quot;Error.RemoteException&quot;)+ &quot;\n&quot; + remex.getMessage(),
-		 							   L10n.getString(&quot;Error.RemoteExceptionTitle&quot;), JOptionPane.WARNING_MESSAGE);																						
-									logger.error(remex + &quot;: &quot; + remex.getMessage());
-		   							getTask().stop();
-		   							return;
-		   						}
-		   						JOptionPane.showMessageDialog(view, L10n.getString(&quot;Delete.Message.UnknownException&quot;)+ &quot;\n&quot; + e.getMessage(),
-			 					    L10n.getString(&quot;Delete.Message.UnknownExceptionTitle&quot;), JOptionPane.WARNING_MESSAGE);							
-		   						logger.error(e);
-		   					}
-	
-		   					public void afterStopping() {
+                   new DefaultProgressBar(task, view, true) {
+                	        @Override
+			   				public void afterStopping() {
 		   						//load data
-		   	                   model.searchWholeHistoryData();        	
-		   	                   model.processResult(1,model.getDisplayRows());
-		   	                   view.tableHistoryList.setModel(new WholeHistoryTableModel(model));
-		   	                   view.displayedValueLabel.setText(&quot;0-0&quot;);
-		   	                   view.displayedValueLabel.setText(&quot;0-0&quot;); 
-		   	                   view.totalResultValueLabel.setText(&quot;0&quot;);
+                	        	try {
+                	        		model.searchWholeHistoryData();
+                	        		reloadData(1,model.getDisplayRows());
+                	        		view.totalResultValueLabel.setText(&quot;0&quot;);
+                	        	} catch (RemoteException e) {
+									DefaultReconnectDialog.show(view, e);
+						    	} catch (DBLayerException e) {
+						    		view.showErrorMessage(e.getMessage());
+						    	}		   	               
 		   					}
-		   				};
-		   				progressBar.setTitle(L10n.getString(&quot;History.Undo.ProgressTitle&quot;));	                   	                   
+		   				};		   					                   	                   
 	                    task.start();	                                                         
            }
        }

Modified: trunk/src/net/sf/plantlore/client/history/WholeHistoryView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/WholeHistoryView.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/history/WholeHistoryView.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -43,14 +43,7 @@
         getRootPane().setDefaultButton(closeButton);            
         // Init Help
         PlantloreHelp.addKeyHelp(PlantloreHelp.HISTORY_MANAGER, this.getRootPane());
-        PlantloreHelp.addButtonHelp(PlantloreHelp.HISTORY_MANAGER, this.helpButton);        
-        this.tableHistoryList.setRowSelectionAllowed(true);
-        this.tableHistoryList.setSelectionMode(DefaultListSelectionModel.SINGLE_SELECTION);
-        this.tableHistoryList.setModel(new WholeHistoryTableModel(model));     
-        previousButton.setEnabled(false);
-        if (this.tableHistoryList.getRowCount() &lt;= model.getDisplayRows()) {
-        	nextButton.setEnabled(false);
-        }
+        PlantloreHelp.addButtonHelp(PlantloreHelp.HISTORY_MANAGER, this.helpButton);                
     }
     
      /**
@@ -65,6 +58,34 @@
         } 
     }
     
+    /**
+     * Initialize actual data for displaying in view dialog.     
+     */
+    public void initialize() {
+    	model.setDisplayRows(History.DEFAULT_DISPLAY_ROWS);
+        model.setCurrentFirstRow(1);
+    	this.tableHistoryList.setRowSelectionAllowed(true);
+        this.tableHistoryList.setSelectionMode(DefaultListSelectionModel.SINGLE_SELECTION);
+        this.tableHistoryList.setModel(new WholeHistoryTableModel(model));     
+        previousButton.setEnabled(false);
+        nextButton.setEnabled(true);
+        if ((History.DEFAULT_DISPLAY_ROWS &gt;= model.getResultRows())) {
+        	nextButton.setEnabled(false);
+        }
+        totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());
+        toDisplayValueTextField.setText(((Integer)model.getDisplayRows()).toString());
+        displayedValueLabel.setText(model.getCurrentDisplayRows());
+    }
+    
+    /**
+     *  Shows and inicialize actual data or hides this dialog depending on the value of parameter visible. 
+     *  @param visible if true, shows this component and initialize actual data; otherwise, hides this component
+     */
+    public void setVisible(boolean visible) {
+    	if (visible) initialize();
+    	super.setVisible(visible);
+    }
+    
     /** This method is called from within the constructor to
      * initialize the form.
      * WARNING: Do NOT modify this code. The content of this method is
@@ -279,6 +300,16 @@
         return countRows;
     }
     
+    /** 
+     * Set number of rows in results
+     * @param resultRows number of rows in results
+     */
+    public void setCountResult(Integer resultRows)
+    {
+    	if (resultRows != null)
+    		this.totalResultValueLabel.setText(resultRows.toString());
+    }    
+    
     /**
      * Set numger of rows to displaying on one page
      * @param value numger of rows to displaying on one page

Modified: trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataCtrl.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataCtrl.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -11,11 +11,12 @@
 
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
-import java.awt.event.KeyEvent;
-import java.awt.event.KeyListener;
 import java.util.Date;
 
-import net.sf.plantlore.client.history.WholeHistoryCtrl.escapeKeyPressed;
+import net.sf.plantlore.client.history.History;
+import net.sf.plantlore.common.DefaultCancelAction;
+import net.sf.plantlore.common.DefaultEscapeKeyPressed;
+import net.sf.plantlore.common.DefaultReconnectDialog;
 import net.sf.plantlore.common.record.Metadata;
 import org.apache.log4j.Logger;
 
@@ -44,57 +45,32 @@
         logger = Logger.getLogger(this.getClass().getPackage().getName());        
         this.model = model;
         this.view = view;
+        DefaultEscapeKeyPressed escapeKeyPressed = new DefaultEscapeKeyPressed(view);
         
-        // Add action listener
-        view.closeButton.addActionListener(new closeButtonListener());
+        // Add action listene
+        view.closeButton.setAction(new DefaultCancelAction(view)); 
         view.operationButton.addActionListener(new operationButtonListener());
         // Add key listener
-        view.closeButton.addKeyListener(new escapeKeyPressed());
-        view.operationButton.addKeyListener(new escapeKeyPressed());
-        view.technicalContactNameText.addKeyListener(new escapeKeyPressed());
-        view.technicalContactEmailText.addKeyListener(new escapeKeyPressed());
-        view.technicalContactAddressText.addKeyListener(new escapeKeyPressed());
-        view.contentContactNameText.addKeyListener(new escapeKeyPressed());
-        view.contentContactEmailText.addKeyListener(new escapeKeyPressed());
-        view.contectContactAddressText.addKeyListener(new escapeKeyPressed());
-        view.dataSetTitleText.addKeyListener(new escapeKeyPressed());
-        view.dataSetDetailsText.addKeyListener(new escapeKeyPressed());
-        view.sourceInstirutionIdText.addKeyListener(new escapeKeyPressed());
-        view.sourceIdText.addKeyListener(new escapeKeyPressed());
-        view.abbrevText.addKeyListener(new escapeKeyPressed());
-        view.recordbasisText.addKeyListener(new escapeKeyPressed());
-        view.biotopetextText.addKeyListener(new escapeKeyPressed());
-        view.createDateChooser.addKeyListener(new escapeKeyPressed());
-        view.helpButton.addKeyListener(new escapeKeyPressed());
+        view.closeButton.addKeyListener(escapeKeyPressed);
+        view.operationButton.addKeyListener(escapeKeyPressed);
+        view.technicalContactNameText.addKeyListener(escapeKeyPressed);
+        view.technicalContactEmailText.addKeyListener(escapeKeyPressed);
+        view.technicalContactAddressText.addKeyListener(escapeKeyPressed);
+        view.contentContactNameText.addKeyListener(escapeKeyPressed);
+        view.contentContactEmailText.addKeyListener(escapeKeyPressed);
+        view.contectContactAddressText.addKeyListener(escapeKeyPressed);
+        view.dataSetTitleText.addKeyListener(escapeKeyPressed);
+        view.dataSetDetailsText.addKeyListener(escapeKeyPressed);
+        view.sourceInstirutionIdText.addKeyListener(escapeKeyPressed);
+        view.sourceIdText.addKeyListener(escapeKeyPressed);
+        view.abbrevText.addKeyListener(escapeKeyPressed);
+        view.recordbasisText.addKeyListener(escapeKeyPressed);
+        view.biotopetextText.addKeyListener(escapeKeyPressed);
+        view.createDateChooser.addKeyListener(escapeKeyPressed);
+        view.helpButton.addKeyListener(escapeKeyPressed);
       }
-    
-    /**     
-     * KeyListener class controlling the pressing key ESCAPE.
-     * On key ESCAPE hides the view.     
-     */
-    public class escapeKeyPressed implements KeyListener {
-    	 	 public void keyPressed(KeyEvent evt){
-    	 		if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) {
-    	 			view.close();
-    	 		}    	 		     	 		 
-    	 	 }
-    	      public void keyReleased(KeyEvent evt) {}    	     
-    	      public void keyTyped(KeyEvent evt) {}    	         
-    }
-    
+   
    /**
-    * ActionListener class controlling the &lt;b&gt;CLOSE&lt;/b&gt; button on the form.
-    * On Close hides the view.
-    */
-   class closeButtonListener implements ActionListener {
-       public void actionPerformed(ActionEvent actionEvent)
-       {
-    	   model.setUsedClose(true);
-    	   view.close();
-       }
-   }
-     
-   /**
     * ActionListener class controlling the &lt;b&gt;ADD&lt;/b&gt;, &lt;b&gt;EDIT&lt;/b&gt; and &lt;b&gt;OK&lt;/b&gt; buttons on the form.   
     */
    class operationButtonListener implements ActionListener {
@@ -102,12 +78,23 @@
        {    	  
     	   // Get information about operation - ADD, EDIT, DETAILS
            logger.debug(&quot;Operation &quot; + model.getOperation() + &quot;was called&quot;);
+           model.setUsedClose(false);
            if (model.getOperation().equals(&quot;ADD&quot;)) {
                logger.debug(&quot;Add of Metadata.&quot;);
                //check wether all obligatory fields were filled 
                 if (view.checkNotNull()) {
                         //Check if new name of project (dataSetTitle) already exist
-                	if (!model.uniqueDatasetTitle(view.dataSetTitleText.getText())){                		
+                	if (!model.uniqueDatasetTitle(view.dataSetTitleText.getText())){       
+                		if (model.isError()) {
+                			if (model.getError().equals(History.ERROR_REMOTE_EXCEPTION)) {
+                		 		   DefaultReconnectDialog.show(view, model.getRemoteEx());
+                		 	   } else {
+                		 		   view.showErrorMessage(model.getError());
+                		 	   }
+                			   //TODO nastavit zde null
+                		 	   model.setError(null); 
+                		 	   return;
+                		}
                 		view.showErrorMessage(MetadataManager.ERROR_TITLE, MetadataManager.ERROR_DATASETTITLE);
                 		return;
                 	}
@@ -151,6 +138,7 @@
                     model.getMetadataRecord().setOwnerOrganizationAbbrev(view.abbrevText.getText());
                     model.getMetadataRecord().setRecordBasis(view.recordbasisText.getText());
                     model.getMetadataRecord().setBiotopeText(view.biotopetextText.getText());
+                    model.getMetadataRecord().setDateModified(new Date());
                     model.getMetadataRecord().setDeleted(0);                 
                     view.close(); 
                 }

Modified: trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/metadata/AddEditMetadataView.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -161,6 +161,14 @@
         JOptionPane.showMessageDialog(this, message, title, JOptionPane.ERROR_MESSAGE);               
     }
     
+    /**
+     *  Display generic error message.     
+     *  @param message error message we want to display
+     */
+    public void showErrorMessage(String message) {
+        JOptionPane.showMessageDialog(this, message, L10n.getString(&quot;Common.ErrorMessageTitle&quot;), JOptionPane.ERROR_MESSAGE);               
+    }
+    
     /** This method is called from within the constructor to
      * initialize the form.
      * WARNING: Do NOT modify this code. The content of this method is

Modified: trunk/src/net/sf/plantlore/client/metadata/MetadataManager.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/MetadataManager.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/metadata/MetadataManager.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -16,7 +16,6 @@
 import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.record.Metadata;
 import net.sf.plantlore.common.record.Occurrence;
-import net.sf.plantlore.common.record.User;
 import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.middleware.SelectQuery;
@@ -38,8 +37,10 @@
     private DBLayer database;   
     /** Exception with details about an error */
     private String error = null;
+    /** Remote exception (network communication failed)*/
+    private RemoteException remoteEx;
     /** Constant with default number of rows to display */
-    public static final int DEFAULT_DISPLAY_ROWS = 6;    
+    public static final int DEFAULT_DISPLAY_ROWS = 14;    
     /** Actual number of rows to display */
     private int displayRows = DEFAULT_DISPLAY_ROWS;   
     /** Index of the first record shown in the table */
@@ -55,7 +56,7 @@
     /** Type of operation - ADD, EDIT, DELETE, DETAIL*/
     private String operation = &quot;&quot;;
     /** Containing information about closing the addEdit dialog*/
-    private boolean usedClose = false;
+    private boolean usedClose = true;
     /** Record for add, update or delete*/
     private Metadata metadataRecord;
     /** Identifier of record for add, update or delete*/
@@ -88,7 +89,8 @@
     public static final String ERROR_UNKNOWEN = L10n.getString(&quot;Error.UnknownException&quot;);
     public static final String ERROR_TITLE = L10n.getString(&quot;Error.MetadataMessageTitle&quot;);
     public static final String ERROR_CHECK_DELETE = L10n.getString(&quot;Error.MetadataCheckDelete&quot;);
-    public static final String ERROR_DATASETTITLE = L10n.getString(&quot;Error.MetadataUniqueDatasetTitle&quot;);    
+    public static final String ERROR_DATASETTITLE = L10n.getString(&quot;Error.MetadataUniqueDatasetTitle&quot;); 
+    public static final String ERROR_REMOTE_EXCEPTION = &quot;REMOTE_EXCEPTION&quot;;
     
     public static final String QUESTION_DELETE_TITLE = L10n.getString(&quot;Question.DeleteMetadataTitle&quot;);
     public static final String QUESTION_DELETE = L10n.getString(&quot;Question.DeleteMetadata&quot;);
@@ -132,17 +134,17 @@
 	    			try {
 	  		    	    resultIdent = search();
 	  		    	    setResultId(resultIdent);
-		    	   } catch (RemoteException e) {	            
+		    	   }catch (RemoteException e) {	            
 			            logger.error(&quot;Searching metada failed. Remote exception caught in Metadata. Details: &quot;+e.getMessage());			        	
-		                RemoteException remex = new RemoteException(ERROR_SEARCH + e);
+		                RemoteException remex = new RemoteException(ERROR_SEARCH + e.getMessage());
 		                remex.setStackTrace(e.getStackTrace());
 		                throw remex; 		           
 			        } catch (DBLayerException e) {
 			        	logger.error(&quot;Searching metada failed. DBLayer exception caught in Metadata. Details: &quot;+e.getMessage());       	                                                   			        
-		                DBLayerException dbex = new DBLayerException(ERROR_SEARCH + e);
+		                DBLayerException dbex = new DBLayerException(ERROR_SEARCH + e.getMessage());
 		                dbex.setStackTrace(e.getStackTrace());
 		                throw dbex; 		           
-			        }					       
+			        }			
                     return null;			        
 				}
 		    };
@@ -153,14 +155,11 @@
     			setResultId(resultIdent);
 			} catch (DBLayerException e) {
 				logger.error(&quot;Searching metada failed. Remote exception caught in Metadata. Details: &quot;+e.getMessage());
-				setError(ERROR_SEARCH);
-				setChanged();
-                notifyObservers();                
+				setError(ERROR_SEARCH);				               
 			} catch (RemoteException e) {
-				logger.error(&quot;Searching metada failed. DBLayer exception caught in Metadata. Details: &quot;+e.getMessage());
-				setError(ERROR_SEARCH);
-				setChanged();
-                notifyObservers();                
+				logger.error(&quot;Searching metada failed. DBLayer exception caught in Metadata. Details: &quot;+e.getMessage());				
+				 setError(ERROR_REMOTE_EXCEPTION);	
+				 setRemoteEx(e);
 			}
 			return null;
     	}
@@ -241,7 +240,7 @@
      * @param from number of the first row to show in table. 
      * @param count number of rows to retrieve 
      */
-    public void processResult(int from, int count) {
+    public void processResult(int from, int count) throws RemoteException, DBLayerException{
         
     	if (this.resultId != 0) {    		
             int currentRow = getResultRows();
@@ -262,24 +261,20 @@
              	try {
              		objectMetadata = database.more(this.resultId, 0, to-1);  
              	} catch(RemoteException e) {
-             		logger.error(&quot;Remote exception caught in MetadataManager (processResult). Details: &quot;+e.getMessage());
-        			setError(ERROR_PROCESS);
-        			setChanged();
-                    notifyObservers();
-                 	return;                                                                                       
+             		logger.error(&quot;Remote exception caught in MetadataManager (processResult). Details: &quot;+e.getMessage());        			
+        			RemoteException remex = new RemoteException(e.getMessage());
+                    remex.setStackTrace(e.getStackTrace());
+                    throw remex; 		                                    	                                                                                      
                 } catch (DBLayerException e) {                  
                     logger.error(&quot;Processing search results failed: &quot; + e.getMessage());   
-                    setError(ERROR_PROCESS);
-                    setChanged();
-                    notifyObservers();
-                    return;
+                    DBLayerException dbex = new DBLayerException(ERROR_PROCESS + e.getMessage());
+                    dbex.setStackTrace(e.getStackTrace());
+                    throw dbex; 
                 }  
                 if (objectMetadata == null) {
                 	logger.error(&quot;tMetadata doesn`t contain required data&quot;);
-                	setError(ERROR_PROCESS);
-                    setChanged();
-                    notifyObservers();
-                    return;
+                	DBLayerException dbex = new DBLayerException(ERROR_PROCESS + &quot;tMetadata doesn`t contain required data&quot;);                   
+                    throw dbex; 
                 }
                 int countResult = objectMetadata.length;  
                 logger.debug(&quot;Results retrieved. Count: &quot;+ countResult);                
@@ -322,7 +317,8 @@
             database.closeQuery(sq);
         } catch (RemoteException e) {
             logger.error(&quot;Remote exception caught in Metadata. Details: &quot;+e.getMessage());
-            setError(ERROR_DELETE);
+            setError(ERROR_REMOTE_EXCEPTION);  
+            setRemoteEx(e);
             return false;
         } catch (DBLayerException e) {
             logger.error(&quot;Loading metadata failed. Cannot determine whether metadata can be deleted&quot;);
@@ -355,10 +351,13 @@
             database.closeQuery(sq);
     	} catch (RemoteException e) {
             logger.error(&quot;Remote exception caught in Metadata. Details: &quot;+e.getMessage());
-            setError(ERROR_DATASETTITLE);
+            setError(ERROR_REMOTE_EXCEPTION);
+            setRemoteEx(e);
+            return false;
         } catch (DBLayerException e) {
             logger.error(&quot;Check unique datasetTitle failed. Cannot determine whether some name of project equals new datasetTitle.&quot;);
             setError(ERROR_DATASETTITLE);
+            return false;
         }        
     	return true;
     }
@@ -378,13 +377,13 @@
 		        }catch (RemoteException e) {
 		        	logger.error(&quot;Process add metadata failed. Remote exception caught in MetadataManager. Details: &quot;+e.getMessage());
 		        	database.rollbackTransaction();
-                    RemoteException remex = new RemoteException(ERROR_ADD + e);
+                    RemoteException remex = new RemoteException(ERROR_ADD + e.getMessage());
                     remex.setStackTrace(e.getStackTrace());
                     throw remex; 		           		       	    
 		        } catch (DBLayerException e) {
 		        	logger.error(&quot;Process add metadata failed. DBLayer exception caught in MetadataManager. Details: &quot;+e.getMessage());       	                                                   
 		        	database.rollbackTransaction();
-                    DBLayerException dbex = new DBLayerException(ERROR_ADD + e);
+                    DBLayerException dbex = new DBLayerException(ERROR_ADD + e.getMessage());
                     dbex.setStackTrace(e.getStackTrace());
                     throw dbex; 		            
 		        } 		       
@@ -413,13 +412,13 @@
 		        }catch (RemoteException e) {
 		        	logger.error(&quot;Process update metadata failed. Remote exception caught in MetadataManager. Details: &quot;+e.getMessage());
 		        	database.rollbackTransaction();
-                    RemoteException remex = new RemoteException(ERROR_EDIT + e);
+                    RemoteException remex = new RemoteException(ERROR_EDIT + e.getMessage());
                     remex.setStackTrace(e.getStackTrace());
                     throw remex; 		           		       	    
 		        } catch (DBLayerException e) {
 		        	logger.error(&quot;Process update metadata failed. DBLayer exception caught in MetadataManager. Details: &quot;+e.getMessage());       	                                                   
 		        	database.rollbackTransaction();
-                    DBLayerException dbex = new DBLayerException(ERROR_EDIT + e);
+                    DBLayerException dbex = new DBLayerException(ERROR_EDIT + e.getMessage());
                     dbex.setStackTrace(e.getStackTrace());
                     throw dbex; 		            
 		        } 		        
@@ -444,17 +443,17 @@
     		public Object task() throws DBLayerException, RemoteException {
     			try {
 		        	metadataRecord.setDeleted(1);
-		                database.executeUpdate(metadataRecord);		            
+		            database.executeUpdate(metadataRecord);		            
 		        }catch (RemoteException e) {
 		        	logger.error(&quot;Process delete metadata failed. Remote exception caught in MetadataManager. Details: &quot;+e.getMessage());
 		        	database.rollbackTransaction();
-                    RemoteException remex = new RemoteException(ERROR_DELETE + e);
+                    RemoteException remex = new RemoteException(ERROR_DELETE + e.getMessage());
                     remex.setStackTrace(e.getStackTrace());
                     throw remex; 		           		       	    
 		        } catch (DBLayerException e) {
 		        	logger.error(&quot;Process delete metadata failed. DBLayer exception caught in MetadataManager. Details: &quot;+e.getMessage());       	                                                   
 		        	database.rollbackTransaction();
-                    DBLayerException dbex = new DBLayerException(ERROR_DELETE + e);
+                    DBLayerException dbex = new DBLayerException(ERROR_DELETE + e.getMessage());
                     dbex.setStackTrace(e.getStackTrace());
                     throw dbex; 		            
 		        } 			        
@@ -500,6 +499,22 @@
     }    
     
     /**
+     *  Set an remote exception (network communication failed)
+     *  @param ex  RemoteException (network communication failed)
+     */
+    public void setRemoteEx(RemoteException ex) {
+        this.remoteEx = ex;
+    }
+    
+    /**
+     *  Get remote exception (network communication failed)
+     *  @return remote exception (network communication failed)
+     */
+    public RemoteException getRemoteEx() {
+        return this.remoteEx;
+    }  
+    
+    /**
      * Set true if addEdit dialog was closed by CLOSE button
      * @param usedClose containing information about closing the addEdit dialog
      */
@@ -545,7 +560,7 @@
         if (resultId != 0) try {
                 resultCount = database.getNumRows(resultId);        	
         } catch(RemoteException e) {
-        	logger.error(&quot;Get number of results failed.Remote exception caught in History. Details: &quot;+e.getMessage());  
+        	logger.error(&quot;Get number of results failed.Remote exception caught in MetadataManager. Details: &quot;+e.getMessage());  
         	setError(ERROR_NUMBER_ROWS);
         }
         return resultCount;

Modified: trunk/src/net/sf/plantlore/client/metadata/MetadataManagerCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/MetadataManagerCtrl.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/metadata/MetadataManagerCtrl.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -13,14 +13,17 @@
 import java.awt.event.ActionListener;
 import java.awt.event.FocusEvent;
 import java.awt.event.FocusListener;
-import java.awt.event.KeyEvent;
-import java.awt.event.KeyListener;
 import java.rmi.RemoteException;
 
-import net.sf.plantlore.client.history.WholeHistoryCtrl.escapeKeyPressed;
-import net.sf.plantlore.common.ProgressBar;
+import net.sf.plantlore.client.history.History;
+import net.sf.plantlore.client.history.HistoryTableModel;
+import net.sf.plantlore.common.DefaultCancelAction;
+import net.sf.plantlore.common.DefaultEscapeKeyPressed;
+import net.sf.plantlore.common.DefaultProgressBar;
+import net.sf.plantlore.common.DefaultReconnectDialog;
 import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.exception.DBLayerException;
+
 import org.apache.log4j.Logger;
 
 /**
@@ -47,8 +50,9 @@
         logger = Logger.getLogger(this.getClass().getPackage().getName());        
         this.model = modelPar;
         this.view = viewPar;
-          
-        view.closeButton.addActionListener(new closeButtonListener());
+        DefaultEscapeKeyPressed escapeKeyPressed = new DefaultEscapeKeyPressed(view);
+        
+        view.closeButton.setAction(new DefaultCancelAction(view)); 
         view.previousButton.addActionListener(new previousButtonListener());
         view.nextButton.addActionListener(new nextButtonListener());            
         view.toDisplayValueTextField.addActionListener(new rowSetDisplayChangeListener());    
@@ -62,87 +66,74 @@
         view.sortField.addFocusListener(new SortComboFocusListener());
         
         // Add key listeners
-        view.closeButton.addKeyListener(new escapeKeyPressed());
-        view.previousButton.addKeyListener(new escapeKeyPressed());
-        view.nextButton.addKeyListener(new escapeKeyPressed());
-        view.addButtons.addKeyListener(new escapeKeyPressed());
-        view.toDisplayValueTextField.addKeyListener(new escapeKeyPressed());
-        view.helpButton.addKeyListener(new escapeKeyPressed());
-        view.editButtons.addKeyListener(new escapeKeyPressed());
-        view.deleteButton.addKeyListener(new escapeKeyPressed());
-        view.detailsButton.addKeyListener(new escapeKeyPressed());
-        view.searchButton.addKeyListener(new escapeKeyPressed());
-        view.sortField.addKeyListener(new escapeKeyPressed());
-        view.tableMetadataList.addKeyListener(new escapeKeyPressed());
-        view.sortAscendingRadioButton.addKeyListener(new escapeKeyPressed());
-        view.sortDescendingRadioButton.addKeyListener(new escapeKeyPressed());
-        view.sourceInstitutionIdText.addKeyListener(new escapeKeyPressed());           
-        view.sourceIdText.addKeyListener(new escapeKeyPressed());
-        view.dataSetTitleText.addKeyListener(new escapeKeyPressed());
-        view.addKeyListener(new escapeKeyPressed());        
+        view.closeButton.addKeyListener(escapeKeyPressed);
+        view.previousButton.addKeyListener(escapeKeyPressed);
+        view.nextButton.addKeyListener(escapeKeyPressed);
+        view.addButtons.addKeyListener(escapeKeyPressed);
+        view.toDisplayValueTextField.addKeyListener(escapeKeyPressed);
+        view.helpButton.addKeyListener(escapeKeyPressed);
+        view.editButtons.addKeyListener(escapeKeyPressed);
+        view.deleteButton.addKeyListener(escapeKeyPressed);
+        view.detailsButton.addKeyListener(escapeKeyPressed);
+        view.searchButton.addKeyListener(escapeKeyPressed);
+        view.sortField.addKeyListener(escapeKeyPressed);
+        view.tableMetadataList.addKeyListener(escapeKeyPressed);
+        view.sortAscendingRadioButton.addKeyListener(escapeKeyPressed);
+        view.sortDescendingRadioButton.addKeyListener(escapeKeyPressed);
+        view.sourceInstitutionIdText.addKeyListener(escapeKeyPressed);           
+        view.sourceIdText.addKeyListener(escapeKeyPressed);
+        view.dataSetTitleText.addKeyListener(escapeKeyPressed);
+        view.addKeyListener(escapeKeyPressed);        
         
         //Search metadata
         Task task = model.searchMetadata(true);
         
-        ProgressBar progressBar = new ProgressBar(task, view, true) {		   							 			
-			private static final long serialVersionUID = -3944058265290571972L;
-			public void exceptionHandler(Exception e) {
-				if (e instanceof DBLayerException) {	   									   							
-   					DBLayerException dbex = (DBLayerException) e;	
-   					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE,MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
-   					getTask().stop();
-   					return;
-   				}
-   				if (e instanceof RemoteException) {	 
-   					RemoteException remex = (RemoteException) e;		
-   					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE, MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
-   					getTask().stop();
-   					return;
-   				}
-   				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
-   				logger.error(e);
-   			}
-
-			public void afterStopping() {
-				//Process result
-		        model.processResult(1, model.getDisplayRows());
-		        //Update view dialog
-		        view.tableMetadataList.setModel(new MetadataManagerTableModel(model));
-		        int from = model.getCurrentFirstRow();
-                int to = from + view.tableMetadataList.getRowCount() - 1;
-                view.displayedValueLabel.setText(from + &quot;-&quot; + to);
-                view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());
+        new DefaultProgressBar(task, view, true) {		   							 						
+        	@Override
+        	public void afterStopping() {
+				//Process result and Update view dialog
+		        reloadData(1, model.getDisplayRows());		        		        
            } 		   					
-		};
-		progressBar.setTitle(MetadataManager.PROGRESS_SEARCH);	                   	                   
+		};			                   	                   
         task.start();                                       
-    }
+    }   
     
-    /**     
-     * KeyListener class controlling the pressing key ESCAPE.
-     * On key ESCAPE hides the view.     
+    /**
+     * Reload new data for displaying in view dialog.
+     * @param fromRow number of the first row to show in table
+     * @param countRow number of rows to retrieve 
      */
-    public class escapeKeyPressed implements KeyListener {
-    	 	 public void keyPressed(KeyEvent evt){
-    	 		if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) {
-    	 			logger.debug(&quot;ESCAPE: &quot; + view.getFocusOwner());
-    	 			view.close();
-    	 		}    	 		     	 		 
-    	 	 }
-    	      public void keyReleased(KeyEvent evt) {}    	     
-    	      public void keyTyped(KeyEvent evt) {}    	         
+    public void reloadData(int fromRow, int countRow) {
+    	try {
+    		model.processResult(fromRow, countRow);     
+    		view.tableMetadataList.setModel(new MetadataManagerTableModel(model));
+	        int from = model.getCurrentFirstRow();
+            int to = from + view.tableMetadataList.getRowCount() - 1;
+            if (to &lt;= 0 ) {
+            	view.displayedValueLabel.setText(&quot;0-0&quot;);
+            } else {
+            	view.displayedValueLabel.setText(from + &quot;-&quot; + to);
+            }
+            view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());    		
+    	} catch (RemoteException e) {
+    		DefaultReconnectDialog.show(view, e);
+    	} catch (DBLayerException e) {
+    		view.showErrorMessage(e.getMessage());
+    	}    	           
     }
     
     /**
-    * ActionListener class controlling the &lt;b&gt;CLOSE&lt;/b&gt; button on the form.
-    * On Close hides the view.
-    */
-   class closeButtonListener implements ActionListener {
-       public void actionPerformed(ActionEvent actionEvent)
-       {
-    	   view.close();
-       }
-   }
+     * Display error message.
+     */
+    public void displayError() {
+    	if (model.getError().equals(History.ERROR_REMOTE_EXCEPTION)) {
+ 		   DefaultReconnectDialog.show(view, model.getRemoteEx());
+ 	   } else {
+ 		   view.showErrorMessage(model.getError());
+ 	   }
+    	//TODO nastavit ci nenastvit null
+ 	   model.setError(null); 
+    }
      
    /**
     *  ActionListener class controlling the &lt;b&gt;PREV&lt;/b&gt; button on the form.
@@ -159,14 +150,7 @@
            // Get previous page of results
            if (model.getCurrentFirstRow() &gt; 1) {
                int firstRow = Math.max(model.getCurrentFirstRow()- model.getDisplayRows(), 1);
-               model.processResult(firstRow, model.getDisplayRows()); 
-               if (model.isError()) return;
-               if (model.getCurrentFirstRow() &gt; 1){
-               }
-               view.tableMetadataList.setModel(new MetadataManagerTableModel(model));
-               int from = model.getCurrentFirstRow();
-               int to = from + view.tableMetadataList.getRowCount() - 1;
-               view.displayedValueLabel.setText(from + &quot;-&quot; + to);
+               reloadData(firstRow, model.getDisplayRows());                
            }      
            //Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -198,16 +182,7 @@
            }
            // Get next page of result
            if (model.getCurrentFirstRow()+ view.tableMetadataList.getRowCount()&lt;=model.getResultRows()) {
-               model.processResult(model.getCurrentFirstRow()+ model.getDisplayRows(), view.tableMetadataList.getRowCount());
-               if (model.isError()) return;
-               view.tableMetadataList.setModel(new MetadataManagerTableModel(model));             
-               int from = model.getCurrentFirstRow();
-               int to = from + view.tableMetadataList.getRowCount() - 1;
-               if (to &lt;= 0){
-            	   view.displayedValueLabel.setText(&quot;0-0&quot;);
-               }else {
-            	   view.displayedValueLabel.setText(from + &quot;-&quot; + to);
-               }               
+               reloadData(model.getCurrentFirstRow()+ model.getDisplayRows(), view.tableMetadataList.getRowCount());                    
            }  
            //Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -246,12 +221,7 @@
            logger.debug(&quot;New display rows: &quot;+view.getDisplayRows());
            // If neccessary reload search results
            if (oldValue != view.getDisplayRows()) {
-               model.processResult(model.getCurrentFirstRow(), view.getDisplayRows());
-               if (model.isError()) return;
-               view.tableMetadataList.setModel(new MetadataManagerTableModel(model));
-               int from = model.getCurrentFirstRow();
-               int to = from + view.tableMetadataList.getRowCount() - 1;
-               view.displayedValueLabel.setText(from + &quot;-&quot; + to);               
+               reloadData(model.getCurrentFirstRow(), view.getDisplayRows());                         
            }
            // Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -291,35 +261,18 @@
            //save new record Metadata into database
            Task task = model.addMetedataRecord();
            
-           ProgressBar progressBar = new ProgressBar(task, view, true) {		   							 
-   			public void exceptionHandler(Exception e) {
-   				if (e instanceof DBLayerException) {	   									   							
-   					DBLayerException dbex = (DBLayerException) e;	
-   					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE,MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
-   					getTask().stop();
-   					return;
-   				}
-   				if (e instanceof RemoteException) {	 
-   					RemoteException remex = (RemoteException) e;		
-   					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE,MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
-   					getTask().stop();
-   					return;
-   				}
-   				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
-   				logger.error(e);
-   			}
-   			
+           new DefaultProgressBar(task, view, true) {		   							 
+   			@Override
    			public void afterStopping() {
     			   //load metadata
-    	           model.searchMetadata(false);           
-    	           model.processResult(1, model.getDisplayRows());
-    	           if (model.isError()) return;
-    	           view.tableMetadataList.setModel(new MetadataManagerTableModel(model));                      
-    	           view.displayedValueLabel.setText(1 + &quot;-&quot; + view.tableMetadataList.getRowCount());
-    	           view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());    	           
+    	           model.searchMetadata(false);
+    	           if (model.isError()) {
+    	        	   displayError();
+    	        	   return;
+    	           }    	           
+    	           reloadData(1, model.getDisplayRows());    	                   
                } 		   		
-   		};
-   		progressBar.setTitle(MetadataManager.PROGRESS_ADD);	                   	                   
+   		};   		               	                   
         task.start();                                       
        }
     }
@@ -330,7 +283,7 @@
     class editMetadataListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
        {
-    	   //  whether an error flag is set
+    	   //  Check whether an error flag is set
     	   if (model.isError()) {
         	   view.showErrorMessage(MetadataManager.ERROR_TITLE, model.getError());
         	   return;
@@ -356,31 +309,14 @@
                //Update metadata               
                Task task = model.editMetadataRecord();
                
-               ProgressBar progressBar = new ProgressBar(task, view, true) {		   							 
-          			public void exceptionHandler(Exception e) {
-          				if (e instanceof DBLayerException) {	   									   							
-           					DBLayerException dbex = (DBLayerException) e;	
-           					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE,MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
-           					getTask().stop();
-           					return;
-           				}
-           				if (e instanceof RemoteException) {	 
-           					RemoteException remex = (RemoteException) e;		
-           					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE,MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
-           					getTask().stop();
-           					return;
-           				}
-           				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
-           				logger.error(e);
-           			}
-
+               new DefaultProgressBar(task, view, true) {
+            	   @Override
           			public void afterStopping() {
           			   //load metadata          				
                         if (model.isError()) return;
                         view.tableMetadataList.setModel(new MetadataManagerTableModel(model));                         
                      } 		   					
-          		};
-          		progressBar.setTitle(MetadataManager.PROGRESS_EDIT);	                   	                   
+          		};          		                 	                   
                 task.start();                                       
               }
        }
@@ -436,8 +372,12 @@
                //Set information about selected row
                int resultNumber = view.tableMetadataList.getSelectedRow() + model.getCurrentFirstRow()-1; 
                model.setMetadataRecord(resultNumber);
-               //Test if record can be deleted
+               //Test if record can be deleted               
                if (!model.checkDelete(resultNumber)) {
+            	   if (model.isError()) {
+	            	   displayError();
+	            	   return;
+            	   }
                    view.showErrorMessage(MetadataManager.ERROR_TITLE, MetadataManager.ERROR_CHECK_DELETE);
                } else {
             	   int okCancle = view.showQuestionMessage(MetadataManager.QUESTION_DELETE_TITLE, MetadataManager.QUESTION_DELETE);               
@@ -447,36 +387,18 @@
 		               //delete selected record
 		               Task task = model.deleteMetadataRecord();
 		               
-		               ProgressBar progressBar = new ProgressBar(task, view, true) {		   								  		   				
-						private static final long serialVersionUID = -6156468821508998437L;
-						public void exceptionHandler(Exception e) {
-							if (e instanceof DBLayerException) {	   									   							
-			   					DBLayerException dbex = (DBLayerException) e;	
-			   					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE,MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
-			   					getTask().stop();
-			   					return;
-			   				}
-			   				if (e instanceof RemoteException) {	 
-			   					RemoteException remex = (RemoteException) e;		
-			   					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE,MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
-			   					getTask().stop();
-			   					return;
-			   				}
-			   				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
-			   				logger.error(e);
-			   			}
-		
-                                    public void afterStopping() {
-                                       // load metadata
-		   	               model.searchMetadata(false);               
-		   	               model.processResult(1, model.getDisplayRows());
-		   	               if (model.isError()) return;
-		   	               view.tableMetadataList.setModel(new MetadataManagerTableModel(model));                      
-		   	               view.displayedValueLabel.setText(1 + &quot;-&quot; + view.tableMetadataList.getRowCount());
-		   	               view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());		   	               
+		             new DefaultProgressBar(task, view, true) {		   								  		   				
+						@Override						
+                        public void afterStopping() {
+                           // load metadata
+		   	               model.searchMetadata(false);  
+		   	               if (model.isError()) {
+		   	            	   displayError();
+		   	            	   return;
+		   	               }
+		   	               reloadData(1, model.getDisplayRows());		   	              		   	               
 		                } 		   					
-		   			};
-		   			progressBar.setTitle(MetadataManager.PROGRESS_DELETE);	                   	                   
+		   			};		   			                   	                   
 		            task.start();                                                                  
 		          }else {
 		        	  logger.debug(&quot;Button Cancle was press.&quot;);
@@ -487,7 +409,7 @@
    }       
     
    /**
-    * * ActionListener class controlling the &lt;b&gt;Search/Sort&lt;/b&gt; button on the form.    
+    *  ActionListener class controlling the &lt;b&gt;Search/Sort&lt;/b&gt; button on the form.    
     */
     class searchUserListener implements ActionListener {
        public void actionPerformed(ActionEvent actionEvent)
@@ -509,26 +431,9 @@
            //Load metadata with specific conditions
            Task task = model.searchMetadata(true);   
            
-           ProgressBar progressBar = new ProgressBar(task, view, true) {		   								  			
-			    private static final long serialVersionUID = -7147752276335991652L; 
-				public void exceptionHandler(Exception e) {
-					if (e instanceof DBLayerException) {	   									   							
-	   					DBLayerException dbex = (DBLayerException) e;	
-	   					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE, MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
-	   					getTask().stop();
-	   					return;
-	   				}
-	   				if (e instanceof RemoteException) {	 
-	   					RemoteException remex = (RemoteException) e;		
-	   					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE,MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
-	   					getTask().stop();
-	   					return;
-	   				}
-	   				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
-	   				logger.error(e);
-	   			}
-
-				public void afterStopping() {
+           new DefaultProgressBar(task, view, true) {		   								  			
+			   @Override 
+        	   public void afterStopping() {
 					if (model.getDisplayRows() &lt;= 0) {
 		               model.setDisplayRows(MetadataManager.DEFAULT_DISPLAY_ROWS);
 		           }
@@ -536,14 +441,9 @@
 		           if (model.getResultRows() &lt; 1) {
 		               view.showInfoMessage(MetadataManager.INFORMATION_RESULT_TITLE,MetadataManager.INFORMATION_RESULT);
 		           }
-		           model.processResult(1, model.getDisplayRows());
-		           if (model.isError()) return;		           
-		           view.tableMetadataList.setModel(new MetadataManagerTableModel(model)); 		           
-		           view.displayedValueLabel.setText(model.getCurrentDisplayRows());  
-		           view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString()); 		           
+		           reloadData(1, model.getDisplayRows());		           		           
                } 		   					
-			};
-			progressBar.setTitle(MetadataManager.PROGRESS_SEARCH);	                   	                   
+			};			                  	                   
             task.start();                                                                  
        }
     }

Modified: trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/metadata/MetadataManagerView.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -12,6 +12,8 @@
 import javax.swing.DefaultListSelectionModel;
 import javax.swing.JDialog;
 import javax.swing.JOptionPane;
+
+import net.sf.plantlore.client.history.History;
 import net.sf.plantlore.common.PlantloreHelp;
 import net.sf.plantlore.common.TransferFocus;
 import net.sf.plantlore.l10n.L10n;
@@ -40,18 +42,10 @@
         model.addObserver(this);
         setDefaultCloseOperation(JDialog.HIDE_ON_CLOSE);
         initComponents();
-        getRootPane().setDefaultButton(closeButton);
+        //getRootPane().setDefaultButton(closeButton);
         //Init Help
         PlantloreHelp.addKeyHelp(PlantloreHelp.METDATA_MANAGER, this.getRootPane());
-        PlantloreHelp.addButtonHelp(PlantloreHelp.METDATA_MANAGER, this.helpButton); 
-        
-        sortButtonGroup.add(sortAscendingRadioButton);
-        sortButtonGroup.add(sortDescendingRadioButton);
-        sortButtonGroup.setSelected(sortAscendingRadioButton.getModel(), true);
-        this.tableMetadataList.setRowSelectionAllowed(true);
-        this.tableMetadataList.setSelectionMode(DefaultListSelectionModel.SINGLE_SELECTION);
-        this.tableMetadataList.setModel(new MetadataManagerTableModel(model));  
-       
+        PlantloreHelp.addButtonHelp(PlantloreHelp.METDATA_MANAGER, this.helpButton);                  
     }
     
     /**
@@ -64,7 +58,38 @@
               showErrorMessage(L10n.getString(&quot;Common.ErrorMessageTitle&quot;), model.getError());                          
               return;
           } 
-    }      
+    }  
+      
+      /**
+       * Initialize actual data for displaying in view dialog.     
+       */
+      public void initialize() {   
+    	  model.setDisplayRows(MetadataManager.DEFAULT_DISPLAY_ROWS);
+          model.setCurrentFirstRow(1);
+    	  previousButton.setEnabled(false);
+    	  nextButton.setEnabled(true);
+          if (MetadataManager.DEFAULT_DISPLAY_ROWS &gt;= model.getResultRows()) {
+          	nextButton.setEnabled(false);
+          }
+          sortButtonGroup.add(sortAscendingRadioButton);
+          sortButtonGroup.add(sortDescendingRadioButton);
+          sortButtonGroup.setSelected(sortAscendingRadioButton.getModel(), true);
+          this.tableMetadataList.setRowSelectionAllowed(true);
+          this.tableMetadataList.setSelectionMode(DefaultListSelectionModel.SINGLE_SELECTION);
+          this.tableMetadataList.setModel(new MetadataManagerTableModel(model));
+          totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());
+          toDisplayValueTextField.setText(((Integer)model.getDisplayRows()).toString());
+          displayedValueLabel.setText(model.getCurrentDisplayRows());
+      }
+      
+      /**
+       *  Shows and inicialize actual data or hides this dialog depending on the value of parameter visible. 
+       *  @param visible if true, shows this component and initialize actual data; otherwise, hides this component
+       */
+      public void setVisible(boolean visible) {
+      	if (visible) initialize();
+      	super.setVisible(visible);
+      }
     
      /**
      *  Close this dialog.
@@ -136,6 +161,14 @@
         JOptionPane.showMessageDialog(this, message, title, JOptionPane.ERROR_MESSAGE);               
     }
     
+    /**
+     *  Display generic error message.     
+     *  @param message error message we want to display
+     */
+    public void showErrorMessage(String message) {
+        JOptionPane.showMessageDialog(this, message, L10n.getString(&quot;Common.ErrorMessageTitle&quot;), JOptionPane.ERROR_MESSAGE);               
+    }
+    
       /**
      * Display warning message.
      * @param title title of warning message

Modified: trunk/src/net/sf/plantlore/client/user/AddEditUserCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/user/AddEditUserCtrl.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/user/AddEditUserCtrl.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -16,47 +16,63 @@
 import java.util.ArrayList;
 import java.util.Date;
 import net.sf.plantlore.common.AutoTextArea;
+import net.sf.plantlore.common.DefaultCancelAction;
+import net.sf.plantlore.common.DefaultEscapeKeyPressed;
 import net.sf.plantlore.common.record.User;
 import net.sf.plantlore.common.record.Right;
 import org.apache.log4j.Logger;
 
 /**
+ * Controller for the Add/Edit user dialog in the UserManager MVC.
  *
  * @author Lada Oberreiterova
+ * @version 1.0
  */
 public class AddEditUserCtrl {
-        
+     
+	/** Instance of a logger */
     private Logger logger;
+    /** Model of UserManager MVC */
     private UserManager model;
+    /** View of UserManager MVC */
     private AddEditUserView view;
     
     /**
      * Creates a new instance of AddEditUserCtrl
+     * @param view View of AddEditUser
+     * @param model Model of UserManager MVC
      */
     public AddEditUserCtrl(AddEditUserView view, UserManager model) {
         
         logger = Logger.getLogger(this.getClass().getPackage().getName());        
         this.model = model;
         this.view = view;
+        DefaultEscapeKeyPressed escapeKeyPressed = new DefaultEscapeKeyPressed(view);
         
-        view.closeButton.addActionListener(new CloseButtonListener());
+        //Add action listene
+        view.closeButton.setAction(new DefaultCancelAction(view)); 
         view.operationButton.addActionListener(new OperationButtonListener());
         view.editGroupTextArea.addFocusListener(new UserAreaListener());
+        // Add key listener
+        view.helpButton.addKeyListener(escapeKeyPressed);
+        view.closeButton.addKeyListener(escapeKeyPressed);
+        view.operationButton.addKeyListener(escapeKeyPressed);
+        view.editGroupTextArea.addKeyListener(escapeKeyPressed);
+        view.loginText.addKeyListener(escapeKeyPressed);
+        view.passwordtext.addKeyListener(escapeKeyPressed);
+        view.firstNameText.addKeyListener(escapeKeyPressed);
+        view.surnameText.addKeyListener(escapeKeyPressed);
+        view.emailText.addKeyListener(escapeKeyPressed);
+        view.addressText.addKeyListener(escapeKeyPressed);
+        view.noteText.addKeyListener(escapeKeyPressed);
+        view.addRightCheckBox.addKeyListener(escapeKeyPressed);
+        view.administratorCheckBox.addKeyListener(escapeKeyPressed);
+        view.editAllCheckBox.addKeyListener(escapeKeyPressed);
+        view.editGroupTextArea.addKeyListener(escapeKeyPressed);
     }
     
+ 
    /**
-    * On Cancel just hides the view.
-    *
-    */
-   class CloseButtonListener implements ActionListener {
-       public void actionPerformed(ActionEvent actionEvent)
-       {
-    	   model.setUsedClose(true);
-    	   view.close();
-       }
-   }
-   
-   /**
     * ActionListener class controlling the &lt;b&gt;ADD&lt;/b&gt;, &lt;b&gt;EDIT&lt;/b&gt; and &lt;b&gt;OK&lt;/b&gt; buttons on the form.
     */
    class OperationButtonListener implements ActionListener {
@@ -64,6 +80,7 @@
        {    	
         	// Get information about operation - ADD, EDIT, DETAILS
             logger.debug(&quot;Operation &quot; + model.getOperation() + &quot;was called&quot;);
+            model.setUsedClose(false);
             if (model.getOperation().equals(&quot;ADD&quot;)) {
                 logger.debug(&quot;Add of User.&quot;);
                 //check wether all obligatory fields were filled 
@@ -152,6 +169,9 @@
         }
    }
    
+   /**    
+     *  Focus listener for the editGroupTextArea - adding user from user list.        
+    */
     class UserAreaListener implements FocusListener {
         public void focusGained(FocusEvent e) {
         }
@@ -162,11 +182,10 @@
             int lineCount = ta.getLineCount();
             for (int i=0; i &lt; lineCount; i++) {
                 String tmp = ta.getLine(i);
-                if (tmp.length() &gt; 1) //omit empty lines
+                if (tmp.length() &gt; 1) 
                     userList.add(tmp);
-            }
-            // TODO - co tu mam volat??? model.setEditGroup(userList);
+            }            
         }
-    }//taxonAreaListener
+    }
     
 }

Modified: trunk/src/net/sf/plantlore/client/user/AddEditUserView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/user/AddEditUserView.form	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/user/AddEditUserView.form	2006-08-08 16:12:12 UTC (rev 496)
@@ -21,7 +21,7 @@
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                   &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                      &lt;Component id=&quot;jPanel1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jPanel1&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                       &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
                   &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
@@ -68,7 +68,7 @@
         &lt;DimensionLayout dim=&quot;0&quot;&gt;
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
-                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Component id=&quot;loginLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;addressLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -85,50 +85,50 @@
                       &lt;Component id=&quot;dropWhenValueLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;createWhenValueLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                              &lt;Component id=&quot;surnameText&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;jScrollPane1&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;addressText&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;firstNameText&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;passwordtext&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;emailText&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                              &lt;Component id=&quot;loginText&quot; alignment=&quot;0&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;surnameText&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;jScrollPane1&quot; alignment=&quot;0&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;addressText&quot; alignment=&quot;0&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;firstNameText&quot; alignment=&quot;0&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;passwordtext&quot; alignment=&quot;0&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;emailText&quot; alignment=&quot;0&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                              &lt;Component id=&quot;loginText&quot; alignment=&quot;0&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
                           &lt;/Group&gt;
                           &lt;EmptySpace min=&quot;-2&quot; pref=&quot;21&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;jPanel2&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
+                          &lt;Component id=&quot;jPanel2&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;2&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
         &lt;DimensionLayout dim=&quot;1&quot;&gt;
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
                       &lt;Component id=&quot;jPanel2&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
                       &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                               &lt;Component id=&quot;loginLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;loginText&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                               &lt;Component id=&quot;jLabel2&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;passwordtext&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                               &lt;Component id=&quot;firstNameLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;firstNameText&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                               &lt;Component id=&quot;surnameLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;surnameText&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                               &lt;Component id=&quot;emailLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;emailText&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -138,11 +138,12 @@
                               &lt;Component id=&quot;addressLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;addressText&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                               &lt;Component id=&quot;noteLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Component id=&quot;jScrollPane1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
+                              &lt;Component id=&quot;jScrollPane1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;2&quot;/&gt;
                           &lt;/Group&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; pref=&quot;12&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
                   &lt;EmptySpace min=&quot;-2&quot; pref=&quot;24&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -150,12 +151,12 @@
                       &lt;Component id=&quot;createWhenuser&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;createWhenValueLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                       &lt;Component id=&quot;dropWhenLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;dropWhenValueLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace pref=&quot;20&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; pref=&quot;20&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;

Modified: trunk/src/net/sf/plantlore/client/user/AddEditUserView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/user/AddEditUserView.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/user/AddEditUserView.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -22,8 +22,10 @@
 
 
 /**
+ * View for the Add/Edit user dialog in the UserManager MVC.
  *
- * @author  Lada
+ * @author  Lada Oberreiterova
+ * @version 1.0
  */
 public class AddEditUserView extends javax.swing.JDialog  implements Observer {
     
@@ -32,6 +34,9 @@
     
     /**
      * Creates new form AddEditUserView
+     * @param model model of UserManager MVC     
+     * @param parent parent of this dialog
+     * @param modal boolean flag whether the dialog should be modal or not
      */
     public AddEditUserView(UserManager model, javax.swing.JDialog parent, boolean modal) {
         super(parent, modal);
@@ -57,20 +62,49 @@
          JOptionPane.showMessageDialog(this, message, title, JOptionPane.ERROR_MESSAGE);               
      }
      
-     /*
-      * nastaveni formulare pro add
+     /**
+      * Set add form
       */
-     public void setAddForm() {
-         operationButton.setText(L10n.getString(&quot;UserManager.ButtonAdd&quot;));
-         createWhenuser.setText(&quot;&quot;);
-         dropWhenLabel.setText(&quot;&quot;);
+     public void setAddForm() {    	 
+         operationButton.setText(L10n.getString(&quot;UserManager.ButtonAdd&quot;));         
+         createWhenuser.setText(&quot;&quot;);        
+         dropWhenLabel.setText(&quot;&quot;);        
+         this.loginText.setText(&quot;&quot;);        
+         this.passwordtext.setText(&quot;&quot;);         
+         this.firstNameText.setText(&quot;&quot;);        
+         this.surnameText.setText(&quot;&quot;);        
+         this.emailText.setText(&quot;&quot;);         
+         this.addressText.setText(&quot;&quot;);        
+         this.administratorCheckBox.setSelected(false);        
+         this.editAllCheckBox.setSelected(false);         
+         this.addRightCheckBox.setSelected(false);         
+         this.editGroupTextArea.setText(&quot;&quot;);        
+         this.noteText.setText(&quot;&quot;);        
+         this.editGroupTextArea.setText(&quot;&quot;);        
+         
+         Pair&lt;String, Integer&gt;[] users = model.getUsers();
+         String[] choices = new String[users.length];
+         for (int i = 0; i &lt; users.length; i++) {
+             choices[i] = users[i].getFirst();
+         }
+         ((AutoTextArea)editGroupTextArea).setChoices(choices);
      }
      
       public void setEditForm() {
          operationButton.setText(L10n.getString(&quot;UserManager.ButtonEdit&quot;));
          loginText.setEditable(false);
+         
+         Pair&lt;String, Integer&gt;[] users = model.getUsers();
+         String[] choices = new String[users.length];
+         for (int i = 0; i &lt; users.length; i++) {
+             choices[i] = users[i].getFirst();
+         }
+         ((AutoTextArea)editGroupTextArea).setChoices(choices);
      }
      
+      /**
+       * Set Details form       
+       */
      public void setDetailsForm() {
        operationButton.setText(L10n.getString(&quot;UserManager.ButtonOk&quot;));
        this.loginText.setEditable(false);
@@ -88,7 +122,7 @@
      }
      
      /**
-      * Nacteni dat pro edit/details dialog
+      * Load data for edit/details dialog
       */
      public void loadData() {
            //Get selected user object
@@ -139,14 +173,15 @@
     }    
      
      /**
-     *
+     * Close this dialog.
      */
     public void close() {
         dispose();
     }
     
-    /*
-     *
+    /**
+     *  Check whether the given field is empty or not. This is used for validating user input when 
+     *  add or edit metadata.
      */
     public boolean checkNotNull() {
         if (this.loginText.getText().equals(&quot;&quot;)) {
@@ -317,13 +352,13 @@
                     .add(dropWhenValueLabel)
                     .add(createWhenValueLabel)
                     .add(jPanel1Layout.createSequentialGroup()
-                        .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
-                            .add(surnameText)
-                            .add(jScrollPane1)
-                            .add(addressText)
-                            .add(firstNameText)
-                            .add(passwordtext)
-                            .add(emailText)
+                        .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                            .add(surnameText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 223, Short.MAX_VALUE)
+                            .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 223, Short.MAX_VALUE)
+                            .add(addressText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 223, Short.MAX_VALUE)
+                            .add(firstNameText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 223, Short.MAX_VALUE)
+                            .add(passwordtext, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 223, Short.MAX_VALUE)
+                            .add(emailText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 223, Short.MAX_VALUE)
                             .add(loginText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 223, Short.MAX_VALUE))
                         .add(21, 21, 21)
                         .add(jPanel2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
@@ -333,7 +368,7 @@
             jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(jPanel1Layout.createSequentialGroup()
                 .addContainerGap()
-                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
+                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                     .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                     .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel1Layout.createSequentialGroup()
                         .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
@@ -362,7 +397,8 @@
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                             .add(noteLabel)
-                            .add(jScrollPane1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))))
+                            .add(jScrollPane1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                        .add(12, 12, 12)))
                 .add(24, 24, 24)
                 .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(createWhenuser)
@@ -371,7 +407,7 @@
                 .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(dropWhenLabel)
                     .add(dropWhenValueLabel))
-                .addContainerGap(20, Short.MAX_VALUE))
+                .add(20, 20, 20))
         );
 
         operationButton.setText(&quot;&quot;);
@@ -388,7 +424,7 @@
                 .addContainerGap()
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(layout.createSequentialGroup()
-                        .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                        .add(jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                         .addContainerGap())
                     .add(layout.createSequentialGroup()
                         .add(helpButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)

Modified: trunk/src/net/sf/plantlore/client/user/UserManager.java
===================================================================
--- trunk/src/net/sf/plantlore/client/user/UserManager.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/user/UserManager.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -39,6 +39,8 @@
     private DBLayer database;   
     /** Exception with details about an error */
     private String error = null;
+    /** Remote exception (network communication failed)*/
+    private RemoteException remoteEx;
     /** Constant with default number of rows to display */
     protected static final int DEFAULT_DISPLAY_ROWS = 6;    
     /** Actual number of rows to display */
@@ -56,7 +58,7 @@
     /** Type of operation - ADD, EDIT, DELETE, DETAIL*/
     private String operation = &quot;&quot;;
     /** Containing information about closing the addEdit dialog*/
-    private boolean usedClose = false;
+    private boolean usedClose = true;
     /** Record for add, update or delete*/
     private User userRecord;
     /** Identifier of record for add, update or delete*/
@@ -105,9 +107,12 @@
     public static final String ERROR_TRANSACTION = L10n.getString(&quot;Error.TransactionRaceConditions&quot;);
     public static final String ERROR_CREATE_PAIRS = L10n.getString(&quot;Error.UserManagerCreatePairs&quot;); 
     public static final String ERROR_LOGIN = L10n.getString(&quot;Error.UserManagerDuplicityLogin&quot;);
+    public static final String ERROR_REMOTE_EXCEPTION = &quot;REMOTE_EXCEPTION&quot;;
     
     public static final String QUESTION_DELETE_TITLE = L10n.getString(&quot;Question.DeleteUserTitle&quot;);
     public static final String QUESTION_DELETE = L10n.getString(&quot;Question.DeleteUser&quot;);
+    public static final String QUESTION_DROP = L10n.getString(&quot;Question.DropUser&quot;);
+    public static final String QUESTION_DROP_TITLE = L10n.getString(&quot;Question.DropUserTitle&quot;);
     
     public static final String PROGRESS_SEARCH = L10n.getString(&quot;User.Search.ProgressTitle&quot;);
     public static final String PROGRESS_ADD = L10n.getString(&quot;User.Add.ProgressTitle&quot;);
@@ -155,13 +160,13 @@
 		    	   } catch (RemoteException e) {	            
 			            logger.error(&quot;Searching user failed. Remote exception caught in User. Details: &quot;+e.getMessage());
 			        	database.rollbackTransaction();
-		                RemoteException remex = new RemoteException(ERROR_SEARCH + e);
+		                RemoteException remex = new RemoteException(ERROR_SEARCH + e.getMessage());
 		                remex.setStackTrace(e.getStackTrace());
 		                throw remex; 		           
 			        } catch (DBLayerException e) {
 			        	logger.error(&quot;Searching user failed. DBLayer exception caught in User. Details: &quot;+e.getMessage());       	                                                   
 			        	database.rollbackTransaction();
-		                DBLayerException dbex = new DBLayerException(ERROR_SEARCH + e);
+		                DBLayerException dbex = new DBLayerException(ERROR_SEARCH + e.getMessage());
 		                dbex.setStackTrace(e.getStackTrace());
 		                throw dbex; 		           
 			        }					       
@@ -176,13 +181,10 @@
 			} catch (DBLayerException e) {
 				logger.error(&quot;Searching user failed. Remote exception caught in User. Details: &quot;+e.getMessage());
 				setError(ERROR_SEARCH);
-				setChanged();
-                notifyObservers();                
 			} catch (RemoteException e) {
-				logger.error(&quot;Searching user failed. DBLayer exception caught in User. Details: &quot;+e.getMessage());
-				setError(ERROR_SEARCH);
-				setChanged();
-                notifyObservers();                
+				logger.error(&quot;Searching user failed. DBLayer exception caught in User. Details: &quot;+e.getMessage());				
+				setError(ERROR_REMOTE_EXCEPTION);	
+				setRemoteEx(e);                
 			}
 			return null;
     	}
@@ -256,7 +258,7 @@
      * @param from number of the first row to show in table. Number of the first row to retraieve is 1.
      * @param count number of rows to retrieve 
      */
-    public void processResult(int from, int count) {
+    public void processResult(int from, int count) throws RemoteException, DBLayerException {
         
         if (this.resultId != 0) {
             int currentRow = getResultRows();
@@ -278,23 +280,19 @@
              		objectUser = database.more(this.resultId, 0, to-1);  
              	} catch(RemoteException e) {
              		logger.error(&quot;Remote exception caught in UserManager (processResult). Details: &quot;+e.getMessage());
-        			setError(ERROR_PROCESS);
-        			setChanged();
-                    notifyObservers();
-                 	return;                                                                                       
+             		RemoteException remex = new RemoteException(e.getMessage());
+                    remex.setStackTrace(e.getStackTrace());
+                    throw remex;                                                                              
                 } catch (DBLayerException e) {                  
                     logger.error(&quot;Processing search results failed: &quot; + e.getMessage());   
-                    setError(ERROR_PROCESS);
-                    setChanged();
-                    notifyObservers();
-                    return;
+                    DBLayerException dbex = new DBLayerException(ERROR_PROCESS + e.getMessage());
+                    dbex.setStackTrace(e.getStackTrace());
+                    throw dbex; 
                 }  
                 if (objectUser == null) {
                 	logger.error(&quot;tUser doesn`t contain required data&quot;);
-                	setError(ERROR_PROCESS);
-                    setChanged();
-                    notifyObservers();
-                    return;
+                	DBLayerException dbex = new DBLayerException(ERROR_PROCESS + &quot;tUser doesn`t contain required data&quot;);                   
+                    throw dbex; 
                 }
                 int countResult = objectUser.length;  
                 logger.debug(&quot;Results retrieved. Count: &quot;+ countResult);                
@@ -381,16 +379,14 @@
     	            users[userRecord.getId()].setFirst(userRecord.getWholeName()+ &quot; (&quot; + userRecord.getLogin() + &quot; )&quot;);
 		        }catch (RemoteException e) {
 		        	logger.error(&quot;Process update User failed. Remote exception caught in UserManager. Details: &quot;+e.getMessage());
-		        	database.rollbackTransaction();
-		        	database.rollbackTransaction();
-                    RemoteException remex = new RemoteException(ERROR_EDIT + e);
+		        	database.rollbackTransaction();		        	
+                    RemoteException remex = new RemoteException(ERROR_EDIT + e.getMessage());
                     remex.setStackTrace(e.getStackTrace());
                     throw remex; 		           		       	    
 		        } catch (DBLayerException e) {
 		        	logger.error(&quot;Process update User failed. DBLayer exception caught in UserManager. Details: &quot;+e.getMessage());       	                                                   
-		        	database.rollbackTransaction();
-		        	database.rollbackTransaction();
-                    DBLayerException dbex = new DBLayerException(ERROR_EDIT + e);
+		        	database.rollbackTransaction();		        
+                    DBLayerException dbex = new DBLayerException(ERROR_EDIT + e.getMessage());
                     dbex.setStackTrace(e.getStackTrace());
                     throw dbex; 		            
 		        } 	
@@ -420,12 +416,12 @@
     				 database.executeUpdate(userRecord);		            
 		        }catch (RemoteException e) {
 		        	logger.error(&quot;Process delete User failed. Remote exception caught in UserManager. Details: &quot;+e.getMessage());		        	
-                    RemoteException remex = new RemoteException(ERROR_DELETE + e);
+                    RemoteException remex = new RemoteException(ERROR_DELETE + e.getMessage());
                     remex.setStackTrace(e.getStackTrace());
                     throw remex; 		           		       	    
 		        } catch (DBLayerException e) {
 		        	logger.error(&quot;Process delete User failed. DBLayer exception caught in UserManager. Details: &quot;+e.getMessage());       	                                                   		        	
-                    DBLayerException dbex = new DBLayerException(ERROR_DELETE + e);
+                    DBLayerException dbex = new DBLayerException(ERROR_DELETE + e.getMessage());
                     dbex.setStackTrace(e.getStackTrace());
                     throw dbex; 		            
 		        } 			        		      			        
@@ -472,12 +468,12 @@
                 database.closeQuery(sq);
             }catch (RemoteException e) {	            
 	            logger.error(&quot;Searching user and creating Pairs (login, identifier) failed. Remote exception caught in User. Details: &quot;+e.getMessage());	        	
-                RemoteException remex = new RemoteException(ERROR_CREATE_PAIRS + e);
+                RemoteException remex = new RemoteException(ERROR_CREATE_PAIRS + e.getMessage());
                 remex.setStackTrace(e.getStackTrace());
                 throw remex; 		           
 	        } catch (DBLayerException e) {
 	        	logger.error(&quot;Searching user and creating Pairs (login, identifier) failed. DBLayer exception caught in User. Details: &quot;+e.getMessage());       	                                                   
-                DBLayerException dbex = new DBLayerException(ERROR_CREATE_PAIRS + e);
+                DBLayerException dbex = new DBLayerException(ERROR_CREATE_PAIRS + e.getMessage());
                 dbex.setStackTrace(e.getStackTrace());
                 throw dbex; 		           
 	        }					       
@@ -602,6 +598,22 @@
     }      
     
     /**
+     *  Set an remote exception (network communication failed)
+     *  @param ex  RemoteException (network communication failed)
+     */
+    public void setRemoteEx(RemoteException ex) {
+        this.remoteEx = ex;
+    }
+    
+    /**
+     *  Get remote exception (network communication failed)
+     *  @return remote exception (network communication failed)
+     */
+    public RemoteException getRemoteEx() {
+        return this.remoteEx;
+    }  
+    
+    /**
      * Set true if addEdit dialog was closed by CLOSE button
      * @param usedClose containing information about closing the addEdit dialog
      */
@@ -647,7 +659,7 @@
                 resultCount = database.getNumRows(resultId);        	
         } catch(RemoteException e) {
                 logger.error(&quot;Get number of results failed.Remote exception caught in UserManager. Details: &quot;+e.getMessage());  
-            	setError(ERROR_NUMBER_ROWS);
+            	setError(ERROR_REMOTE_EXCEPTION);
         }
         return resultCount;
     }

Modified: trunk/src/net/sf/plantlore/client/user/UserManagerCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/user/UserManagerCtrl.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/user/UserManagerCtrl.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -13,20 +13,16 @@
 import java.awt.event.ActionListener;
 import java.awt.event.FocusEvent;
 import java.awt.event.FocusListener;
-import java.awt.event.KeyEvent;
-import java.awt.event.KeyListener;
 import java.rmi.RemoteException;
-
-import net.sf.plantlore.client.metadata.AddEditMetadataCtrl;
-import net.sf.plantlore.client.metadata.AddEditMetadataView;
+import net.sf.plantlore.client.history.History;
 import net.sf.plantlore.client.metadata.MetadataManager;
-import net.sf.plantlore.client.metadata.MetadataManagerTableModel;
-import net.sf.plantlore.client.metadata.MetadataManagerCtrl.escapeKeyPressed;
+import net.sf.plantlore.common.DefaultCancelAction;
+import net.sf.plantlore.common.DefaultEscapeKeyPressed;
 import net.sf.plantlore.common.DefaultProgressBar;
-import net.sf.plantlore.common.ProgressBar;
+import net.sf.plantlore.common.DefaultReconnectDialog;
 import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.exception.DBLayerException;
-import net.sf.plantlore.common.record.User;
+
 import org.apache.log4j.Logger;
 
 /**
@@ -42,19 +38,13 @@
     /** Model of UserManager MVC */
     private UserManager model;
     /** View of UserManager MVC */
-    private UserManagerView view;
-    /** View of add dialog*/
+    private UserManagerView view;  
+    /** View of add dialog */
     private AddEditUserView addView;
-    /** Controler of add dialog*/
-    private AddEditUserCtrl addCtrl;
-    /** View of edit dialog*/
+    /** View of edit dialog */
     private AddEditUserView editView;
-    /** Controler of edit dialog*/
-    private AddEditUserCtrl editCtrl;
-    /** View of details dialog*/
+    /** View of details dialog */
     private AddEditUserView detailView;
-    /** Controler of details dialog*/
-    private AddEditUserCtrl detailCtrl;
     
     /**
      * Creates a new instance of UserManagerCtrl
@@ -66,8 +56,9 @@
         logger = Logger.getLogger(this.getClass().getPackage().getName());        
         this.model = modelUser;
         this.view = viewUser;
+        DefaultEscapeKeyPressed escapeKeyPressed = new DefaultEscapeKeyPressed(view);
           
-        view.closeButton.addActionListener(new closeButtonListener());
+        view.closeButton.setAction(new DefaultCancelAction(view)); 
         view.previousButton.addActionListener(new previousButtonListener());
         view.nextButton.addActionListener(new nextButtonListener());            
         view.toDisplayValueTextField.addActionListener(new rowSetDisplayChangeListener());    
@@ -83,89 +74,79 @@
         view.showCurrentUserRadioButton.addFocusListener(new ShowUserDirectionRadioFocusListener());
         
         //Add key listeners
-        view.closeButton.addKeyListener(new escapeKeyPressed());
-        view.previousButton.addKeyListener(new escapeKeyPressed());
-        view.nextButton.addKeyListener(new escapeKeyPressed());
-        view.addButtons.addKeyListener(new escapeKeyPressed());
-        view.toDisplayValueTextField.addKeyListener(new escapeKeyPressed());
-        view.helpButton.addKeyListener(new escapeKeyPressed());
-        view.editButtons.addKeyListener(new escapeKeyPressed());
-        view.deleteButton.addKeyListener(new escapeKeyPressed());
-        view.detailsButton.addKeyListener(new escapeKeyPressed());
-        view.searchButton.addKeyListener(new escapeKeyPressed());
-        view.sortComboBox.addKeyListener(new escapeKeyPressed());
-        view.tableUserList.addKeyListener(new escapeKeyPressed());
-        view.sortAscendingRadioButton.addKeyListener(new escapeKeyPressed());
-        view.sortDescendingRadioButton.addKeyListener(new escapeKeyPressed());
-        view.addressSearchText.addKeyListener(new escapeKeyPressed());           
-        view.emailSearchText.addKeyListener(new escapeKeyPressed());
-        view.loginSearchText.addKeyListener(new escapeKeyPressed());
-        view.wholeNameSearchText.addKeyListener(new escapeKeyPressed());
-        view.addKeyListener(new escapeKeyPressed());
+        view.closeButton.addKeyListener(escapeKeyPressed);
+        view.previousButton.addKeyListener(escapeKeyPressed);
+        view.nextButton.addKeyListener(escapeKeyPressed);
+        view.addButtons.addKeyListener(escapeKeyPressed);
+        view.toDisplayValueTextField.addKeyListener(escapeKeyPressed);
+        view.helpButton.addKeyListener(escapeKeyPressed);
+        view.editButtons.addKeyListener(escapeKeyPressed);
+        view.deleteButton.addKeyListener(escapeKeyPressed);
+        view.detailsButton.addKeyListener(escapeKeyPressed);
+        view.searchButton.addKeyListener(escapeKeyPressed);
+        view.sortComboBox.addKeyListener(escapeKeyPressed);
+        view.tableUserList.addKeyListener(escapeKeyPressed);
+        view.sortAscendingRadioButton.addKeyListener(escapeKeyPressed);
+        view.sortDescendingRadioButton.addKeyListener(escapeKeyPressed);
+        view.addressSearchText.addKeyListener(escapeKeyPressed);           
+        view.emailSearchText.addKeyListener(escapeKeyPressed);
+        view.loginSearchText.addKeyListener(escapeKeyPressed);
+        view.wholeNameSearchText.addKeyListener(escapeKeyPressed);
+        view.showActiveUserPanel.addKeyListener(escapeKeyPressed);
+        view.showAllUserRadioBUtton.addKeyListener(escapeKeyPressed);
+        view.showCurrentUserRadioButton.addKeyListener(escapeKeyPressed);
+        view.addKeyListener(escapeKeyPressed);
         
         //Search user and Load data
         Task task = model.searchUser(true);        
         
-        ProgressBar progressBar = new ProgressBar(task, view, true) {		   							 						
-        	public void exceptionHandler(Exception e) {
-				if (e instanceof DBLayerException) {	   									   							
-   					DBLayerException dbex = (DBLayerException) e;	
-   					view.showErrorMessage(MetadataManager.ERROR_DBLAYER_TITLE,MetadataManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
-   					getTask().stop();
-   					return;
-   				}
-   				if (e instanceof RemoteException) {	 
-   					RemoteException remex = (RemoteException) e;		
-   					view.showErrorMessage(MetadataManager.ERROR_REMOTE_TITLE, MetadataManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
-   					getTask().stop();
-   					return;
-   				}
-   				view.showErrorMessage(MetadataManager.ERROR_UNKNOWEN_TITLE, MetadataManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
-   				logger.error(e);
-   			}
-
+        new DefaultProgressBar(task, view, true) {		   							 						
+        	@Override
 			public void afterStopping() {
-				//Process result
-		        model.processResult(1, model.getDisplayRows());
-		        //Update view dialog
-		        view.tableUserList.setModel(new UserManagerTableModel(model));
-		        int from = model.getCurrentFirstRow();
-                int to = from + view.tableUserList.getRowCount() - 1;
-                view.displayedValueLabel.setText(from + &quot;-&quot; + to);
-                view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());
+				//Process result and Update view dialog
+		        reloadData(1, model.getDisplayRows());		       
            } 		   					
-		};
-		progressBar.setTitle(MetadataManager.PROGRESS_SEARCH);	                   	                   
+		};		                 	                   
         task.start();                                       
-    }                        
-   
-    /**     
-     * KeyListener class controlling the pressing key ESCAPE.
-     * On key ESCAPE hides the view.     
+    }  
+    
+    /**
+     * Reload new data for displaying in view dialog.
+     * @param fromRow number of the first row to show in table
+     * @param countRow number of rows to retrieve 
      */
-    public class escapeKeyPressed implements KeyListener {
-    	 	 public void keyPressed(KeyEvent evt){
-    	 		if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) {
-    	 			logger.debug(&quot;ESCAPE: &quot; + view.getFocusOwner());
-    	 			view.close();
-    	 		}    	 		     	 		 
-    	 	 }
-    	      public void keyReleased(KeyEvent evt) {}    	     
-    	      public void keyTyped(KeyEvent evt) {}    	         
+    public void reloadData(int fromRow, int countRow) {
+    	try {
+    		model.processResult(fromRow, countRow);     
+    		view.tableUserList.setModel(new UserManagerTableModel(model));
+	        int from = model.getCurrentFirstRow();
+            int to = from + view.tableUserList.getRowCount() - 1;
+            if (to &lt;= 0 ) {
+            	view.displayedValueLabel.setText(&quot;0-0&quot;);
+            } else {
+            	view.displayedValueLabel.setText(from + &quot;-&quot; + to);
+            }
+            view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());    		
+    	} catch (RemoteException e) {
+    		DefaultReconnectDialog.show(view, e);
+    	} catch (DBLayerException e) {
+    		view.showErrorMessage(e.getMessage());
+    	}    	           
     }
- 
     
     /**
-     * ActionListener class controlling the &lt;b&gt;CLOSE&lt;/b&gt; button on the form.
-     * On Close hides the view.
+     * Display error message.
      */
-   class closeButtonListener implements ActionListener {
-       public void actionPerformed(ActionEvent actionEvent)
-       {
-    	   view.close();
-       }
-   }
-     
+    public void displayError() {
+    	if (model.getError().equals(History.ERROR_REMOTE_EXCEPTION)) {
+ 		   DefaultReconnectDialog.show(view, model.getRemoteEx());
+ 	   } else {
+ 		   view.showErrorMessage(model.getError());
+ 	   }
+    	//TODO nastavit ci nenastvit null
+ 	   model.setError(null); 
+    }
+   
    /**
     *  ActionListener class controlling the &lt;b&gt;PREV&lt;/b&gt; button on the form.
     *  The button PREV is used for browsing the search results.
@@ -181,14 +162,7 @@
            // Get previous page of results
            if (model.getCurrentFirstRow() &gt; 1) {
                int firstRow = Math.max(model.getCurrentFirstRow()- model.getDisplayRows(), 1);
-               model.processResult(firstRow, model.getDisplayRows()); 
-               if (model.isError()) return;
-               if (model.getCurrentFirstRow() &gt; 1){
-               }
-               view.tableUserList.setModel(new UserManagerTableModel(model));
-               int from = model.getCurrentFirstRow();
-               int to = from + view.tableUserList.getRowCount() - 1;
-               view.displayedValueLabel.setText(from + &quot;-&quot; + to);
+               reloadData(firstRow, model.getDisplayRows());                
            }      
            //Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -219,16 +193,7 @@
            }
            // Get next page of result
            if (model.getCurrentFirstRow()+ view.tableUserList.getRowCount()&lt;=model.getResultRows()) {
-               model.processResult(model.getCurrentFirstRow()+ model.getDisplayRows(), view.tableUserList.getRowCount());
-               if (model.isError()) return;
-               view.tableUserList.setModel(new UserManagerTableModel(model));             
-               int from = model.getCurrentFirstRow();
-               int to = from + view.tableUserList.getRowCount() - 1;
-               if (to &lt;= 0){
-            	   view.displayedValueLabel.setText(&quot;0-0&quot;);
-               }else {
-            	   view.displayedValueLabel.setText(from + &quot;-&quot; + to);
-               }               
+               reloadData(model.getCurrentFirstRow()+ model.getDisplayRows(), view.tableUserList.getRowCount());                          
            }  
            //Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -267,12 +232,7 @@
            logger.debug(&quot;New display rows: &quot;+view.getDisplayRows());
            // If neccessary reload search results
            if (oldValue != view.getDisplayRows()) {
-               model.processResult(model.getCurrentFirstRow(), view.getDisplayRows());
-               if (model.isError()) return;
-               view.tableUserList.setModel(new UserManagerTableModel(model));
-               int from = model.getCurrentFirstRow();
-               int to = from + view.tableUserList.getRowCount() - 1;
-               view.displayedValueLabel.setText(from + &quot;-&quot; + to);               
+               reloadData(model.getCurrentFirstRow(), view.getDisplayRows());                         
            }
            // Set button prev active if we see the first page, in other way set it inactive
            if (model.getCurrentFirstRow() &gt; 1) {
@@ -302,47 +262,28 @@
            }
            //set information abut selected operation ADD
            model.setOperation(&quot;ADD&quot;);           
-           //create add dialog if dialog not exist and open Add dialog
-           if (addView == null) {
-       	   	    addView = new AddEditUserView(model, view,true);
-          		addCtrl = new AddEditUserCtrl(addView, model);
-          }
+           //create add dialog if dialog not exist and open Add dialog                  	  
+          AddEditUserView addView = new AddEditUserView(model, view,true);
+          new AddEditUserCtrl(addView, model);          
           addView.setAddForm();
           addView.setVisible(true);          
            //User press button close
-           if (model.usedClose()) return;
+           if (model.usedClose()) return;           
            //save new record Metadata into database
            Task task = model.addUserRecord();
            
-           ProgressBar progressBar = new ProgressBar(task, view, true) {		   							 
-   			public void exceptionHandler(Exception e) {
-   				if (e instanceof DBLayerException) {	   									   							
-   					DBLayerException dbex = (DBLayerException) e;	
-   					view.showErrorMessage(UserManager.ERROR_DBLAYER_TITLE, UserManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
-   					getTask().stop();
-   					return;
-   				}
-   				if (e instanceof RemoteException) {	 
-   					RemoteException remex = (RemoteException) e;		
-   					view.showErrorMessage(UserManager.ERROR_REMOTE_TITLE,UserManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
-   					getTask().stop();
-   					return;
-   				}
-   				view.showErrorMessage(UserManager.ERROR_UNKNOWEN_TITLE, UserManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
-   				logger.error(e);
-   			}
-   			
-   			public void afterStopping() {
+           new DefaultProgressBar(task, view, true) {		   							 
+   			   @Override
+        	   public void afterStopping() {
     			   //load data
-    	           model.searchUser(false);           
-    	           model.processResult(1, model.getDisplayRows());
-    	           if (model.isError()) return;
-    	           view.tableUserList.setModel(new UserManagerTableModel(model));                      
-    	           view.displayedValueLabel.setText(1 + &quot;-&quot; + view.tableUserList.getRowCount());
-    	           view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());    	           
+    	           model.searchUser(false);  
+    	           if (model.isError()) {
+    	        	   displayError();
+    	        	   return;
+    	           }    	
+    	           reloadData(1, model.getDisplayRows());    	             	           
                } 		   		
-   		};
-   		progressBar.setTitle(UserManager.PROGRESS_ADD);	                   	                   
+   		};   			                   	                   
         task.start();                                       
        }
     }
@@ -366,12 +307,10 @@
                model.setOperation(&quot;EDIT&quot;);
                //Set information about selected row
                int resultNumber = view.tableUserList.getSelectedRow() + model.getCurrentFirstRow()-1;  
-               model.setUserRecord(resultNumber);
-               //Create edit dialog
-               User user = model.getUserRecord(); 
+               model.setUserRecord(resultNumber);                
                if (editView == null) {
             	   	editView = new AddEditUserView(model,view,true);
-        	   		editCtrl = new AddEditUserCtrl(editView, model);
+        	   		new AddEditUserCtrl(editView, model);
                }               
                //Load data and setting of edit dialog
                editView.loadData();                              
@@ -382,31 +321,14 @@
                //Update User               
                Task task = model.editUserRecord();
                
-               ProgressBar progressBar = new ProgressBar(task, view, true) {		   							 
-          			public void exceptionHandler(Exception e) {
-          				if (e instanceof DBLayerException) {	   									   							
-           					DBLayerException dbex = (DBLayerException) e;	
-           					view.showErrorMessage(UserManager.ERROR_DBLAYER_TITLE,UserManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
-           					getTask().stop();
-           					return;
-           				}
-           				if (e instanceof RemoteException) {	 
-           					RemoteException remex = (RemoteException) e;		
-           					view.showErrorMessage(UserManager.ERROR_REMOTE_TITLE,UserManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
-           					getTask().stop();
-           					return;
-           				}
-           				view.showErrorMessage(UserManager.ERROR_UNKNOWEN_TITLE, UserManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
-           				logger.error(e);
-           			}
-
-          			public void afterStopping() {
+               new DefaultProgressBar(task, view, true) {		   							 
+          		   @Override
+            	   public void afterStopping() {
           			   //load User          				
                         if (model.isError()) return;
                         view.tableUserList.setModel(new UserManagerTableModel(model));                         
                      } 		   					
-          		};
-          		progressBar.setTitle(UserManager.PROGRESS_EDIT);	                   	                   
+          		};          			                   	                  
                 task.start();                                       
               }
        }
@@ -431,12 +353,10 @@
                 model.setOperation(&quot;DETAILS&quot;);
                //Set information about selected row
                int resultNumber = view.tableUserList.getSelectedRow() + model.getCurrentFirstRow()-1;  
-               model.setUserRecord(resultNumber);
-               //Create detail dialog
-               User user = model.getUserRecord();               
+               model.setUserRecord(resultNumber);                             
                if (detailView == null) {
                		detailView = new AddEditUserView(model, view,true);
-           			detailCtrl = new AddEditUserCtrl(detailView, model);
+           			new AddEditUserCtrl(detailView, model);
                }
                //Load data and setting of detail dialog            
                detailView.loadData();               
@@ -476,36 +396,19 @@
 	               //Delete selected record
 	               Task task = model.deleteUserRecord();
 	               
-	               ProgressBar progressBar = new ProgressBar(task, view, true) {		   								  		   									
-					public void exceptionHandler(Exception e) {
-						if (e instanceof DBLayerException) {	   									   							
-		   					DBLayerException dbex = (DBLayerException) e;	
-		   					view.showErrorMessage(UserManager.ERROR_DBLAYER_TITLE,UserManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
-		   					getTask().stop();
-		   					return;
-		   				}
-		   				if (e instanceof RemoteException) {	 
-		   					RemoteException remex = (RemoteException) e;		
-		   					view.showErrorMessage(UserManager.ERROR_REMOTE_TITLE,UserManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
-		   					getTask().stop();
-		   					return;
-		   				}
-		   				view.showErrorMessage(UserManager.ERROR_UNKNOWEN_TITLE, UserManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
-		   				logger.error(e);
-		   			}
-	
-                    public void afterStopping() {
-                       // load User
-	   	               model.searchUser(false);               
-	   	               model.processResult(1, model.getDisplayRows());
-	   	               if (model.isError()) return;
-	   	               view.tableUserList.setModel(new UserManagerTableModel(model));                      
-	   	               view.displayedValueLabel.setText(1 + &quot;-&quot; + view.tableUserList.getRowCount());
-	   	               view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());		   	               
-                                }
-		   			};
-		   			progressBar.setTitle(UserManager.PROGRESS_DELETE);	                   	                   
-		            task.start();                                                                  
+	               new DefaultProgressBar(task, view, true) {		   								  		   									
+					   @Override
+	            	   public void afterStopping() {
+	                       // load User
+		   	               model.searchUser(false); 
+		   	               if (model.isError()) {
+		    	        	   displayError();
+		    	        	   return;
+		    	           }    	
+		   	               reloadData(1, model.getDisplayRows());		   	               		   	              
+	                      }
+			   			};			   			                   	                   
+			            task.start();                                                                  
 		          }else {
 		        	  logger.debug(&quot;Button Cancle was press.&quot;);
 		          }	           
@@ -538,25 +441,9 @@
            //Load User with specific conditions
            Task task = model.searchUser(true);   
            
-           ProgressBar progressBar = new ProgressBar(task, view, true) {		   								  						    
-				public void exceptionHandler(Exception e) {
-					if (e instanceof DBLayerException) {	   									   							
-	   					DBLayerException dbex = (DBLayerException) e;	
-	   					view.showErrorMessage(UserManager.ERROR_DBLAYER_TITLE, UserManager.ERROR_DBLAYER+ &quot;\n&quot; + dbex.getMessage());   																				   					
-	   					getTask().stop();
-	   					return;
-	   				}
-	   				if (e instanceof RemoteException) {	 
-	   					RemoteException remex = (RemoteException) e;		
-	   					view.showErrorMessage(UserManager.ERROR_REMOTE_TITLE,UserManager.ERROR_REMOTE+ &quot;\n&quot; + remex.getMessage());   																				   					
-	   					getTask().stop();
-	   					return;
-	   				}
-	   				view.showErrorMessage(UserManager.ERROR_UNKNOWEN_TITLE, UserManager.ERROR_UNKNOWEN+ &quot;\n&quot; + e.getMessage());   						
-	   				logger.error(e);
-	   			}
-
-				public void afterStopping() {
+           new DefaultProgressBar(task, view, true) {		   								  						    
+        	   @Override
+        	   public void afterStopping() {
 					if (model.getDisplayRows() &lt;= 0) {
 		               model.setDisplayRows(UserManager.DEFAULT_DISPLAY_ROWS);
 		           }
@@ -564,14 +451,9 @@
 		           if (model.getResultRows() &lt; 1) {
 		               view.showInfoMessage(UserManager.INFORMATION_RESULT_TITLE,UserManager.INFORMATION_RESULT);
 		           }
-		           model.processResult(1, model.getDisplayRows());
-		           if (model.isError()) return;		           
-		           view.tableUserList.setModel(new UserManagerTableModel(model)); 		           
-		           view.displayedValueLabel.setText(model.getCurrentDisplayRows());  
-		           view.totalResultValueLabel.setText(((Integer)model.getResultRows()).toString()); 		           
+		           reloadData(1, model.getDisplayRows());		            		           
                } 		   					
-			};
-			progressBar.setTitle(UserManager.PROGRESS_SEARCH);	                   	                   
+			};				                   	                   
             task.start();                                                                  
        }
     }

Modified: trunk/src/net/sf/plantlore/client/user/UserManagerTableModel.java
===================================================================
--- trunk/src/net/sf/plantlore/client/user/UserManagerTableModel.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/user/UserManagerTableModel.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -20,23 +20,26 @@
 import org.apache.log4j.Logger;
 
 /**
- *
- * @author Lada
+ * Implements a table model for the UserManage
+ * 
+ * @author Lada Oberreiterova
+ * @version 1.0
  */
 public class UserManagerTableModel  extends AbstractTableModel  {
     
   
-        //Logger
+	/** Instance of a logger */
     private Logger logger;
-    // UserManager model
+    /** Model of userMnagre MVC*/
     private UserManager model; 
-    private ArrayList&lt;User&gt; userDataList;
-    
+    /** Results of a search query for displaying */
+    private ArrayList&lt;User&gt; userDataList;    
     /** Names of the columns */
     private String[] columnNames;
     /** Data values displayed in the table*/
     private Object[][] data;
 
+    /** Constants used for identification of columns of table */
     public final static int LOGIN = 0;
     public final static int WHOLENAME = 1;
     public final static int EMAIL = 2;       
@@ -45,6 +48,7 @@
     
     /**
      * Creates a new instance of UserManagerTableModel
+     * @param model model of UserManager MVC 
      */
     public UserManagerTableModel(UserManager model) {
         logger = Logger.getLogger(this.getClass().getPackage().getName());
@@ -53,6 +57,9 @@
     	initData();    	
     }  
    
+    /**
+     * Init names of columns.     
+     */
     private void initColumns() {
         columnNames = new String[5];                  
         columnNames[0] = L10n.getString(&quot;UserManager.Login&quot;);   
@@ -67,7 +74,7 @@
      */
     public void initData() {
     	
-    	logger.debug(&quot;User - Init data.&quot;);
+    	logger.debug(&quot;UserManager - Init data.&quot;);
     	
     	userDataList = model.getUserList();
     	if (userDataList.size()==0 ){
@@ -77,10 +84,8 @@
     	int firstRow = model.getCurrentFirstRow();
     	int countResult = Math.min(userDataList.size(), firstRow+ model.getDisplayRows()-1);
     	int countRow = countResult - firstRow + 1;   
-        int ii = 0;
-        //init Calendar for save valu of date   		
-        Calendar isoDateTime = new GregorianCalendar();
-    	//loud data for view
+        int ii = 0;        
+    	//Loud data for view
         Object[][] userData = new Object[countRow][5];   
     	for (int i=firstRow-1; i &lt; countResult; i++) {                             
             userData[ii][0] = ((User)userDataList.get(i)).getLogin();

Modified: trunk/src/net/sf/plantlore/client/user/UserManagerView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/user/UserManagerView.form	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/user/UserManagerView.form	2006-08-08 16:12:12 UTC (rev 496)
@@ -30,15 +30,15 @@
     &lt;DimensionLayout dim=&quot;0&quot;&gt;
       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
           &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
                   &lt;Component id=&quot;jPanel2&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
                   &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Component id=&quot;helpButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace pref=&quot;556&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;568&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;closeButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;Component id=&quot;jPanel1&quot; alignment=&quot;0&quot; min=&quot;-2&quot; pref=&quot;756&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
+                  &lt;Component id=&quot;jPanel1&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
               &lt;/Group&gt;
               &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
@@ -47,10 +47,10 @@
     &lt;DimensionLayout dim=&quot;1&quot;&gt;
       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
           &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
-              &lt;Component id=&quot;jPanel1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;jPanel1&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
               &lt;EmptySpace min=&quot;-2&quot; pref=&quot;15&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Component id=&quot;jPanel2&quot; min=&quot;-2&quot; pref=&quot;129&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                   &lt;Component id=&quot;helpButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Component id=&quot;closeButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -82,7 +82,7 @@
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
                               &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
                                   &lt;Component id=&quot;previousButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                                  &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;EmptySpace pref=&quot;6&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;totalResultLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                                   &lt;Component id=&quot;totalResultValueLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -113,7 +113,7 @@
                               &lt;Component id=&quot;nextButton&quot; min=&quot;-2&quot; pref=&quot;100&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
                           &lt;/Group&gt;
                       &lt;/Group&gt;
-                      &lt;Component id=&quot;jScrollPane1&quot; alignment=&quot;0&quot; min=&quot;-2&quot; pref=&quot;725&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jScrollPane1&quot; alignment=&quot;0&quot; pref=&quot;732&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
                   &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
@@ -123,17 +123,17 @@
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
                   &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;jScrollPane1&quot; pref=&quot;227&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;jScrollPane1&quot; pref=&quot;213&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                       &lt;Component id=&quot;totalResultLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;toDisplayedLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;displayedLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Component id=&quot;totalResultValueLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;toDisplayValueTextField&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;displayedValueLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;previousButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;nextButton&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;totalResultValueLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
                   &lt;EmptySpace min=&quot;-2&quot; pref=&quot;15&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
@@ -149,6 +149,9 @@
       &lt;/Layout&gt;
       &lt;SubComponents&gt;
         &lt;Container class=&quot;javax.swing.JScrollPane&quot; name=&quot;jScrollPane1&quot;&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_InitCodePost&quot; type=&quot;java.lang.String&quot; value=&quot;jScrollPane1.getViewport().setBackground(Color.WHITE);&quot;/&gt;
+          &lt;/AuxValues&gt;
 
           &lt;Layout class=&quot;org.netbeans.modules.form.compat2.layouts.support.JScrollPaneSupportLayout&quot;/&gt;
           &lt;SubComponents&gt;
@@ -164,6 +167,7 @@
                 &lt;/Property&gt;
               &lt;/Properties&gt;
               &lt;AuxValues&gt;
+                &lt;AuxValue name=&quot;JavaCodeGenerator_InitCodePost&quot; type=&quot;java.lang.String&quot; value=&quot;TransferFocus.patch(tableUserList);&quot;/&gt;
                 &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
               &lt;/AuxValues&gt;
             &lt;/Component&gt;
@@ -340,7 +344,7 @@
                               &lt;Component id=&quot;emailSearchText&quot; alignment=&quot;0&quot; pref=&quot;104&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
                           &lt;/Group&gt;
                       &lt;/Group&gt;
-                      &lt;Component id=&quot;searchButton&quot; min=&quot;-2&quot; pref=&quot;120&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
+                      &lt;Component id=&quot;searchButton&quot; min=&quot;-2&quot; pref=&quot;110&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
                   &lt;/Group&gt;
                   &lt;EmptySpace min=&quot;-2&quot; pref=&quot;17&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Component id=&quot;showActiveUserPanel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -352,12 +356,10 @@
         &lt;/DimensionLayout&gt;
         &lt;DimensionLayout dim=&quot;1&quot;&gt;
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
-                      &lt;Component id=&quot;jPanel3&quot; alignment=&quot;1&quot; min=&quot;0&quot; pref=&quot;88&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                      &lt;Component id=&quot;showActiveUserPanel&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                      &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                               &lt;Component id=&quot;emailLabel&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                               &lt;Component id=&quot;emailSearchText&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -374,8 +376,10 @@
                           &lt;EmptySpace min=&quot;-2&quot; pref=&quot;16&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Component id=&quot;searchButton&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
+                      &lt;Component id=&quot;jPanel3&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                      &lt;Component id=&quot;showActiveUserPanel&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; pref=&quot;5&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
@@ -571,7 +575,7 @@
                       &lt;Component id=&quot;showAllUserRadioBUtton&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;showCurrentUserRadioButton&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace pref=&quot;15&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;17&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;

Modified: trunk/src/net/sf/plantlore/client/user/UserManagerView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/user/UserManagerView.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/client/user/UserManagerView.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -6,24 +6,26 @@
 
 package net.sf.plantlore.client.user;
 
+import java.awt.Color;
 import java.util.Observable;
 import java.util.Observer;
 import javax.swing.DefaultListSelectionModel;
 import javax.swing.JDialog;
 import javax.swing.JOptionPane;
 import net.sf.plantlore.common.PlantloreHelp;
+import net.sf.plantlore.common.TransferFocus;
 import net.sf.plantlore.l10n.L10n;
 
-/**
- *
- * @author  Lada
+/** Creates new form UserManagerView
+ * 
+ * @param model model of the UserManager MVC
+ * @param parent parent of this dialog
+ * @param modal boolean flag whether the dialog should be modal or not
  */
 public class UserManagerView extends javax.swing.JDialog implements Observer{
     
-    //Whole UserManager model
-    private UserManager model;  
-    //data
-    private Object[][] data;
+    /** Model of UserManager MVC */
+    private UserManager model;      
     
     /**
      * Creates new form UserManagerView
@@ -32,10 +34,31 @@
         super(parent, modal);
         this.model = model;
         setDefaultCloseOperation(JDialog.HIDE_ON_CLOSE);
-        initComponents();
+        initComponents();        
+        getRootPane().setDefaultButton(closeButton);
         PlantloreHelp.addKeyHelp(PlantloreHelp.USER_MANAGER, this.getRootPane());
-        PlantloreHelp.addButtonHelp(PlantloreHelp.USER_MANAGER, this.helpButton);        
-        sortButtonGroup.add(sortAscendingRadioButton);
+        PlantloreHelp.addButtonHelp(PlantloreHelp.USER_MANAGER, this.helpButton);                
+    }
+    
+    /**
+     * Reload the view dialog or display some kind of error.
+     */
+    public void update(Observable observable, Object object)
+    {
+    	// Check whether we have some kind of error to display
+        if (model.isError()) {
+            showErrorMessage(L10n.getString(&quot;Common.ErrorMessageTitle&quot;), model.getError());                          
+            return;
+        } 
+    }
+    
+    /**
+     * Initialize actual data for displaying in view dialog.     
+     */
+    public void initialize() {  
+    	model.setDisplayRows(UserManager.DEFAULT_DISPLAY_ROWS);
+        model.setCurrentFirstRow(1);
+    	sortButtonGroup.add(sortAscendingRadioButton);
         sortButtonGroup.add(sortDescendingRadioButton);
         sortButtonGroup.setSelected(sortAscendingRadioButton.getModel(), true);
         showUserbuttonGroup.add(showAllUserRadioBUtton);
@@ -44,21 +67,36 @@
         tableUserList.setRowSelectionAllowed(true);
         tableUserList.setSelectionMode(DefaultListSelectionModel.SINGLE_SELECTION);
         tableUserList.setModel(new UserManagerTableModel(model));  
-       
+        previousButton.setEnabled(false);
+        nextButton.setEnabled(true);
+        if (UserManager.DEFAULT_DISPLAY_ROWS &gt;= model.getResultRows()) {
+        	nextButton.setEnabled(false);
+        }
+        totalResultValueLabel.setText(((Integer)model.getResultRows()).toString());
+        toDisplayValueTextField.setText(((Integer)model.getDisplayRows()).toString());
+        displayedValueLabel.setText(model.getCurrentDisplayRows());
     }
     
-    public void update(Observable observable, Object object)
-    {
+    /**
+     *  Shows and inicialize actual data or hides this dialog depending on the value of parameter visible. 
+     *  @param visible if true, shows this component and initialize actual data; otherwise, hides this component
+     */
+    public void setVisible(boolean visible) {
+    	if (visible) initialize();
+    	super.setVisible(visible);
     }
     
      /**
-     *
+     *  Close this dialog.
      */
     public void close() {
         dispose();
     }
     
-    /**Rows to display */
+    /**
+     *  Get the number of rows to display per page
+     *  @return number of rows to display per page
+     */ 
     public Integer getDisplayRows() { 
         Integer countRows;
         try {
@@ -69,34 +107,18 @@
         return countRows;
     }
     
-    /**Rows to display*/
+    /**
+     *  Set the number of rows to display per page
+     *  @param value number of rows to display per page
+     */  
     public void setDisplayRows(Integer value) {
         this.toDisplayValueTextField.setText(value.toString());
     }  
-    
+       
     /**
-     * Display error message saying that no row of table has been selected.
+     *  Get the direction of sorting.
+     *  @return direction of sorting. 0 is ASCENDING, 1 is DESCENDING
      */
-    public void selectRowMessage() {
-    	JOptionPane.showMessageDialog(this, L10n.getString(&quot;Warning.EmptySelection&quot;), L10n.getString(&quot;Warning.EmptySelectionTitle&quot;), JOptionPane.WARNING_MESSAGE);               
-    }             
-    
-     public int messageDelete(String message) {
-    	int okCancle = JOptionPane.showConfirmDialog(this, L10n.getString(&quot;Question.DropUser&quot;), L10n.getString(&quot;Question.DropUserTitle&quot;), JOptionPane.OK_CANCEL_OPTION);
-    	return okCancle;
-    }          
-    
-     /**
-     *  Display info message saying that no search field has been filled in.
-     */
-    public void showSearchInfoFillMessage() {
-        JOptionPane.showMessageDialog(this, L10n.getString(&quot;Information.SearchUser&quot;), L10n.getString(&quot;Information.SearchUserTitle&quot;), JOptionPane.INFORMATION_MESSAGE);       
-    }
-    
-    public void showSearchInfoMessage() {
-        JOptionPane.showMessageDialog(this, L10n.getString(&quot;Information.NoUserInResult&quot;), L10n.getString(&quot;Information.NoUserInResultTitle&quot;), JOptionPane.INFORMATION_MESSAGE);                
-    }
-     
      public int getSortDirection() {
         if (this.sortButtonGroup.isSelected(this.sortAscendingRadioButton.getModel()) == true) {
             return 0;
@@ -105,6 +127,10 @@
         }
     }
     
+     /**
+      * Get information about user selection - display all users or only active users
+      * @return zero if user want to display only active user, one in other way
+      */
       public int getShowUserDirection() {
         if (this.showUserbuttonGroup.isSelected(this.showAllUserRadioBUtton.getModel()) == true) {
             return 0;
@@ -113,7 +139,7 @@
         }
     }
      
-        /**
+     /**
      *  Check whether the given field is emty or not. This is used for validating user input when searching
      *  user.
      *
@@ -147,6 +173,14 @@
         JOptionPane.showMessageDialog(this, message, title, JOptionPane.ERROR_MESSAGE);               
     }
     
+    /**
+     *  Display generic error message.     
+     *  @param message error message we want to display
+     */
+    public void showErrorMessage(String message) {
+        JOptionPane.showMessageDialog(this, message, L10n.getString(&quot;Common.ErrorMessageTitle&quot;), JOptionPane.ERROR_MESSAGE);               
+    }
+    
       /**
      * Display warning message.
      * @param title title of warning message
@@ -223,6 +257,7 @@
 
         setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
         jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(L10n.getString(&quot;UserManager.UserList&quot;)));
+        jScrollPane1.getViewport().setBackground(Color.WHITE);
         tableUserList.setModel(new javax.swing.table.DefaultTableModel(
             new Object [][] {
                 {null, null, null, null},
@@ -234,6 +269,7 @@
                 &quot;Title 1&quot;, &quot;Title 2&quot;, &quot;Title 3&quot;, &quot;Title 4&quot;
             }
         ));
+        TransferFocus.patch(tableUserList);
         jScrollPane1.setViewportView(tableUserList);
 
         previousButton.setText(L10n.getString(&quot;UserManager.ButtonPrev&quot;));
@@ -271,7 +307,7 @@
                         .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                             .add(jPanel1Layout.createSequentialGroup()
                                 .add(previousButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 6, Short.MAX_VALUE)
                                 .add(totalResultLabel)
                                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                 .add(totalResultValueLabel)
@@ -295,24 +331,24 @@
                         .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                             .add(deleteButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 110, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                             .add(nextButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
-                    .add(jScrollPane1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 725, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                    .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 732, Short.MAX_VALUE))
                 .addContainerGap())
         );
         jPanel1Layout.setVerticalGroup(
             jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel1Layout.createSequentialGroup()
                 .addContainerGap()
-                .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 227, Short.MAX_VALUE)
+                .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 213, Short.MAX_VALUE)
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(totalResultLabel)
                     .add(toDisplayedLabel)
                     .add(displayedLabel)
-                    .add(totalResultValueLabel)
                     .add(toDisplayValueTextField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                     .add(displayedValueLabel)
                     .add(previousButton)
-                    .add(nextButton))
+                    .add(nextButton)
+                    .add(totalResultValueLabel))
                 .add(15, 15, 15)
                 .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(detailsButton)
@@ -403,7 +439,7 @@
                 .add(showAllUserRadioBUtton)
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(showCurrentUserRadioButton)
-                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                .addContainerGap(17, Short.MAX_VALUE))
         );
 
         org.jdesktop.layout.GroupLayout jPanel2Layout = new org.jdesktop.layout.GroupLayout(jPanel2);
@@ -419,17 +455,17 @@
                             .add(wholeNameLabel))
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                            .add(loginSearchText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 79, Short.MAX_VALUE)
-                            .add(wholeNameSearchText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 79, Short.MAX_VALUE))
+                            .add(loginSearchText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 85, Short.MAX_VALUE)
+                            .add(wholeNameSearchText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 85, Short.MAX_VALUE))
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                             .add(emailLabel)
                             .add(addressLabel))
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                            .add(addressSearchText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 98, Short.MAX_VALUE)
-                            .add(emailSearchText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 98, Short.MAX_VALUE)))
-                    .add(searchButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 120, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                            .add(addressSearchText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 104, Short.MAX_VALUE)
+                            .add(emailSearchText, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 104, Short.MAX_VALUE)))
+                    .add(searchButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 110, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                 .add(17, 17, 17)
                 .add(showActiveUserPanel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
@@ -439,11 +475,9 @@
         jPanel2Layout.setVerticalGroup(
             jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(jPanel2Layout.createSequentialGroup()
-                .addContainerGap()
-                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
-                    .add(jPanel3, 0, 88, Short.MAX_VALUE)
-                    .add(org.jdesktop.layout.GroupLayout.LEADING, showActiveUserPanel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
-                    .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel2Layout.createSequentialGroup()
+                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
+                    .add(jPanel2Layout.createSequentialGroup()
+                        .addContainerGap()
                         .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                             .add(emailLabel)
                             .add(emailSearchText, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
@@ -456,8 +490,10 @@
                             .add(wholeNameLabel)
                             .add(wholeNameSearchText, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                         .add(16, 16, 16)
-                        .add(searchButton)))
-                .addContainerGap())
+                        .add(searchButton))
+                    .add(jPanel3, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                    .add(showActiveUserPanel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                .add(5, 5, 5))
         );
 
         org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
@@ -470,18 +506,18 @@
                     .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                     .add(org.jdesktop.layout.GroupLayout.LEADING, layout.createSequentialGroup()
                         .add(helpButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 556, Short.MAX_VALUE)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 568, Short.MAX_VALUE)
                         .add(closeButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 100, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
-                    .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 756, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                    .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                 .addContainerGap())
         );
         layout.setVerticalGroup(
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
-                .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                .add(jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                 .add(15, 15, 15)
                 .add(jPanel2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 129, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(helpButton)
                     .add(closeButton))

Added: trunk/src/net/sf/plantlore/common/DefaultEscapeKeyPressed.java
===================================================================
--- trunk/src/net/sf/plantlore/common/DefaultEscapeKeyPressed.java	2006-08-08 12:05:06 UTC (rev 495)
+++ trunk/src/net/sf/plantlore/common/DefaultEscapeKeyPressed.java	2006-08-08 16:12:12 UTC (rev 496)
@@ -0,0 +1,56 @@
+package net.sf.plantlore.common;
+
+import java.awt.event.KeyEvent;
+import java.awt.event.KeyListener;
+import javax.swing.JDialog;
+import javax.swing.JFrame;
+
+/**     
+ * KeyListener class controlling the pressing key ESCAPE. On key ESCAPE hides the view dialog.   
+ * &lt;br/&gt;
+ * The use is very simple (in the controller):
+ * &lt;br/&gt;
+ * &lt;code&gt;myView.myButton.addKeyListener( new DefaultEscapeKeyPressed( myView ) ); &lt;/code&gt;
+ * &lt;br/&gt;
+ * 
+ *   @author Lada Oberreiterova
+ *   @version 1.0
+ */  
+public class DefaultEscapeKeyPressed implements KeyListener {
+
+	protected JDialog dialog;
+	protected JFrame frame;
+	
+	/**
+	 * Create new instance of DefaultEscapeKeyPressed
+	 * @param dialogView 
+	 */
+	public 	DefaultEscapeKeyPressed(JDialog dialogView) {
+		dialog = dialogView;		
+	}
+	
+	/**
+	 * Create new instance of DefaultEscapeKeyPressed
+	 * @param frameView
+	 */
+	public 	DefaultEscapeKeyPressed(JFrame frameView) {
+		frame = frameView;		
+	}
+	
+	/**
+	 * Invoked when a key has been pressed. On key ESCAPE hides the view dialog.
+	 * @param evt
+	 */
+ 	public void keyPressed(KeyEvent evt){
+ 		if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) { 			
+ 			if (dialog != null) {
+ 				dialog.setVisible(false);
+ 			} else if (frame != null) {
+ 				frame.setVisible(false);
+ 			}
+ 		}    	 		     	 		 
+ 	 }
+ 	
+     public void keyReleased(KeyEvent evt) {}    	     
+     public void keyTyped(KeyEvent evt) {}    	               
+}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000670.html">[Plantlore-dev] r495 - trunk/src/net/sf/plantlore/common
</A></li>
	<LI>Next message: <A HREF="000672.html">[Plantlore-dev] r497 - in trunk/src/net/sf/plantlore: common server	server/manager server/tools
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#671">[ date ]</a>
              <a href="thread.html#671">[ thread ]</a>
              <a href="subject.html#671">[ subject ]</a>
              <a href="author.html#671">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
