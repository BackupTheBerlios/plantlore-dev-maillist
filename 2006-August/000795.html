<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r578 - in trunk/src/net/sf/plantlore: client	client/export client/export/component client/history	client/login client/overview client/overview/detail	client/overview/search client/overview/tree	client/tableimport client/tableimport/parsers common	common/record config/hibernate server
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-August/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r578%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%0A%09client/export%20client/export/component%20client/history%0A%09client/login%20client/overview%20client/overview/detail%0A%09client/overview/search%20client/overview/tree%0A%09client/tableimport%20client/tableimport/parsers%20common%0A%09common/record%20config/hibernate%20server&In-Reply-To=%3C200608271135.k7RBZL2n003855%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000794.html">
   <LINK REL="Next"  HREF="000796.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r578 - in trunk/src/net/sf/plantlore: client	client/export client/export/component client/history	client/login client/overview client/overview/detail	client/overview/search client/overview/tree	client/tableimport client/tableimport/parsers common	common/record config/hibernate server</H1>
    <B>krater at mail.berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r578%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%0A%09client/export%20client/export/component%20client/history%0A%09client/login%20client/overview%20client/overview/detail%0A%09client/overview/search%20client/overview/tree%0A%09client/tableimport%20client/tableimport/parsers%20common%0A%09common/record%20config/hibernate%20server&In-Reply-To=%3C200608271135.k7RBZL2n003855%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r578 - in trunk/src/net/sf/plantlore: client	client/export client/export/component client/history	client/login client/overview client/overview/detail	client/overview/search client/overview/tree	client/tableimport client/tableimport/parsers common	common/record config/hibernate server">krater at mail.berlios.de
       </A><BR>
    <I>Sun Aug 27 13:35:21 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000794.html">[Plantlore-dev] [Bug #8589] Improve author role handling
</A></li>
        <LI>Next message: <A HREF="000796.html">[Plantlore-dev] r579 - in trunk/src/net/sf/plantlore: client	client/export client/history client/login client/metadata	client/user middleware server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#795">[ date ]</a>
              <a href="thread.html#795">[ thread ]</a>
              <a href="subject.html#795">[ subject ]</a>
              <a href="author.html#795">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: krater
Date: 2006-08-27 13:34:58 +0200 (Sun, 27 Aug 2006)
New Revision: 578

Added:
   trunk/src/net/sf/plantlore/common/record/NearestVillage.java
Removed:
   trunk/src/net/sf/plantlore/common/record/Village.java
Modified:
   trunk/src/net/sf/plantlore/client/AppCore.java
   trunk/src/net/sf/plantlore/client/export/ExportMng2.java
   trunk/src/net/sf/plantlore/client/export/component/ExtendedTree.java
   trunk/src/net/sf/plantlore/client/history/History.java
   trunk/src/net/sf/plantlore/client/login/AuthCtrl.java
   trunk/src/net/sf/plantlore/client/login/ItemCtrl2.java
   trunk/src/net/sf/plantlore/client/login/Login.java
   trunk/src/net/sf/plantlore/client/overview/AddEdit.java
   trunk/src/net/sf/plantlore/client/overview/JasperDataSource.java
   trunk/src/net/sf/plantlore/client/overview/OverviewTableModel.java
   trunk/src/net/sf/plantlore/client/overview/detail/Detail.java
   trunk/src/net/sf/plantlore/client/overview/search/Search.java
   trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java
   trunk/src/net/sf/plantlore/client/tableimport/TableImportTask.java
   trunk/src/net/sf/plantlore/client/tableimport/parsers/UnifiedTableParser.java
   trunk/src/net/sf/plantlore/common/DBLayerUtils.java
   trunk/src/net/sf/plantlore/common/PlantloreConstants.java
   trunk/src/net/sf/plantlore/common/record/Author.java
   trunk/src/net/sf/plantlore/common/record/AuthorOccurrence.java
   trunk/src/net/sf/plantlore/common/record/Deletable.java
   trunk/src/net/sf/plantlore/common/record/Habitat.java
   trunk/src/net/sf/plantlore/common/record/Occurrence.java
   trunk/src/net/sf/plantlore/common/record/Publication.java
   trunk/src/net/sf/plantlore/common/record/Record.java
   trunk/src/net/sf/plantlore/config/hibernate/Habitats.hbm.xml
   trunk/src/net/sf/plantlore/config/hibernate/Villages.hbm.xml
   trunk/src/net/sf/plantlore/server/HibernateDBLayer.java
Log:
Village.java renamed to NearestVillage.java. Something that should have been done a long time ago.

Modified: trunk/src/net/sf/plantlore/client/AppCore.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCore.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/AppCore.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -32,7 +32,7 @@
 import net.sf.plantlore.common.record.Right;
 import net.sf.plantlore.common.record.Territory;
 import net.sf.plantlore.common.record.User;
-import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.common.record.NearestVillage;
 import net.sf.plantlore.l10n.L10n;
 
 // Imports for temporary db access
@@ -458,10 +458,10 @@
         Object[] row;
 
         setChanged(); notifyObservers(&quot;LOADING_VILLAGES&quot;);
-        sq = database.createQuery(Village.class);
-        sq.addOrder(PlantloreConstants.DIRECT_ASC, Village.NAME);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY, Village.NAME);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY, Village.ID);
+        sq = database.createQuery(NearestVillage.class);
+        sq.addOrder(PlantloreConstants.DIRECT_ASC, NearestVillage.NAME);
+        sq.addProjection(PlantloreConstants.PROJ_PROPERTY, NearestVillage.NAME);
+        sq.addProjection(PlantloreConstants.PROJ_PROPERTY, NearestVillage.ID);
         resultid = database.executeQuery(sq);
         resultsCount = database.getNumRows(resultid);
         records = database.more(resultid, 0, resultsCount-1);

Modified: trunk/src/net/sf/plantlore/client/export/ExportMng2.java
===================================================================
--- trunk/src/net/sf/plantlore/client/export/ExportMng2.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/export/ExportMng2.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -271,7 +271,7 @@
 			else
 				template.addProjections( query, 
 					Occurrence.class, Plant.class, Metadata.class, Publication.class, 
-					Habitat.class, Territory.class, Village.class, Phytochorion.class );
+					Habitat.class, Territory.class, NearestVillage.class, Phytochorion.class );
 		}
 		
 		// Create a new file and writer (wrapper).

Modified: trunk/src/net/sf/plantlore/client/export/component/ExtendedTree.java
===================================================================
--- trunk/src/net/sf/plantlore/client/export/component/ExtendedTree.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/export/component/ExtendedTree.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -106,8 +106,8 @@
 				new UserTreeNode(Habitat.class, Habitat.QUADRANT),
 				new UserTreeNode(Habitat.class, Habitat.DESCRIPTION),
 				new Object[] { // NEAREST VILLAGE
-					new UserTreeNode(Village.class, null),
-					new UserTreeNode(Village.class, Village.NAME, true)
+					new UserTreeNode(NearestVillage.class, null),
+					new UserTreeNode(NearestVillage.class, NearestVillage.NAME, true)
 				},
 				new UserTreeNode(Habitat.class, Habitat.COUNTRY),
 				new UserTreeNode(Habitat.class, Habitat.ALTITUDE),
@@ -212,8 +212,8 @@
 			new UserTreeNode(Phytochorion.class, Phytochorion.NAME, true),
 		},
 		new Object[] { // NEAREST VILLAGE
-			new UserTreeNode(Village.class, null),
-			new UserTreeNode(Village.class, Village.NAME, true)
+			new UserTreeNode(NearestVillage.class, null),
+			new UserTreeNode(NearestVillage.class, NearestVillage.NAME, true)
 		},
 		new Object[] { // HABITAT
 			new UserTreeNode(Habitat.class, null),

Modified: trunk/src/net/sf/plantlore/client/history/History.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/History.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/history/History.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -33,7 +33,7 @@
 import net.sf.plantlore.common.record.Publication;
 import net.sf.plantlore.common.record.Record;
 import net.sf.plantlore.common.record.Territory;
-import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.common.record.NearestVillage;
 import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.middleware.SelectQuery;
@@ -901,15 +901,15 @@
                 logger.debug(&quot;Set selected value for update of attribute Longitude.&quot;);                
                 break;
         case 7: //Nearest bigger seat   	                	 	                			                		 
-                //Select record Village where id = oldRocordId 
+                //Select record NearestVillage where id = oldRocordId 
                 if (oldRecordId != 0){
                         Object[] objectVill = searchObject(PlantloreConstants.ENTITY_VILLAGE,oldRecordId);
                         if (isError()) return; //tVillage doesn`t contain required data
-                        Village village = (Village)objectVill[0];
+                        NearestVillage village = (NearestVillage)objectVill[0];
                 hab.setNearestVillage(village);
                 logger.debug(&quot;Set selected value for update of attribute NearesVillage.&quot;);
                 } else {
-                        logger.error(&quot;UNDO - Incorrect oldRecordId for Village.&quot;);
+                        logger.error(&quot;UNDO - Incorrect oldRecordId for NearestVillage.&quot;);
                 }                
             break;
         case 8: //Phytochorion or phytochorion code 	                	             			                		 
@@ -1272,34 +1272,34 @@
     public void undoVillage() {
        
     	int villageId = historyChange.getRecordId();	        
-        Village village = null;
+        NearestVillage village = null;
     	int placings = 0;
     	boolean contain = false;
     	for (int i=0; i &lt; editObjectList.size(); i++) {
-    		if (editObjectList.get(i) instanceof Village) {    			
-    			int listVillId = ((Village)(editObjectList.get(i))).getId();
+    		if (editObjectList.get(i) instanceof NearestVillage) {    			
+    			int listVillId = ((NearestVillage)(editObjectList.get(i))).getId();
     			if (villageId == listVillId) {
     				contain = true;
     				placings = i; 
-    				village = (Village)(editObjectList.get(i));
+    				village = (NearestVillage)(editObjectList.get(i));
     				break;
     			}
     		}
     	} 
     	
     	if (!contain) {
-        	// Select record Village where id = villageId 
+        	// Select record NearestVillage where id = villageId 
     		Object[] object = searchObject(PlantloreConstants.ENTITY_VILLAGE, villageId);
     		if (isError()) return; //tVillage doesn`t contain required data
-            village = (Village)object[0];     
+            village = (NearestVillage)object[0];     
         }
        
        // Save new value for the column
         if (columnName.equals(&quot;nameVillage&quot;)) {
             village.setName(oldValue);	                 
-            logger.debug(&quot;Village - Set selected value for update of attribute Name.&quot;);                 	
+            logger.debug(&quot;NearestVillage - Set selected value for update of attribute Name.&quot;);                 	
         } else {
-            logger.error(&quot;Village - No column defined for name &quot;+ columnName);	                   
+            logger.error(&quot;NearestVillage - No column defined for name &quot;+ columnName);	                   
         }   
         
         if (contain) {        	
@@ -1386,8 +1386,8 @@
                 query = database.createQuery(Publication.class);
                 query.addRestriction(PlantloreConstants.RESTR_EQ, Publication.ID, null, id , null);
             } else if (typeObject.equals(PlantloreConstants.ENTITY_VILLAGE)){
-                query = database.createQuery(Village.class);
-                query.addRestriction(PlantloreConstants.RESTR_EQ, Village.ID, null, id, null);
+                query = database.createQuery(NearestVillage.class);
+                query.addRestriction(PlantloreConstants.RESTR_EQ, NearestVillage.ID, null, id, null);
             }  else if  (typeObject.equals(PlantloreConstants.ENTITY_TERRITORY)){
                 query = database.createQuery(Territory.class);
                 query.addRestriction(PlantloreConstants.RESTR_EQ, Territory.ID, null, id , null);
@@ -1776,12 +1776,12 @@
               detailsMessage = L10n.getString(&quot;History.DetailsTerritory&quot;) + &quot;\n\n&quot;;
               detailsMessage = detailsMessage + L10n.getString(PlantloreConstants.ENTITY_TERRITORY +&quot;.&quot;+ Territory.NAME) + &quot;: &quot; + territory.getName() + &quot;\n&quot;;
         } else if (tableName.equals(PlantloreConstants.ENTITY_VILLAGE)) {
-              //Get details for Village
+              //Get details for NearestVillage
               Object[] object = searchObject(PlantloreConstants.ENTITY_VILLAGE,recordId);
               if (isError()) return &quot;&quot;; //tVillage doesn`t contain required data
-              Village village = (Village)object[0];
+              NearestVillage village = (NearestVillage)object[0];
               detailsMessage = L10n.getString(&quot;History.detailsVillage&quot;) + &quot;\n\n&quot;;
-              detailsMessage = detailsMessage + L10n.getString(PlantloreConstants.ENTITY_VILLAGE +&quot;.&quot;+ Village.NAME) + &quot;: &quot; + village.getName() + &quot;\n&quot;;
+              detailsMessage = detailsMessage + L10n.getString(PlantloreConstants.ENTITY_VILLAGE +&quot;.&quot;+ NearestVillage.NAME) + &quot;: &quot; + village.getName() + &quot;\n&quot;;
         } else {
             logger.error(&quot;No table defined&quot;);
             detailsMessage = &quot;No details for selected row.&quot;;
@@ -1994,7 +1994,7 @@
         editTypeHash.put(&quot;Author&quot;, PlantloreConstants.Table.AUTHOR);
         editTypeHash.put(&quot;Metadata&quot;, PlantloreConstants.Table.METADATA);
         editTypeHash.put(&quot;Publication&quot;, PlantloreConstants.Table.PUBLICATION);
-        editTypeHash.put(&quot;Village&quot;, PlantloreConstants.Table.VILLAGE);
+        editTypeHash.put(&quot;NearestVillage&quot;, PlantloreConstants.Table.VILLAGE);
         editTypeHash.put(&quot;Territory&quot;, PlantloreConstants.Table.TERRITORY);
         editTypeHash.put(&quot;Phytochorion&quot;, PlantloreConstants.Table.PHYTOCHORION);        
     }

Modified: trunk/src/net/sf/plantlore/client/login/AuthCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/AuthCtrl.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/login/AuthCtrl.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -39,10 +39,14 @@
 				@Override
 				public void exceptionHandler(Exception ex) {
 					getTask().stop();
+					
+//					if(ex instanceof DBLayerException)
+//						System.out.println(((DBLayerException)e).getErrorCode());
+					
 					JOptionPane.showMessageDialog( 
 							parent, 
 							ex.getMessage(), 
-							L10n.getString(&quot;Error.General&quot;), 
+							L10n.getString(&quot;Error.ConnectionFailed&quot;), 
 							JOptionPane.ERROR_MESSAGE );
 				}
 			};

Modified: trunk/src/net/sf/plantlore/client/login/ItemCtrl2.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/ItemCtrl2.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/login/ItemCtrl2.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -12,7 +12,7 @@
 	private Login model;
 	private ItemView2 view;
 	
-	public enum Mode { ADD, EDIT };
+	public enum Mode { ADD, EDIT }
 	
 	private Mode mode = Mode.ADD;
 	

Modified: trunk/src/net/sf/plantlore/client/login/Login.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/Login.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/login/Login.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -397,7 +397,7 @@
 			// Everything went fine - 
 			// there is a new DBLayer which is to be announced to the observers of Login.
 			announceConnection();
-
+			
 			return null;
 		}
 		

Modified: trunk/src/net/sf/plantlore/client/overview/AddEdit.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -35,7 +35,7 @@
 import net.sf.plantlore.common.record.Record;
 import net.sf.plantlore.common.record.Territory;
 import net.sf.plantlore.common.record.User;
-import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.common.record.NearestVillage;
 import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.middleware.SelectQuery;
@@ -317,7 +317,7 @@
 
     public void setVillage(Pair&lt;String, Integer&gt; village) {
         this.village = village;
-        logger.debug(&quot;Village set to &quot;+village);
+        logger.debug(&quot;NearestVillage set to &quot;+village);
     }
 
     public String getTaxon(int i) {
@@ -743,7 +743,7 @@
      */
     private void prepareOccurrenceUpdate(boolean updateAllPlants) throws DBLayerException, RemoteException {
         Habitat h;
-        Village v;
+        NearestVillage v;
         Phytochorion p;
         Territory t;
         Metadata m;
@@ -757,7 +757,7 @@
             h = new Habitat();
         
         
-        v = (Village)dlu.getObjectFor(village.getSecond(),Village.class);
+        v = (NearestVillage)dlu.getObjectFor(village.getSecond(),NearestVillage.class);
         p = (Phytochorion)dlu.getObjectFor(phytCode.getSecond(),Phytochorion.class);
         t = (Territory)dlu.getObjectFor(territoryName.getSecond(),Territory.class);
 
@@ -1033,11 +1033,11 @@
                     newOccurrenceInserted = false;
                     
                 } else { //Add Mode
-                    Village v;
+                    NearestVillage v;
                     Phytochorion p;
                     Territory t;
                     Habitat h = new Habitat();
-                    v = (Village)dlu.getObjectFor(village.getSecond(),Village.class);
+                    v = (NearestVillage)dlu.getObjectFor(village.getSecond(),NearestVillage.class);
                     p = (Phytochorion)dlu.getObjectFor(phytCode.getSecond(),Phytochorion.class);
                     t = (Territory)dlu.getObjectFor(territoryName.getSecond(),Territory.class);                    
                     if (altitude != null) h.setAltitude(altitude);

Modified: trunk/src/net/sf/plantlore/client/overview/JasperDataSource.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/JasperDataSource.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/overview/JasperDataSource.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -34,7 +34,7 @@
 import net.sf.plantlore.common.record.Right;
 import net.sf.plantlore.common.record.Territory;
 import net.sf.plantlore.common.record.User;
-import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.common.record.NearestVillage;
 import net.sf.plantlore.middleware.DBLayer;
 import org.apache.log4j.Logger;
 
@@ -218,7 +218,7 @@
                 value = occurrence.getValue(User.class,column);
                 break;
             case VILLAGE:
-                value = occurrence.getValue(Village.class,column);
+                value = occurrence.getValue(NearestVillage.class,column);
                 break;
             default:
                 logger.error(&quot;Table type &quot;+table+&quot; is not handled properly in JasperDataSource!&quot;);
@@ -255,7 +255,7 @@
             case USER:
                 return new User().getColumns();
             case VILLAGE:
-                return new Village().getColumns();
+                return new NearestVillage().getColumns();
             default:
                 logger.error(&quot;Table type &quot;+table+&quot; is not handled properly in JasperDataSource!&quot;);
                 throw new JRException(&quot;Table type &quot;+table+&quot; is not handled properly in JasperDataSource!&quot;);

Modified: trunk/src/net/sf/plantlore/client/overview/OverviewTableModel.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/OverviewTableModel.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/overview/OverviewTableModel.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -23,7 +23,7 @@
 import net.sf.plantlore.common.record.Phytochorion;
 import net.sf.plantlore.common.record.Plant;
 import net.sf.plantlore.common.record.Territory;
-import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.common.record.NearestVillage;
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.common.exception.DBLayerException;
 import net.sf.plantlore.middleware.SelectQuery;

Modified: trunk/src/net/sf/plantlore/client/overview/detail/Detail.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/detail/Detail.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/overview/detail/Detail.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -27,7 +27,7 @@
 import net.sf.plantlore.common.record.Publication;
 import net.sf.plantlore.common.record.Territory;
 import net.sf.plantlore.common.record.User;
-import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.common.record.NearestVillage;
 import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.middleware.SelectQuery;
@@ -112,7 +112,7 @@
         sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.DESCRIPTION);                    
         sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.NOTE);
         sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.QUADRANT);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;vill.&quot;+Village.NAME);
+        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;vill.&quot;+NearestVillage.NAME);
         sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;metadata.&quot;+Metadata.DATASETTITLE);
         sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;phyt.&quot;+Phytochorion.CODE);                    
         sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;phyt.&quot;+Phytochorion.NAME);                    

Modified: trunk/src/net/sf/plantlore/client/overview/search/Search.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/search/Search.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/overview/search/Search.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -32,7 +32,7 @@
 import net.sf.plantlore.common.record.Publication;
 import net.sf.plantlore.common.record.Record;
 import net.sf.plantlore.common.record.Territory;
-import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.common.record.NearestVillage;
 import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.middleware.SelectQuery;
@@ -143,7 +143,7 @@
 
     public void setVillage(Pair&lt;String, Integer&gt; village) {
         this.village = village;
-        logger.debug(&quot;Village set to &quot;+village);
+        logger.debug(&quot;NearestVillage set to &quot;+village);
     }
 
     public String getTaxon(int i) {
@@ -585,7 +585,7 @@
     	 // Add publications using LEFT OUTER JOIN - so that occurrences without a publication are displayed as well!
         exportQuery.createAlias(Occurrence.PUBLICATION, Record.alias(Publication.class), PlantloreConstants.LEFT_OUTER_JOIN);
     	exportQuery.createAlias(habitatAlias+Habitat.TERRITORY, Record.alias(Territory.class));
-    	exportQuery.createAlias(habitatAlias+Habitat.NEARESTVILLAGE, Record.alias(Village.class));
+    	exportQuery.createAlias(habitatAlias+Habitat.NEARESTVILLAGE, Record.alias(NearestVillage.class));
     	exportQuery.createAlias(habitatAlias+Habitat.PHYTOCHORION, Record.alias(Phytochorion.class));
     	exportQuery.addOrder(PlantloreConstants.DIRECT_ASC, Occurrence.YEARCOLLECTED);
     	for( Restriction restriction : restrictions ) {
@@ -657,7 +657,7 @@
                             sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.LONGITUDE);
                             break;
                         case HABITAT_NEAREST_VILLAGE_NAME:
-                            sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;vill.&quot;+Village.NAME);
+                            sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;vill.&quot;+NearestVillage.NAME);
                             break;
                         case HABITAT_NOTE:
                             sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.NOTE);
@@ -716,7 +716,7 @@
                 }
                 
                 if (isNotEmpty(village)) {
-                	arg = dlu.getObjectFor(village.getSecond(),Village.class);
+                	arg = dlu.getObjectFor(village.getSecond(),NearestVillage.class);
                     sq.addRestriction(PlantloreConstants.RESTR_EQ,&quot;habitat.&quot;+Habitat.NEARESTVILLAGE,null,arg,null);
                     restrictions.add(new Restriction(RESTR_EQ, habitatAlias+Habitat.NEARESTVILLAGE, arg));
                 }

Modified: trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -26,7 +26,7 @@
 import net.sf.plantlore.common.record.Occurrence;
 import net.sf.plantlore.common.record.Phytochorion;
 import net.sf.plantlore.common.record.Territory;
-import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.common.record.NearestVillage;
 import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.middleware.SelectQuery;
@@ -162,7 +162,7 @@
         DefaultMutableTreeNode node;
         for (Object record : records) {
             Object[] obj = (Object[])record;
-            String name = ((Village)obj[2]).getName() + &quot; - &quot; + obj[1] + &quot; (quadrant &quot; + obj[3] + &quot;)&quot;;
+            String name = ((NearestVillage)obj[2]).getName() + &quot; - &quot; + obj[1] + &quot; (quadrant &quot; + obj[3] + &quot;)&quot;;
             name = &quot;(&quot;+getOccurrenceCount((Integer)obj[0])+&quot;) &quot;+name;
             node = new DefaultMutableTreeNode(new NodeInfo(NodeInfo.NodeType.HABITAT,name,(Integer)obj[0],-1));
             treeModel.insertNodeInto(node, phytNode,0);

Modified: trunk/src/net/sf/plantlore/client/tableimport/TableImportTask.java
===================================================================
--- trunk/src/net/sf/plantlore/client/tableimport/TableImportTask.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/tableimport/TableImportTask.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -33,7 +33,7 @@
 	private DBLayerUtils dbutils;
 	
 //	private static Set&lt;Class&gt; supportedTables = new HashSet&lt;Class&gt;(
-//			Arrays.asList(Metadata.class, Plant.class, Village.class, Phytochorion.class, Territory.class));
+//			Arrays.asList(Metadata.class, Plant.class, NearestVillage.class, Phytochorion.class, Territory.class));
 	
 	/**
 	 * 

Modified: trunk/src/net/sf/plantlore/client/tableimport/parsers/UnifiedTableParser.java
===================================================================
--- trunk/src/net/sf/plantlore/client/tableimport/parsers/UnifiedTableParser.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/client/tableimport/parsers/UnifiedTableParser.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -30,7 +30,7 @@
 	static {
 		tables.put( &quot;plants&quot;, Plant.class);
 		tables.put( &quot;metadata&quot;, Metadata.class);
-		tables.put( &quot;villages&quot;, Village.class);
+		tables.put( &quot;villages&quot;, NearestVillage.class);
 		tables.put( &quot;phytochoria&quot;, Phytochorion.class);
 		tables.put( &quot;territories&quot;, Territory.class);
 	}

Modified: trunk/src/net/sf/plantlore/common/DBLayerUtils.java
===================================================================
--- trunk/src/net/sf/plantlore/common/DBLayerUtils.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/DBLayerUtils.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -31,7 +31,7 @@
 import net.sf.plantlore.common.record.Plant;
 import net.sf.plantlore.common.record.Record;
 import net.sf.plantlore.common.record.Territory;
-import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.common.record.NearestVillage;
 import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.middleware.SelectQuery;
@@ -64,7 +64,7 @@
 	private static Map&lt;Class, String&gt; parentColumn = new Hashtable&lt;Class, String&gt;();
 	
 	static {
-		parentTable.put(Village.class, Habitat.class);
+		parentTable.put(NearestVillage.class, Habitat.class);
 		parentTable.put(Phytochorion.class, Habitat.class);
 		parentTable.put(Territory.class, Habitat.class);
 		parentTable.put(Metadata.class, Occurrence.class);
@@ -74,7 +74,7 @@
 		// &gt;&gt;Occurrence&lt;&lt; MUST NOT BE LISTED HERE!
 		// It would cause problems with DELETE and INSERT...
 
-		parentColumn.put(Village.class, Habitat.NEARESTVILLAGE);
+		parentColumn.put(NearestVillage.class, Habitat.NEARESTVILLAGE);
 		parentColumn.put(Phytochorion.class, Habitat.PHYTOCHORION);
 		parentColumn.put(Territory.class, Habitat.TERRITORY);
 		parentColumn.put(Metadata.class, Occurrence.METADATA);
@@ -268,7 +268,7 @@
 			q = db.createQuery( parent );
 			q.addRestriction(RESTR_EQ, column, null, record, null);
 			if( aliveOnly &amp;&amp; record instanceof Deletable )
-				q.addRestriction(RESTR_EQ, &quot;DELETED&quot;, null, 0, null);
+				q.addRestriction(RESTR_EQ, Deletable.DELETED, null, 0, null);
 			int resultset = db.executeQuery(q); 
 			rows = db.getNumRows(resultset);
 		} finally {
@@ -304,7 +304,7 @@
 			q = db.createQuery(AuthorOccurrence.class);
 			q.addRestriction(RESTR_EQ, AuthorOccurrence.OCCURRENCE, null, occurrence, null);
 			if( aliveOnly )
-				q.addRestriction(RESTR_EQ, AuthorOccurrence.DELETED, null, 0, null);
+				q.addRestriction(RESTR_EQ, Deletable.DELETED, null, 0, null);
 			int resultset = db.executeQuery(q),
 			rows = db.getNumRows(resultset);
 			if(rows &gt; 0) {
@@ -330,7 +330,7 @@
 	 * There are occurrences &lt;i&gt;A&lt;/i&gt; and &lt;i&gt;B&lt;/i&gt;. The &lt;i&gt;B&lt;/i&gt;
 	 * goes right after &lt;i&gt;A&lt;/i&gt;.
 	 * The probability, that both occurrences will share the same
-	 * Phytochorion, Territory, Village, Publication, or Metadata,
+	 * Phytochorion, Territory, NearestVillage, Publication, or Metadata,
 	 * is quite high. 
 	 * &lt;br/&gt;
 	 * However, if the cache is not used for some time, its contents may
@@ -356,6 +356,8 @@
 		// Get the table.
 		Class table = record.getClass();
 		
+		logger.debug(&quot;Finding match for &quot; + record.toFullString());
+		
 		// Look in the cache.
 		if(isCacheEnabled) {
 			Record cachedRecord = cache.get(table);
@@ -365,6 +367,8 @@
 				
 		// Create a query that will look for the record with the same properties.
 		SelectQuery query = db.createQuery( table );
+		
+		logger.debug(&quot;Table is &quot; + table.getSimpleName());
 
 		try {
 			// Equal properties.
@@ -379,6 +383,9 @@
 				query.addRestriction(RESTR_EQ, key, null, subrecord, null);
 			}
 			
+			
+			
+			
 			// Is there such record?
 			int results = db.executeQuery( query );
 			int rows = db.getNumRows( results );
@@ -906,8 +913,11 @@
 			throw new DBLayerException(L10n.getString(&quot;Error.IncompleteRecord&quot;));
 		}
 		
+		logger.debug(&quot;Processing new occurrence data [&quot; + occ.toFullString() + &quot;].&quot;);
+		
 		// If the record is dead, then it is clearly meant to be deleted!
 		Intention intention =  occ.isDead() ? Intention.DELETE : Intention.UNKNOWN; 
+		logger.debug(&quot;The intention with the data is &quot; + intention);
 			
 		boolean isInDB, isDead;
 		Occurrence occInDB;
@@ -927,12 +937,16 @@
 			isInDB = (rows != 0);
 			occInDB = isInDB ? (Occurrence)((Object[])db.more(resultId, 0, 0)[0])[0]  :  null;
 			isDead = isInDB ? occInDB.isDead() : false;
+			
+			logger.debug(&quot;Matching record found? &quot; + isInDB +&quot; Is dead? &quot; + isDead);
+			
 		} finally {
 			db.closeQuery(q);	
 		}
 			
 		// Begin a new transaction.
 		db.beginTransaction();
+		logger.debug(&quot;Performing the reqested operation...&quot;);
 			
 		try {
 			// The `occ` IS in the database as `occInDB` already.  
@@ -967,7 +981,7 @@
 					occInDB = (Occurrence) insert( occ );
 				}
 			
-			
+			logger.debug(&quot;Occurrence processed. About to start processing author-occurrences...&quot;);
 			// Now, deal with Authors associated with this Occurrence.
 			int numberOfUndeadAuthors = 0; 
 			
@@ -980,6 +994,7 @@
 			// The intention was to ADD or UPDATE the existing Occurrence record.  
 			else {
 				AuthorOccurrence[] aosInDB = new AuthorOccurrence[0];
+				logger.debug(&quot;Loading all authors of the occurrence record from the database...&quot;);
 				if( isInDB ) 
 					aosInDB = findAllAuthors(occInDB, false);
 				// Compute the number of undead authors (authors, that are not marked as deleted). 
@@ -994,18 +1009,22 @@
 						continue;
 					}
 					
+					logger.debug(&quot;The AO seems ok. See [&quot; + ao.toFullString() + &quot;].&quot;);
+					
 					// Simplify the comparison (the Occurrence is known...)
 					ao.setOccurrence( null );
 					
 					// Check if that AuthorOccurrence is already in the database.
 					AuthorOccurrence aoInDB = null;
 					for( AuthorOccurrence alpha : aosInDB ) {
-						if( alpha.equalsUpTo( ao, AuthorOccurrence.DELETED ) ) {
+						if( alpha.equalsUpTo( ao, Deletable.DELETED ) ) {
 							aoInDB = alpha;
 							break;
 						}
 					}
 					
+					logger.debug(&quot;Is the AO in the database already? &quot; + aoInDB != null);
+					
 					//	The Occurrence `occInDB` is in the database, that is for sure.
 					// The ao.Occurrence, however, is NOT from the database.
 					ao.setOccurrence( occInDB ); // now it's fine
@@ -1013,6 +1032,8 @@
 					// The intention with this AuthorOccurrence. 
 					intention = ao.isDead() ? Intention.DELETE : Intention.UNKNOWN;
 					
+					logger.debug(&quot;The intention with the AO is &quot; + intention);
+					
 
 					// [A] AO is not in the database.
 					if(aoInDB == null)
@@ -1041,6 +1062,8 @@
 								numberOfUndeadAuthors++;
 							}
 						}
+					
+					logger.debug(&quot;AO processed.&quot;);
 				}
 			
 				// Transaction is valid iff everything went fine and the number of undead authors is positive.
@@ -1049,6 +1072,7 @@
 					throw new DBLayerException(L10n.getString(&quot;Error.NoAuthorsLeft&quot;));
 				}
 				
+				logger.debug(&quot;Processing of the occurrence data completed.&quot;);
 				db.commitTransaction();
 			}
 			

Modified: trunk/src/net/sf/plantlore/common/PlantloreConstants.java
===================================================================
--- trunk/src/net/sf/plantlore/common/PlantloreConstants.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/PlantloreConstants.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -80,7 +80,7 @@
     	classToTable.put(Plant.class, Table.PLANT);
     	classToTable.put(Publication.class, Table.PUBLICATION);
     	classToTable.put(Territory.class, Table.TERRITORY);
-    	classToTable.put(Village.class, Table.VILLAGE);
+    	classToTable.put(NearestVillage.class, Table.VILLAGE);
     }
     
     

Modified: trunk/src/net/sf/plantlore/common/record/Author.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/Author.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/record/Author.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -47,7 +47,7 @@
     public static final String URL = &quot;url&quot;;
     public static final String NOTE = &quot;note&quot;;    
     public static final String CREATEDWHO = &quot;createdWho&quot;;    
-    public static final String DELETED = &quot;deleted&quot;;
+    //public static final String DELETED = &quot;deleted&quot;;
     
     /** Creates a new instance of AuthorRecord */
     public Author() {

Modified: trunk/src/net/sf/plantlore/common/record/AuthorOccurrence.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/AuthorOccurrence.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/record/AuthorOccurrence.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -38,7 +38,7 @@
     public static final String OCCURRENCE = &quot;occurrence&quot;;
     public static final String ROLE = &quot;role&quot;;
     public static final String NOTE = &quot;note&quot;;
-    public static final String DELETED = &quot;deleted&quot;;
+    //public static final String DELETED = &quot;deleted&quot;;
 
     private static Hashtable&lt;String,Integer&gt; columnSizes;
 

Modified: trunk/src/net/sf/plantlore/common/record/Deletable.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/Deletable.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/record/Deletable.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -4,6 +4,8 @@
 
 public interface Deletable extends Serializable {
 	
+	static final String DELETED = &quot;deleted&quot;;
+	
 	void setDeleted(Integer arg);
 	
 	Integer getDeleted();

Modified: trunk/src/net/sf/plantlore/common/record/Habitat.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/Habitat.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/record/Habitat.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -27,7 +27,7 @@
     private Integer id;
     private Territory territory;
     private Phytochorion phytochorion;    
-    private Village nearestVillage;    
+    private NearestVillage nearestVillage;    
     private String quadrant;
     private String description;
     private String country;
@@ -50,13 +50,11 @@
     public static final String ALTITUDE = &quot;altitude&quot;;
     public static final String LATITUDE = &quot;latitude&quot;;    
     public static final String LONGITUDE = &quot;longitude&quot;;    
-    public static final String DELETED = &quot;deleted&quot;;    
+    //public static final String DELETED = &quot;deleted&quot;;    
     public static final String CREATEDWHO = &quot;createdWho&quot;; 
     public static final String NOTE = &quot;note&quot;;
     
-    public static final String VILLAGE = &quot;village&quot;;
-    
-    
+        
     private static Hashtable&lt;String, Integer&gt; columnSizes;
     static {
         columnSizes = new Hashtable&lt;String,Integer&gt;();
@@ -73,11 +71,11 @@
     
     @Override
     public List&lt;String&gt; getForeignKeys() { 
-    	return asList( TERRITORY, PHYTOCHORION, /*NEAREST*/VILLAGE ); 
+    	return asList( TERRITORY, PHYTOCHORION, NEARESTVILLAGE ); 
     }
     
     public List&lt;String&gt; getColumns() {
-    	return asList( TERRITORY, PHYTOCHORION, /*NEAREST*/VILLAGE, 
+    	return asList( TERRITORY, PHYTOCHORION, NEARESTVILLAGE, 
     			QUADRANT, DESCRIPTION, COUNTRY, ALTITUDE, LATITUDE, LONGITUDE, NOTE, DELETED );
     }
     
@@ -110,7 +108,7 @@
 		}
 		else if(column.equalsIgnoreCase(TERRITORY)) setTerritory((Territory)value);
 		else if(column.equalsIgnoreCase(PHYTOCHORION)) setPhytochorion((Phytochorion)value);
-		else if(column.equalsIgnoreCase(NEARESTVILLAGE) || column.equals(VILLAGE)) setNearestVillage((Village)value);
+		else if(column.equalsIgnoreCase(NEARESTVILLAGE)) setNearestVillage((NearestVillage)value);
 		else if(column.equalsIgnoreCase(QUADRANT)) setQuadrant((String)value);
 		else if(column.equalsIgnoreCase(DESCRIPTION)) setDescription((String)value);
 		else if(column.equalsIgnoreCase(COUNTRY)) setCountry((String)value);
@@ -206,45 +204,25 @@
     }
     
     /**
-     *   Get associated Village record
-     *   @return associated Village record
+     *   Get associated NearestVillage record
+     *   @return associated NearestVillage record
      *   @see setNearestVillage
      */
-    public Village getNearestVillage() {
+    public NearestVillage getNearestVillage() {
         //obligatory
         return this.nearestVillage;
     }
     
     /**
-     *   Get associated Village record
-     *   @return associated Village record
-     *   @see setNearestVillage
-     */
-    public Village getVillage() {
-        //obligatory
-        return getNearestVillage();
-    }
-    
-    /**
-     *   Set associated Village record
-     *   @param nearestVillage associated Village record
+     *   Set associated NearestVillage record
+     *   @param nearestVillage associated NearestVillage record
      *   @see getNearestVillage
      */
-    public void setNearestVillage(Village nearestVillage) {
+    public void setNearestVillage(NearestVillage nearestVillage) {
         this.nearestVillage = nearestVillage;
     }
     
-    /**
-     *   Set associated Village record
-     *   @param nearestVillage associated Village record
-     *   @see getNearestVillage
-     */
-    public void setVillage(Village nearestVillage) {
-        //obligatory
-        setNearestVillage(nearestVillage);
-    }
     
-    
     /**
      *   Get quadrant
      *   @return quadrant

Added: trunk/src/net/sf/plantlore/common/record/NearestVillage.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/NearestVillage.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/record/NearestVillage.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -0,0 +1,98 @@
+/*
+ * NearestVillage.java
+ *
+ * Created on 15. b&#345;ezen 2006, 0:17
+ *
+ */
+
+package net.sf.plantlore.common.record;
+
+import java.util.List;
+
+/**
+ *  Data holder object representing TVILLAGES table in the DB. This object is used as a data holder
+ *  for Hibernate operations on the server side. On the side of the client, it represents a village
+ *  we are currently working with. It is being sent from client to server and back when executing
+ *  database queries.
+ *
+ * @author Tomas Kovarik
+ * @author Lada Oberreiterova
+ */
+public class NearestVillage extends Record {
+	
+	private static final long serialVersionUID = 20060604034L;
+	
+    /** Parameters of the NearestVillage */    
+    private Integer id;   
+    private String name;
+
+    /** Constants with column mapping (used for building select queries) */
+    public static final String ID = &quot;id&quot;;
+    public static final String NAME = &quot;name&quot;;    
+
+    //public enum Column {ID, NAME};
+    
+    @Override
+    public void setValue(String column, Object value) {
+    	if(value instanceof String &amp;&amp; &quot;&quot;.equals(value))
+        	value = null;
+    	
+		if(column.equalsIgnoreCase(ID)) {
+			if(value != null &amp;&amp; value instanceof String)
+				setId(Integer.parseInt((String)value));
+			else
+				setId((Integer)value);
+		}
+		else if(column.equalsIgnoreCase(NAME)) setName((String)value);
+    }
+    
+    /** Creates a new instance of NearestVillage */
+    public NearestVillage() {
+        
+    }
+    
+    public List&lt;String&gt; getColumns() {
+    	return asList( NAME );
+    }
+        
+    public List&lt;String&gt; getNN() {
+    	return asList(NAME);
+    }
+    
+    /**
+     *   Get village id
+     *   @return id of the village
+     *   @see setId
+     */
+    public Integer getId() {
+        return this.id;
+    }
+    
+    /**
+     *   Set village id
+     *   @param id id of the village
+     *   @see getId
+     */
+    public void setId(Integer id) {
+        this.id = id;
+    }
+    
+    /**
+     *   Get name of the village
+     *   @return name of the village
+     *   @see setName
+     */
+    public String getName() {
+        return this.name;
+    }
+    
+    /**
+     *   Set name of the village
+     *   @param name string containing name of the village
+     *   @see getName
+     */
+    public void setName(String name) {
+        this.name = name;
+    }    
+}
+

Modified: trunk/src/net/sf/plantlore/common/record/Occurrence.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/Occurrence.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/record/Occurrence.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -70,7 +70,7 @@
     public static final String UPDATEDWHEN = &quot;updatedWhen&quot;;    
     public static final String UPDATEDWHO = &quot;updatedWho&quot;;    
     public static final String METADATA = &quot;metadata&quot;;    
-    public static final String DELETED = &quot;deleted&quot;;
+    //public static final String DELETED = &quot;deleted&quot;;
     public static final String NOTE = &quot;note&quot;;        
     
     private static Hashtable&lt;String,Integer&gt; columnSizes;

Modified: trunk/src/net/sf/plantlore/common/record/Publication.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/Publication.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/record/Publication.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -45,7 +45,7 @@
     public static final String REFERENCECITATION = &quot;referenceCitation&quot;;    
     public static final String REFERENCEDETAIL = &quot;referenceDetail&quot;;    
     public static final String URL = &quot;url&quot;;    
-    public static final String DELETED = &quot;deleted&quot;;            
+    //public static final String DELETED = &quot;deleted&quot;;            
     public static final String CREATEDWHO = &quot;createdWho&quot;;    
     public static final String NOTE = &quot;note&quot;;
     

Modified: trunk/src/net/sf/plantlore/common/record/Record.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/Record.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/record/Record.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -36,7 +36,7 @@
 	 * (concerns History, LastUpdate, User, AccessRights, and possibly more).
 	 */
 	public final static Set&lt;Class&gt; BASIC_TABLES = new HashSet&lt;Class&gt;( Arrays.asList(
-		Occurrence.class, Habitat.class, Territory.class, Village.class, Phytochorion.class,
+		Occurrence.class, Habitat.class, Territory.class, NearestVillage.class, Phytochorion.class,
 		Plant.class, Metadata.class, Publication.class, Author.class, AuthorOccurrence.class) 
 	);
 	        
@@ -44,7 +44,7 @@
 	 * A set of tables that cannot be changed.
 	 */
 	public final static HashSet&lt;Class&gt; IMMUTABLE = new HashSet&lt;Class&gt;( Arrays.asList(
-			Plant.class, Territory.class, Village.class, Phytochorion.class/*, Metadata.class*/) 
+			Plant.class, Territory.class, NearestVillage.class, Phytochorion.class/*, Metadata.class*/) 
 	);
 	
 	
@@ -173,12 +173,9 @@
 	public Record createTorso() {
 		StringBuilder className;
 		for(String key : getForeignKeys()) {
-			if(key.equals(Habitat.NEARESTVILLAGE))
-				className = new StringBuilder(&quot;Village&quot;);
-			else {
-				className = new StringBuilder(key);
-				className.setCharAt(0, Character.toUpperCase(className.charAt(0)));
-			}
+			className = new StringBuilder(key);
+			className.setCharAt(0, Character.toUpperCase(className.charAt(0)));
+
 			try {
 				Record subrecord = (Record)Class.forName(pckg+className).newInstance();
 				subrecord.createTorso();

Deleted: trunk/src/net/sf/plantlore/common/record/Village.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/Village.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/common/record/Village.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -1,98 +0,0 @@
-/*
- * Village.java
- *
- * Created on 15. b&#345;ezen 2006, 0:17
- *
- */
-
-package net.sf.plantlore.common.record;
-
-import java.util.List;
-
-/**
- *  Data holder object representing TVILLAGES table in the DB. This object is used as a data holder
- *  for Hibernate operations on the server side. On the side of the client, it represents a village
- *  we are currently working with. It is being sent from client to server and back when executing
- *  database queries.
- *
- * @author Tomas Kovarik
- * @author Lada Oberreiterova
- */
-public class Village extends Record {
-	
-	private static final long serialVersionUID = 20060604034L;
-	
-    /** Parameters of the Village */    
-    private Integer id;   
-    private String name;
-
-    /** Constants with column mapping (used for building select queries) */
-    public static final String ID = &quot;id&quot;;
-    public static final String NAME = &quot;name&quot;;    
-
-    //public enum Column {ID, NAME};
-    
-    @Override
-    public void setValue(String column, Object value) {
-    	if(value instanceof String &amp;&amp; &quot;&quot;.equals(value))
-        	value = null;
-    	
-		if(column.equalsIgnoreCase(ID)) {
-			if(value != null &amp;&amp; value instanceof String)
-				setId(Integer.parseInt((String)value));
-			else
-				setId((Integer)value);
-		}
-		else if(column.equalsIgnoreCase(NAME)) setName((String)value);
-    }
-    
-    /** Creates a new instance of Village */
-    public Village() {
-        
-    }
-    
-    public List&lt;String&gt; getColumns() {
-    	return asList( NAME );
-    }
-        
-    public List&lt;String&gt; getNN() {
-    	return asList(NAME);
-    }
-    
-    /**
-     *   Get village id
-     *   @return id of the village
-     *   @see setId
-     */
-    public Integer getId() {
-        return this.id;
-    }
-    
-    /**
-     *   Set village id
-     *   @param id id of the village
-     *   @see getId
-     */
-    public void setId(Integer id) {
-        this.id = id;
-    }
-    
-    /**
-     *   Get name of the village
-     *   @return name of the village
-     *   @see setName
-     */
-    public String getName() {
-        return this.name;
-    }
-    
-    /**
-     *   Set name of the village
-     *   @param name string containing name of the village
-     *   @see getName
-     */
-    public void setName(String name) {
-        this.name = name;
-    }    
-}
-

Modified: trunk/src/net/sf/plantlore/config/hibernate/Habitats.hbm.xml
===================================================================
--- trunk/src/net/sf/plantlore/config/hibernate/Habitats.hbm.xml	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/config/hibernate/Habitats.hbm.xml	2006-08-27 11:34:58 UTC (rev 578)
@@ -28,7 +28,7 @@
                 not-null=&quot;false&quot;                
                 type=&quot;java.lang.String&quot;/&gt;   
       &lt;many-to-one name=&quot;nearestVillage&quot; 
-                   class=&quot;net.sf.plantlore.common.record.Village&quot; 
+                   class=&quot;net.sf.plantlore.common.record.NearestVillage&quot; 
                    column=&quot;CNEARESTVILLAGEID&quot;
                    fetch=&quot;select&quot;/&gt;                   
       &lt;property column=&quot;CCOUNTRY&quot;

Modified: trunk/src/net/sf/plantlore/config/hibernate/Villages.hbm.xml
===================================================================
--- trunk/src/net/sf/plantlore/config/hibernate/Villages.hbm.xml	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/config/hibernate/Villages.hbm.xml	2006-08-27 11:34:58 UTC (rev 578)
@@ -4,7 +4,7 @@
           &quot;<A HREF="http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd</A>&quot;&gt;
 
 &lt;hibernate-mapping&gt;
-   &lt;class name=&quot;net.sf.plantlore.common.record.Village&quot; table=&quot;TVILLAGES&quot; lazy=&quot;false&quot;&gt;
+   &lt;class name=&quot;net.sf.plantlore.common.record.NearestVillage&quot; table=&quot;TVILLAGES&quot; lazy=&quot;false&quot;&gt;
       &lt;id column=&quot;CID&quot; name=&quot;id&quot; type=&quot;java.lang.Integer&quot;&gt;
          &lt;generator class=&quot;increment&quot;/&gt;
       &lt;/id&gt;

Modified: trunk/src/net/sf/plantlore/server/HibernateDBLayer.java
===================================================================
--- trunk/src/net/sf/plantlore/server/HibernateDBLayer.java	2006-08-26 21:12:44 UTC (rev 577)
+++ trunk/src/net/sf/plantlore/server/HibernateDBLayer.java	2006-08-27 11:34:58 UTC (rev 578)
@@ -35,7 +35,7 @@
 import net.sf.plantlore.common.record.Right;
 import net.sf.plantlore.common.record.Territory;
 import net.sf.plantlore.common.record.User;
-import net.sf.plantlore.common.record.Village;
+import net.sf.plantlore.common.record.NearestVillage;
 import net.sf.plantlore.l10n.L10n;
 import org.apache.log4j.Logger;
 import net.sf.plantlore.common.exception.DBLayerException;
@@ -1061,12 +1061,12 @@
         }
         // Check rights for table TRIGHT, TPHYTOCHORIA, TVILLAGES, TTERRITORIES, TPLANTS, TMETADATA
         if ((data instanceof Right) || (data instanceof Phytochorion) ||
-            (data instanceof Village) || (data instanceof Territory) ||
+            (data instanceof NearestVillage) || (data instanceof Territory) ||
             (data instanceof Plant) || (data instanceof Metadata)) {
             String entity = &quot;&quot;;
             if (data instanceof Right) { entity = PlantloreConstants.ENTITY_RIGHT; }
             if (data instanceof Phytochorion) { entity = PlantloreConstants.ENTITY_PHYTOCHORION; }
-            if (data instanceof Village) { entity = PlantloreConstants.ENTITY_VILLAGE; }
+            if (data instanceof NearestVillage) { entity = PlantloreConstants.ENTITY_VILLAGE; }
             if (data instanceof Territory) { entity = PlantloreConstants.ENTITY_TERRITORY; }
             if (data instanceof Plant) { entity = PlantloreConstants.ENTITY_PLANT; }            
             if (data instanceof Metadata) { entity = PlantloreConstants.ENTITY_METADATA; }
@@ -1414,7 +1414,7 @@
 	            table = PlantloreConstants.ENTITY_AUTHOR;                        
 	        } else if (data instanceof Phytochorion) {
 	            table = PlantloreConstants.ENTITY_PHYTOCHORION;                        
-	        } else if (data instanceof Village) {
+	        } else if (data instanceof NearestVillage) {
 	            table = PlantloreConstants.ENTITY_VILLAGE;
 	        } else if (data instanceof Territory) {
 	            table = PlantloreConstants.ENTITY_TERRITORY;                        
@@ -1524,7 +1524,7 @@
             }
             if ((data instanceof Author) || (data instanceof Publication) ||
                 (data instanceof Territory) || (data instanceof Phytochorion) ||
-                (data instanceof Village) || (data instanceof Metadata) ||
+                (data instanceof NearestVillage) || (data instanceof Metadata) ||
                 (data instanceof Occurrence) || (data instanceof Habitat) ||
                 (data instanceof AuthorOccurrence)) {                                                               
                 historyChange.setOperation(UPDATE);
@@ -1578,11 +1578,11 @@
                     tableId = Metadata.ID;
                     historyChange.setRecordId(((Metadata)data).getId());                    
                 } else
-                if (data instanceof Village) {
-                    updated = Village.class;
-                    updatedId = ((Village)data).getId();
-                    tableId = Village.ID;
-                    historyChange.setRecordId(((Village)data).getId());                    
+                if (data instanceof NearestVillage) {
+                    updated = NearestVillage.class;
+                    updatedId = ((NearestVillage)data).getId();
+                    tableId = NearestVillage.ID;
+                    historyChange.setRecordId(((NearestVillage)data).getId());                    
                 }                                  
                 // Read the to-be-updated object
                 Session tempSess = this.sessionFactory.openSession(); 
@@ -1776,12 +1776,12 @@
                     			 hist.setOldRecordId(((Phytochorion)newRec.getValue((String)cols.get(i))).getId());
                     			 hist.setOldValue(((Phytochorion)origRec.getValue((String)cols.get(i))).getName());
                                  hist.setNewValue(((Phytochorion)newRec.getValue((String)cols.get(i))).getName());
-                    		 } else if (((String)cols.get(i)).equals(Habitat.VILLAGE)) {
-                    			 logger.debug(&quot;VILLAGE: &quot; + ((Village)newRec.getValue((String)cols.get(i))).getId());
-                    			 logger.debug(&quot;VILLAGE: &quot; + ((Village)newRec.getValue((String)cols.get(i))).getName());
-                    			 hist.setOldRecordId(((Village)newRec.getValue((String)cols.get(i))).getId());
-                    			 hist.setOldValue(((Village)origRec.getValue((String)cols.get(i))).getName());
-                                 hist.setNewValue(((Village)newRec.getValue((String)cols.get(i))).getName());
+                    		 } else if (((String)cols.get(i)).equals(Habitat.NEARESTVILLAGE)) {
+                    			 logger.debug(&quot;VILLAGE: &quot; + ((NearestVillage)newRec.getValue((String)cols.get(i))).getId());
+                    			 logger.debug(&quot;VILLAGE: &quot; + ((NearestVillage)newRec.getValue((String)cols.get(i))).getName());
+                    			 hist.setOldRecordId(((NearestVillage)newRec.getValue((String)cols.get(i))).getId());
+                    			 hist.setOldValue(((NearestVillage)origRec.getValue((String)cols.get(i))).getName());
+                                 hist.setNewValue(((NearestVillage)newRec.getValue((String)cols.get(i))).getName());
                     		 } else {
                     			 String origValueString = (origRec.getValue((String)cols.get(i)) == null) ? null : origValue.toString(),
                            			    newValueString = (newRec.getValue((String)cols.get(i)) == null) ? null : newValue.toString(); 
@@ -1968,9 +1968,9 @@
                             sess.save(hist);
                         }
                     }
-                } else if (data instanceof Village) {
-                    Village origRec = (Village)original[0];                    
-                    Village newRec = (Village)data;
+                } else if (data instanceof NearestVillage) {
+                    NearestVillage origRec = (NearestVillage)original[0];                    
+                    NearestVillage newRec = (NearestVillage)data;
                     ArrayList cols = (ArrayList)origRec.getColumns();
                     for (int i=0;i&lt;cols.size();i++) {                        
                         Object origValue = (origRec.getValue((String)cols.get(i)) == null) ? new String(&quot;&quot;) : origRec.getValue((String)cols.get(i));                        


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000794.html">[Plantlore-dev] [Bug #8589] Improve author role handling
</A></li>
	<LI>Next message: <A HREF="000796.html">[Plantlore-dev] r579 - in trunk/src/net/sf/plantlore: client	client/export client/history client/login client/metadata	client/user middleware server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#795">[ date ]</a>
              <a href="thread.html#795">[ thread ]</a>
              <a href="subject.html#795">[ subject ]</a>
              <a href="author.html#795">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
