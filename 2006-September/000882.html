<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r628 - in trunk/src/net/sf/plantlore/client: .	overview overview/search
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-September/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r628%20-%20in%20trunk/src/net/sf/plantlore/client%3A%20.%0A%09overview%20overview/search&In-Reply-To=%3C200609021303.k82D3Qco031195%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000881.html">
   <LINK REL="Next"  HREF="000883.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r628 - in trunk/src/net/sf/plantlore/client: .	overview overview/search</H1>
    <B>fraktalek at mail.berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r628%20-%20in%20trunk/src/net/sf/plantlore/client%3A%20.%0A%09overview%20overview/search&In-Reply-To=%3C200609021303.k82D3Qco031195%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r628 - in trunk/src/net/sf/plantlore/client: .	overview overview/search">fraktalek at mail.berlios.de
       </A><BR>
    <I>Sat Sep  2 15:03:26 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000881.html">[Plantlore-dev] r627 - trunk/src/net/sf/plantlore/common
</A></li>
        <LI>Next message: <A HREF="000883.html">[Plantlore-dev] r629 - trunk/src/net/sf/plantlore/client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#882">[ date ]</a>
              <a href="thread.html#882">[ thread ]</a>
              <a href="subject.html#882">[ subject ]</a>
              <a href="author.html#882">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fraktalek
Date: 2006-09-02 15:03:14 +0200 (Sat, 02 Sep 2006)
New Revision: 628

Modified:
   trunk/src/net/sf/plantlore/client/AppCore.java
   trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
   trunk/src/net/sf/plantlore/client/AppCoreView.form
   trunk/src/net/sf/plantlore/client/AppCoreView.java
   trunk/src/net/sf/plantlore/client/overview/AddEdit.java
   trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java
   trunk/src/net/sf/plantlore/client/overview/search/Search.java
   trunk/src/net/sf/plantlore/client/overview/search/SearchView.java
Log:
dded a few JavaDocs, Edit now starts using Task,
better exception handling on many places. Fix of a problem in search that appeared after the previous changes.



Modified: trunk/src/net/sf/plantlore/client/AppCore.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCore.java	2006-09-02 08:21:17 UTC (rev 627)
+++ trunk/src/net/sf/plantlore/client/AppCore.java	2006-09-02 13:03:14 UTC (rev 628)
@@ -892,7 +892,7 @@
                         setStatusMessage(L10n.getFormattedString(&quot;Delete.Message.ProgressInfo&quot;,deleted,toBeDeleted.size()));
                     }
                 } catch (DBLayerException ex) {
-                    database.rollbackTransaction();
+                    database.rollbackTransaction();//FIXME:
                     DBLayerException dbex = new DBLayerException(&quot;Delete rolled back. Some database problem occurred: &quot;+ex);
                     dbex.setStackTrace(ex.getStackTrace());
                     throw dbex;
@@ -929,7 +929,7 @@
             int resId = database.executeQuery(sq);
             int resCount = database.getNumRows(resId);
             assert resCount == 1;
-            if (resCount == 0)
+            if (resCount == 0) //FIXME
                 throw new DBLayerException(&quot;The record is no longer in the database.&quot;);
             Object[] obj = database.more(resId, 0, 0);
             Object[] res = (Object[])obj[0];

Modified: trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-09-02 08:21:17 UTC (rev 627)
+++ trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-09-02 13:03:14 UTC (rev 628)
@@ -32,9 +32,7 @@
 import java.util.Observer;
 import java.util.prefs.Preferences;
 import javax.swing.AbstractAction;
-import javax.swing.JDialog;
 import javax.swing.JFormattedTextField;
-import javax.swing.JFrame;
 import javax.swing.JOptionPane;
 import javax.swing.KeyStroke;
 import javax.swing.ListSelectionModel;
@@ -80,11 +78,9 @@
 import net.sf.plantlore.client.user.UserManager;
 import net.sf.plantlore.client.user.UserManagerCtrl;
 import net.sf.plantlore.client.user.UserManagerView;
+import net.sf.plantlore.common.DefaultExceptionHandler;
 import net.sf.plantlore.common.DefaultProgressBar;
-import net.sf.plantlore.common.DefaultProgressBarEx;
 import net.sf.plantlore.common.DefaultReconnectDialog;
-import net.sf.plantlore.common.DefaultReconnectDialog;
-import net.sf.plantlore.common.DefaultReconnectDialog;
 import net.sf.plantlore.common.Pair;
 import net.sf.plantlore.common.PlantloreConstants;
 import net.sf.plantlore.common.ProgressBar;
@@ -92,10 +88,7 @@
 import net.sf.plantlore.common.StandardAction;
 import net.sf.plantlore.common.StatusBarManager;
 import net.sf.plantlore.common.Task;
-import net.sf.plantlore.common.record.Occurrence;
 import net.sf.plantlore.common.exception.DBLayerException;
-import net.sf.plantlore.common.exception.ExportException;
-import net.sf.plantlore.common.exception.ImportException;
 import net.sf.plantlore.client.authors.AuthorManager;
 import net.sf.plantlore.client.authors.AuthorManagerCtrl;
 import net.sf.plantlore.client.authors.AuthorManagerView;
@@ -687,6 +680,11 @@
 		}
 	}
 
+        /** Action for handling edit commands.
+         *
+         * Determines the selected occurrence in overview and then invokes edit dialog
+         * on that occurrence.
+         */
 	class EditAction extends AbstractAction {
 		public EditAction() {
 			if (showButtonText)
@@ -696,7 +694,6 @@
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.EditTT&quot;));
 			putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_E,
 					ActionEvent.CTRL_MASK));
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.Edit&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {                    
@@ -705,37 +702,45 @@
                         return;
                     }
                         
-			Object[] row = model.getSelectedRow();
+                    final Object[] row = model.getSelectedRow();
 
-			try {
-				if (!model.isEditAllowed(model.getSelectedOccurrence())) {
-					JOptionPane.showMessageDialog(view, L10n
-							.getString(&quot;AddEdit.InsufficientEditRights&quot;), L10n
-							.getString(&quot;AddEdit.InsufficientRightsTitle&quot;),
-							JOptionPane.INFORMATION_MESSAGE);
-					return;
-				}
-				editModel.setRecord((Integer) row[row.length - 1]);
-			} catch (DBLayerException ex) {
-				JOptionPane.showMessageDialog(view, L10n
-						.getString(&quot;Error.DBLayerException&quot;)
-						+ &quot;\n&quot; + ex.getErrorInfo(), L10n
-						.getString(&quot;Error.DBLayerExceptionTitle&quot;),
-						JOptionPane.WARNING_MESSAGE);
-				logger.error(ex + &quot;: &quot; + ex.getErrorInfo());
-			} catch (RemoteException ex) {
-				JOptionPane.showMessageDialog(view, L10n
-						.getString(&quot;Error.RemoteException&quot;)
-						+ &quot;\n&quot; + ex.getMessage(), L10n
-						.getString(&quot;Error.RemoteExceptionTitle&quot;),
-						JOptionPane.WARNING_MESSAGE);
-				logger.error(ex);
-			}
-			editView.loadComponentData();
-			editView.setVisible(true);
-		}
-	}
+                    try {
+                        if (!model.isEditAllowed(model.getSelectedOccurrence())) {
+                                JOptionPane.showMessageDialog(view, L10n
+                                                .getString(&quot;AddEdit.InsufficientEditRights&quot;), L10n
+                                                .getString(&quot;AddEdit.InsufficientRightsTitle&quot;),
+                                                JOptionPane.INFORMATION_MESSAGE);
+                                return;
+                        }
+                    } catch(RemoteException ex) {
+                        DefaultExceptionHandler.handle(view,ex);  
+                        return;
+                    } catch (DBLayerException ex) {
+                        DefaultExceptionHandler.handle(view,ex);                            
+                        return;
+                    }
 
+                    Task t = new Task() {
+                        public Object task() throws DBLayerException, RemoteException {
+                            setStatusMessage(L10n.getString(&quot;Overview.LoadingOccurrenceRecord&quot;));
+                            return editModel.loadRecord((Integer) row[row.length - 1]);
+                        }
+                    };
+
+                    new DefaultProgressBar(t, view, true) {
+                        public void afterStopping() {
+                            SwingUtilities.invokeLater(new Runnable() {
+                                public void run() {
+                                    editView.loadComponentData();
+                                    editView.setVisible(true);    
+                                }
+                            });
+                        }
+                    };
+                    t.start();
+		}//actionPerformed()
+	}//EditAction
+
 	class DeleteAction extends AbstractAction {
 		public DeleteAction() {
 			if (showButtonText)
@@ -745,109 +750,71 @@
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.DeleteTT&quot;));
 			putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(
 					KeyEvent.VK_DELETE, 0));
-
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.Delete&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
 			Selection selection = model.getTableModel().getSelection();
 			Object[] arg = { selection.values().size() };
 
+                        //Nothing checked in the overview -&gt; tell user to check something first
 			if (arg[0].equals(0)) {
-				JOptionPane.showMessageDialog(view, L10n
-						.getString(&quot;Message.CheckAnOccurrence&quot;), L10n
-						.getString(&quot;Message.CheckAnOccurrenceTitle&quot;),
-						JOptionPane.INFORMATION_MESSAGE);
-				return;
+                            JOptionPane.showMessageDialog(view, 
+                                    L10n.getString(&quot;Message.CheckAnOccurrence&quot;), 
+                                    L10n.getString(&quot;Message.CheckAnOccurrenceTitle&quot;),
+                                    JOptionPane.INFORMATION_MESSAGE);
+                            return;
 			}
 
 			try {
-				for (Integer occId : selection.values())
-					if (!model.isEditAllowed(occId)) {
-						JOptionPane.showMessageDialog(view, L10n
-								.getString(&quot;Delete.InsufficientRights&quot;), L10n
-								.getString(&quot;Delete.InsufficientRightsTitle&quot;),
-								JOptionPane.INFORMATION_MESSAGE);
-						return;
-					}
+                            for (Integer occId : selection.values())
+                                    if (!model.isEditAllowed(occId)) {
+                                            JOptionPane.showMessageDialog(view, 
+                                                    L10n.getString(&quot;Delete.InsufficientRights&quot;), 
+                                                    L10n.getString(&quot;Delete.InsufficientRightsTitle&quot;),
+                                                    JOptionPane.INFORMATION_MESSAGE);
+                                            return;
+                                    }
 			} catch (RemoteException ex) {
-				logger.error(&quot;Remote problem: &quot; + ex);
-				ex.printStackTrace();
-				JOptionPane.showMessageDialog(view, &quot;RemoteException: &quot; + ex);
+                            DefaultExceptionHandler.handle(view, ex);
+                            return;
 			} catch (DBLayerException ex) {
-				logger.error(&quot;Database problem: &quot; + ex);
-				ex.printStackTrace();
-				JOptionPane.showMessageDialog(view, &quot;DBLayerException: &quot; + ex);
+                            DefaultExceptionHandler.handle(view, ex);
+                            return;
 			}
 
-			int choice = JOptionPane.showConfirmDialog(view, L10n
-					.getFormattedString(&quot;Message.DeleteRecords&quot;, arg), L10n
-					.getString(&quot;Message.DeleteRecordsTitle&quot;),
-					JOptionPane.OK_CANCEL_OPTION, JOptionPane.WARNING_MESSAGE);
+                        int choice = JOptionPane.showConfirmDialog(view, L10n
+                                .getFormattedString(&quot;Message.DeleteRecords&quot;, arg), L10n
+                                .getString(&quot;Message.DeleteRecordsTitle&quot;),
+                                JOptionPane.OK_CANCEL_OPTION, JOptionPane.WARNING_MESSAGE);
+                        
+                        switch (choice) {
+                            case JOptionPane.CANCEL_OPTION:
+                                return;
+                            case JOptionPane.OK_OPTION:
+                                logger.info(&quot;Deleting &quot; + arg[0] + &quot; records.&quot;);
+                                
+                                Task task = model.deleteSelected();
+                                
+                                ProgressBar progressBar = new DefaultProgressBar(task, view, true) {                                    
+                                    public void afterStopped(Object value) {
+                                        refreshOverview(false); // false -&gt; do not create task,
+                                        // refresh the overview directly
+                                        // in this thread
+                                    }
+                                };                                
+                                task.start();
+                                break;
+                        }// switch
+		}//actionPerformed
+	}//DeleteAction
 
-			switch (choice) {
-			case JOptionPane.CANCEL_OPTION:
-				return;
-			case JOptionPane.OK_OPTION:
-				logger.info(&quot;Deleting &quot; + arg[0] + &quot; records.&quot;);
-
-				Task task = model.deleteSelected();
-
-				ProgressBar progressBar = new ProgressBar(task, view, true) {
-					public void exceptionHandler(Exception ex) {
-						if (ex instanceof DBLayerException) {
-							DBLayerException e = (DBLayerException) ex;
-							JOptionPane.showMessageDialog(view, L10n
-									.getString(&quot;Error.DBLayerException&quot;)
-									+ &quot;\n&quot; + e.getErrorInfo(), L10n
-									.getString(&quot;Error.DBLayerExceptionTitle&quot;),
-									JOptionPane.WARNING_MESSAGE);
-							logger.error(e + &quot;: &quot; + e.getErrorInfo());
-							getTask().stop();
-							return;
-						}
-						if (ex instanceof RemoteException) {
-							RemoteException e = (RemoteException) ex;
-							JOptionPane.showMessageDialog(view, L10n
-									.getString(&quot;Error.RemoteException&quot;)
-									+ &quot;\n&quot; + e.getMessage(), L10n
-									.getString(&quot;Error.RemoteExceptionTitle&quot;),
-									JOptionPane.WARNING_MESSAGE);
-							logger.error(e);
-							getTask().stop();
-							return;
-						}
-						JOptionPane
-								.showMessageDialog(
-										view,
-										L10n
-												.getString(&quot;Delete.Message.UnknownException&quot;)
-												+ &quot;\n&quot; + ex.getMessage(),
-										L10n
-												.getString(&quot;Delete.Message.UnkownExceptionTitle&quot;),
-										JOptionPane.WARNING_MESSAGE);
-						logger.error(ex);
-					}
-
-					public void afterStopped(Object value) {
-						refreshOverview(false); // false -&gt; do not create task,
-						// refresh the overview directly
-						// in this thread
-					}
-				};
-				progressBar.setTitle(L10n.getString(&quot;Delete.ProgressTitle&quot;));
-
-				task.start();
-				break;
-			}// switch
-		}
-	}
-
+        /** Overview select all action.
+         * Selects all occurrences on current page.
+         */
 	class SelectAllAction extends AbstractAction {
 		public SelectAllAction() {
 			putValue(NAME, L10n.getString(&quot;Overview.SelectAll&quot;));
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.SelectAllTT&quot;));
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.SelectAll&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
@@ -856,11 +823,13 @@
 		}
 	}
 
+        /** Overview select none action.
+         * Unselects all occurrences on current page.
+         */
 	class SelectNoneAction extends AbstractAction {
 		public SelectNoneAction() {
 			putValue(NAME, L10n.getString(&quot;Overview.SelectNone&quot;));
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.SelectNoneTT&quot;));
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.SelectNone&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
@@ -869,13 +838,14 @@
 		}
 	}
 
+        /** Overview invert selected action.
+         * Inverts the selection of occurrences on current page.
+         */
 	class InvertSelectedAction extends AbstractAction {
 		public InvertSelectedAction() {
 			putValue(NAME, L10n.getString(&quot;Overview.InvertSelected&quot;));
 			putValue(SHORT_DESCRIPTION, L10n
 					.getString(&quot;Overview.InvertSelectedTT&quot;));
-			// putValue(MNEMONIC_KEY,
-			// L10n.getMnemonic(&quot;Overview.InvertSelected&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
@@ -884,82 +854,81 @@
 		}
 	}
 
+        /** Handles the overview's Search action.
+         */
 	class SearchAction extends AbstractAction {
 		public SearchAction() {
 			if (showButtonText)
 				putValue(NAME, L10n.getString(&quot;Overview.Search&quot;));
-			putValue(SMALL_ICON, Resource
-					.createIcon(&quot;/toolbarButtonGraphics/general/Search24.gif&quot;));
+			putValue(SMALL_ICON, Resource.createIcon(&quot;/toolbarButtonGraphics/general/Search24.gif&quot;));
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.SearchTT&quot;));
-			putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_S,
-					ActionEvent.CTRL_MASK));
-
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.Search&quot;));
+			putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_S,ActionEvent.CTRL_MASK));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
 			searchModel.clear();
-			searchView.setVisible(true);
-		}
-	}
+                        SwingUtilities.invokeLater(new Runnable() {
+                            public void run() {
+                                searchView.setVisible(true);
+                            }
+                        });
+		}//actionPerformed
+	}//SearchAction
 
+        /** Handles the invoking of habitat tree from overview.
+         *
+         */
 	class HabitatTreeAction extends AbstractAction {
 		public HabitatTreeAction() {
 			if (showButtonText)
 				putValue(NAME, L10n.getString(&quot;Overview.HabitatTree&quot;));
 			putValue(SMALL_ICON, Resource.createIcon(&quot;/toolbarButtonGraphics/development/Application24.gif&quot;));
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.HabitatTreeTT&quot;));
-			//putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_S,
-			//		ActionEvent.CTRL_MASK));
-
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.Search&quot;));
+			putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_T,ActionEvent.CTRL_MASK));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
                         habitatTreeModel.setDBLayer(model.getDatabase());
                         try {
                             habitatTreeModel.loadData();
-                            habitatTreeView.setVisible(true);
-                        } catch (Exception ex) {
-                            if (ex instanceof DBLayerException || ex instanceof RemoteException) {
-                                DefaultReconnectDialog.show(view,ex);
-                            } else {
-                                logger.error(&quot;Exception: &quot;+ex);
-                                ex.printStackTrace(); //FIXME
+                        } catch (RemoteException ex) {
+                            DefaultExceptionHandler.handle(view,ex);
+                            return;
+                        } catch (DBLayerException ex) {
+                            DefaultExceptionHandler.handle(view,ex);
+                            return;
+                        }
+                        SwingUtilities.invokeLater(new Runnable() {
+                            public void run() {
+                                habitatTreeView.setVisible(true);
                             }
-                        }
-		}
-	}
+                        });
+		}//actionPerformed
+	}// HabitatTreeAction
 
+        /** Bridge that informs overview about a new query.
+         *
+         */
 	class SearchBridge implements Observer {
 		public void update(Observable o, Object arg) {
-			if (arg != null &amp;&amp; arg instanceof Integer) {
-				logger.debug(&quot;Fetching new result id from Search model. Storing it to AppCore model.&quot;);
-				try {
-					model.setResultId(searchModel.getNewResultId(), searchModel
-							.getNewSelectQuery());
-				} catch (RemoteException ex) {
-					JOptionPane.showMessageDialog(view, L10n
-							.getString(&quot;Error.RemoteException&quot;)
-							+ &quot;\n&quot; + ex.getMessage(), L10n
-							.getString(&quot;Error.RemoteExceptionTitle&quot;),
-							JOptionPane.WARNING_MESSAGE);
-					logger.error(ex);
-				} catch (DBLayerException ex) {
-					JOptionPane.showMessageDialog(view, L10n
-							.getString(&quot;Error.DBLayerException&quot;)
-							+ &quot;\n&quot; + ex.getErrorInfo(), L10n
-							.getString(&quot;Error.DBLayerExceptionTitle&quot;),
-							JOptionPane.WARNING_MESSAGE);
-					logger.error(ex + &quot;: &quot; + ex.getErrorInfo());
-				}
-				// model.setExportQuery(searchModel.getExportQuery(), false,
-				// Occurrence.class);
-			}
-		}
-
-	}
+                    if (arg != null &amp;&amp; arg instanceof Integer) {
+                        logger.debug(&quot;Fetching new result id from Search model. Storing it to AppCore model.&quot;);
+                        try {
+                            model.setResultId(searchModel.getNewResultId(), searchModel.getNewSelectQuery());
+                        } catch (RemoteException ex) {
+                            DefaultExceptionHandler.handle(view,ex);
+                            return;
+                        } catch (DBLayerException ex) {
+                            DefaultExceptionHandler.handle(view,ex);
+                            return;
+                        }
+                    }
+		}//update()
+	}//SearchBridge
         
+        /** Bridge from HabitatTree to overview, search and add.
+         *
+         */
         class HabitatTreeBridge implements Observer {
             public void update(Observable o, Object arg) {
                 if (arg != null &amp;&amp; arg instanceof Pair) {                    
@@ -979,60 +948,60 @@
                     if (message.equals(&quot;ADD&quot;)) {
 			try {
 				if (model.getDatabase().getUserRights().getAdd() != 1) {
-					JOptionPane.showMessageDialog(view, L10n
-							.getString(&quot;AddEdit.InsufficientAddRights&quot;), L10n
-							.getString(&quot;AddEdit.InsufficientRightsTitle&quot;),
-							JOptionPane.INFORMATION_MESSAGE);
+					JOptionPane.showMessageDialog(view, 
+                                                L10n.getString(&quot;AddEdit.InsufficientAddRights&quot;), 
+                                                L10n.getString(&quot;AddEdit.InsufficientRightsTitle&quot;),
+                                                JOptionPane.INFORMATION_MESSAGE);
 					return;
 				}
 			} catch (RemoteException ex) {
-                            DefaultReconnectDialog.show(view,ex);
-                            logger.error(ex);
+                            DefaultExceptionHandler.handle(view, ex);
+                            return;
 			}
 			addModel.clear();
                         try {
                             addModel.setHabitat(nodeInfo.getId());
                         } catch (RemoteException ex) {
-                            DefaultReconnectDialog.show(view,ex);
+                            DefaultExceptionHandler.handle(view,ex);
+                            return;
                         } catch (DBLayerException ex) {
-                            DefaultReconnectDialog.show(view,ex);
+                            DefaultExceptionHandler.handle(view,ex);
+                            return;
                         }
-                        addView.loadComponentData();
-			addView.setVisible(true);         
-//                        habitatTreeView.setVisible(false);
+                        SwingUtilities.invokeLater( new Runnable() {
+                            public void run() {
+                                addView.loadComponentData();
+                                addView.setVisible(true);   
+                            }
+                        });//invokeLater
                     }//if ADD
                 }//if
             }//update
         }//class HabitatTreeBridge
 
+        /** Handles the overview scheda action.
+         *
+         */
 	class SchedaAction extends AbstractAction {
 		public SchedaAction() {
 			putValue(NAME, L10n.getString(&quot;Overview.Scheda&quot;));
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.SchedaTT&quot;));
-			putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_X,
-					ActionEvent.CTRL_MASK));
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.Scheda&quot;));
-			putValue(
-					SMALL_ICON,
-					Resource
-							.createIcon(&quot;/toolbarButtonGraphics/general/ComposeMail24.gif&quot;));
+			putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_X,	ActionEvent.CTRL_MASK));
+			putValue(SMALL_ICON,Resource.createIcon(&quot;/toolbarButtonGraphics/general/ComposeMail24.gif&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
 			try {
 				if (model.getTableModel().getSelection().values().size() &lt; 1) {
-					JOptionPane.showMessageDialog(view, L10n
-							.getString(&quot;Message.CheckAnOccurrence&quot;), L10n
-							.getString(&quot;Message.CheckAnOccurrenceTitle&quot;),
+					JOptionPane.showMessageDialog(view, 
+                                                L10n.getString(&quot;Message.CheckAnOccurrence&quot;), 
+                                                L10n.getString(&quot;Message.CheckAnOccurrenceTitle&quot;),
 							JOptionPane.INFORMATION_MESSAGE);
 					return;
 				}
 
 				final JasperReport schedaReport;
-				InputStream schedaIs = this
-						.getClass()
-						.getClassLoader()
-						.getResourceAsStream(
+				InputStream schedaIs = this.getClass().getClassLoader().getResourceAsStream(
 								&quot;net/sf/plantlore/client/resources/SchedaA6.jasper&quot;);
 
 				try {
@@ -1092,21 +1061,15 @@
 
 				ProgressBar pb = new ProgressBar(task, view, true) {
 					public void exceptionHandler(final Exception ex) {
-						logger
-								.error(&quot;Error while filling jasper report in SchedaAction: &quot;
-										+ ex);
+						logger.error(&quot;Error while filling jasper report in SchedaAction: &quot;+ ex);
 						ex.printStackTrace();
 						SwingUtilities.invokeLater(new Runnable() {
 							public void run() {
-								JOptionPane
-										.showMessageDialog(
-												view.getParent(),
-												L10n
-														.getString(&quot;Print.Message.BrokenReport&quot;)
+								JOptionPane.showMessageDialog(view.getParent(),
+											L10n.getString(&quot;Print.Message.BrokenReport&quot;)
 														+ &quot;\n&quot;
 														+ ex.getMessage(),
-												L10n
-														.getString(&quot;Print.Message.BrokenReport&quot;),
+											L10n.getString(&quot;Print.Message.BrokenReport&quot;),
 												JOptionPane.WARNING_MESSAGE);
 							}
 						});
@@ -1122,10 +1085,8 @@
 						});
 					}
 				};
-				pb.setTitle(L10n.getString(&quot;Scheda.ProgressTitle&quot;));
-
 				task.start();
-			} catch (Exception ex) { // Unreachable CATCH block
+			} catch (Exception ex) { 
 				logger.error(&quot;Broken report: &quot; + ex);
 				JOptionPane.showMessageDialog(view, L10n
 						.getString(&quot;Print.Message.BrokenReport&quot;)
@@ -1137,46 +1098,49 @@
 		}
 	}
 
+        /** Handles the previous page overview action */
 	class PreviousPageAction extends AbstractAction {
 		public PreviousPageAction() {
 			putValue(NAME, L10n.getString(&quot;Overview.PrevPage&quot;));
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.PrevPageTT&quot;));
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.PrevPage&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
 			try {
 				model.prevPage();
 			} catch (RemoteException ex) {
-				ex.printStackTrace();
-				JOptionPane.showMessageDialog(view, &quot;RemoteException: &quot; + ex);
+                            DefaultExceptionHandler.handle(view, ex);
+                            return;
 			} catch (DBLayerException ex) {
-				ex.printStackTrace();
-				JOptionPane.showMessageDialog(view, &quot;DBLayerException: &quot; + ex);
+                            DefaultExceptionHandler.handle(view, ex);
+                            return;
 			}
 		}
 	}
 
+        /** Handles the next page overview action */        
 	class NextPageAction extends AbstractAction {
 		public NextPageAction() {
 			putValue(NAME, L10n.getString(&quot;Overview.NextPage&quot;));
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.NextPageTT&quot;));
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.NextPage&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
 			try {
 				model.nextPage();
 			} catch (RemoteException ex) {
-				ex.printStackTrace();
-				JOptionPane.showMessageDialog(view, &quot;RemoteException: &quot; + ex);
+                            DefaultExceptionHandler.handle(view, ex);
+                            return;
 			} catch (DBLayerException ex) {
-				ex.printStackTrace();
-				JOptionPane.showMessageDialog(view, &quot;DBLayerException: &quot; + ex);
+                            DefaultExceptionHandler.handle(view, ex);
+                            return;
 			}
 		}
 	}
 
+        /** Window closing listener.
+         * Saves preferences on that event.
+         */
 	class AppWindowListener extends WindowAdapter {
 		public void windowClosing(WindowEvent e) {
 			try {
@@ -1185,40 +1149,42 @@
 				
 				model.savePreferences();
 			} catch (IOException ex) {
-				JOptionPane.showMessageDialog(view,
-						&quot;Problem while saving configuration: &quot;
+				JOptionPane.showMessageDialog(view,L10n.getString(&quot;Overview.ProblemSavingPreferences&quot;)+&quot;: &quot;
 								+ ex.getMessage());
 			}
 		}
 	}
 
+        /** Handles author manager action invoked from overview. */
 	class DataAuthorsAction extends AbstractAction {
 		public DataAuthorsAction() {
 			putValue(NAME, L10n.getString(&quot;Overview.MenuDataAuthors&quot;));
-			putValue(SHORT_DESCRIPTION, L10n
-					.getString(&quot;Overview.MenuDataAuthorsTT&quot;));
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.MenuDataAuthorsTT&quot;));
 			putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.MenuDataAuthors&quot;));
 		}
 
 		public void actionPerformed(ActionEvent e) {
 			AuthorManager authModel = new AuthorManager(model.getDatabase());
-			AuthorManagerView authView = new AuthorManagerView(authModel, view,
+			final AuthorManagerView authView = new AuthorManagerView(authModel, view,
 					true);
 			AuthorManagerCtrl authCtrl = new AuthorManagerCtrl(authModel,
 					authView);
 			authModel.addObserver(managerBridge);
-			authView.setVisible(true);
+                        SwingUtilities.invokeLater(new Runnable() {
+                            public void run() {
+                                authView.setVisible(true);
+                            }
+                        });
 		}
 
 	}
 
+        /** Handles publication manager action invoked from overview. */
 	class DataPublicationsAction extends AbstractAction {
 		public DataPublicationsAction() {
 			putValue(NAME, L10n.getString(&quot;Overview.MenuDataPublications&quot;));
-			putValue(SHORT_DESCRIPTION, L10n
-					.getString(&quot;Overview.MenuDataPublicationsTT&quot;));
-			putValue(MNEMONIC_KEY, L10n
-					.getMnemonic(&quot;Overview.MenuDataPublications&quot;));
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.MenuDataPublicationsTT&quot;));
+			putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.MenuDataPublications&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
@@ -1229,17 +1195,22 @@
 			publicationManagerCtrl = new PublicationManagerCtrl(
 					publicationManagerModel, publicationManagerView);
 			publicationManagerModel.addObserver(managerBridge);
-			publicationManagerView.setVisible(true);
+                        SwingUtilities.invokeLater(new Runnable() {
+                            public void run() {
+                                publicationManagerView.setVisible(true);
+                            }
+                        });
 		}
 	}
 
+        /** Handles user manager action invoked from overview. */        
 	class DataUserAction extends AbstractAction {
 		public DataUserAction() {
 			putValue(NAME, L10n.getString(&quot;userManager&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
-			System.out.println(&quot;UserManager&quot;);
+			logger.info(&quot;Starting UserManager&quot;);
 
 			if (userManagerModel == null) {
 				userManagerModel = new UserManager(model.getDatabase());
@@ -1253,13 +1224,18 @@
 					if (! userManagerModel.isFinishedTask()) return;
 					userManagerModel.setInfoFinishedTask(false);
 					userManagerCtrl.reloadData(1, UserManager.DEFAULT_DISPLAY_ROWS);
-					userManagerView.setVisible(true);						
+                                        SwingUtilities.invokeLater(new Runnable() {
+                                            public void run() {
+                                                userManagerView.setVisible(true);	
+                                            }
+                                        });
 	 	    	}
 			};			
 			task.start();					
 		}
 	}
-
+        
+        /** Handles history action invoked from overview. */
 	class DataHistoryAction extends AbstractAction {
 		public DataHistoryAction() {
 			if (showButtonText)
@@ -1267,9 +1243,6 @@
 			putValue(SMALL_ICON, Resource
 					.createIcon(&quot;/toolbarButtonGraphics/general/History24.gif&quot;));
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.HistoryTT&quot;));
-			// putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_S,
-			// ActionEvent.CTRL_MASK));
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.History&quot;));
 		}
 
 		public void actionPerformed(ActionEvent e) {
@@ -1292,24 +1265,29 @@
 	 	    	public void afterStopping() {
 					if (! historyModel.isFinishedTask()) return;
 					historyModel.setInfoFinishedTask(false);
-					historyView.setVisible(true);						
+                                        SwingUtilities.invokeLater(new Runnable() {
+                                            public void run() {
+                                                historyView.setVisible(true);		
+                                            }
+                                        });
 	 	    	}				
 			};			
 			task.start();							
 		}
 	}
 
+        /** Handles the whole history action invoked from overview. */
 	class DataWholeHistoryAction extends AbstractAction {
 		public DataWholeHistoryAction() {
 			putValue(NAME, L10n.getString(&quot;wholeHistory&quot;));
 		}
 
 		public void actionPerformed(ActionEvent actionEvent) {
-			System.out.println(&quot;Whole history&quot;);
+			logger.info(&quot;Starting Whole history&quot;);
 
 			if (wholeHistoryModel == null) {
 				wholeHistoryModel = new History(model.getDatabase());				
-			    wholeHistoryView = new WholeHistoryView(wholeHistoryModel, view,true);
+                                wholeHistoryView = new WholeHistoryView(wholeHistoryModel, view,true);
 				wholeHistoryCtrl = new WholeHistoryCtrl(wholeHistoryModel, wholeHistoryView);
 				wholeHistoryModel.addObserver(managerBridge);
 			}
@@ -1319,13 +1297,18 @@
 	 	    	public void afterStopping() {	
 					if (! wholeHistoryModel.isFinishedTask()) return;
 					wholeHistoryModel.setInfoFinishedTask(false);
-					wholeHistoryView.setVisible(true);
+                                        SwingUtilities.invokeLater( new Runnable() {
+                                            public void run() {
+                                                wholeHistoryView.setVisible(true);
+                                            }
+                                        });
 	 	    	}
 			};			
 			task.start();							
 		}
 	}
 	
+        /** Handles metadata manager action invoked from overview. */
 	class DataMetadataAction extends AbstractAction {
 		public DataMetadataAction() {
 			putValue(NAME, L10n.getString(&quot;metadataManager&quot;));
@@ -1349,13 +1332,18 @@
 					if (! metadataManagerModel.isFinishedTask()) return;
 					metadataManagerModel.setInfoFinishedTask(false);
 					metadataManagerCtrl.reloadData(1, MetadataManager.DEFAULT_DISPLAY_ROWS);
-					metadataManagerView.setVisible(true);
+                                        SwingUtilities.invokeLater(new Runnable() {
+                                            public void run() {
+                                                metadataManagerView.setVisible(true);
+                                            }
+                                        });
 	 	    	}
 			};			
 			task.start();						
 		}
 	}
 
+        /** Handles changes of the page size invoked from overview. */
 	class RecordsPerPagePropertyChangeListener implements
 			PropertyChangeListener {
 		public void propertyChange(PropertyChangeEvent e) {
@@ -1366,8 +1354,8 @@
 					JOptionPane.showMessageDialog(view, L10n
 							.getString(&quot;Overview.Warning.MaxRecordsPerPage&quot;)
 							+ &quot; &quot; + MAX_RECORDS_PER_PAGE);
-					Object obj = e.getOldValue();
-					if (obj != null)
+					Object obj = e.getOldValue();                                        
+					if (obj != null) 
 						tf.setValue(obj);
 					else
 						// either multiple properties changed or there was no
@@ -1390,19 +1378,18 @@
 					try {
 						model.setRecordsPerPage(i);
 					} catch (RemoteException ex) {
-						JOptionPane.showMessageDialog(view, &quot;RemoteException: &quot;
-								+ ex);
-						ex.printStackTrace();
+                                            DefaultExceptionHandler.handle(view, ex);
+                                            return;
 					} catch (DBLayerException ex) {
-						JOptionPane.showMessageDialog(view,
-								&quot;DBLayerException: &quot; + ex);
-						ex.printStackTrace();
+                                            DefaultExceptionHandler.handle(view, ex);
+                                            return;
 					}
 				}
 			}
 		}
 	}
 
+        /** Keeps track of selected row in overview. */
 	class OverviewSelectionListener implements ListSelectionListener {
 		public void valueChanged(ListSelectionEvent e) {
 			// Ignore extra messages.
@@ -1420,6 +1407,7 @@
 		}
 	}
 
+        /** Handles double clicks in overview to invoke the Detail. */
 	class OverviewMouseListener implements MouseListener {
 		public void mouseClicked(MouseEvent e) {
 			if (e.getClickCount() &gt;= 2)
@@ -1427,22 +1415,24 @@
 					int resultNumber = model.getSelectedResultNumber();
                                         if (resultNumber &gt; model.getResultsCount()) {
                                             logger.error(&quot;Trying to show detail for a record number of which is bigger than results count. Have we been disconnected?&quot;);
-                                            JOptionPane.showMessageDialog(view,&quot;The connection has been probably lost.&quot;);
+                                            JOptionPane.showMessageDialog(view,L10n.getString(&quot;Error.LostConnection&quot;));
                                             return;
                                         }
                                         
 					if (resultNumber != model.getResultsCount())
 						model.selectAndShow(resultNumber);
 					detailModel.load(model.getSelectedResultNumber());
-					detailView.setVisible(true);
-				} catch (RemoteException ex) {//FIXME
-					JOptionPane.showMessageDialog(view, &quot;RemoteException: &quot;
-							+ ex);
-					ex.printStackTrace();
+                                        SwingUtilities.invokeLater( new Runnable() {
+                                            public void run() {
+                                                detailView.setVisible(true);
+                                            }
+                                        });
+				} catch (RemoteException ex) {
+                                    DefaultExceptionHandler.handle(view,ex);
+                                    return;
 				} catch (DBLayerException ex) {
-					JOptionPane.showMessageDialog(view, &quot;DBLayerException: &quot;
-							+ ex);
-					ex.printStackTrace();
+                                    DefaultExceptionHandler.handle(view,ex);
+                                    return;
 				}
 		}
 
@@ -1460,6 +1450,7 @@
 
 	}
 
+        /** Listnes to the enter key pressed in overview and invokes Detail. */
 	class OverviewKeyListener implements KeyListener {
 		public void keyTyped(KeyEvent e) {
 			if (e.getKeyText(e.getKeyChar()).equals(&quot;Space&quot;))
@@ -1483,15 +1474,17 @@
 					// we need to
 					// correct that
 					detailModel.load(model.getSelectedResultNumber());
-					detailView.setVisible(true);
+                                        SwingUtilities.invokeLater( new Runnable() {
+                                            public void run() {
+                                                detailView.setVisible(true);
+                                            }
+                                        });
 				} catch (RemoteException ex) {
-					JOptionPane.showMessageDialog(view, &quot;RemoteException: &quot;
-							+ ex);
-					ex.printStackTrace();
+                                    DefaultExceptionHandler.handle(view,ex);
+                                    return;
 				} catch (DBLayerException ex) {
-					JOptionPane.showMessageDialog(view, &quot;DBLayerException: &quot;
-							+ ex);
-					ex.printStackTrace();
+                                    DefaultExceptionHandler.handle(view,ex);
+                                    return;
 				}
 			}
 		}
@@ -1505,6 +1498,7 @@
 
 	}
 
+        /** Handles the login action. */
 	class LoginAction extends AbstractAction {
 		public LoginAction() {
 			putValue(NAME, L10n.getString(&quot;Overview.MenuFileLogin&quot;));
@@ -1539,7 +1533,7 @@
 				newDBView = new CreateDBView(view, newDBModel);
 				newDBCtrl = new CreateDBCtrl(newDBModel, newDBView);
 			}
-	    	view.setVisible(true);
+                        view.setVisible(true);
 		}
 	}
 
@@ -1568,13 +1562,17 @@
 			 * etc.)
 			 */
 
-			setDatabaseDependentCommandsEnabled(false);
+                        SwingUtilities.invokeLater( new Runnable() {
+                            public void run() {
+                                setDatabaseDependentCommandsEnabled(false);
+                            }
+                        });
 		}
 
 	}
 
 	
-	
+	/** Handles the reconnect action invoked from overview. */
 	public class ReconnectAction extends AbstractAction {
 
 		private Component parent = view;
@@ -1613,8 +1611,10 @@
 	}
 	
 
-	// Update all information about the database layer and inform everyone who
-	// has to be informed
+	/** Bridge from login / reconnect(?) to the rest of the application.
+         * Updates all information about the database layer and informs everyone who
+	 * has to be informed.
+         */
 	class DatabaseChange implements Observer {
 		/**
 		 * Fetches combobox items from AppCore and stores them to dialog models.
@@ -1661,56 +1661,52 @@
 			searchModel.setTerritories(model.getTerritories());
 		}
 
-		public void update(Observable targer, Object parameter) {
-			if (parameter != null &amp;&amp; parameter instanceof DBLayer) {
-				loginAction.setEnabled(false);
-				view.setCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));
+		public void update(final Observable targer, final Object parameter) {
+                    SwingUtilities.invokeLater( new Runnable() {
+                        public void run() {
+                            if (parameter != null &amp;&amp; parameter instanceof DBLayer) {
+                                    loginAction.setEnabled(false);
+                                    view.setCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));
 
-				logger.debug(&quot;Database layer retrieval.&quot;);
-				DBLayer dblayer = loginModel.getDBLayer();
+                                    logger.debug(&quot;Database layer retrieval.&quot;);
+                                    DBLayer dblayer = loginModel.getDBLayer();
 
-				// FIXME: neni potreba zresetovat stav treba loginModelu, pokdu
-				// neco takhle selze? pripadne stav jinyho objektu?
-				try {
-					model.setDatabase(dblayer);
-				} catch (RemoteException ex) {
-                                    logger.error(&quot;Caught an error in AppCoreCtrl update(): &quot;+ex.getMessage());
-                                    ex.printStackTrace();
-                                    DefaultReconnectDialog.show(view,ex);
-                                    return;
-				} catch (DBLayerException ex) {
-                                    logger.error(&quot;Caught an error in AppCoreCtrl update(): &quot;+ex.getMessage());
-                                    ex.printStackTrace();
-                                    DefaultReconnectDialog.show(view,ex);
-                                    return;
-				}
-				// distribute database to dialogs
-				addModel.setDatabase(dblayer);
-				editModel.setDatabase(dblayer);
-				searchModel.setDatabase(dblayer);
-				detailModel.setDatabase(dblayer);
+                                    // FIXME: neni potreba zresetovat stav treba loginModelu, pokdu
+                                    // neco takhle selze? pripadne stav jinyho objektu?
+                                    try {
+                                            model.setDatabase(dblayer);
+                                    } catch (RemoteException ex) {
+                                        logger.error(&quot;Caught an error in AppCoreCtrl update(): &quot;+ex.getMessage());
+                                        ex.printStackTrace();
+                                        DefaultReconnectDialog.show(view,ex);
+                                        return;
+                                    } catch (DBLayerException ex) {
+                                        logger.error(&quot;Caught an error in AppCoreCtrl update(): &quot;+ex.getMessage());
+                                        ex.printStackTrace();
+                                        DefaultReconnectDialog.show(view,ex);
+                                        return;
+                                    }
+                                    // distribute database to dialogs
+                                    addModel.setDatabase(dblayer);
+                                    editModel.setDatabase(dblayer);
+                                    searchModel.setDatabase(dblayer);
+                                    detailModel.setDatabase(dblayer);
 
-				model.setAccessRights(loginModel.getAccessRights());
-				model.login();
+                                    model.setAccessRights(loginModel.getAccessRights());
+                                    model.login();
 
-				view.getSBM().display(L10n.getString(&quot;Message.FillingDialogs&quot;));
-				fillDialogModels();
+                                    view.getSBM().display(L10n.getString(&quot;Message.FillingDialogs&quot;));
+                                    fillDialogModels();
 
-				view.getSBM().display(L10n.getString(&quot;Message.LoadingOverviewData&quot;));
-				searchModel.clear();
-				searchModel.constructQuery();
-				view.getSBM().displayDefaultText();
+                                    view.getSBM().display(L10n.getString(&quot;Message.LoadingOverviewData&quot;));
+                                    searchModel.clear();
+                                    searchModel.constructQuery();
 
-				view.initOverview();
-				view.setCursor(Cursor.getDefaultCursor());
-				setDatabaseDependentCommandsEnabled(true);
-				
-                                
-                                //this can't be done earlier. must be done after the query is created
-                                //otherwise this listener would give the overview table model commands to load data
-                                //for a query that doesn't exist yet
-                                view.overviewScrollPane.addComponentListener(overviewResizeListener);
+                                    view.getSBM().displayDefaultText();
 
+                                    view.initOverview();
+                                    view.setCursor(Cursor.getDefaultCursor());
+                                    setDatabaseDependentCommandsEnabled(true);
 				/*-------------------------------------------------------------------
 				 *  This may no longer be necessary:
 				 *------------------------------------------------------------------*/
@@ -1741,6 +1737,46 @@
 	}
 
 
+                                    //this can't be done earlier. must be done after the query is created
+                                    //otherwise this listener would give the overview table model commands to load data
+                                    //for a query that doesn't exist yet
+                                    view.overviewScrollPane.addComponentListener(overviewResizeListener);
+
+                                    /*-------------------------------------------------------------------
+                                     *  This may no longer be necessary:
+                                     *------------------------------------------------------------------*/
+                    logger.debug(&quot;Distributing the new database layer to:&quot;);
+                    logger.debug(&quot; # export &quot;);
+                                    if( exportModel != null )
+                                            exportModel.setDBLayer( dblayer );
+                                    logger.debug(&quot; # occurrence data import &quot;);
+                                    if( importModel != null )
+                                            importModel.setDBLayer( dblayer );
+                                    logger.debug(&quot; # table data import &quot;);
+                                    if( tableImportModel != null )
+                                            tableImportModel.setDBLayer( dblayer );
+                                    logger.debug(&quot; # record history &quot;);
+                                    if (historyModel != null ) 
+                                            historyModel.setDBLayer( dblayer );
+                                    logger.debug(&quot; # complete history &quot;);
+                                    if (wholeHistoryModel != null ) 
+                                            wholeHistoryModel.setDBLayer( dblayer );
+                                    logger.debug(&quot; # user manager &quot;);
+                                    if (userManagerModel != null )
+                                            userManagerModel.setDBLayer( dblayer );
+                                    logger.debug(&quot; # metadata manager &quot;);
+                                    if (metadataManagerModel != null )
+                                            metadataManagerModel.setDBLayer( dblayer );							
+                            }//if
+                        }//run()
+                    });//invokeLater
+		}//update()
+	}//DatabaseChange
+
+
+        /** Helper class to refresh overview or to create a task that refreshes overview.
+         *
+         */
 	private Task refreshOverview(boolean createTask) {
 		if (createTask) {
 			Task task = new Task() {
@@ -1760,6 +1796,7 @@
 		}
 	}
 
+        /** Handles the refresh action invoked from overview. */
 	class RefreshAction extends AbstractAction {
 		public RefreshAction() {
 			if (showButtonText)
@@ -1769,21 +1806,19 @@
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.RefreshTT&quot;));
 			putValue(ACCELERATOR_KEY, KeyStroke.getKeyStroke(KeyEvent.VK_R,
 					ActionEvent.CTRL_MASK));
-			// putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Overview.Refresh&quot;));
 		}
 
 		public void actionPerformed(ActionEvent e) {
 			// e can be null !!! - we call actionPerformed(null) in DeleteAction
 			Task task = refreshOverview(true);
 			ProgressBar progressBar = new DefaultProgressBar(task, view, true);
-			progressBar.setTitle(L10n.getString(&quot;Overview.Refresh.ProgressTitle&quot;));
 
 			task.start();
 		}
 
 	}
 
-	/**
+	/** Bridge between mostly managers and the rest of the application. 
 	 * Propagates changes made in managers to the rest of the application.
 	 * 
 	 */
@@ -1873,24 +1908,20 @@
 						}// switch table
 					}// for
 				} catch (DBLayerException ex) {
-					JOptionPane.showMessageDialog(view, L10n
-							.getString(&quot;Error.DBLayerException&quot;)
-							+ &quot;\n&quot; + ex.getErrorInfo(), L10n
-							.getString(&quot;Error.DBLayerExceptionTitle&quot;),
-							JOptionPane.WARNING_MESSAGE);
-					logger.error(ex + &quot;: &quot; + ex.getErrorInfo());
+                                    DefaultExceptionHandler.handle(view,ex);
+                                    return;
 				} catch (RemoteException ex) {
-					JOptionPane.showMessageDialog(view, L10n
-							.getString(&quot;Error.RemoteException&quot;)
-							+ &quot;\n&quot; + ex.getMessage(), L10n
-							.getString(&quot;Error.RemoteExceptionTitle&quot;),
-							JOptionPane.WARNING_MESSAGE);
-					logger.error(ex);
+                                    DefaultExceptionHandler.handle(view,ex);
+                                    return;
 				}
 			}// if arg instanceof Table[]
 		}// update()
 	}// class ManagerBridge
 
+        /** Handles resizing of Plantlore's main window.
+         *
+         * Computes and changes the page size if needed.
+         */
 	class OverviewResizeListener implements ComponentListener {
 		private final static int sub = 20; // height of the header row perhaps
 
@@ -1906,12 +1937,12 @@
 			try {
 				model.setRecordsPerPage(newRecordsCount);
 				view.recordsPerPage.setValue(newRecordsCount);
-			} catch (RemoteException ex) {
-				JOptionPane.showMessageDialog(view, &quot;RemoteException: &quot; + ex);
-				ex.printStackTrace();
+                        } catch (RemoteException ex) {
+                            DefaultExceptionHandler.handle(view,ex);
+                            return;
 			} catch (DBLayerException ex) {
-				JOptionPane.showMessageDialog(view, &quot;DBLayerException: &quot; + ex);
-				ex.printStackTrace();
+                            DefaultExceptionHandler.handle(view,ex);
+                            return;
 			}
 		}
 

Modified: trunk/src/net/sf/plantlore/client/AppCoreView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreView.form	2006-09-02 08:21:17 UTC (rev 627)
+++ trunk/src/net/sf/plantlore/client/AppCoreView.form	2006-09-02 13:03:14 UTC (rev 628)
@@ -512,7 +512,7 @@
         &lt;/DimensionLayout&gt;
         &lt;DimensionLayout dim=&quot;1&quot;&gt;
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;Component id=&quot;overviewScrollPane&quot; alignment=&quot;1&quot; pref=&quot;172&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;overviewScrollPane&quot; alignment=&quot;1&quot; pref=&quot;136&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
       &lt;/Layout&gt;

Modified: trunk/src/net/sf/plantlore/client/AppCoreView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreView.java	2006-09-02 08:21:17 UTC (rev 627)
+++ trunk/src/net/sf/plantlore/client/AppCoreView.java	2006-09-02 13:03:14 UTC (rev 628)
@@ -15,6 +15,7 @@
 import javax.swing.AbstractAction;
 import javax.swing.Action;
 import javax.swing.ListSelectionModel;
+import javax.swing.SwingUtilities;
 import javax.swing.event.ListSelectionListener;
 import javax.swing.table.TableColumn;
 import net.sf.plantlore.client.overview.*;
@@ -422,42 +423,46 @@
         });
     }
 
-    public void update(Observable observable, Object object) {
-        if (object != null &amp;&amp; object instanceof String) {
-            String arg = (String) object;
-            if (arg.equals(&quot;PAGE_CHANGED&quot;)||arg.equals(&quot;RECORDS_PER_PAGE&quot;)) {
-                recordsCount.setText(&quot;&quot;+model.getResultsCount());
-                pageStatus.setText(&quot;&quot;+model.getCurrentPage()+&quot;/&quot;+model.getPagesCount());
-                //FIXME: change selection only if really required
-                overview.changeSelection(model.getSelectedRowNumber(),0,false,false);
-                return;
-            }
-            if (arg.equals(&quot;NEW_QUERY&quot;)) {
-                //setPreferredColumnSizes();
-                overview.setEnabled(true);
-                overview.setVisible(true);
-                recordsCount.setText(&quot;&quot;+model.getResultsCount());
-                pageStatus.setText(&quot;&quot;+model.getCurrentPage()+&quot;/&quot;+model.getPagesCount()); 
-                overview.getSelectionModel().setSelectionInterval(0,0);
-                return;
-            }
-            if (arg.equals(&quot;LOADING_NEW_DATA&quot;)) {
-                //TableSorter and OverviewTable model threw exceptions while loading data
-                //because they were trying to display data in possibly inconsistent state
-                //I hope that I've fixed it at least in OverviewTableModel where data are now
-                //loaded into a new variable and then put in place of the working data at one point
-                //
-                //However now I noticed a NullPointerException from TableSorter, which is not my work
-                //and I don't want to study it now, so we'll try to ensure that overview doesn't ask
-                //for any data during the loading:
-                overview.setVisible(false);
-                overview.setEnabled(false);
-            }
-            if (arg.equals(&quot;SELECTION_CHANGED&quot;)) {
-                overview.getSelectionModel().setSelectionInterval(model.getSelectedRowNumber(),model.getSelectedRowNumber());
-            }
-        }        
-    }
+    public void update(final Observable observable, final Object object) {
+        SwingUtilities.invokeLater( new Runnable() {
+            public void run() {
+                if (object != null &amp;&amp; object instanceof String) {
+                    String arg = (String) object;
+                    if (arg.equals(&quot;PAGE_CHANGED&quot;)||arg.equals(&quot;RECORDS_PER_PAGE&quot;)) {
+                        recordsCount.setText(&quot;&quot;+model.getResultsCount());
+                        pageStatus.setText(&quot;&quot;+model.getCurrentPage()+&quot;/&quot;+model.getPagesCount());
+                        //FIXME: change selection only if really required
+                        overview.changeSelection(model.getSelectedRowNumber(),0,false,false);
+                        return;
+                    }
+                    if (arg.equals(&quot;NEW_QUERY&quot;)) {
+                        //setPreferredColumnSizes();
+                        overview.setEnabled(true);
+                        overview.setVisible(true);
+                        recordsCount.setText(&quot;&quot;+model.getResultsCount());
+                        pageStatus.setText(&quot;&quot;+model.getCurrentPage()+&quot;/&quot;+model.getPagesCount()); 
+                        overview.getSelectionModel().setSelectionInterval(0,0);
+                        return;
+                    }
+                    if (arg.equals(&quot;LOADING_NEW_DATA&quot;)) {
+                        //TableSorter and OverviewTable model threw exceptions while loading data
+                        //because they were trying to display data in possibly inconsistent state
+                        //I hope that I've fixed it at least in OverviewTableModel where data are now
+                        //loaded into a new variable and then put in place of the working data at one point
+                        //
+                        //However now I noticed a NullPointerException from TableSorter, which is not my work
+                        //and I don't want to study it now, so we'll try to ensure that overview doesn't ask
+                        //for any data during the loading:
+                        overview.setVisible(false);
+                        overview.setEnabled(false);
+                    }
+                    if (arg.equals(&quot;SELECTION_CHANGED&quot;)) {
+                        overview.getSelectionModel().setSelectionInterval(model.getSelectedRowNumber(),model.getSelectedRowNumber());
+                    }
+                }//if instanceof String        
+            }//run()
+        });//invokeLater()
+    }//update()
 
     private void setPreferredColumnSizes() {
         OverviewTableModel otm = model.getTableModel();

Modified: trunk/src/net/sf/plantlore/client/overview/AddEdit.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-09-02 08:21:17 UTC (rev 627)
+++ trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-09-02 13:03:14 UTC (rev 628)
@@ -180,7 +180,7 @@
      * @return &gt;=0 if everything was OK
      * @return -1 if the Occurrence table overflew
      */
-    public int setRecord(Integer occurrenceId) throws DBLayerException, RemoteException {
+    public int loadRecord(Integer occurrenceId) throws DBLayerException, RemoteException {
         logger.debug(&quot;Loading AddEdit data for occurrence id &quot;+occurrenceId);
         
         clearOccurrence();

Modified: trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java	2006-09-02 08:21:17 UTC (rev 627)
+++ trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java	2006-09-02 13:03:14 UTC (rev 628)
@@ -15,29 +15,19 @@
 import java.awt.event.ActionListener;
 import java.awt.event.FocusEvent;
 import java.awt.event.FocusListener;
-import java.awt.event.ItemEvent;
-import java.awt.event.ItemListener;
-import java.awt.event.MouseAdapter;
-import java.awt.event.MouseEvent;
 import java.beans.PropertyChangeEvent;
 import java.beans.PropertyChangeListener;
 import java.rmi.RemoteException;
 import java.text.DateFormat;
-import java.text.MessageFormat;
 import java.text.NumberFormat;
 import java.text.ParseException;
 import java.util.ArrayList;
 import java.util.Calendar;
 import java.util.Date;
-import java.util.Locale;
 
 import javax.swing.AbstractAction;
-import javax.swing.DefaultCellEditor;
-import javax.swing.JButton;
-import javax.swing.JCheckBox;
 import javax.swing.JComboBox;
 import javax.swing.JDialog;
-import javax.swing.JFormattedTextField;
 import javax.swing.JOptionPane;
 import javax.swing.JSpinner;
 import javax.swing.JTextArea;
@@ -46,24 +36,20 @@
 import javax.swing.event.ChangeListener;
 import javax.swing.event.DocumentEvent;
 import javax.swing.event.DocumentListener;
-import javax.swing.table.TableColumn;
 import javax.swing.text.BadLocationException;
 import com.toedter.calendar.JCalendar;
-import net.sf.plantlore.client.*;
+import org.apache.log4j.Logger;
 
 import net.sf.plantlore.client.checklist.ChecklistCtrl;
 import net.sf.plantlore.client.checklist.ChecklistView;
-import net.sf.plantlore.common.AutoComboBox;
 import net.sf.plantlore.common.AutoComboBoxNG3;
 import net.sf.plantlore.common.AutoTextArea;
 import net.sf.plantlore.common.DefaultEscapeKeyPressed;
 import net.sf.plantlore.common.DefaultReconnectDialog;
 import net.sf.plantlore.common.Pair;
-import net.sf.plantlore.common.PlantloreHelp;
 import net.sf.plantlore.common.exception.DBLayerException;
 import net.sf.plantlore.common.record.Occurrence;
 import net.sf.plantlore.l10n.L10n;
-import org.apache.log4j.Logger;
 
 /**
  *

Modified: trunk/src/net/sf/plantlore/client/overview/search/Search.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/search/Search.java	2006-09-02 08:21:17 UTC (rev 627)
+++ trunk/src/net/sf/plantlore/client/overview/search/Search.java	2006-09-02 13:03:14 UTC (rev 628)
@@ -205,11 +205,22 @@
     public void setPhytName(Pair&lt;String, Integer&gt; phytName) {
         if (phytName == null)
             return;
+        
         if (skipUpdate) {
             skipUpdate = false;
             logger.debug(&quot;Skipping setPhytName&quot;);
             return;
         }
+
+        if (phytName.equals(EMPTY_PAIR)) {
+            this.phytCode = EMPTY_PAIR;
+            this.phytName = EMPTY_PAIR;
+            skipUpdate = true;
+            setChanged();
+            notifyObservers(new Pair&lt;String,Integer&gt;(&quot;updateCode&quot;,-1));
+            return;
+        }
+            
         this.phytName = phytName;
         if (phytCodes != null)
             for (int i=0; i &lt; phytCodes.length; i++) {
@@ -234,12 +245,22 @@
     public void setPhytCode(Pair&lt;String, Integer&gt; phytCode) {
         if (phytCode == null)
             return;
-        
+            
         if (skipUpdate) {
             skipUpdate = false;
             logger.debug(&quot;Skipping setPhytCode&quot;);
             return;
         }
+
+        if (phytCode.equals(EMPTY_PAIR)) {
+            this.phytName = EMPTY_PAIR;
+            this.phytCode = EMPTY_PAIR;
+            skipUpdate = true;
+            setChanged();
+            notifyObservers(new Pair&lt;String,Integer&gt;(&quot;updateName&quot;,-1));
+            return;
+        }
+            
         this.phytCode = phytCode;
         if (phytNames != null)
             for (int i=0; i &lt; phytNames.length; i++) {

Modified: trunk/src/net/sf/plantlore/client/overview/search/SearchView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/search/SearchView.java	2006-09-02 08:21:17 UTC (rev 627)
+++ trunk/src/net/sf/plantlore/client/overview/search/SearchView.java	2006-09-02 13:03:14 UTC (rev 628)
@@ -13,6 +13,7 @@
 import javax.swing.DefaultComboBoxModel;
 import javax.swing.JComboBox;
 import javax.swing.JDialog;
+import javax.swing.SwingUtilities;
 import javax.swing.event.PopupMenuEvent;
 import javax.swing.event.PopupMenuListener;
 import javax.swing.table.TableColumn;
@@ -841,165 +842,176 @@
         });
     }
 
-    public void update(Observable o, Object arg) {
-        if (arg != null &amp;&amp; arg instanceof Pair) {
-            String s = ((Pair&lt;String,Integer&gt;)arg).getFirst();
-            int row = ((Pair&lt;String,Integer&gt;)arg).getSecond(); 
-            if (s.equals(&quot;updateCode&quot;))
-                phytCodeCombo.setSelectedItem(model.getPhytCode());
-            if (s.equals(&quot;updateName&quot;))
-                phytNameCombo.setSelectedItem(model.getPhytName());
-            if (s.equals(&quot;addAuthorRow&quot;)) {
-                tableModel.addRow();
-                /*
-                DefaultCellEditor dce = (DefaultCellEditor) authorTable.getCellEditor(0,0);
-                Object o = dce.getCellEditorValue();
-                 */            
-            }             
-            if (s.equals(&quot;removeAuthorRow&quot;)) {
-                tableModel.removeRow(row);
-                //unfortunately have to set up the editors and renderers again because of the
-                //fireTableStructureChanged() in the tableModel.removeRow() ... :-/
-                //initAuthorTable();            
-            }            
-        }//instanceof Pair
+    /** Observer update method.
+     *
+     * Updates the dialog as messages from the observable model come.
+     */
+    public void update(final Observable o, final Object arg) {
+        SwingUtilities.invokeLater(new Runnable() {
+            public void run() {
         
-        if (arg != null &amp;&amp; arg instanceof String) {
-            String s = (String) arg;
-            
-            if (s.equals(&quot;CLEAR&quot;)) {
-                clearComponentData();
-                return;
-            }
-            
-            if (s.equals(&quot;PLANTS_CHANGED&quot;)) {
-                logger.debug(&quot;Updating plant area&quot;);
-                if (model.getPlants() == null) {
-                    ((AutoTextArea)taxonTextArea).setChoices(new String[] {&quot;&quot;});
-                    return;
-                }
-                Pair&lt;String, Integer&gt;[] plants = model.getPlants();
-                String[] choices = new String[plants.length];
-                for (int i = 0; i &lt; plants.length; i++) 
-                    choices[i] = plants[i].getFirst();
-                
-                ((AutoTextArea)taxonTextArea).setChoices(choices);
-                return;
-            }
-            
-            if (s.equals(&quot;AUTHORS_CHANGED&quot;)) {
-                logger.debug(&quot;Updating authors combo&quot;);
-                JComboBox cb;
-                
-                if (model.getAuthors() == null) 
-                    cb = new AutoComboBoxNG3();
-                else
-                    cb = new AutoComboBoxNG3(model.getAuthors());
-                    
-                TableColumn tc1 = authorTable.getColumnModel().getColumn(0);
+                if (arg != null &amp;&amp; arg instanceof Pair) {
+                    String s = ((Pair&lt;String,Integer&gt;)arg).getFirst();
+                    int row = ((Pair&lt;String,Integer&gt;)arg).getSecond(); 
+                    if (s.equals(&quot;updateCode&quot;))
+                        phytCodeCombo.setSelectedItem(model.getPhytCode());
+                    if (s.equals(&quot;updateName&quot;))
+                        phytNameCombo.setSelectedItem(model.getPhytName());
+                    if (s.equals(&quot;addAuthorRow&quot;)) {
+                        tableModel.addRow();
+                        /*
+                        DefaultCellEditor dce = (DefaultCellEditor) authorTable.getCellEditor(0,0);
+                        Object o = dce.getCellEditorValue();
+                         */            
+                    }             
+                    if (s.equals(&quot;removeAuthorRow&quot;)) {
+                        tableModel.removeRow(row);
+                        //unfortunately have to set up the editors and renderers again because of the
+                        //fireTableStructureChanged() in the tableModel.removeRow() ... :-/
+                        //initAuthorTable();            
+                    }            
+                }//instanceof Pair
 
-                
-                tc1.setCellEditor(new DefaultCellEditor(cb));  
-                return;
-            }
+                if (arg != null &amp;&amp; arg instanceof String) {
+                    String s = (String) arg;
 
-            if (s.equals(&quot;AUTHORROLES_CHANGED&quot;)) {
-                logger.debug(&quot;Updating authorroles combobox&quot;);
-                JComboBox cb;
-                
-                if (model.getAuthorRoles() == null)
-                    cb = new AutoComboBoxNG3();
-                else
-                    cb = new AutoComboBoxNG3(model.getAuthorRoles());
+                    if (s.equals(&quot;CLEAR&quot;)) {
+                        clearComponentData();
+                        return;
+                    }
 
-                TableColumn tc2 = authorTable.getColumnModel().getColumn(1);
-                
-                tc2.setCellEditor(new DefaultCellEditor(cb));                
-                return;
-            }
-            
-            if (s.equals(&quot;VILLAGES_CHANGED&quot;)) {
-                logger.debug(&quot;Updating villages combobox&quot;);
-                if (model.getVillages() == null)
-                    townComboBox.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
-                else
-                    townComboBox.setModel(new DefaultComboBoxModel(model.getVillages()));
-                townComboBox.insertItemAt(model.EMPTY_PAIR,0);
-                return;
-            }
-            
-            if (s.equals(&quot;TERRITORIES_CHANGED&quot;)) {
-                logger.debug(&quot;Updating territories combobox&quot;);
-                if (model.getTerritories() == null)
-                    territoryNameCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
-                else
-                    territoryNameCombo.setModel(new DefaultComboBoxModel(model.getTerritories()));
-                territoryNameCombo.insertItemAt(model.EMPTY_PAIR,0);
-                return;
-            }
+                    if (s.equals(&quot;PLANTS_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating plant area&quot;);
+                        if (model.getPlants() == null) {
+                            ((AutoTextArea)taxonTextArea).setChoices(new String[] {&quot;&quot;});
+                            return;
+                        }
+                        Pair&lt;String, Integer&gt;[] plants = model.getPlants();
+                        String[] choices = new String[plants.length];
+                        for (int i = 0; i &lt; plants.length; i++) 
+                            choices[i] = plants[i].getFirst();
 
-            if (s.equals(&quot;PHYTNAMES_CHANGED&quot;)) {
-                logger.debug(&quot;Updating phytnames combobox&quot;);
-                if (model.getPhytNames() == null)
-                    phytNameCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
-                else
-                    phytNameCombo.setModel(new DefaultComboBoxModel(model.getPhytNames()));
-                phytNameCombo.insertItemAt(model.EMPTY_PAIR,0);
-                return;
-            }
+                        ((AutoTextArea)taxonTextArea).setChoices(choices);
+                        return;
+                    }
 
-            if (s.equals(&quot;PHYTCODES_CHANGED&quot;)) {
-                logger.debug(&quot;Updating phytcodes combobox&quot;);
-                if (model.getPhytCodes() == null)
-                    phytCodeCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
-                else
-                    phytCodeCombo.setModel(new DefaultComboBoxModel(model.getPhytCodes()));
-                phytCodeCombo.insertItemAt(model.EMPTY_PAIR,0);
-                return;
-            }
+                    if (s.equals(&quot;AUTHORS_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating authors combo&quot;);
+                        JComboBox cb;
 
-            if (s.equals(&quot;COUNTRIES_CHANGED&quot;)) {
-                logger.debug(&quot;Updating countries combobox&quot;);
-                if (model.getCountries() == null)
-                    phytCountryCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
-                else
-                    phytCountryCombo.setModel(new DefaultComboBoxModel(model.getCountries()));
-                phytCountryCombo.insertItemAt(model.EMPTY_STRING,0);
-                return;
-            }
-            
-            if (s.equals(&quot;SOURCES_CHANGED&quot;)) {
-                logger.debug(&quot;Updating sources combobox&quot;);
-                if (model.getSources() == null)
-                    sourceCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
-                else
-                    sourceCombo.setModel(new DefaultComboBoxModel(model.getSources()));
-                sourceCombo.insertItemAt(model.EMPTY_STRING,0);
-                return;
-            }
-            
-            if (s.equals(&quot;PUBLICATIONS_CHANGED&quot;)) {
-                logger.debug(&quot;Updating publications combobox&quot;);
-                if (model.getPublications() == null)
-                    publicationCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
-                else
-                    publicationCombo.setModel(new DefaultComboBoxModel(model.getPublications()));
-                publicationCombo.insertItemAt(model.EMPTY_PAIR,0);
-                return;
-            }
+                        if (model.getAuthors() == null) 
+                            cb = new AutoComboBoxNG3();
+                        else
+                            cb = new AutoComboBoxNG3(model.getAuthors());
 
-            if (s.equals(&quot;PROJECTS_CHANGED&quot;)) {
-                logger.debug(&quot;Updating projects combobox&quot;);
-                if (model.getProjects() == null)
-                    projectCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
-                else
-                    projectCombo.setModel(new DefaultComboBoxModel(model.getProjects()));
-                projectCombo.insertItemAt(model.EMPTY_PAIR,0);
-                return;
-            }                       
-        }//instanceof String
-    }
+                        TableColumn tc1 = authorTable.getColumnModel().getColumn(0);
+
+
+                        tc1.setCellEditor(new DefaultCellEditor(cb));  
+                        return;
+                    }
+
+                    if (s.equals(&quot;AUTHORROLES_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating authorroles combobox&quot;);
+                        JComboBox cb;
+
+                        if (model.getAuthorRoles() == null)
+                            cb = new AutoComboBoxNG3();
+                        else
+                            cb = new AutoComboBoxNG3(model.getAuthorRoles());
+
+                        TableColumn tc2 = authorTable.getColumnModel().getColumn(1);
+
+                        tc2.setCellEditor(new DefaultCellEditor(cb));                
+                        return;
+                    }
+
+                    if (s.equals(&quot;VILLAGES_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating villages combobox&quot;);
+                        if (model.getVillages() == null)
+                            townComboBox.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
+                        else
+                            townComboBox.setModel(new DefaultComboBoxModel(model.getVillages()));
+                        townComboBox.insertItemAt(model.EMPTY_PAIR,0);
+                        return;
+                    }
+
+                    if (s.equals(&quot;TERRITORIES_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating territories combobox&quot;);
+                        if (model.getTerritories() == null)
+                            territoryNameCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
+                        else
+                            territoryNameCombo.setModel(new DefaultComboBoxModel(model.getTerritories()));
+                        territoryNameCombo.insertItemAt(model.EMPTY_PAIR,0);
+                        return;
+                    }
+
+                    if (s.equals(&quot;PHYTNAMES_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating phytnames combobox&quot;);
+                        if (model.getPhytNames() == null)
+                            phytNameCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
+                        else
+                            phytNameCombo.setModel(new DefaultComboBoxModel(model.getPhytNames()));
+                        phytNameCombo.insertItemAt(model.EMPTY_PAIR,0);
+                        return;
+                    }
+
+                    if (s.equals(&quot;PHYTCODES_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating phytcodes combobox&quot;);
+                        if (model.getPhytCodes() == null)
+                            phytCodeCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
+                        else
+                            phytCodeCombo.setModel(new DefaultComboBoxModel(model.getPhytCodes()));
+                        phytCodeCombo.insertItemAt(model.EMPTY_PAIR,0);
+                        return;
+                    }
+
+                    if (s.equals(&quot;COUNTRIES_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating countries combobox&quot;);
+                        if (model.getCountries() == null)
+                            phytCountryCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
+                        else
+                            phytCountryCombo.setModel(new DefaultComboBoxModel(model.getCountries()));
+                        phytCountryCombo.insertItemAt(model.EMPTY_STRING,0);
+                        return;
+                    }
+
+                    if (s.equals(&quot;SOURCES_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating sources combobox&quot;);
+                        if (model.getSources() == null)
+                            sourceCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
+                        else
+                            sourceCombo.setModel(new DefaultComboBoxModel(model.getSources()));
+                        sourceCombo.insertItemAt(model.EMPTY_STRING,0);
+                        return;
+                    }
+
+                    if (s.equals(&quot;PUBLICATIONS_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating publications combobox&quot;);
+                        if (model.getPublications() == null)
+                            publicationCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
+                        else
+                            publicationCombo.setModel(new DefaultComboBoxModel(model.getPublications()));
+                        publicationCombo.insertItemAt(model.EMPTY_PAIR,0);
+                        return;
+                    }
+
+                    if (s.equals(&quot;PROJECTS_CHANGED&quot;)) {
+                        logger.debug(&quot;Updating projects combobox&quot;);
+                        if (model.getProjects() == null)
+                            projectCombo.setModel(new DefaultComboBoxModel(new String[] {&quot;&quot;}));
+                        else
+                            projectCombo.setModel(new DefaultComboBoxModel(model.getProjects()));
+                        projectCombo.insertItemAt(model.EMPTY_PAIR,0);
+                        return;
+                    }                       
+                }//instanceof String
+            }//run()
+        }//runnable
+        );//invokeLater
         
+    }//update()
+        
     
     // Variables declaration - do not modify//GEN-BEGIN:variables
     protected javax.swing.JRadioButton S42Button;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000881.html">[Plantlore-dev] r627 - trunk/src/net/sf/plantlore/common
</A></li>
	<LI>Next message: <A HREF="000883.html">[Plantlore-dev] r629 - trunk/src/net/sf/plantlore/client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#882">[ date ]</a>
              <a href="thread.html#882">[ thread ]</a>
              <a href="subject.html#882">[ subject ]</a>
              <a href="author.html#882">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
