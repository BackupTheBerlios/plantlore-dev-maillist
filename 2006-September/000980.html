<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r709 - in trunk/src/net/sf/plantlore: client	client/overview client/overview/tree client/resources common
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-September/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r709%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%0A%09client/overview%20client/overview/tree%20client/resources%20common&In-Reply-To=%3C200609061740.k86HeMen009318%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000979.html">
   <LINK REL="Next"  HREF="000981.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r709 - in trunk/src/net/sf/plantlore: client	client/overview client/overview/tree client/resources common</H1>
    <B>fraktalek at mail.berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r709%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%0A%09client/overview%20client/overview/tree%20client/resources%20common&In-Reply-To=%3C200609061740.k86HeMen009318%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r709 - in trunk/src/net/sf/plantlore: client	client/overview client/overview/tree client/resources common">fraktalek at mail.berlios.de
       </A><BR>
    <I>Wed Sep  6 19:40:22 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000979.html">[Plantlore-dev] r708 - in trunk/src/net/sf/plantlore:	client/createdb common/exception l10n server
</A></li>
        <LI>Next message: <A HREF="000981.html">[Plantlore-dev] r710 - trunk/src/net/sf/plantlore/client/resources
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#980">[ date ]</a>
              <a href="thread.html#980">[ thread ]</a>
              <a href="subject.html#980">[ subject ]</a>
              <a href="author.html#980">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fraktalek
Date: 2006-09-06 19:40:21 +0200 (Wed, 06 Sep 2006)
New Revision: 709

Added:
   trunk/src/net/sf/plantlore/client/resources/icon32.gif
Modified:
   trunk/src/net/sf/plantlore/client/AboutView.form
   trunk/src/net/sf/plantlore/client/AboutView.java
   trunk/src/net/sf/plantlore/client/AppCore.java
   trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
   trunk/src/net/sf/plantlore/client/AppCoreView.form
   trunk/src/net/sf/plantlore/client/AppCoreView.java
   trunk/src/net/sf/plantlore/client/Plantlore.java
   trunk/src/net/sf/plantlore/client/overview/AddEdit.java
   trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java
   trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeCtrl.java
   trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.form
   trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.java
   trunk/src/net/sf/plantlore/common/DBLayerUtils.java
Log:
Fixed habitat deletion so that it works now as expected. Closing queries on exception in deleteHabitat in DBLayerUtils.
Habitat tree fixed a little.
The main application frame now has a not very nice icon...
..



Modified: trunk/src/net/sf/plantlore/client/AboutView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/AboutView.form	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/AboutView.form	2006-09-06 17:40:21 UTC (rev 709)
@@ -43,7 +43,7 @@
           &lt;/Properties&gt;
           &lt;Constraints&gt;
             &lt;Constraint layoutClass=&quot;org.netbeans.modules.form.compat2.layouts.support.JTabbedPaneSupportLayout&quot; value=&quot;org.netbeans.modules.form.compat2.layouts.support.JTabbedPaneSupportLayout$JTabbedPaneConstraintsDescription&quot;&gt;
-              &lt;JTabbedPaneConstraints tabName=&quot;&quot;&gt;
+              &lt;JTabbedPaneConstraints tabName=&quot;About&quot;&gt;
                 &lt;Property name=&quot;tabTitle&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
                   &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Overview.About.About&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
                 &lt;/Property&gt;
@@ -54,25 +54,43 @@
           &lt;Layout&gt;
             &lt;DimensionLayout dim=&quot;0&quot;&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;EmptySpace min=&quot;0&quot; pref=&quot;377&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;aboutLabel&quot; alignment=&quot;0&quot; pref=&quot;377&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;
             &lt;DimensionLayout dim=&quot;1&quot;&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;EmptySpace min=&quot;0&quot; pref=&quot;250&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;aboutLabel&quot; alignment=&quot;0&quot; pref=&quot;250&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;
           &lt;/Layout&gt;
+          &lt;SubComponents&gt;
+            &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;aboutLabel&quot;&gt;
+              &lt;AccessibilityProperties&gt;
+                &lt;Property name=&quot;AccessibleContext.accessibleName&quot; type=&quot;java.lang.String&quot; value=&quot;Plantlore 1.0&quot;/&gt;
+              &lt;/AccessibilityProperties&gt;
+              &lt;AuxValues&gt;
+                &lt;AuxValue name=&quot;JavaCodeGenerator_CreateCodeCustom&quot; type=&quot;java.lang.String&quot; value=&quot;new JLabel(new ImageIcon(java.awt.Toolkit.getDefaultToolkit().getImage(AppCoreView.class.getResource(&quot;resources/splash_new.jpg&quot;))));&quot;/&gt;
+              &lt;/AuxValues&gt;
+            &lt;/Component&gt;
+          &lt;/SubComponents&gt;
         &lt;/Container&gt;
         &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;detailTab&quot;&gt;
           &lt;Properties&gt;
+            &lt;Property name=&quot;background&quot; type=&quot;java.awt.Color&quot; editor=&quot;org.netbeans.beaninfo.editors.ColorEditor&quot;&gt;
+              &lt;Color blue=&quot;ff&quot; green=&quot;ff&quot; red=&quot;ff&quot; type=&quot;rgb&quot;/&gt;
+            &lt;/Property&gt;
+            &lt;Property name=&quot;border&quot; type=&quot;javax.swing.border.Border&quot; editor=&quot;org.netbeans.modules.form.editors2.BorderEditor&quot;&gt;
+              &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.TitledBorderInfo&quot;&gt;
+                &lt;TitledBorder/&gt;
+              &lt;/Border&gt;
+            &lt;/Property&gt;
             &lt;Property name=&quot;name&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
               &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Overview.About.Detail&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
             &lt;/Property&gt;
           &lt;/Properties&gt;
           &lt;Constraints&gt;
             &lt;Constraint layoutClass=&quot;org.netbeans.modules.form.compat2.layouts.support.JTabbedPaneSupportLayout&quot; value=&quot;org.netbeans.modules.form.compat2.layouts.support.JTabbedPaneSupportLayout$JTabbedPaneConstraintsDescription&quot;&gt;
-              &lt;JTabbedPaneConstraints tabName=&quot;Detail: &quot;&gt;
+              &lt;JTabbedPaneConstraints tabName=&quot;Detail&quot;&gt;
                 &lt;Property name=&quot;tabTitle&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
                   &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Overview.About.Detail&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
                 &lt;/Property&gt;
@@ -84,44 +102,30 @@
             &lt;DimensionLayout dim=&quot;0&quot;&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                   &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                                  &lt;Component id=&quot;versionLabel&quot; alignment=&quot;0&quot; pref=&quot;343&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;osLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;javaLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;userDirLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;configDirLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;authorsLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;/Group&gt;
                               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Component id=&quot;versionLabel&quot; pref=&quot;353&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Component id=&quot;osLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                                  &lt;Component id=&quot;erikLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;ladaLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;kovoLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;jakubLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;/Group&gt;
+                              &lt;EmptySpace min=&quot;-2&quot; pref=&quot;29&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;/Group&gt;
-                          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Component id=&quot;javaLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;/Group&gt;
-                          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Component id=&quot;userDirLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;/Group&gt;
-                          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Component id=&quot;configDirLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;/Group&gt;
-                          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                              &lt;Component id=&quot;authorsLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;/Group&gt;
                       &lt;/Group&gt;
-                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
-                  &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
-                      &lt;EmptySpace pref=&quot;75&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                          &lt;Component id=&quot;erikLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;ladaLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;kovoLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;jakubLabel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;/Group&gt;
-                      &lt;EmptySpace min=&quot;-2&quot; pref=&quot;29&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;/Group&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;
             &lt;DimensionLayout dim=&quot;1&quot;&gt;
@@ -147,7 +151,7 @@
                       &lt;Component id=&quot;kovoLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;jakubLabel&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace pref=&quot;34&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;24&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;

Modified: trunk/src/net/sf/plantlore/client/AboutView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AboutView.java	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/AboutView.java	2006-09-06 17:40:21 UTC (rev 709)
@@ -7,6 +7,8 @@
 package net.sf.plantlore.client;
 
 import java.io.File;
+import javax.swing.ImageIcon;
+import javax.swing.JLabel;
 import net.sf.plantlore.l10n.L10n;
 
 /**
@@ -25,7 +27,7 @@
     
     private void loadData() {
         String os = System.getProperty(&quot;os.name&quot;);
-        String plantloreDir = (os.equals(&quot;linux&quot;) ? &quot;.&quot; : &quot;&quot;) + Plantlore.PLANTLORE;
+        String plantloreDir = (os.equals(&quot;Linux&quot;) ? &quot;.&quot; : &quot;&quot;) + Plantlore.PLANTLORE;
         configDirLabel.setText(configDirLabel.getText()+System.getProperty(&quot;user.home&quot;)+File.separator+plantloreDir);
         osLabel.setText(osLabel.getText()+System.getProperty(&quot;os.name&quot;));
         userDirLabel.setText(userDirLabel.getText()+System.getProperty(&quot;user.home&quot;));
@@ -42,6 +44,7 @@
     private void initComponents() {
         aboutTabbedPane = new javax.swing.JTabbedPane();
         aboutTab = new javax.swing.JPanel();
+        aboutLabel = new JLabel(new ImageIcon(java.awt.Toolkit.getDefaultToolkit().getImage(AppCoreView.class.getResource(&quot;resources/splash_new.jpg&quot;))));
         detailTab = new javax.swing.JPanel();
         versionLabel = new javax.swing.JLabel();
         osLabel = new javax.swing.JLabel();
@@ -57,18 +60,22 @@
         setTitle(L10n.getString(&quot;Overview.About.About&quot;));
         setResizable(false);
         aboutTab.setName(L10n.getString(&quot;Overview.About.About&quot;));
+        aboutLabel.getAccessibleContext().setAccessibleName(&quot;Plantlore 1.0&quot;);
+
         org.jdesktop.layout.GroupLayout aboutTabLayout = new org.jdesktop.layout.GroupLayout(aboutTab);
         aboutTab.setLayout(aboutTabLayout);
         aboutTabLayout.setHorizontalGroup(
             aboutTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-            .add(0, 377, Short.MAX_VALUE)
+            .add(aboutLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 377, Short.MAX_VALUE)
         );
         aboutTabLayout.setVerticalGroup(
             aboutTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-            .add(0, 250, Short.MAX_VALUE)
+            .add(aboutLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 250, Short.MAX_VALUE)
         );
         aboutTabbedPane.addTab(L10n.getString(&quot;Overview.About.About&quot;), aboutTab);
 
+        detailTab.setBackground(new java.awt.Color(255, 255, 255));
+        detailTab.setBorder(javax.swing.BorderFactory.createTitledBorder(&quot;&quot;));
         detailTab.setName(L10n.getString(&quot;Overview.About.Detail&quot;));
         versionLabel.setText(L10n.getString(&quot;Overview.About.Version&quot;));
 
@@ -95,34 +102,24 @@
         detailTabLayout.setHorizontalGroup(
             detailTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(detailTabLayout.createSequentialGroup()
+                .addContainerGap()
                 .add(detailTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(detailTabLayout.createSequentialGroup()
-                        .addContainerGap()
-                        .add(versionLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 353, Short.MAX_VALUE))
-                    .add(detailTabLayout.createSequentialGroup()
-                        .addContainerGap()
-                        .add(osLabel))
-                    .add(detailTabLayout.createSequentialGroup()
-                        .addContainerGap()
-                        .add(javaLabel))
-                    .add(detailTabLayout.createSequentialGroup()
-                        .addContainerGap()
-                        .add(userDirLabel))
-                    .add(detailTabLayout.createSequentialGroup()
-                        .addContainerGap()
-                        .add(configDirLabel))
-                    .add(detailTabLayout.createSequentialGroup()
-                        .addContainerGap()
-                        .add(authorsLabel)))
-                .addContainerGap())
-            .add(org.jdesktop.layout.GroupLayout.TRAILING, detailTabLayout.createSequentialGroup()
-                .addContainerGap(75, Short.MAX_VALUE)
-                .add(detailTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                    .add(erikLabel)
-                    .add(ladaLabel)
-                    .add(kovoLabel)
-                    .add(jakubLabel))
-                .add(29, 29, 29))
+                        .add(detailTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                            .add(versionLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 343, Short.MAX_VALUE)
+                            .add(osLabel)
+                            .add(javaLabel)
+                            .add(userDirLabel)
+                            .add(configDirLabel)
+                            .add(authorsLabel))
+                        .addContainerGap())
+                    .add(org.jdesktop.layout.GroupLayout.TRAILING, detailTabLayout.createSequentialGroup()
+                        .add(detailTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                            .add(erikLabel)
+                            .add(ladaLabel)
+                            .add(kovoLabel)
+                            .add(jakubLabel))
+                        .add(29, 29, 29))))
         );
         detailTabLayout.setVerticalGroup(
             detailTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -147,7 +144,7 @@
                 .add(kovoLabel)
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(jakubLabel)
-                .addContainerGap(34, Short.MAX_VALUE))
+                .addContainerGap(24, Short.MAX_VALUE))
         );
         aboutTabbedPane.addTab(L10n.getString(&quot;Overview.About.Detail&quot;), detailTab);
 
@@ -176,6 +173,7 @@
     }
     
     // Variables declaration - do not modify//GEN-BEGIN:variables
+    private javax.swing.JLabel aboutLabel;
     private javax.swing.JPanel aboutTab;
     private javax.swing.JTabbedPane aboutTabbedPane;
     private javax.swing.JLabel authorsLabel;

Modified: trunk/src/net/sf/plantlore/client/AppCore.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCore.java	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/AppCore.java	2006-09-06 17:40:21 UTC (rev 709)
@@ -11,7 +11,9 @@
 import java.rmi.RemoteException;
 import java.util.ArrayList;
 import java.util.Collection;
+import java.util.HashSet;
 import java.util.Hashtable;
+import java.util.Iterator;
 import java.util.Observable;
 import java.util.prefs.Preferences;
 import javax.swing.table.TableModel;
@@ -879,6 +881,7 @@
                     throw new DBLayerException(&quot;Can't create transaction. Another already running.&quot;);
                 }
                 
+                HashSet&lt;Habitat&gt; habitatsToCheck = new HashSet&lt;Habitat&gt;();
                 try {
                     Collection&lt;Integer&gt; toBeDeleted = getTableModel().getSelection().values();
                     setLength(toBeDeleted.size()*2); //inform about approx. length of this task
@@ -890,7 +893,8 @@
                         logger.debug(&quot;Deleting occurrence id &quot;+i);
                         occ.setDeleted(1);
                         database.executeUpdateInTransaction(occ);
-                        dlu.deleteHabitatInTransaction(occ.getHabitat());
+                        //dlu.deleteHabitatInTransaction(occ.getHabitat());
+                        habitatsToCheck.add(occ.getHabitat());
                         logger.debug(&quot;Occurrence id &quot;+occ.getId()+&quot; &quot;+occ.getPlant().getTaxon()+&quot; deleted.&quot;);
                         setPosition(getPosition()+1);
 
@@ -911,6 +915,13 @@
                 }
                 
                 database.commitTransaction();
+                
+                Iterator&lt;Habitat&gt; it = habitatsToCheck.iterator();
+                while (it.hasNext()) {
+                    Habitat h = it.next();
+                    dlu.deleteHabitat(h);
+                }
+                
                 getTableModel().clearSelection();
                 fireStopped(null);
                 return null;

Modified: trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-09-06 17:40:21 UTC (rev 709)
@@ -1050,6 +1050,21 @@
                         addView.loadComponentData();
                         addView.setVisible(true);   
                     }//if ADD
+                    if (message.equals(&quot;DELETE&quot;)) {
+                        switch (nodeInfo.getType()) {
+                            case HABITAT:
+                                System.out.println(&quot;=== DELETE &quot;+nodeInfo.getChildCount());
+                                if (nodeInfo.getChildCount() &gt; 0) {
+                                    JOptionPane.showMessageDialog(view,
+                                            L10n.getString(&quot;Overview.Tree.ContainsOccurrencesCantDelete&quot;),
+                                            L10n.getString(&quot;Overview.Tree.ContainsOccurrencesCantDelete&quot;),
+                                            JOptionPane.INFORMATION_MESSAGE);
+                                    return;
+                                }
+                                break;
+                        }//switch
+                        
+                    }//if DELETE
                 }//if
             }//update
         }//class HabitatTreeBridge

Modified: trunk/src/net/sf/plantlore/client/AppCoreView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreView.form	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/AppCoreView.form	2006-09-06 17:40:21 UTC (rev 709)
@@ -537,7 +537,7 @@
         &lt;/DimensionLayout&gt;
         &lt;DimensionLayout dim=&quot;1&quot;&gt;
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;Component id=&quot;overviewScrollPane&quot; alignment=&quot;0&quot; pref=&quot;295&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;overviewScrollPane&quot; alignment=&quot;0&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
       &lt;/Layout&gt;

Modified: trunk/src/net/sf/plantlore/client/AppCoreView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreView.java	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/AppCoreView.java	2006-09-06 17:40:21 UTC (rev 709)
@@ -68,6 +68,7 @@
         model.addObserver(sbm);
         progressBar.setVisible(false);
         progressBar.setBorderPainted(false);
+        setIconImage(java.awt.Toolkit.getDefaultToolkit().getImage(AppCoreView.class.getResource(&quot;resources/icon.gif&quot;)));
     }
 
     /** This method is called from within the constructor to

Modified: trunk/src/net/sf/plantlore/client/Plantlore.java
===================================================================
--- trunk/src/net/sf/plantlore/client/Plantlore.java	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/Plantlore.java	2006-09-06 17:40:21 UTC (rev 709)
@@ -144,7 +144,7 @@
             }
             
             logger.info(&quot;Constructing AppCore MVC&quot;);
-            splashScreen = new SplashScreen(&quot;resources/splashscreen.gif&quot;);
+            splashScreen = new SplashScreen(&quot;resources/splash_new.jpg&quot;);
             splashScreen.splash();
             model = new AppCore(mainConfig);
             view = new AppCoreView(model);

Modified: trunk/src/net/sf/plantlore/client/overview/AddEdit.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-09-06 17:40:21 UTC (rev 709)
@@ -1018,7 +1018,8 @@
                                 logger.debug(&quot;AppCore.deleteSelected(): Can't create transaction. Another is probably already running.&quot;);
                                 throw new DBLayerException(&quot;Can't create transaction. Another already running.&quot;);
                             }
-
+                            Habitat habitatToCheck = null;
+                            
                             prepareOccurrenceUpdate(updateAllPlants);
                             if (originalTaxonSurvived) {
                                 // update original occurrence
@@ -1030,7 +1031,7 @@
                                 logger.info(&quot;Deleting original occurrence and associated author occurrences&quot;);
                                 o.setDeleted(1);
                                 database.executeUpdateInTransaction(o);
-                                dlu.deleteHabitatInTransaction(o.getHabitat());
+                                habitatToCheck = o.getHabitat(); //we'll maybe have to delete this habitat
                                 logger.debug(&quot;Occurrence id &quot;+o.getId()+&quot; &quot;+o.getPlant().getTaxon()+&quot; deleted.&quot;);
                                 Set&lt;Map.Entry&lt;Integer,AuthorOccurrence&gt;&gt; aoSet = authorOccurrences.entrySet();
                                 Iterator it = aoSet.iterator();
@@ -1153,6 +1154,8 @@
                                 }
 
                             database.commitTransaction();
+                            if (habitatToCheck != null)
+                                dlu.deleteHabitat(habitatToCheck);
                             occurrenceTableModel.reload();
                             newOccurrenceInserted = false;
 

Modified: trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/overview/tree/HabitatTree.java	2006-09-06 17:40:21 UTC (rev 709)
@@ -105,6 +105,7 @@
     public int getPhythochoriaCount(Territory t) throws RemoteException, DBLayerException {
         SelectQuery query = dblayer.createQuery(Habitat.class);
         query.addRestriction(PlantloreConstants.RESTR_EQ,Habitat.TERRITORY,null,t,null);
+        query.addRestriction(PlantloreConstants.RESTR_EQ, Habitat.DELETED, null, 0, null);        
         query.addProjection(PlantloreConstants.PROJ_COUNT_DISTINCT,Habitat.PHYTOCHORION);
         int resultid = dblayer.executeQuery(query);
         int rowCount = dblayer.getNumRows(resultid);
@@ -135,6 +136,7 @@
     protected void addPhythochoria(DefaultMutableTreeNode territoryNode, Territory t) throws DBLayerException, RemoteException {
         SelectQuery query = dblayer.createQuery(Habitat.class);
         query.addRestriction(PlantloreConstants.RESTR_EQ,Habitat.TERRITORY,null,t,null);
+        query.addRestriction(PlantloreConstants.RESTR_EQ, Habitat.DELETED, null, 0, null);
         query.addProjection(PlantloreConstants.PROJ_DISTINCT,Habitat.PHYTOCHORION);
         int resultid = dblayer.executeQuery(query);
         int rowCount = dblayer.getNumRows(resultid);
@@ -168,6 +170,7 @@
         
         SelectQuery query = dblayer.createQuery(Habitat.class);
         query.addRestriction(PlantloreConstants.RESTR_EQ, Habitat.PHYTOCHORION, null, dlu.getObjectFor(phytochorionId, Phytochorion.class),null);
+        query.addRestriction(PlantloreConstants.RESTR_EQ, Habitat.DELETED, null, 0, null);
         query.addProjection(PlantloreConstants.PROJ_PROPERTY, Habitat.ID);
         query.addProjection(PlantloreConstants.PROJ_PROPERTY, Habitat.DESCRIPTION);
         query.addProjection(PlantloreConstants.PROJ_PROPERTY, Habitat.NEARESTVILLAGE);
@@ -175,14 +178,17 @@
 
         int resultid = dblayer.executeQuery(query);
         int rowCount = dblayer.getNumRows(resultid);
-                
+        if (rowCount == 0)
+            return;
+        
         Object[] records = dblayer.more(resultid, 0, rowCount - 1);
         dblayer.closeQuery(query);
         DefaultMutableTreeNode node;
         for (Object record : records) {
             Object[] obj = (Object[])record;
             String name = ((NearestVillage)obj[2]).getName() + &quot; - &quot; + obj[1] + &quot; (quadrant &quot; + obj[3] + &quot;)&quot;;
-            name = &quot;(&quot;+getOccurrenceCount((Integer)obj[0])+&quot;) &quot;+name;
+            Integer count = getOccurrenceCount((Integer)obj[0]);
+            name = &quot;(&quot;+count+&quot;) &quot;+name;
             node = new DefaultMutableTreeNode(new NodeInfo(NodeInfo.NodeType.HABITAT,name,(Integer)obj[0],-1));
             treeModel.insertNodeInto(node, phytNode,0);
             //phytNode.add(node);
@@ -206,6 +212,17 @@
         }
     }
     
+    /** Notifies observers about a requirement to delete a node.
+     *
+     * Sends the &lt;code&gt;NodeInfo&lt;/code&gt; object of the selected node to the observer.
+     */
+    public void delete() {
+        if (selectedNode != null) {
+            setChanged();
+            notifyObservers(new Pair&lt;String,NodeInfo&gt;(&quot;DELETE&quot;,(NodeInfo)selectedNode.getUserObject()));
+        }        
+    }
+    
     /** Reloads the whole tree.
      *
      * Removes all children of the &lt;code&gt;rootNode&lt;/code&gt; and then calls &lt;code&gt;loadData()&lt;/code&gt;
@@ -213,6 +230,7 @@
      */
     public Task reload() {
         rootNode.removeAllChildren();
+        treeModel.nodeStructureChanged(rootNode);
         return loadData();
     }
     

Modified: trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeCtrl.java	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeCtrl.java	2006-09-06 17:40:21 UTC (rev 709)
@@ -56,6 +56,7 @@
         view.refreshButton.setAction(new RefreshAction());
         view.refreshMenuItem.setAction(new RefreshItemAction());
         view.addMenuItem.setAction(new AddItemAction());
+        //view.deleteMenuItem.setAction(new DeleteItemAction()); ... it would cause problems to history
     }
 
     /** Expansion event handler.
@@ -188,6 +189,18 @@
             }
     }//SearchAction
    
+    class DeleteItemAction extends AbstractAction {
+            public DeleteItemAction() {
+                    putValue(NAME, L10n.getString(&quot;Overview.Tree.Delete&quot;));
+//                    putValue(SMALL_ICON, Resource.createIcon(&quot;/toolbarButtonGraphics/general/Search24.gif&quot;));
+                    putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Overview.Tree.DeleteTT&quot;));
+            }
+
+            public void actionPerformed(ActionEvent actionEvent) {
+                model.delete();
+            }
+    }//SearchAction
+   
     class RefreshItemAction extends AbstractAction {
             public RefreshItemAction() {
                     putValue(NAME, L10n.getString(&quot;Overview.Tree.Refresh&quot;));
@@ -196,11 +209,8 @@
             }
 
             public void actionPerformed(ActionEvent actionEvent) {
-                try {
-                    model.reload();
-                } catch (Exception ex) {
-                    DefaultExceptionHandler.handle(view,ex);
-                }
+                    Task task = model.reload();
+                    Dispatcher.getDispatcher().dispatch(task, view, false);
             }
     }//RefreshAction
     

Modified: trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.form	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.form	2006-09-06 17:40:21 UTC (rev 709)
@@ -33,6 +33,14 @@
         &lt;/MenuItem&gt;
       &lt;/SubComponents&gt;
     &lt;/Menu&gt;
+    &lt;MenuItem class=&quot;javax.swing.JMenuItem&quot; name=&quot;deleteMenuItem&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Item&quot;/&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/MenuItem&gt;
   &lt;/NonVisualComponents&gt;
   &lt;SyntheticProperties&gt;
     &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;

Modified: trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.java	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/client/overview/tree/HabitatTreeView.java	2006-09-06 17:40:21 UTC (rev 709)
@@ -27,6 +27,7 @@
         setLocationRelativeTo(parent);
         searchMenuItem.setText(L10n.getString(&quot;Overview.Tree.SearchMenuItem&quot;));
         refreshMenuItem.setText(L10n.getString(&quot;Overview.Tree.RefreschMenuItem&quot;));
+        deleteMenuItem.setText(L10n.getString(&quot;Overview.Tree.DeleteMenuItem&quot;));
     }
     
     /** This method is called from within the constructor to
@@ -40,6 +41,7 @@
         searchMenuItem = new javax.swing.JMenuItem();
         refreshMenuItem = new javax.swing.JMenuItem();
         addMenuItem = new javax.swing.JMenuItem();
+        deleteMenuItem = new javax.swing.JMenuItem();
         jScrollPane1 = new javax.swing.JScrollPane();
         habitatTree = new JTree(model.getTreeModel());
         jPanel1 = new javax.swing.JPanel();
@@ -55,6 +57,8 @@
         addMenuItem.setText(&quot;Item&quot;);
         popupMenu.add(addMenuItem);
 
+        deleteMenuItem.setText(&quot;Item&quot;);
+
         jScrollPane1.setViewportView(habitatTree);
 
         searchButton.setText(&quot;jButton1&quot;);
@@ -115,6 +119,7 @@
     
     // Variables declaration - do not modify//GEN-BEGIN:variables
     protected javax.swing.JMenuItem addMenuItem;
+    protected javax.swing.JMenuItem deleteMenuItem;
     protected javax.swing.JTree habitatTree;
     private javax.swing.JPanel jPanel1;
     private javax.swing.JScrollPane jScrollPane1;

Added: trunk/src/net/sf/plantlore/client/resources/icon32.gif
===================================================================
(Binary files differ)


Property changes on: trunk/src/net/sf/plantlore/client/resources/icon32.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/src/net/sf/plantlore/common/DBLayerUtils.java
===================================================================
--- trunk/src/net/sf/plantlore/common/DBLayerUtils.java	2006-09-06 14:38:13 UTC (rev 708)
+++ trunk/src/net/sf/plantlore/common/DBLayerUtils.java	2006-09-06 17:40:21 UTC (rev 709)
@@ -208,11 +208,20 @@
      *
      */
     public void deleteHabitat(Habitat h) throws DBLayerException, RemoteException {
+        if (h == null)
+            return;
         SelectQuery sq = db.createQuery(Occurrence.class);        
         sq.addRestriction(PlantloreConstants.RESTR_EQ,Occurrence.HABITAT,null,h,null);
         sq.addRestriction(PlantloreConstants.RESTR_EQ,Deletable.DELETED, null, 0, null);
-        int resultid = db.executeQuery(sq);
-        int resultCount = db.getNumRows(resultid);
+        int resultid;
+        int resultCount;
+        try {
+            resultid = db.executeQuery(sq);
+            resultCount = db.getNumRows(resultid);
+        } catch (DBLayerException ex) {
+            db.closeQuery(sq);
+            throw ex;
+        }
         if (resultCount == 0) {
             logger.info(&quot;Deleting habitat id=&quot;+h.getId()+&quot; with nearest village &quot;+h.getNearestVillage().getName());
             h.setDeleted(1);
@@ -229,6 +238,8 @@
      *
      */
     public void deleteHabitatInTransaction(Habitat h) throws DBLayerException, RemoteException {
+        if (h == null)
+            return;
         SelectQuery sq = db.createQuery(Occurrence.class);        
         sq.addRestriction(PlantloreConstants.RESTR_EQ,Occurrence.HABITAT,null,h,null);
         sq.addRestriction(PlantloreConstants.RESTR_EQ,Deletable.DELETED, null, 0, null);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000979.html">[Plantlore-dev] r708 - in trunk/src/net/sf/plantlore:	client/createdb common/exception l10n server
</A></li>
	<LI>Next message: <A HREF="000981.html">[Plantlore-dev] r710 - trunk/src/net/sf/plantlore/client/resources
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#980">[ date ]</a>
              <a href="thread.html#980">[ thread ]</a>
              <a href="subject.html#980">[ subject ]</a>
              <a href="author.html#980">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
