<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r697 - in trunk: installer	src/net/sf/plantlore/client	src/net/sf/plantlore/client/overview/detail
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-September/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r697%20-%20in%20trunk%3A%20installer%0A%09src/net/sf/plantlore/client%0A%09src/net/sf/plantlore/client/overview/detail&In-Reply-To=%3C200609052033.k85KXXTJ021506%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000958.html">
   <LINK REL="Next"  HREF="000960.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r697 - in trunk: installer	src/net/sf/plantlore/client	src/net/sf/plantlore/client/overview/detail</H1>
    <B>fraktalek at mail.berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r697%20-%20in%20trunk%3A%20installer%0A%09src/net/sf/plantlore/client%0A%09src/net/sf/plantlore/client/overview/detail&In-Reply-To=%3C200609052033.k85KXXTJ021506%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r697 - in trunk: installer	src/net/sf/plantlore/client	src/net/sf/plantlore/client/overview/detail">fraktalek at mail.berlios.de
       </A><BR>
    <I>Tue Sep  5 22:33:33 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000958.html">[Plantlore-dev] r696 - trunk/src/net/sf/plantlore/server
</A></li>
        <LI>Next message: <A HREF="000960.html">[Plantlore-dev] r698 - in trunk/src/net/sf/plantlore: client	client/login common l10n server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#959">[ date ]</a>
              <a href="thread.html#959">[ thread ]</a>
              <a href="subject.html#959">[ subject ]</a>
              <a href="author.html#959">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fraktalek
Date: 2006-09-05 22:33:31 +0200 (Tue, 05 Sep 2006)
New Revision: 697

Added:
   trunk/installer/intro_cze.html
   trunk/installer/intro_eng.html
Modified:
   trunk/installer/install.xml
   trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
   trunk/src/net/sf/plantlore/client/overview/detail/Detail.java
   trunk/src/net/sf/plantlore/client/overview/detail/DetailCtrl.java
Log:
Detail now closes queries on exceptions too and loads using task and dispatcher.
Introductory text for the installer.



Modified: trunk/installer/install.xml
===================================================================
--- trunk/installer/install.xml	2006-09-05 20:17:17 UTC (rev 696)
+++ trunk/installer/install.xml	2006-09-05 20:33:31 UTC (rev 697)
@@ -1 +1 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;yes&quot; ?&gt;

&lt;installation version=&quot;1.0&quot;&gt;

    &lt;info&gt;

        &lt;appname&gt;Plantlore&lt;/appname&gt;

        &lt;appversion&gt;1.0&lt;/appversion&gt;

        &lt;authors&gt;
            &lt;author name=&quot;Lada Oberreiterova&quot; email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">lada at mail</A>@berlios.de&quot;/&gt;
            &lt;author name=&quot;Erik Kratochvil&quot; email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">krater at mail.berlios.de</A>&quot;/&gt;
	    &lt;author name=&quot;Tomas Kovarik&quot; email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">kovo at mail.berlios.de</A>&quot;/&gt;
	    &lt;author name=&quot;Jakub Kotowski&quot; email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">fraktalek at mail.berlios.de</A>&quot;/&gt;
        &lt;/authors&gt;

        &lt;url&gt;<A HREF="http://plantlore.berlios.de&lt;/url">http://plantlore.berlios.de&lt;/url</A>&gt;
        
        &lt;uninstaller write=&quot;yes&quot;/&gt;

    &lt;/info&gt;

    
    &lt;guiprefs width=&quot;640&quot; height=&quot;480&quot; resizable=&quot;no&quot;/&gt;

    
    &lt;locale&gt;
        &lt;langpack iso3=&quot;cze&quot;/&gt;
        &lt;langpack iso3=&quot;eng&quot;/&gt;
    &lt;/locale&gt;

    


    &lt;resources&gt;
        &lt;res id=&quot;LicencePanel.licence&quot; src=&quot;resources/gpl.txt&quot;/&gt;
        &lt;res id=&quot;InfoPanel.info&quot; src=&quot;installer/readme.txt&quot;/&gt;
        &lt;res id=&quot;userInputSpec.xml&quot; src=&quot;installer/userInputSpec.xml&quot;/&gt;  !
       
        &lt;res id=&quot;userInputLang.xml_eng&quot; src=&quot;installer/userInputLang.xml_eng&quot; /&gt;
        &lt;res id=&quot;userInputLang.xml_cze&quot; src=&quot;installer/userInputLang.xml_cze&quot; /&gt;
    &lt;/resources&gt;

    


    &lt;panels&gt;
        &lt;panel classname=&quot;HelloPanel&quot;/&gt;
        &lt;panel classname=&quot;InfoPanel&quot;/&gt;
        &lt;panel classname=&quot;LicencePanel&quot;/&gt;
        &lt;panel classname=&quot;TargetPanel&quot;/&gt; 
        &lt;panel classname=&quot;PacksPanel&quot;/&gt;
        &lt;panel classname=&quot;UserInputPanel&quot;/&gt;        
        &lt;panel classname=&quot;InstallPanel&quot;/&gt;
        &lt;panel classname=&quot;FinishPanel&quot;/&gt;
    &lt;/panels&gt;

    

    &lt;packs&gt;
        
        &lt;pack name=&quot;Core&quot; required=&quot;yes&quot;&gt;
            &lt;description&gt;Files that Plantlore needs always&lt;/description&gt;
            &lt;file src=&quot;dist/lib&quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt;
        &lt;/pack&gt;
        
	&lt;pack name=&quot;Client&quot; required=&quot;no&quot;&gt;
            &lt;description&gt;Plantlore Java Client&lt;/description&gt;
            &lt;file src=&quot;dist/plantlore-client.jar&quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt;
        &lt;/pack&gt;

	&lt;pack n!
 ame=&quot;Server&quot; required=&quot;no&quot; preselected=&quot;no&quot;&gt;
            &lt;desc!
 ription&gt;
Plantlore Server&lt;/description&gt;
            &lt;file src=&quot;dist/plantlore-server.jar&quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt;
            &lt;file src=&quot;dist/java.policy&quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt;
	&lt;/pack&gt;
	
	&lt;pack name=&quot;PostgreSQL&quot; required=&quot;no&quot;&gt;
            &lt;description&gt;The PostgreSQL database machine&lt;/description&gt;            
            &lt;file src=&quot;installer/postgresql/postgresql-int.msi&quot; targetdir=&quot;$INSTALL_PATH&quot; os=&quot;windows&quot;/&gt;
            &lt;file src=&quot;installer/postgresql/postgres_install.bat&quot; targetdir=&quot;$INSTALL_PATH&quot; os=&quot;windows&quot;/&gt;            
            &lt;parsable targetfile=&quot;$INSTALL_PATH/postgres_install.bat&quot; os=&quot;windows&quot; /&gt;
            &lt;executable targetfile=&quot;$INSTALL_PATH/postgres_install.bat&quot; 
                        stage=&quot;postinstall&quot; 
                        os=&quot;windows&quot; 
                        failure=&quot;warn&quot; /&gt;                        
	&lt;/pack&gt;
	
        &lt;pack name=&quot;Docs&quot; required=&quot;no&quot;&gt;
            &lt;description&gt;The documentation&lt;/description&gt;
            &lt;file src=&quot;documentation!
 &quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt; &lt;!-- Reccursive adding --&gt;
        &lt;/pack&gt;

        &lt;pack name=&quot;Sources&quot; required=&quot;no&quot; preselected=&quot;no&quot;&gt;
            &lt;description&gt;The sources&lt;/description&gt;
            &lt;file src=&quot;src&quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt;
        &lt;/pack&gt;

    &lt;/packs&gt;

    

&lt;/installation&gt;
\ No newline at end of file
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;yes&quot; ?&gt;

&lt;installation version=&quot;1.0&quot;&gt;

    &lt;info&gt;

        &lt;appname&gt;Plantlore&lt;/appname&gt;

        &lt;appversion&gt;1.0&lt;/appversion&gt;

        &lt;authors&gt;
            &lt;author name=&quot;Lada Oberreiterova&quot; email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">lada at mail</A>@berlios.de&quot;/&gt;
            &lt;author name=&quot;Erik Kratochvil&quot; email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">krater at mail.berlios.de</A>&quot;/&gt;
	    &lt;author name=&quot;Tomas Kovarik&quot; email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">kovo at mail.berlios.de</A>&quot;/&gt;
	    &lt;author name=&quot;Jakub Kotowski&quot; email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">fraktalek at mail.berlios.de</A>&quot;/&gt;
        &lt;/authors&gt;

        &lt;url&gt;<A HREF="http://plantlore.berlios.de&lt;/url">http://plantlore.berlios.de&lt;/url</A>&gt;
        
        &lt;uninstaller write=&quot;yes&quot;/&gt;

    &lt;/info&gt;

    
    &lt;guiprefs width=&quot;640&quot; height=&quot;480&quot; resizable=&quot;no&quot;/&gt;

    
    &lt;locale&gt;
        &lt;langpack iso3=&quot;cze&quot;/&gt;
        &lt;langpack iso3=&quot;eng&quot;/&gt;
    &lt;/locale&gt;

    


    &lt;resources&gt;
        &lt;res id=&quot;LicencePanel.licence&quot; src=&quot;resources/gpl.txt&quot;/&gt;
        &lt;res id=&quot;HTMLInfoPanel.info_cze&quot; src=&quot;installer/intro_cze.html&quot;/&gt;
        &lt;res id=&quot;HTMLInfoPanel.info_eng&quot; src=&quot;installer/intro!
 _eng.html&quot;/&gt;
        &lt;res id=&quot;userInputSpec.xml&quot; src=&quot;installer/userInputSpec.xml&quot;/&gt;        
        &lt;res id=&quot;userInputLang.xml_eng&quot; src=&quot;installer/userInputLang.xml_eng&quot; /&gt;
        &lt;res id=&quot;userInputLang.xml_cze&quot; src=&quot;installer/userInputLang.xml_cze&quot; /&gt;
    &lt;/resources&gt;

    


    &lt;panels&gt;
        &lt;panel classname=&quot;HelloPanel&quot;/&gt;
        &lt;panel classname=&quot;HTMLInfoPanel&quot;/&gt;
        &lt;panel classname=&quot;LicencePanel&quot;/&gt;
        &lt;panel classname=&quot;TargetPanel&quot;/&gt; 
        &lt;panel classname=&quot;PacksPanel&quot;/&gt;
        &lt;panel classname=&quot;UserInputPanel&quot;/&gt;        
        &lt;panel classname=&quot;InstallPanel&quot;/&gt;
        &lt;panel classname=&quot;FinishPanel&quot;/&gt;
    &lt;/panels&gt;

    

    &lt;packs&gt;
        
        &lt;pack name=&quot;Core&quot; required=&quot;yes&quot;&gt;
            &lt;description&gt;Files that Plantlore needs always&lt;/description&gt;
            &lt;file src=&quot;dist/lib&quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt;
        &lt;/pack&gt;
        
	&lt;pack name=&quot;Client&quot; required=&quot;no&quot;&gt;
            &lt;description&gt;Plantlore Java Client&lt;/description&gt;
            &lt;!
 file src=&quot;dist/plantlore-client.jar&quot; targetdir=&quot;$INSTALL_PATH&quot;!
 /&gt;
     
   &lt;/pack&gt;

	&lt;pack name=&quot;Server&quot; required=&quot;no&quot; preselected=&quot;no&quot;&gt;
            &lt;description&gt;Plantlore Server&lt;/description&gt;
            &lt;file src=&quot;dist/plantlore-server.jar&quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt;
            &lt;file src=&quot;dist/java.policy&quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt;
	&lt;/pack&gt;
	
	&lt;pack name=&quot;PostgreSQL&quot; required=&quot;no&quot;&gt;
            &lt;description&gt;The PostgreSQL database machine&lt;/description&gt;            
            &lt;file src=&quot;installer/postgresql/postgresql-int.msi&quot; targetdir=&quot;$INSTALL_PATH&quot; os=&quot;windows&quot;/&gt;
            &lt;file src=&quot;installer/postgresql/postgres_install.bat&quot; targetdir=&quot;$INSTALL_PATH&quot; os=&quot;windows&quot;/&gt;            
            &lt;parsable targetfile=&quot;$INSTALL_PATH/postgres_install.bat&quot; os=&quot;windows&quot; /&gt;
            &lt;executable targetfile=&quot;$INSTALL_PATH/postgres_install.bat&quot; 
                        stage=&quot;postinstall&quot; 
                        os=&quot;windows&quot; 
                        failure=&quot;warn&quot; /&gt;                        
	&lt;/pack&gt;
	
        &lt;pack name=&quot;Docs&quot; required=&quot;no&quot;&gt;
   !
          &lt;description&gt;The documentation&lt;/description&gt;
            &lt;file src=&quot;documentation&quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt; &lt;!-- Reccursive adding --&gt;
        &lt;/pack&gt;

        &lt;pack name=&quot;Sources&quot; required=&quot;no&quot; preselected=&quot;no&quot;&gt;
            &lt;description&gt;The sources&lt;/description&gt;
            &lt;file src=&quot;src&quot; targetdir=&quot;$INSTALL_PATH&quot;/&gt;
        &lt;/pack&gt;

    &lt;/packs&gt;

    

&lt;/installation&gt;
\ No newline at end of file

Added: trunk/installer/intro_cze.html
===================================================================
--- trunk/installer/intro_cze.html	2006-09-05 20:17:17 UTC (rev 696)
+++ trunk/installer/intro_cze.html	2006-09-05 20:33:31 UTC (rev 697)
@@ -0,0 +1,26 @@
+&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;
+
+&lt;html&gt;
+  &lt;head&gt;
+    &lt;title&gt;Plantlore&lt;/title&gt;
+  &lt;/head&gt;
+  &lt;body&gt;
+      &lt;h1&gt;Plantlore&lt;/h1&gt;
+      &lt;h2&gt;&#218;vod&lt;/h2&gt;
+      &lt;p&gt;Plantlore je datab&#225;zov&#253; syst&#233;m pro zad&#225;v&#225;n&#237; a vyhled&#225;v&#225;n&#237; dat o v&#253;skytu rostlin &#353;&#237;&#345;en&#253; pod licenc&#237; GPL.
+      Je navr&#382;en jako aplikace s architekturou klient server. Umo&#382;&#328;uje jak pr&#225;ci lok&#225;ln&#237;
+      tak i vzd&#225;lenou po s&#237;ti. Tento instal&#225;tor instaluje Plantlore klienta a server
+      napsan&#233; v programovac&#237;m jazyce Java. Sou&#269;&#225;st&#237; projektu Plantlore je i webov&#253; klient,
+      kter&#253; se instaluje zvl&#225;&#353;&#357;.&lt;/p&gt;
+      &lt;h2&gt;Vybran&#233; funkce&lt;/h2&gt;
+      &lt;ul&gt;
+          &lt;li&gt;Rychl&#233; zad&#225;v&#225;n&#237; a editace n&#225;lez&#367; (&quot;&#353;krt&#225;k&quot;, automatick&#233; dopl&#328;ov&#225;n&#237;, ...)&lt;/li&gt;
+          &lt;li&gt;Spr&#225;va dat o u&#382;ivatel&#237;ch, autorech a projektech&lt;/li&gt;
+          &lt;li&gt;Import a export do XML kompatibiln&#237;ho s ABCD schema a DarwinCore&lt;/li&gt;
+          &lt;li&gt;Lokalizace - zat&#237;m &#269;e&#353;tina a angli&#269;tina&lt;/li&gt;
+          &lt;li&gt;Tisk sched&lt;/li&gt;
+          &lt;li&gt;Voln&#283; dostupn&#233; zdrojov&#233; k&#243;dy pod licenc&#237; GPL&lt;/li&gt;
+          &lt;li&gt;... a dal&#353;&#237;&lt;/li&gt;
+      &lt;/ul&gt;
+  &lt;/body&gt;
+&lt;/html&gt;

Added: trunk/installer/intro_eng.html
===================================================================
--- trunk/installer/intro_eng.html	2006-09-05 20:17:17 UTC (rev 696)
+++ trunk/installer/intro_eng.html	2006-09-05 20:33:31 UTC (rev 697)
@@ -0,0 +1,26 @@
+&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;
+
+&lt;html&gt;
+  &lt;head&gt;
+    &lt;title&gt;Plantlore&lt;/title&gt;
+  &lt;/head&gt;
+  &lt;body&gt;
+      &lt;h1&gt;Plantlore&lt;/h1&gt;
+      &lt;h2&gt;Introduction&lt;/h2&gt;
+      &lt;p&gt;Plantlore is a database system to be used for occurrence data management. 
+      It is a client-server application written in Java and developed under the GPL license. 
+      Plantlore supports local and remote work via a network. This installer installs the Plantlore
+      rich client and Plantlore server. The project also includes a web client which you have
+      to install separately.&lt;/p&gt;
+      &lt;h2&gt;Feature highlights&lt;/h2&gt;
+      &lt;ul&gt;
+          &lt;li&gt;Simple and fast occurrence adding and editation (the checklist, auto completition, ...)&lt;/li&gt;
+          &lt;li&gt;User, author and project management&lt;/li&gt;
+          &lt;li&gt;Import and export of ABCD schema and DarwinCore compatible XML&lt;/li&gt;
+          &lt;li&gt;Localization - English and Czech for the moment&lt;/li&gt;
+          &lt;li&gt;Scheda printing&lt;/li&gt;
+          &lt;li&gt;Open sourced under the GPL license&lt;/li&gt;
+          &lt;li&gt;... and more&lt;/li&gt;
+      &lt;/ul&gt;
+  &lt;/body&gt;
+&lt;/html&gt;

Modified: trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-09-05 20:17:17 UTC (rev 696)
+++ trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-09-05 20:33:31 UTC (rev 697)
@@ -1531,14 +1531,22 @@
 					int resultNumber = model.getSelectedResultNumber();
                                         if (resultNumber &gt; model.getResultsCount()) {
                                             logger.error(&quot;Trying to show detail for a record number of which is bigger than results count. Have we been disconnected?&quot;);
-                                            JOptionPane.showMessageDialog(view,L10n.getString(&quot;Error.LostConnection&quot;));
-                                            return;
+                                            throw new DBLayerException(L10n.getString(&quot;DBLayer.Error.Login&quot;), DBLayerException.ERROR_CONNECT);
                                         }
                                         
 					if (resultNumber != model.getResultsCount())
 						model.selectAndShow(resultNumber);
-					detailModel.load(model.getSelectedResultNumber());
-                                        detailView.setVisible(true);
+					Task task = detailModel.load(model.getSelectedResultNumber());
+                                        task.setPostTaskAction(new PostTaskAction() {
+                                           public void afterStopped(Object value) {
+                                               SwingUtilities.invokeLater(new Runnable() {
+                                                   public void run() {
+                                                        detailView.setVisible(true);                                                       
+                                                   }
+                                               });
+                                           } 
+                                        });
+                                        Dispatcher.getDispatcher().dispatch(task, view, false);
 				} catch (RemoteException ex) {
                                     DefaultExceptionHandler.handle(view,ex);
                                     return;
@@ -1572,8 +1580,7 @@
 					int resultNumber = model.getSelectedResultNumber();
                                         if (resultNumber &gt; model.getResultsCount()) {
                                             logger.error(&quot;Trying to show detail for a record number of which is bigger than results count. Have we been disconnected?&quot;);
-                                            JOptionPane.showMessageDialog(view,&quot;The connection has been probably lost.&quot;);
-                                            return;
+                                            throw new DBLayerException(L10n.getString(&quot;DBLayer.Error.Login&quot;), DBLayerException.ERROR_CONNECT);
                                         }
                                         
 					if (resultNumber != model.getResultsCount())
@@ -1585,8 +1592,17 @@
 					// next row, so
 					// we need to
 					// correct that
-					detailModel.load(model.getSelectedResultNumber());
-                                        detailView.setVisible(true);
+					Task task = detailModel.load(model.getSelectedResultNumber());
+                                        task.setPostTaskAction(new PostTaskAction() {
+                                           public void afterStopped(Object value) {
+                                               SwingUtilities.invokeLater(new Runnable() {
+                                                   public void run() {
+                                                        detailView.setVisible(true);                                                       
+                                                   }
+                                               });
+                                           } 
+                                        });
+                                        Dispatcher.getDispatcher().dispatch(task, view, false);
 				} catch (RemoteException ex) {
                                     DefaultExceptionHandler.handle(view,ex);
                                     return;

Modified: trunk/src/net/sf/plantlore/client/overview/detail/Detail.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/detail/Detail.java	2006-09-05 20:17:17 UTC (rev 696)
+++ trunk/src/net/sf/plantlore/client/overview/detail/Detail.java	2006-09-05 20:33:31 UTC (rev 697)
@@ -16,6 +16,8 @@
 import net.sf.plantlore.client.*;
 import net.sf.plantlore.client.AppCore;
 import net.sf.plantlore.common.PlantloreConstants;
+import net.sf.plantlore.common.PostTaskAction;
+import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.exception.DBLayerException;
 import net.sf.plantlore.common.record.Author;
 import net.sf.plantlore.common.record.AuthorOccurrence;
@@ -76,90 +78,105 @@
     }
     
     
-    public void load(int result) throws DBLayerException, RemoteException {
-        this.currentResult = result;
-        Integer occurrenceId = appCore.getOccurrence(result);
-        logger.debug(&quot;Detail model: loading data for occurrence id &quot;+occurrenceId);
-        SelectQuery sq = null;
-        
-        sq = database.createQuery(Occurrence.class);
-        sq.createAlias(Occurrence.HABITAT,&quot;habitat&quot;);
-        sq.createAlias(Occurrence.PLANT,&quot;plant&quot;);
-        // Add publications using LEFT OUTER JOIN - so that occurrences without a publication are displayed as well
-        sq.createAlias(Occurrence.PUBLICATION,&quot;publication&quot;, PlantloreConstants.LEFT_OUTER_JOIN);
-        sq.createAlias(Occurrence.METADATA,&quot;metadata&quot;);
-        sq.createAlias(&quot;habitat.&quot;+Habitat.PHYTOCHORION,&quot;phyt&quot;);
-        sq.createAlias(&quot;habitat.&quot;+Habitat.NEARESTVILLAGE,&quot;vill&quot;);
-        sq.createAlias(&quot;habitat.&quot;+Habitat.TERRITORY,&quot;territory&quot;);
-        // Add subquery to the query. Compare authoroccurrence.authorid with the result of a subquery (LEALL: &lt;= all(...))
-        sq.addRestriction(PlantloreConstants.RESTR_EQ, Occurrence.ID, null, occurrenceId, null);
-        
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.DATASOURCE);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.HERBARIUM);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.TIMECOLLECTED);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.DAYCOLLECTED);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.MONTHCOLLECTED);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.YEARCOLLECTED);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.NOTE);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.CREATEDWHO);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.CREATEDWHEN);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.UPDATEDWHO);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.UPDATEDWHEN);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.ALTITUDE);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.LATITUDE);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.LONGITUDE);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.COUNTRY);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.DESCRIPTION);                    
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.NOTE);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.QUADRANT);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;vill.&quot;+NearestVillage.NAME);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;metadata.&quot;+Metadata.DATASETTITLE);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;phyt.&quot;+Phytochorion.CODE);                    
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;phyt.&quot;+Phytochorion.NAME);                    
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;plant.&quot;+Plant.TAXON);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;publication.&quot;+Publication.REFERENCECITATION);
-        sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;territory.&quot;+Territory.NAME);
-        
-        int resultId = database.executeQuery(sq);
-        int resultsCount = database.getNumRows(resultId);
-        if (resultsCount == 0) {
-            logger.error(&quot;Detail: occurrence &quot;+occurrenceId+&quot; has no record in the database.&quot;);
-            throw new DBLayerException(&quot;The occurrence you selected is no longer in the database.&quot;);
-        }
-        assert resultsCount == 1;
-        
-        Object[] records = database.more(resultId, 0, resultsCount - 1);
-        database.closeQuery(sq);
-        Object[] pa = (Object[]) records[0];
-        source = (String)pa[0];
-        herbarium = (String)pa[1];
-        time = (Date)pa[2];
-        day = (Integer)pa[3];
-        month = (Integer)pa[4];
-        year = (Integer)pa[5];
-        occNote = (String)pa[6];
-        createdWho = ((User)pa[7]).getWholeName();
-        createdWhen= (Date)pa[8];
-        updatedWho = ((User)pa[9]).getWholeName();
-        updatedWhen = (Date)pa[10];
-        altitude= (Double)pa[11];
-        latitude = (Double)pa[12];
-        longitude = (Double)pa[13];
-        country = (String)pa[14];
-        placeDescription = (String)pa[15];
-        quadrant = (String)pa[16];
-        habNote = (String)pa[17];
-        village = (String)pa[18];
-        project = (String)pa[19];
-        phytCode = (String)pa[20];
-        phytName = (String)pa[21];
-        taxon = (String)pa[22];
-        publication = (String)pa[23];
-        territory = (String)pa[24];
-        
-        detailTableModel = new DetailTableModel(occurrenceId);
-        setChanged();
-        notifyObservers(&quot;NEW_DETAIL_LOADED&quot;);
+    public Task load(final int result) {
+        final Detail model = this;
+        Task task = new Task() {
+            public Object task() throws DBLayerException, RemoteException {
+                setStatusMessage(L10n.getString(&quot;Overview.Detail.Loading&quot;));
+                currentResult = result;
+                Integer occurrenceId = appCore.getOccurrence(result);
+                logger.debug(&quot;Detail model: loading data for occurrence id &quot;+occurrenceId);
+                SelectQuery sq = null;
+
+                sq = database.createQuery(Occurrence.class);
+                sq.createAlias(Occurrence.HABITAT,&quot;habitat&quot;);
+                sq.createAlias(Occurrence.PLANT,&quot;plant&quot;);
+                // Add publications using LEFT OUTER JOIN - so that occurrences without a publication are displayed as well
+                sq.createAlias(Occurrence.PUBLICATION,&quot;publication&quot;, PlantloreConstants.LEFT_OUTER_JOIN);
+                sq.createAlias(Occurrence.METADATA,&quot;metadata&quot;);
+                sq.createAlias(&quot;habitat.&quot;+Habitat.PHYTOCHORION,&quot;phyt&quot;);
+                sq.createAlias(&quot;habitat.&quot;+Habitat.NEARESTVILLAGE,&quot;vill&quot;);
+                sq.createAlias(&quot;habitat.&quot;+Habitat.TERRITORY,&quot;territory&quot;);
+                // Add subquery to the query. Compare authoroccurrence.authorid with the result of a subquery (LEALL: &lt;= all(...))
+                sq.addRestriction(PlantloreConstants.RESTR_EQ, Occurrence.ID, null, occurrenceId, null);
+
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.DATASOURCE);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.HERBARIUM);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.TIMECOLLECTED);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.DAYCOLLECTED);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.MONTHCOLLECTED);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.YEARCOLLECTED);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.NOTE);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.CREATEDWHO);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.CREATEDWHEN);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.UPDATEDWHO);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,Occurrence.UPDATEDWHEN);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.ALTITUDE);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.LATITUDE);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.LONGITUDE);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.COUNTRY);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.DESCRIPTION);                    
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.NOTE);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;habitat.&quot;+Habitat.QUADRANT);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;vill.&quot;+NearestVillage.NAME);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;metadata.&quot;+Metadata.DATASETTITLE);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;phyt.&quot;+Phytochorion.CODE);                    
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;phyt.&quot;+Phytochorion.NAME);                    
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;plant.&quot;+Plant.TAXON);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;publication.&quot;+Publication.REFERENCECITATION);
+                sq.addProjection(PlantloreConstants.PROJ_PROPERTY,&quot;territory.&quot;+Territory.NAME);
+
+                int resultId;
+                int resultsCount;
+                try {
+                    resultId = database.executeQuery(sq);
+                    resultsCount = database.getNumRows(resultId);
+                } catch(DBLayerException ex) {
+                    database.closeQuery(sq);
+                    throw ex;
+                }
+                if (resultsCount == 0) {
+                    logger.error(&quot;Detail: occurrence &quot;+occurrenceId+&quot; has no record in the database.&quot;);
+                    throw new DBLayerException(&quot;The occurrence you selected is no longer in the database.&quot;);
+                }
+                assert resultsCount == 1;
+
+                Object[] records = database.more(resultId, 0, resultsCount - 1);
+                database.closeQuery(sq);
+                Object[] pa = (Object[]) records[0];
+                source = (String)pa[0];
+                herbarium = (String)pa[1];
+                time = (Date)pa[2];
+                day = (Integer)pa[3];
+                month = (Integer)pa[4];
+                year = (Integer)pa[5];
+                occNote = (String)pa[6];
+                createdWho = ((User)pa[7]).getWholeName();
+                createdWhen= (Date)pa[8];
+                updatedWho = ((User)pa[9]).getWholeName();
+                updatedWhen = (Date)pa[10];
+                altitude= (Double)pa[11];
+                latitude = (Double)pa[12];
+                longitude = (Double)pa[13];
+                country = (String)pa[14];
+                placeDescription = (String)pa[15];
+                quadrant = (String)pa[16];
+                habNote = (String)pa[17];
+                village = (String)pa[18];
+                project = (String)pa[19];
+                phytCode = (String)pa[20];
+                phytName = (String)pa[21];
+                taxon = (String)pa[22];
+                publication = (String)pa[23];
+                territory = (String)pa[24];
+
+                detailTableModel = new DetailTableModel(occurrenceId);
+                model.setChanged();
+                model.notifyObservers(&quot;NEW_DETAIL_LOADED&quot;);
+                return null;
+            }//task()
+        };
+        return task;
     }
         
     
@@ -168,20 +185,30 @@
         logger.debug(&quot;Detail model - database set.&quot;);
     }
     
-    public void next() throws DBLayerException, RemoteException {
+    public Task next() throws RemoteException {
         if (appCore.getResultsCount() &lt;= currentResult+1)
-            return;
+            return null;
         currentResult++;
-        load(currentResult);
-        appCore.selectAndShow(currentResult);
+        Task task = load(currentResult);
+        task.setPostTaskAction(new PostTaskAction() {
+            public void afterStopped(Object value) throws DBLayerException, RemoteException {
+                appCore.selectAndShow(currentResult);                        
+            }
+        });
+        return task;
     }
     
-    public void prev() throws DBLayerException, RemoteException {
+    public Task prev() throws RemoteException {
         if (currentResult &lt;=0)
-            return;
+            return null;
         currentResult--;
-        load(currentResult);
-        appCore.selectAndShow(currentResult);
+        Task task = load(currentResult);
+        task.setPostTaskAction(new PostTaskAction() {
+            public void afterStopped(Object value) throws DBLayerException, RemoteException {
+                appCore.selectAndShow(currentResult);                        
+            }
+        });
+        return task;
     }
     
     class DetailTableModel extends AbstractTableModel {

Modified: trunk/src/net/sf/plantlore/client/overview/detail/DetailCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/detail/DetailCtrl.java	2006-09-05 20:17:17 UTC (rev 696)
+++ trunk/src/net/sf/plantlore/client/overview/detail/DetailCtrl.java	2006-09-05 20:33:31 UTC (rev 697)
@@ -14,6 +14,9 @@
 import javax.swing.AbstractAction;
 import javax.swing.JOptionPane;
 import net.sf.plantlore.client.*;
+import net.sf.plantlore.common.DefaultExceptionHandler;
+import net.sf.plantlore.common.Dispatcher;
+import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.exception.DBLayerException;
 import net.sf.plantlore.l10n.L10n;
 import org.apache.log4j.Logger;
@@ -44,13 +47,13 @@
         public void actionPerformed(ActionEvent e) {
             logger.debug(&quot;Next detail.&quot;);
             try {
-                model.next();
-            } catch (DBLayerException ex) {
-                JOptionPane.showMessageDialog(view,&quot;Database problem: &quot;+ex);
-                ex.printStackTrace();
+                Task task = model.next();
+                if (task == null)
+                    return;
+                Dispatcher.getDispatcher().dispatch(task, view, false);
             } catch (RemoteException ex) {
-                JOptionPane.showMessageDialog(view,&quot;Remote connection problem: &quot;+ex);
-                ex.printStackTrace();
+                DefaultExceptionHandler.handle(view, ex);
+                return;
             }
         }
         
@@ -64,13 +67,13 @@
         public void actionPerformed(ActionEvent e) {
             logger.debug(&quot;Prev detail.&quot;);
             try {
-                model.prev();
-            } catch (DBLayerException ex) {
-                JOptionPane.showMessageDialog(view,&quot;Database problem: &quot;+ex);
-                ex.printStackTrace();
+                Task task = model.prev();
+                if (task == null)
+                    return;
+                Dispatcher.getDispatcher().dispatch(task, view, false);
             } catch (RemoteException ex) {
-                JOptionPane.showMessageDialog(view,&quot;Remote connection problem: &quot;+ex);
-                ex.printStackTrace();
+                DefaultExceptionHandler.handle(view, ex);
+                return;
             }
         }
         


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000958.html">[Plantlore-dev] r696 - trunk/src/net/sf/plantlore/server
</A></li>
	<LI>Next message: <A HREF="000960.html">[Plantlore-dev] r698 - in trunk/src/net/sf/plantlore: client	client/login common l10n server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#959">[ date ]</a>
              <a href="thread.html#959">[ thread ]</a>
              <a href="subject.html#959">[ subject ]</a>
              <a href="author.html#959">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
