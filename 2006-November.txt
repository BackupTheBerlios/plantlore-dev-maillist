From lada at mail.berlios.de  Fri Nov  3 15:45:41 2006
From: lada at mail.berlios.de (lada at mail.berlios.de)
Date: Fri, 3 Nov 2006 15:45:41 +0100
Subject: [Plantlore-dev] r857 - in trunk/src/net/sf/plantlore:
	client/history client/overview common/record config/hibernate l10n
Message-ID: <200611031445.kA3Ejfw4031853@sheep.berlios.de>

Author: lada
Date: 2006-11-03 15:45:40 +0100 (Fri, 03 Nov 2006)
New Revision: 857

Modified:
   trunk/src/net/sf/plantlore/client/history/History.java
   trunk/src/net/sf/plantlore/client/overview/AddEdit.java
   trunk/src/net/sf/plantlore/client/overview/AddEditView.java
   trunk/src/net/sf/plantlore/common/record/Habitat.java
   trunk/src/net/sf/plantlore/config/hibernate/Habitats.hbm.xml
   trunk/src/net/sf/plantlore/l10n/Plantlore.properties
   trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties
   trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties
Log:
tHabitats.cDescription is compulsory field now.
History of occurrence show information about editing of authors.

Modified: trunk/src/net/sf/plantlore/client/history/History.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/History.java	2006-10-22 14:17:41 UTC (rev 856)
+++ trunk/src/net/sf/plantlore/client/history/History.java	2006-11-03 14:45:40 UTC (rev 857)
@@ -303,11 +303,10 @@
 	        // Add restriction to COPERATION column of tHistoryChange table
 	        if (data instanceof Occurrence) {	        	       
 		        query.addRestriction(PlantloreConstants.RESTR_EQ, "hc.recordId", null, ((Occurrence)data).getId(), null); 
-                        query.addRestriction(PlantloreConstants.RESTR_EQ, "hcol.tableName", null, PlantloreConstants.ENTITY_OCCURRENCE,null);
-                        
-                        //Object[] items = {PlantloreConstants.RESTR_EQ, "hcol.tableName", null, PlantloreConstants.ENTITY_OCCURRENCE,
-                        //PlantloreConstants.RESTR_EQ, "hcol.tableName", null, PlantloreConstants.ENTITY_AUTHOROCCURRENCE};
-                        //query.addOrRestriction(items);
+                        //query.addRestriction(PlantloreConstants.RESTR_EQ, "hcol.tableName", null, PlantloreConstants.ENTITY_OCCURRENCE,null);                        
+                        Object[] items = {PlantloreConstants.RESTR_EQ, "hcol.tableName", null, PlantloreConstants.ENTITY_OCCURRENCE,
+                        PlantloreConstants.RESTR_EQ, "hcol.tableName", null, PlantloreConstants.ENTITY_AUTHOROCCURRENCE};
+                        query.addOrRestriction(items);
 	        } else if (data instanceof Habitat) {	        	        
 		        query.addRestriction(PlantloreConstants.RESTR_EQ, "hc.recordId", null, ((Habitat)data).getId(), null);  
 	        }	

Modified: trunk/src/net/sf/plantlore/client/overview/AddEdit.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-10-22 14:17:41 UTC (rev 856)
+++ trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-11-03 14:45:40 UTC (rev 857)
@@ -114,7 +114,7 @@
     private String occurrenceNote = null;
     private Pair<String, Integer> territoryName;
     private Pair<String, Integer> phytName;
-    private Pair<String, Integer> phytCode;
+    private Pair<String, Integer> phytCode;    
     private String phytCountry;
     private String quadrant = null;
     private Double altitude = null;
@@ -134,7 +134,7 @@
     private String habitatNoteOld = null;
     private Pair<String, Integer> territoryNameOld;
     private Pair<String, Integer> phytNameOld;
-    private Pair<String, Integer> phytCodeOld;
+    private Pair<String, Integer> phytCodeOld;    
     private String phytCountryOld;
     private String quadrantOld = null;
     private Double altitudeOld = null;
@@ -1374,6 +1374,10 @@
         if (!isNotEmpty(phytCode)) {
             return new Pair<Boolean,String>(false,L10n.getString("AddEdit.CheckMessage.CompulsoryPhytochorion"));            
         }
+        
+        if (!isNotEmpty(habitatDescription)) {
+            return new Pair<Boolean,String>(false,L10n.getString("AddEdit.CheckMessage.CompulsoryDescription"));            
+        }
 
         if (!isNotEmpty(project)) {
             return new Pair<Boolean,String>(false,L10n.getString("AddEdit.CheckMessage.CompulsoryProject"));            

Modified: trunk/src/net/sf/plantlore/client/overview/AddEditView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEditView.java	2006-10-22 14:17:41 UTC (rev 856)
+++ trunk/src/net/sf/plantlore/client/overview/AddEditView.java	2006-11-03 14:45:40 UTC (rev 857)
@@ -1027,7 +1027,7 @@
     
     private void setLabels() {
         townLabel.setText(L10n.getString("AddEdit.TownLabel")+REQUIRED_STRING);
-        placeDescriptionLabel.setText(L10n.getString("AddEdit.PlaceDescriptionLabel"));
+        placeDescriptionLabel.setText(L10n.getString("AddEdit.PlaceDescriptionLabel")+REQUIRED_STRING);
         yearLabel.setText(L10n.getString("AddEdit.YearLabel")+REQUIRED_STRING);
         taxonLabel.setText(L10n.getString("AddEdit.TaxonLabel")+REQUIRED_STRING);
         

Modified: trunk/src/net/sf/plantlore/common/record/Habitat.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/Habitat.java	2006-10-22 14:17:41 UTC (rev 856)
+++ trunk/src/net/sf/plantlore/common/record/Habitat.java	2006-11-03 14:45:40 UTC (rev 857)
@@ -70,6 +70,11 @@
     //public enum Column {ID, TERRITORY, PHYTOCHORION, NEARESTVILLAGE, QUADRANT, DESCRIPTION, COUNTRY, ALTITUDE, LATITUDE, LONGITUDE, DELETED, NOTE};
     
     @Override
+    public List<String> getNN() {
+    	return asList( DESCRIPTION );
+    }
+    
+    @Override
     public List<String> getForeignKeys() { 
     	return asList( TERRITORY, PHYTOCHORION, NEARESTVILLAGE ); 
     }

Modified: trunk/src/net/sf/plantlore/config/hibernate/Habitats.hbm.xml
===================================================================
--- trunk/src/net/sf/plantlore/config/hibernate/Habitats.hbm.xml	2006-10-22 14:17:41 UTC (rev 856)
+++ trunk/src/net/sf/plantlore/config/hibernate/Habitats.hbm.xml	2006-11-03 14:45:40 UTC (rev 857)
@@ -25,7 +25,7 @@
       <property column="CDESCRIPTION"
                 length="255"
                 name="description"
-                not-null="false"                
+                not-null="true"                
                 type="java.lang.String"/>   
       <many-to-one name="nearestVillage" 
                    class="net.sf.plantlore.common.record.NearestVillage" 

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-10-22 14:17:41 UTC (rev 856)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-11-03 14:45:40 UTC (rev 857)
@@ -1867,3 +1867,5 @@
 Import.RecordsDeleted=deleted.
 
 Overview.Tree.Number=number
+
+AddEdit.CheckMessage.CompulsoryDescription=You have to enter all requested data. Please fill in the place description.

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties	2006-10-22 14:17:41 UTC (rev 856)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties	2006-11-03 14:45:40 UTC (rev 857)
@@ -2189,3 +2189,5 @@
 Exception.DropUser=Nepoda\u0159ilo se zru\u0161it u\u017Eivatele.\nOv\u011B\u0159te, zda m\u00E1te dostate\u010Dn\u00E1 pr\u00E1va pro tuto operaci.
 
 Overview.Tree.Number=\u010D\u00EDslo
+
+AddEdit.CheckMessage.CompulsoryDescription=You have to enter all requested data. Please fill in the place description.

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties	2006-10-22 14:17:41 UTC (rev 856)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties	2006-11-03 14:45:40 UTC (rev 857)
@@ -2190,3 +2190,5 @@
 Import.RecordsDeleted=deleted.
 
 Overview.Tree.Number=number
+
+AddEdit.CheckMessage.CompulsoryDescription=You have to enter all requested data. Please fill in the place description.



From fraktalek at mail.berlios.de  Sat Nov  4 00:12:02 2006
From: fraktalek at mail.berlios.de (fraktalek at mail.berlios.de)
Date: Sat, 4 Nov 2006 00:12:02 +0100
Subject: [Plantlore-dev] r858 - trunk/src/net/sf/plantlore/client/overview
Message-ID: <200611032312.kA3NC2YD027641@sheep.berlios.de>

Author: fraktalek
Date: 2006-11-04 00:12:01 +0100 (Sat, 04 Nov 2006)
New Revision: 858

Modified:
   trunk/src/net/sf/plantlore/client/overview/AddEditView.form
   trunk/src/net/sf/plantlore/client/overview/AddEditView.java
Log:
Partially fixed [ Bug #9098 ] Fix the loop of focus
setNextFocusableComponent doesn't seem to work on projectCombo - the focus then doesn't go to the herbarium text field but to the checklist button instead.
I don't see why.



Modified: trunk/src/net/sf/plantlore/client/overview/AddEditView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEditView.form	2006-11-03 14:45:40 UTC (rev 857)
+++ trunk/src/net/sf/plantlore/client/overview/AddEditView.form	2006-11-03 23:12:01 UTC (rev 858)
@@ -122,8 +122,8 @@
                       <Group type="102" alignment="0" attributes="0">
                           <EmptySpace max="-2" attributes="0"/>
                           <Group type="103" groupAlignment="0" attributes="0">
-                              <Component id="jPanel7" alignment="0" pref="918" max="32767" attributes="3"/>
-                              <Component id="jPanel5" alignment="0" pref="918" max="32767" attributes="1"/>
+                              <Component id="jPanel7" alignment="0" pref="921" max="32767" attributes="3"/>
+                              <Component id="jPanel5" alignment="0" pref="921" max="32767" attributes="1"/>
                           </Group>
                       </Group>
                   </Group>
@@ -204,7 +204,7 @@
                                                       <EmptySpace min="-2" pref="434" max="-2" attributes="0"/>
                                                   </Group>
                                                   <Group type="102" attributes="0">
-                                                      <Component id="jScrollPane2" pref="551" max="32767" attributes="1"/>
+                                                      <Component id="jScrollPane2" pref="572" max="32767" attributes="1"/>
                                                       <EmptySpace max="-2" attributes="0"/>
                                                   </Group>
                                               </Group>
@@ -485,7 +485,7 @@
                         <Component class="javax.swing.JTextField" name="altitudeTextField">
                           <Properties>
                             <Property name="nextFocusableComponent" type="java.awt.Component" editor="org.netbeans.modules.form.ComponentChooserEditor">
-                              <ComponentRef name="latitudeTextField"/>
+                              <ComponentRef name="gpsChangeButton"/>
                             </Property>
                           </Properties>
                           <AuxValues>
@@ -518,6 +518,9 @@
                         <Component class="javax.swing.JButton" name="gpsChangeButton">
                           <Properties>
                             <Property name="text" type="java.lang.String" value="Change"/>
+                            <Property name="nextFocusableComponent" type="java.awt.Component" editor="org.netbeans.modules.form.ComponentChooserEditor">
+                              <ComponentRef name="taxonTextArea"/>
+                            </Property>
                           </Properties>
                           <AuxValues>
                             <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
@@ -591,13 +594,13 @@
                                       <Group type="103" groupAlignment="0" attributes="0">
                                           <Group type="102" alignment="0" attributes="0">
                                               <Component id="checklistButton" linkSize="21" min="-2" max="-2" attributes="0"/>
-                                              <EmptySpace pref="342" max="32767" attributes="0"/>
+                                              <EmptySpace pref="239" max="32767" attributes="0"/>
                                               <Component id="clearOccurrenceButton" linkSize="21" min="-2" max="-2" attributes="0"/>
                                           </Group>
                                           <Component id="jPanel4" min="-2" max="-2" attributes="1"/>
                                       </Group>
                                   </Group>
-                                  <Component id="jScrollPane1" pref="660" max="32767" attributes="1"/>
+                                  <Component id="jScrollPane1" pref="652" max="32767" attributes="1"/>
                               </Group>
                               <EmptySpace max="-2" attributes="0"/>
                               <Group type="103" groupAlignment="0" attributes="0">
@@ -610,11 +613,11 @@
                                       </Group>
                                       <EmptySpace max="-2" attributes="0"/>
                                       <Group type="103" groupAlignment="0" attributes="0">
-                                          <Component id="herbariumTextField" alignment="0" pref="148" max="32767" attributes="1"/>
-                                          <Component id="publicationCombo" alignment="0" pref="148" max="32767" attributes="1"/>
-                                          <Component id="projectCombo" alignment="0" pref="148" max="32767" attributes="1"/>
+                                          <Component id="herbariumTextField" alignment="0" pref="132" max="32767" attributes="1"/>
+                                          <Component id="publicationCombo" alignment="0" pref="132" max="32767" attributes="1"/>
+                                          <Component id="projectCombo" alignment="0" pref="132" max="32767" attributes="1"/>
                                           <Group type="102" alignment="0" attributes="0">
-                                              <Component id="sourceCombo" pref="148" max="32767" attributes="1"/>
+                                              <Component id="sourceCombo" pref="132" max="32767" attributes="1"/>
                                               <EmptySpace max="-2" attributes="0"/>
                                           </Group>
                                       </Group>
@@ -838,7 +841,7 @@
                         <Component class="javax.swing.JTextField" name="timeTextField">
                           <Properties>
                             <Property name="nextFocusableComponent" type="java.awt.Component" editor="org.netbeans.modules.form.ComponentChooserEditor">
-                              <ComponentRef name="okButton"/>
+                              <ComponentRef name="sourceCombo"/>
                             </Property>
                           </Properties>
                           <AuxValues>
@@ -884,6 +887,9 @@
                         <Property name="model" type="javax.swing.ComboBoxModel" editor="org.netbeans.modules.form.editors2.ComboBoxModelEditor">
                           <StringArray count="0"/>
                         </Property>
+                        <Property name="nextFocusableComponent" type="java.awt.Component" editor="org.netbeans.modules.form.ComponentChooserEditor">
+                          <ComponentRef name="publicationCombo"/>
+                        </Property>
                       </Properties>
                       <AuxValues>
                         <AuxValue name="JavaCodeGenerator_CreateCodeCustom" type="java.lang.String" value="new AutoComboBoxNG3(false); "/>
@@ -912,6 +918,9 @@
                         <Property name="model" type="javax.swing.ComboBoxModel" editor="org.netbeans.modules.form.editors2.ComboBoxModelEditor">
                           <StringArray count="0"/>
                         </Property>
+                        <Property name="nextFocusableComponent" type="java.awt.Component" editor="org.netbeans.modules.form.ComponentChooserEditor">
+                          <ComponentRef name="projectCombo"/>
+                        </Property>
                       </Properties>
                       <AuxValues>
                         <AuxValue name="JavaCodeGenerator_CreateCodeCustom" type="java.lang.String" value="new AutoComboBoxNG3(true);"/>
@@ -920,6 +929,11 @@
                       </AuxValues>
                     </Component>
                     <Component class="javax.swing.JTextField" name="herbariumTextField">
+                      <Properties>
+                        <Property name="nextFocusableComponent" type="java.awt.Component" editor="org.netbeans.modules.form.ComponentChooserEditor">
+                          <ComponentRef name="authorTable"/>
+                        </Property>
+                      </Properties>
                       <AuxValues>
                         <AuxValue name="JavaCodeGenerator_InitCodePost" type="java.lang.String" value="herbariumTextField.setActionCommand(&quot;herbariumTextField&quot;);"/>
                         <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
@@ -946,6 +960,9 @@
                         <Property name="model" type="javax.swing.ComboBoxModel" editor="org.netbeans.modules.form.editors2.ComboBoxModelEditor">
                           <StringArray count="0"/>
                         </Property>
+                        <Property name="nextFocusableComponent" type="java.awt.Component" editor="org.netbeans.modules.form.ComponentChooserEditor">
+                          <ComponentRef name="herbariumTextField"/>
+                        </Property>
                       </Properties>
                       <AuxValues>
                         <AuxValue name="JavaCodeGenerator_CreateCodeCustom" type="java.lang.String" value="new AutoComboBoxNG3(true);"/>
@@ -956,6 +973,9 @@
                     <Component class="javax.swing.JButton" name="checklistButton">
                       <Properties>
                         <Property name="text" type="java.lang.String" value="Checklist"/>
+                        <Property name="nextFocusableComponent" type="java.awt.Component" editor="org.netbeans.modules.form.ComponentChooserEditor">
+                          <ComponentRef name="authorTable"/>
+                        </Property>
                       </Properties>
                       <AuxValues>
                         <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
@@ -972,6 +992,9 @@
                           <Properties>
                             <Property name="columns" type="int" value="20"/>
                             <Property name="rows" type="int" value="5"/>
+                            <Property name="nextFocusableComponent" type="java.awt.Component" editor="org.netbeans.modules.form.ComponentChooserEditor">
+                              <ComponentRef name="okButton"/>
+                            </Property>
                           </Properties>
                           <AuxValues>
                             <AuxValue name="JavaCodeGenerator_InitCodePost" type="java.lang.String" value="occurrenceNoteArea.setLineWrap(true);&#xa;occurrenceNoteArea.setWrapStyleWord(true);&#xa;new TabTransfersFocus(occurrenceNoteArea);"/>
@@ -997,6 +1020,9 @@
                                 <Column editable="true" title="Title 4" type="java.lang.Object"/>
                               </Table>
                             </Property>
+                            <Property name="nextFocusableComponent" type="java.awt.Component" editor="org.netbeans.modules.form.ComponentChooserEditor">
+                              <ComponentRef name="occurrenceNoteArea"/>
+                            </Property>
                           </Properties>
                           <AuxValues>
                             <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
@@ -1052,7 +1078,7 @@
                           <Component id="restoreButton" linkSize="12" min="-2" max="-2" attributes="0"/>
                           <EmptySpace min="-2" pref="18" max="-2" attributes="0"/>
                           <Component id="requiredInfoLabel" min="-2" max="-2" attributes="0"/>
-                          <EmptySpace pref="226" max="32767" attributes="0"/>
+                          <EmptySpace pref="98" max="32767" attributes="0"/>
                           <Component id="okButton" linkSize="12" min="-2" max="-2" attributes="0"/>
                           <EmptySpace max="-2" attributes="0"/>
                           <Component id="cancelButton" linkSize="12" min="-2" max="-2" attributes="0"/>
@@ -1074,7 +1100,7 @@
                               <Component id="restoreButton" alignment="3" min="-2" max="-2" attributes="0"/>
                               <Component id="requiredInfoLabel" alignment="3" min="-2" max="-2" attributes="0"/>
                           </Group>
-                          <EmptySpace pref="16" max="32767" attributes="0"/>
+                          <EmptySpace pref="13" max="32767" attributes="0"/>
                       </Group>
                   </Group>
                 </DimensionLayout>
@@ -1176,7 +1202,7 @@
                   <Group type="103" groupAlignment="0" attributes="0">
                       <Group type="102" alignment="0" attributes="0">
                           <EmptySpace max="-2" attributes="0"/>
-                          <Component id="jScrollPane6" pref="908" max="32767" attributes="0"/>
+                          <Component id="jScrollPane6" pref="909" max="32767" attributes="0"/>
                           <EmptySpace max="-2" attributes="0"/>
                       </Group>
                   </Group>

Modified: trunk/src/net/sf/plantlore/client/overview/AddEditView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEditView.java	2006-11-03 14:45:40 UTC (rev 857)
+++ trunk/src/net/sf/plantlore/client/overview/AddEditView.java	2006-11-03 23:12:01 UTC (rev 858)
@@ -105,7 +105,7 @@
             rememberButton.setVisible(false);
             restoreButton.setVisible(false);
         }
-        
+
         this.pack();
     }
     
@@ -250,13 +250,14 @@
 
         longitudeLabel.setText("Longitude:");
 
-        altitudeTextField.setNextFocusableComponent(latitudeTextField);
+        altitudeTextField.setNextFocusableComponent(gpsChangeButton);
 
         latitudeTextField.setNextFocusableComponent(longitudeTextField);
 
         coordinateSystemLabel.setText("Coordinate system:");
 
         gpsChangeButton.setText("Change");
+        gpsChangeButton.setNextFocusableComponent(taxonTextArea);
 
         org.jdesktop.layout.GroupLayout gpsPanelLayout = new org.jdesktop.layout.GroupLayout(gpsPanel);
         gpsPanel.setLayout(gpsPanelLayout);
@@ -354,7 +355,7 @@
                                         .add(placeDescriptionLabel)
                                         .add(434, 434, 434))
                                     .add(jPanel5Layout.createSequentialGroup()
-                                        .add(jScrollPane2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 551, Short.MAX_VALUE)
+                                        .add(jScrollPane2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 572, Short.MAX_VALUE)
                                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)))
                                 .add(jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                                     .add(locationNoteLabel)
@@ -421,7 +422,7 @@
 
         timeLabel.setText("Time:");
 
-        timeTextField.setNextFocusableComponent(okButton);
+        timeTextField.setNextFocusableComponent(sourceCombo);
 
         yearLabel.setText("Year:");
 
@@ -487,6 +488,7 @@
                 .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
         );
 
+        sourceCombo.setNextFocusableComponent(publicationCombo);
         sourceCombo.setActionCommand("sourceCombo");
         sourceCombo.insertItemAt(model.EMPTY_STRING,0);
 
@@ -494,21 +496,26 @@
 
         publicationLabel.setText("Publication:");
 
+        publicationCombo.setNextFocusableComponent(projectCombo);
         publicationCombo.setActionCommand("publicationCombo");
         publicationCombo.insertItemAt(model.EMPTY_PAIR,0);
 
+        herbariumTextField.setNextFocusableComponent(authorTable);
         herbariumTextField.setActionCommand("herbariumTextField");
 
         herbariumLabel.setText("Herbarium:");
 
         projectLabel.setText("Project:");
 
+        projectCombo.setNextFocusableComponent(herbariumTextField);
         projectCombo.setActionCommand("projectCombo");
 
         checklistButton.setText("Checklist");
+        checklistButton.setNextFocusableComponent(authorTable);
 
         occurrenceNoteArea.setColumns(20);
         occurrenceNoteArea.setRows(5);
+        occurrenceNoteArea.setNextFocusableComponent(okButton);
         occurrenceNoteArea.setLineWrap(true);
         occurrenceNoteArea.setWrapStyleWord(true);
         new TabTransfersFocus(occurrenceNoteArea);
@@ -525,6 +532,7 @@
                 "Title 1", "Title 2", "Title 3", "Title 4"
             }
         ));
+        authorTable.setNextFocusableComponent(occurrenceNoteArea);
         jScrollPane1.setViewportView(authorTable);
 
         occurrenceNoteLabel.setText("Occurrence note:");
@@ -546,10 +554,10 @@
                         .add(jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                             .add(jPanel7Layout.createSequentialGroup()
                                 .add(checklistButton)
-                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 342, Short.MAX_VALUE)
+                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 239, Short.MAX_VALUE)
                                 .add(clearOccurrenceButton))
                             .add(jPanel4, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
-                    .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 660, Short.MAX_VALUE))
+                    .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 652, Short.MAX_VALUE))
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(jPanel7Layout.createSequentialGroup()
@@ -560,11 +568,11 @@
                             .add(herbariumLabel))
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                            .add(herbariumTextField, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 148, Short.MAX_VALUE)
-                            .add(publicationCombo, 0, 148, Short.MAX_VALUE)
-                            .add(projectCombo, 0, 148, Short.MAX_VALUE)
+                            .add(herbariumTextField, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 132, Short.MAX_VALUE)
+                            .add(publicationCombo, 0, 132, Short.MAX_VALUE)
+                            .add(projectCombo, 0, 132, Short.MAX_VALUE)
                             .add(jPanel7Layout.createSequentialGroup()
-                                .add(sourceCombo, 0, 148, Short.MAX_VALUE)
+                                .add(sourceCombo, 0, 132, Short.MAX_VALUE)
                                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)))
                         .add(19, 19, 19))
                     .add(jPanel7Layout.createSequentialGroup()
@@ -627,8 +635,8 @@
             .add(basicPanelLayout.createSequentialGroup()
                 .addContainerGap()
                 .add(basicPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                    .add(jPanel7, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 918, Short.MAX_VALUE)
-                    .add(jPanel5, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 918, Short.MAX_VALUE)))
+                    .add(jPanel7, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 921, Short.MAX_VALUE)
+                    .add(jPanel5, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 921, Short.MAX_VALUE)))
         );
         basicPanelLayout.setVerticalGroup(
             basicPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -681,7 +689,7 @@
                 .add(restoreButton)
                 .add(18, 18, 18)
                 .add(requiredInfoLabel)
-                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 226, Short.MAX_VALUE)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 98, Short.MAX_VALUE)
                 .add(okButton)
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(cancelButton)
@@ -703,7 +711,7 @@
                     .add(rememberButton)
                     .add(restoreButton)
                     .add(requiredInfoLabel))
-                .addContainerGap(16, Short.MAX_VALUE))
+                .addContainerGap(13, Short.MAX_VALUE))
         );
 
         buttonPanelLayout.linkSize(new java.awt.Component[] {cancelButton, helpButton, okButton}, org.jdesktop.layout.GroupLayout.VERTICAL);
@@ -746,7 +754,7 @@
             extendedPanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(extendedPanelLayout.createSequentialGroup()
                 .addContainerGap()
-                .add(jScrollPane6, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 908, Short.MAX_VALUE)
+                .add(jScrollPane6, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 909, Short.MAX_VALUE)
                 .addContainerGap())
         );
         extendedPanelLayout.setVerticalGroup(



From admin at berlios.de  Sat Nov  4 00:09:56 2006
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 4 Nov 2006 00:09:56 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9098] Fix the loop of focus
Message-ID: <200611032309.kA3N9uYS023448@unicorn.berlios.de>

Bug #9098, was updated on 2006-Oct-13 19:07
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Open
Resolution: None
Bug Group: Bug
Priority: 5
Submitted by: krater
Assigned to : fraktalek
Summary: Fix the loop of focus

Details: The focus gets stuck in the Coordinates pane.

Follow-Ups:

Date: 2006-Nov-04 00:09
By: fraktalek

Comment:
Fixed in rev. 858. 
However, focus doesn't cycle right from project combo to herbarium text field. I don't see why.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9098&group_id=5975


From fraktalek at mail.berlios.de  Sat Nov  4 00:18:51 2006
From: fraktalek at mail.berlios.de (fraktalek at mail.berlios.de)
Date: Sat, 4 Nov 2006 00:18:51 +0100
Subject: [Plantlore-dev] r859 - trunk/src/net/sf/plantlore/client/overview
Message-ID: <200611032318.kA3NIpqP028080@sheep.berlios.de>

Author: fraktalek
Date: 2006-11-04 00:18:51 +0100 (Sat, 04 Nov 2006)
New Revision: 859

Modified:
   trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java
Log:
Fix of [ Bug #9180 ] Increase the number of decimal places
Increased to 6 fraction digits.



Modified: trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java	2006-11-03 23:12:01 UTC (rev 858)
+++ trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java	2006-11-03 23:18:51 UTC (rev 859)
@@ -79,7 +79,7 @@
     private AddEditView view;
     private AuthorManagerView authView;
     private TransformationChangeView transformationView;
-    public final static int MAXIMUM_FRACTION_DIGITS = 3;
+    public final static int MAXIMUM_FRACTION_DIGITS = 6;
     public final static int MAXIMUM_INTEGER_DIGITS = 9;
     private final static Color COLOR_INVALID = Color.RED;
     



From admin at berlios.de  Sat Nov  4 00:15:59 2006
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 4 Nov 2006 00:15:59 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9180] Increase the number of decimal places
Message-ID: <200611032315.kA3NFxk4024071@unicorn.berlios.de>

Bug #9180, was updated on 2006-Oct-18 16:27
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Open
Resolution: Fixed
Bug Group: RFE
Priority: 5
Submitted by: krater
Assigned to : fraktalek
Summary: Increase the number of decimal places

Details: The coordinate's textfields should provide at least 15 valid decimal places (because 1/1000 may be 60 metres).

Follow-Ups:

Date: 2006-Nov-04 00:15
By: fraktalek

Comment:
Fixed in rev. 859.
Increased to 6 fraction digits.

-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9180&group_id=5975


From fraktalek at mail.berlios.de  Sat Nov  4 01:13:04 2006
From: fraktalek at mail.berlios.de (fraktalek at mail.berlios.de)
Date: Sat, 4 Nov 2006 01:13:04 +0100
Subject: [Plantlore-dev] r860 - in trunk/src/net/sf/plantlore:
	client/overview l10n
Message-ID: <200611040013.kA40D4Ul008740@sheep.berlios.de>

Author: fraktalek
Date: 2006-11-04 01:13:03 +0100 (Sat, 04 Nov 2006)
New Revision: 860

Modified:
   trunk/src/net/sf/plantlore/client/overview/AddEdit.java
   trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java
   trunk/src/net/sf/plantlore/client/overview/AddEditView.form
   trunk/src/net/sf/plantlore/client/overview/AddEditView.java
   trunk/src/net/sf/plantlore/l10n/Plantlore.properties
   trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties
   trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties
Log:
Fixed [ Bug #9097 ] Remove the announcement about new Occurrences
Implemented alternative announcement instead. It doesn't require user confirmation anymore.



Modified: trunk/src/net/sf/plantlore/client/overview/AddEdit.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-11-03 23:18:51 UTC (rev 859)
+++ trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-11-04 00:13:03 UTC (rev 860)
@@ -1945,18 +1945,6 @@
         notifyObservers( getDefaultValues(false) );
     }
 
-    
-
-
-    /* 
-     *
-     * This `Netbeans 5.0` is a real shit . Thank God to IBM for their vastly superior Eclipse 3.1
-     * What Netbeans cannot do properly:
-     * 1. indent the code automatically (when inserted...),
-     * 2. find usages (invoked on a method definition)
-     * 3. refactor method names
-     *
-     */
 }
 
 

Modified: trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java	2006-11-03 23:18:51 UTC (rev 859)
+++ trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java	2006-11-04 00:13:03 UTC (rev 860)
@@ -26,6 +26,8 @@
 import java.util.Calendar;
 import java.util.Date;
 import java.util.Hashtable;
+import java.util.Timer;
+import java.util.TimerTask;
 
 import javax.swing.AbstractAction;
 import javax.swing.JComboBox;
@@ -651,6 +653,7 @@
         private String JUST_THIS = L10n.getString("AddEdit.JustThis");
         private String CANCEL = L10n.getString("Common.Cancel");
         private String TITLE = L10n.getString("AddEdit.QuestionDialogTitle");
+        private static final int CONFIRMATION_DELAY = 2500;
         
         public OkButtonAction() {
             putValue(NAME, L10n.getString("Common.Ok"));
@@ -729,22 +732,20 @@
                     }
                 } else {//inAddMode
                     Task task = model.storeRecord(true);
-                    /*
-                     * The following announcement should be removed (it was a RFE)..
-                     */
                     task.setPostTaskAction(new PostTaskAction() {
                         public void afterStopped(Object value) {
                             SwingUtilities.invokeLater(new Runnable() {
                                 public void run() {
-                                    JOptionPane.showMessageDialog(view,L10n.getString("AddEdit.AddConfirmation"),L10n.getString("AddEdit.AddConfirmationTitle"),JOptionPane.INFORMATION_MESSAGE);
+                                    view.confirmationLabel.setText(L10n.getString("AddEdit.AddConfirmation"));
+                                    view.confirmationLabel.setForeground(new Color(0, 204, 0));
+                                    view.confirmationLabel.setVisible(true);
+                                    Timer timer = new Timer();
+                                    timer.schedule(new LabelHider(), CONFIRMATION_DELAY);
                                 }
                             });
                         }
                     });
                     Dispatcher.getDispatcher().dispatch(task, view, false);
-                     /**/
-                    //view.setVisible(false);
-
                 }
             } catch (RemoteException ex) {
                 logger.error("Remote problem: "+ex);
@@ -757,6 +758,11 @@
             }
         }//mouseClicked
             
+        class LabelHider extends TimerTask {
+            public void run() {
+                view.confirmationLabel.setVisible(false);
+            }            
+        }
     }//OkButtonListener
     
     class CancelButtonAction extends AbstractAction {

Modified: trunk/src/net/sf/plantlore/client/overview/AddEditView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEditView.form	2006-11-03 23:18:51 UTC (rev 859)
+++ trunk/src/net/sf/plantlore/client/overview/AddEditView.form	2006-11-04 00:13:03 UTC (rev 860)
@@ -195,7 +195,10 @@
                                           <Group type="102" alignment="0" attributes="0">
                                               <Component id="gpsPanel" min="-2" max="-2" attributes="1"/>
                                               <EmptySpace max="-2" attributes="0"/>
-                                              <Component id="clearLocationButton" min="-2" max="-2" attributes="0"/>
+                                              <Group type="103" groupAlignment="0" attributes="0">
+                                                  <Component id="clearLocationButton" min="-2" max="-2" attributes="0"/>
+                                                  <Component id="confirmationLabel" alignment="0" min="-2" max="-2" attributes="0"/>
+                                              </Group>
                                           </Group>
                                           <Group type="102" alignment="0" attributes="0">
                                               <Group type="103" groupAlignment="0" attributes="0">
@@ -204,7 +207,7 @@
                                                       <EmptySpace min="-2" pref="434" max="-2" attributes="0"/>
                                                   </Group>
                                                   <Group type="102" attributes="0">
-                                                      <Component id="jScrollPane2" pref="572" max="32767" attributes="1"/>
+                                                      <Component id="jScrollPane2" pref="578" max="32767" attributes="1"/>
                                                       <EmptySpace max="-2" attributes="0"/>
                                                   </Group>
                                               </Group>
@@ -262,7 +265,11 @@
                               <EmptySpace max="-2" attributes="0"/>
                               <Group type="103" groupAlignment="0" attributes="0">
                                   <Component id="gpsPanel" min="-2" max="-2" attributes="1"/>
-                                  <Component id="clearLocationButton" min="-2" max="-2" attributes="0"/>
+                                  <Group type="102" attributes="0">
+                                      <Component id="clearLocationButton" min="-2" max="-2" attributes="0"/>
+                                      <EmptySpace pref="31" max="32767" attributes="0"/>
+                                      <Component id="confirmationLabel" min="-2" max="-2" attributes="0"/>
+                                  </Group>
                               </Group>
                               <EmptySpace max="-2" attributes="0"/>
                           </Group>
@@ -563,6 +570,20 @@
                         <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
                       </AuxValues>
                     </Component>
+                    <Component class="javax.swing.JLabel" name="confirmationLabel">
+                      <Properties>
+                        <Property name="font" type="java.awt.Font" editor="org.netbeans.beaninfo.editors.FontEditor">
+                          <Font name="Dialog" size="14" style="1"/>
+                        </Property>
+                        <Property name="foreground" type="java.awt.Color" editor="org.netbeans.beaninfo.editors.ColorEditor">
+                          <Color blue="0" green="cc" red="0" type="rgb"/>
+                        </Property>
+                        <Property name="text" type="java.lang.String" value="jLabel1"/>
+                      </Properties>
+                      <AuxValues>
+                        <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
+                      </AuxValues>
+                    </Component>
                   </SubComponents>
                 </Container>
                 <Container class="javax.swing.JPanel" name="jPanel7">

Modified: trunk/src/net/sf/plantlore/client/overview/AddEditView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEditView.java	2006-11-03 23:18:51 UTC (rev 859)
+++ trunk/src/net/sf/plantlore/client/overview/AddEditView.java	2006-11-04 00:13:03 UTC (rev 860)
@@ -106,6 +106,7 @@
             restoreButton.setVisible(false);
         }
 
+        confirmationLabel.setVisible(false);
         this.pack();
     }
     
@@ -154,6 +155,7 @@
         jScrollPane4 = new javax.swing.JScrollPane();
         locationNoteArea = new javax.swing.JTextArea();
         clearLocationButton = new javax.swing.JButton();
+        confirmationLabel = new javax.swing.JLabel();
         jPanel7 = new javax.swing.JPanel();
         jScrollPane3 = new javax.swing.JScrollPane();
 
@@ -314,6 +316,10 @@
 
         clearLocationButton.setText("Vyma\u017e");
 
+        confirmationLabel.setFont(new java.awt.Font("Dialog", 1, 14));
+        confirmationLabel.setForeground(new java.awt.Color(0, 204, 0));
+        confirmationLabel.setText("jLabel1");
+
         org.jdesktop.layout.GroupLayout jPanel5Layout = new org.jdesktop.layout.GroupLayout(jPanel5);
         jPanel5.setLayout(jPanel5Layout);
         jPanel5Layout.setHorizontalGroup(
@@ -348,14 +354,16 @@
                             .add(jPanel5Layout.createSequentialGroup()
                                 .add(gpsPanel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                                .add(clearLocationButton))
+                                .add(jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                                    .add(clearLocationButton)
+                                    .add(confirmationLabel)))
                             .add(jPanel5Layout.createSequentialGroup()
                                 .add(jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                     .add(jPanel5Layout.createSequentialGroup()
                                         .add(placeDescriptionLabel)
                                         .add(434, 434, 434))
                                     .add(jPanel5Layout.createSequentialGroup()
-                                        .add(jScrollPane2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 572, Short.MAX_VALUE)
+                                        .add(jScrollPane2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 578, Short.MAX_VALUE)
                                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)))
                                 .add(jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                                     .add(locationNoteLabel)
@@ -399,7 +407,10 @@
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(gpsPanel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
-                    .add(clearLocationButton))
+                    .add(jPanel5Layout.createSequentialGroup()
+                        .add(clearLocationButton)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 31, Short.MAX_VALUE)
+                        .add(confirmationLabel)))
                 .addContainerGap())
         );
 
@@ -1396,6 +1407,7 @@
     protected javax.swing.JButton checklistButton;
     protected javax.swing.JButton clearLocationButton;
     protected javax.swing.JButton clearOccurrenceButton;
+    protected javax.swing.JLabel confirmationLabel;
     private javax.swing.ButtonGroup convertCoordinatesGroup;
     protected javax.swing.JLabel coordinateSystemLabel;
     protected javax.swing.JLabel countryLabel;

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-11-03 23:18:51 UTC (rev 859)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-11-04 00:13:03 UTC (rev 860)
@@ -1726,7 +1726,7 @@
 
 Common.HelpTT=Displays help for current section
 
-AddEdit.AddConfirmation=Occurrence has been added successfuly
+AddEdit.AddConfirmation=Added
 
 AddEdit.AddConfirmationTitle=Success
 

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties	2006-11-03 23:18:51 UTC (rev 859)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties	2006-11-04 00:13:03 UTC (rev 860)
@@ -2040,7 +2040,7 @@
 
 Common.HelpTT=Zobraz\u00ED n\u00E1pov\u011Bdu pro aktu\u00E1ln\u00ED \u010D\u00E1st programu
 
-AddEdit.AddConfirmation=N\u00E1lez \u00FAsp\u011B\u0161n\u011B p\u0159id\u00E1n
+AddEdit.AddConfirmation=P\u0159id\u00E1no
 
 AddEdit.AddConfirmationTitle=\u00DAsp\u011Bch
 

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties	2006-11-03 23:18:51 UTC (rev 859)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties	2006-11-04 00:13:03 UTC (rev 860)
@@ -1573,7 +1573,7 @@
 
 Common.HelpTT=Displays help for current section
 
-AddEdit.AddConfirmation=Occurrence has been added successfuly
+AddEdit.AddConfirmation=Added
 
 AddEdit.AddConfirmationTitle=Success
 



From admin at berlios.de  Sat Nov  4 01:10:26 2006
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 4 Nov 2006 01:10:26 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9097] Remove the announcement about new
	Occurrences
Message-ID: <200611040010.kA40AQdk002905@unicorn.berlios.de>

Bug #9097, was updated on 2006-Oct-13 19:05
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: Fixed
Bug Group: RFE
Priority: 2
Submitted by: krater
Assigned to : krater
Summary: Remove the announcement about new Occurrences

Details: Do not announce a successful insert of new Occurrence records.

Follow-Ups:

Date: 2006-Nov-04 01:10
By: fraktalek

Comment:
Really fixed and improved in rev. 860.
-------------------------------------------------------

Date: 2006-Oct-18 17:10
By: krater

Comment:
Fixed in Revision 853
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9097&group_id=5975


From fraktalek at mail.berlios.de  Sat Nov  4 19:57:22 2006
From: fraktalek at mail.berlios.de (fraktalek at mail.berlios.de)
Date: Sat, 4 Nov 2006 19:57:22 +0100
Subject: [Plantlore-dev] r861 - in trunk/src/net/sf/plantlore: client
	client/overview common l10n
Message-ID: <200611041857.kA4IvM9e000285@sheep.berlios.de>

Author: fraktalek
Date: 2006-11-04 19:57:21 +0100 (Sat, 04 Nov 2006)
New Revision: 861

Modified:
   trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
   trunk/src/net/sf/plantlore/client/overview/AddEdit.java
   trunk/src/net/sf/plantlore/common/DBLayerUtils.java
   trunk/src/net/sf/plantlore/l10n/Plantlore.properties
   trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties
   trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties
Log:
Implemented [ Bug #9105 ] Implement a better duplicity check
Had to fix a bug(?) in DBLayerUtils.findMatch() ... needs Erik to review the change whether it could affect his code in a wrong way.

Also fixed a bug in overview - after executing plantlore it crashed on enter or spacebar key press.



Modified: trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-11-04 00:13:03 UTC (rev 860)
+++ trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-11-04 18:57:21 UTC (rev 861)
@@ -1598,6 +1598,9 @@
         /** Listnes to the enter key pressed in overview and invokes Detail. */
 	class OverviewKeyListener implements KeyListener {
 		public void keyTyped(KeyEvent e) {
+                    if (! model.loggedIn())
+                        return;
+                    
 			if (e.getKeyText(e.getKeyChar()).equals("Space"))
 				model.invertSelectedOnCurrentRow();
 			if (e.getKeyText(e.getKeyChar()).equals("Enter")) {

Modified: trunk/src/net/sf/plantlore/client/overview/AddEdit.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-11-04 00:13:03 UTC (rev 860)
+++ trunk/src/net/sf/plantlore/client/overview/AddEdit.java	2006-11-04 18:57:21 UTC (rev 861)
@@ -840,9 +840,13 @@
             temp.setTime(time);
             c.set(Calendar.HOUR_OF_DAY,temp.get(Calendar.HOUR_OF_DAY));
             c.set(Calendar.MINUTE,temp.get(Calendar.MINUTE));
+            c.set(Calendar.SECOND,0);
+            c.set(Calendar.MILLISECOND,0);
         } else {
             c.set(Calendar.HOUR_OF_DAY,0);
             c.set(Calendar.MINUTE,1); //so that we avoid possible problems with strong inequality when searching - we set the from minute in search by default to 0
+            c.set(Calendar.SECOND,0);
+            c.set(Calendar.MILLISECOND,0);
         }
         occ.setIsoDateTimeBegin(c.getTime());
         
@@ -1322,7 +1326,7 @@
      *
      * @return Pair<Boolean,String> where the Boolean is true if the data is fine, otherwise it is false in which case the String contains a message for the user
      */
-    public Pair<Boolean,String> checkData() throws RemoteException {
+    public Pair<Boolean,String> checkData() throws RemoteException, DBLayerException {
         if (authorList.size() < 1)
             return new Pair<Boolean,String>(false, L10n.getString("AddEdit.CheckMessage.AtLeastOneAuthor"));
         else {
@@ -1417,6 +1421,63 @@
                 return new Pair<Boolean,String>(false,L10n.getString("AddEdit.CheckMessage.InvalidLatitude"));            
         }
         
+        DBLayerUtils dlu = new DBLayerUtils(database);
+        NearestVillage v;
+        Phytochorion p;
+        Territory t;
+        Habitat h = new Habitat();
+        v = (NearestVillage)dlu.getObjectFor(village.getSecond(),NearestVillage.class);
+        p = (Phytochorion)dlu.getObjectFor(phytCode.getSecond(),Phytochorion.class);
+        t = (Territory)dlu.getObjectFor(territoryName.getSecond(),Territory.class);                    
+        if (altitude != null) h.setAltitude(altitude);
+        if (phytCountry != null) h.setCountry(phytCountry);
+        if (habitatDescription != null) h.setDescription(habitatDescription);
+        if (latitude != null) h.setLatitude(latitude);
+        if (longitude != null) h.setLongitude(longitude);
+        h.setNearestVillage(v);
+        if (habitatNote != null)h.setNote(habitatNote);
+        h.setPhytochorion(p);
+        if (quadrant != null) h.setQuadrant(quadrant);
+        h.setTerritory(t);
+        h.setDeleted(0);
+
+        Record rec = dlu.findMatchInDB(h);
+
+        if (rec != null) {
+            logger.debug("HABITAT FOUND in db");
+            h = (Habitat) rec;
+            int aoTmpId = 0;
+            for (int j = 0; j < taxonList.size(); j++) {
+                logger.debug("Checking occurrence");
+                Occurrence occ = prepareNewOccurrence(taxonList.get(j), h);//share the habitat
+                rec = dlu.findMatchInDB(occ);
+                if (rec == null) { //the occurrence is not yet in the db. it's safe to continue
+                    logger.debug("Occurrence NOT in db, continuing");
+                    continue;
+                }
+
+                occ = (Occurrence) rec;
+                //the occurrence is in the db. -> check the author occurrences 
+
+                for (int k = 0; k < authorList.size(); k++) {
+                    Pair<Pair<String,Integer>,String> pTmp = authorList.get(k);
+                    AuthorOccurrence aoTmp = new AuthorOccurrence();
+                    aoTmp.setRole(pTmp.getSecond());
+                    aoTmp.setAuthor((Author)dlu.getObjectFor(pTmp.getFirst().getSecond(),Author.class));
+                    aoTmp.setNote(resultRevision.get(k));
+                    aoTmp.setOccurrence(occ);
+                    aoTmp.setDeleted(0);
+                    logger.debug("Checking author occurrence");
+                    rec = dlu.findMatchInDB(aoTmp);
+                    if (rec != null) { //found a duplicate, announce it
+                        logger.debug("DUPLICATE found");
+                        return new Pair<Boolean,String>(false,L10n.getString("AddEdit.CheckMessage.TryingToInsertDuplicate"));
+                    } else
+                        logger.debug("Author occurrence NOT in db. yet");
+                }//for authorList
+            }// for taxonList                                    
+        }
+        
         return new Pair<Boolean,String>(true,"");
     }
     

Modified: trunk/src/net/sf/plantlore/common/DBLayerUtils.java
===================================================================
--- trunk/src/net/sf/plantlore/common/DBLayerUtils.java	2006-11-04 00:13:03 UTC (rev 860)
+++ trunk/src/net/sf/plantlore/common/DBLayerUtils.java	2006-11-04 18:57:21 UTC (rev 861)
@@ -409,13 +409,15 @@
 			// Equal properties.
 			for(String property : record.getProperties()) {
 				Object value = record.getValue(property);
-				if( value != null ) 
+				if( value != null ) {
 					query.addRestriction(RESTR_EQ, property, null, value, null);
+                                }
 			}
 			// Equal foreign keys (by their ID's)!
 			for(String key : record.getForeignKeys() ) {
 				Record subrecord = (Record) record.getValue(key);
-				query.addRestriction(RESTR_EQ, key, null, subrecord, null);
+                                if (subrecord != null) //the query won't find a record with no publication associated if restriction "publication = null" added...
+                                    query.addRestriction(RESTR_EQ, key, null, subrecord, null);
 			}
 			
 			// Is there such record?

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-11-04 00:13:03 UTC (rev 860)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-11-04 18:57:21 UTC (rev 861)
@@ -1869,3 +1869,5 @@
 Overview.Tree.Number=number
 
 AddEdit.CheckMessage.CompulsoryDescription=You have to enter all requested data. Please fill in the place description.
+
+AddEdit.CheckMessage.TryingToInsertDuplicate=You are trying to insert a record that already exists in the database.

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties	2006-11-04 00:13:03 UTC (rev 860)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties	2006-11-04 18:57:21 UTC (rev 861)
@@ -2191,3 +2191,5 @@
 Overview.Tree.Number=\u010D\u00EDslo
 
 AddEdit.CheckMessage.CompulsoryDescription=You have to enter all requested data. Please fill in the place description.
+
+AddEdit.CheckMessage.TryingToInsertDuplicate=Pokou\u0161\u00EDte se vlo\u017Eit z\u00E1znam, kter\u00FD u\u017E v datab\u00E1zi existuje.

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties	2006-11-04 00:13:03 UTC (rev 860)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties	2006-11-04 18:57:21 UTC (rev 861)
@@ -2192,3 +2192,5 @@
 Overview.Tree.Number=number
 
 AddEdit.CheckMessage.CompulsoryDescription=You have to enter all requested data. Please fill in the place description.
+
+AddEdit.CheckMessage.TryingToInsertDuplicate=You are trying to insert a record that already exists in the database.



From admin at berlios.de  Sat Nov  4 19:54:37 2006
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 4 Nov 2006 19:54:37 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9105] Implement a better duplicity check
Message-ID: <200611041854.kA4Isb9J019295@unicorn.berlios.de>

Bug #9105, was updated on 2006-Oct-13 19:18
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Open
Resolution: Fixed
Bug Group: RFE
Priority: 5
Submitted by: krater
Assigned to : fraktalek
Summary: Implement a better duplicity check

Details: System should prevent the User from inserting the same Occurrences twice.

Follow-Ups:

Date: 2006-Nov-04 19:54
By: fraktalek

Comment:
Implemented in rev. 861.

-------------------------------------------------------

Date: 2006-Oct-18 15:59
By: krater

Comment:
This will be achieved by erasing all plants that were inserted into the taxonArea in the Add dialog after the OK button is pressed.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9105&group_id=5975


From lada at mail.berlios.de  Mon Nov 13 13:34:03 2006
From: lada at mail.berlios.de (lada at mail.berlios.de)
Date: Mon, 13 Nov 2006 13:34:03 +0100
Subject: [Plantlore-dev] r862 - trunk/src/net/sf/plantlore/l10n
Message-ID: <200611131234.kADCY3ea021590@sheep.berlios.de>

Author: lada
Date: 2006-11-13 13:34:03 +0100 (Mon, 13 Nov 2006)
New Revision: 862

Modified:
   trunk/src/net/sf/plantlore/l10n/Plantlore.properties
   trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties
   trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties
Log:
Replace text of buttons: 
"OK"  --> "Pridej"
"Storno" --> "Zavri"

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-11-04 18:57:21 UTC (rev 861)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-11-13 12:34:03 UTC (rev 862)
@@ -132,7 +132,6 @@
 History.ButtonDetails = Details
 History.ButtonHelp = Help
 History.ButtonClose = Close
-History.ButtonOk = Ok
 History.Whole.ButtonUndoToDate = Undo
 History.Whole.ButtonClearHistory = Clear history
 History.ButtonSelectAll = Select all
@@ -265,7 +264,7 @@
 UserManager.ButtonSearch = Search/Sort
 UserManager.ButtonHelp = Help
 UserManager.ButtonClose = Close
-UserManager.ButtonOk = Ok
+UserManager.ButtonOk = Close
 
 UserManager.ShowAllUser = All user
 UserManager.ShowActiveUser = Only current user
@@ -333,7 +332,7 @@
 MetadataManager.ButtonSearch = Search/Sort
 MetadataManager.ButtonHelp = Help
 MetadataManager.ButtonClose = Close
-MetadataManager.ButtonOk = Ok
+MetadataManager.ButtonOk = Close
 
 MetadataManager.DisplayRows = Rows to display
 MetadataManager.TotalResult = Total results:

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties	2006-11-04 18:57:21 UTC (rev 861)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore_cs_CZ.properties	2006-11-13 12:34:03 UTC (rev 862)
@@ -66,7 +66,6 @@
 History.ButtonDetails = Detail
 History.ButtonHelp = Pomoc
 History.ButtonClose = Zav\u0159i
-History.ButtonOk = Ok
 History.Whole.ButtonUndoToDate = Undo
 History.Whole.ButtonClearHistory = Sma\u017e
 History.ButtonSelectAll = Vyber v\u0161e
@@ -197,7 +196,7 @@
 UserManager.ButtonSearch = Hledej
 UserManager.ButtonHelp = Pomoc
 UserManager.ButtonClose = Zav\u0159i
-UserManager.ButtonOk = Ok
+UserManager.ButtonOk = Zav\u0159i
 
 UserManager.ShowAllUser = V\u0161ichni u\u017eivatel\u00e9
 UserManager.ShowActiveUser = Jen aktu\u00e1ln\u00ed u\u017eivatel\u00e9
@@ -265,7 +264,7 @@
 MetadataManager.ButtonSearch = Hledej
 MetadataManager.ButtonHelp = N\u00E1pov\u011Bda
 MetadataManager.ButtonClose = Zav\u0159i
-MetadataManager.ButtonOk = Ok
+MetadataManager.ButtonOk = Zav\u0159i
 
 MetadataManager.DisplayRows = Zobrazit \u0159\u00e1dk\u016f
 MetadataManager.TotalResult = V\u00fdsledk\u016f:
@@ -496,7 +495,7 @@
 
 Continue=Pokra\u010Duj
 
-Common.Cancel=&Storno
+Common.Cancel=&Zav\u0159\u00EDt
 
 Close=Zav\u0159\u00EDt
 

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties	2006-11-04 18:57:21 UTC (rev 861)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore_en.properties	2006-11-13 12:34:03 UTC (rev 862)
@@ -140,7 +140,7 @@
 UserManager.ButtonSearch = Search/Sort
 UserManager.ButtonHelp = Help
 UserManager.ButtonClose = Close
-UserManager.ButtonOk = Ok
+UserManager.ButtonOk = Close
 
 UserManager.ShowAllUser = All user
 UserManager.ShowActiveUser = Only current user
@@ -801,8 +801,6 @@
 
 History.ButtonClose=Close
 
-History.ButtonOk=Ok
-
 History.Whole.ButtonUndoToDate=Undo
 
 History.Whole.ButtonClearHistory=Clear history
@@ -1361,7 +1359,7 @@
 
 MetadataManager.DataSort=Sort by
 
-MetadataManager.ButtonOk=Ok
+MetadataManager.ButtonOk=Close
 
 MetadataManager.ButtonHelp=Help
 



From admin at berlios.de  Tue Nov 14 02:33:43 2006
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 14 Nov 2006 02:33:43 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9096] Provide a reasonable description of all
	buttons
Message-ID: <200611140133.kAE1XhJe009517@unicorn.berlios.de>

Bug #9096, was updated on 2006-Oct-13 19:03
Here is a current snapshot of the bug.

Project: Plantlore
Category: None
Status: Open
Resolution: None
Bug Group: RFE
Priority: 1
Submitted by: krater
Assigned to : none
Summary: Provide a reasonable description of all buttons

Details: Update the captions of the default buttons (Ok, Cancel) whenever reasonable.

Follow-Ups:

Date: 2006-Nov-14 02:33
By: tkovarik

Comment:
The captions should be "Add" and "Close". The only ones left unmodified are login.discard, export.abort and common.ok
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9096&group_id=5975


From admin at berlios.de  Tue Nov 14 02:37:18 2006
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 14 Nov 2006 02:37:18 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9442] Do not display message dialog after
	saving new occurrence
Message-ID: <200611140137.kAE1bIDe009805@unicorn.berlios.de>

Bug #9442, was updated on 2006-Nov-14 02:37
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Open
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : fraktalek
Summary: Do not display message dialog after saving new occurrence

Details: Message dialog should be displayed only in case an error occurred while saving occurrence, not in case everythingwent fine and the occurrence was added.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9442&group_id=5975


From admin at berlios.de  Tue Nov 14 03:02:23 2006
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 14 Nov 2006 03:02:23 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9443] Insert "Not specified" item to
	Phytochoria and Territories
Message-ID: <200611140202.kAE22Nkw012073@unicorn.berlios.de>

Bug #9443, was updated on 2006-Nov-14 03:02
Here is a current snapshot of the bug.

Project: Plantlore
Category: DBLayer
Status: Open
Resolution: None
Bug Group: RFE
Priority: 5
Submitted by: tkovarik
Assigned to : tkovarik
Summary: Insert "Not specified" item to Phytochoria and Territories

Details: When creating new database, phytochoria and territories tables should contain dummy item "Not specified" so that we can insert occurrences with unknown phytochorion and territory and NOT NULL constraint on these columns doesn't have to be dropped

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9443&group_id=5975


From admin at berlios.de  Tue Nov 14 03:05:54 2006
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 14 Nov 2006 03:05:54 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9444] Description of habitat should be a
	mandatory item
Message-ID: <200611140205.kAE25sLk012322@unicorn.berlios.de>

Bug #9444, was updated on 2006-Nov-14 03:05
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Open
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : joselada
Summary: Description of habitat should be a mandatory item

Details: Description of habitat (tHabitat.cDescription) should be a mandatory item

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9444&group_id=5975


From admin at berlios.de  Tue Nov 14 03:13:22 2006
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 14 Nov 2006 03:13:22 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9445] The same occurrence can be created
	accidentaly
Message-ID: <200611140213.kAE2DMKE012879@unicorn.berlios.de>

Bug #9445, was updated on 2006-Nov-14 03:13
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Open
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : fraktalek
Summary: The same occurrence can be created accidentaly

Details: Multiple clicks on the Add button in the Add dialog result in inserting multiple occurrences with the same properties to the database.

Suggested solution is to clear the Taxon after Add button is clicked (error message will be shown after Add button is clicked next time since Taxon is a mandatory item)

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9445&group_id=5975


From admin at berlios.de  Tue Nov 14 03:15:04 2006
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 14 Nov 2006 03:15:04 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9442] Do not display message dialog after
	saving new occurrence
Message-ID: <200611140215.kAE2F4oc013034@unicorn.berlios.de>

Bug #9442, was updated on 2006-Nov-14 02:37
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: Duplicate
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : fraktalek
Summary: Do not display message dialog after saving new occurrence

Details: Message dialog should be displayed only in case an error occurred while saving occurrence, not in case everythingwent fine and the occurrence was added.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9442&group_id=5975


From admin at berlios.de  Tue Nov 14 03:17:54 2006
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 14 Nov 2006 03:17:54 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9446] Start server without GUI from the
	command line
Message-ID: <200611140217.kAE2HsXl013328@unicorn.berlios.de>

Bug #9446, was updated on 2006-Nov-14 03:17
Here is a current snapshot of the bug.

Project: Plantlore
Category: General
Status: Open
Resolution: None
Bug Group: RFE
Priority: 2
Submitted by: tkovarik
Assigned to : krater
Summary: Start server without GUI from the command line

Details: It should be possible to start server without displaying GUI and passing all the neccessary parameters from the command line.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9446&group_id=5975


From admin at berlios.de  Tue Nov 14 03:23:51 2006
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 14 Nov 2006 03:23:51 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9447] Identify phytochorion by code when
	adding occurrence
Message-ID: <200611140223.kAE2NpfL013786@unicorn.berlios.de>

Bug #9447, was updated on 2006-Nov-14 03:23
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Open
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : fraktalek
Summary: Identify phytochorion by code when adding occurrence

Details: In the Add/Edit dialog it should be possible to enter phytochorion not only by the name but by its code as well.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9447&group_id=5975


From admin at berlios.de  Tue Nov 14 03:26:22 2006
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 14 Nov 2006 03:26:22 +0100 (CET)
Subject: [Plantlore-dev] [Task #3143] Update project homepage at berlios.de
Message-ID: <200611140226.kAE2QMRN013975@unicorn.berlios.de>

Task #3143 has been updated. 

Project: Plantlore
Subproject: General
Summary: Update project homepage at berlios.de
Priority: 5
Percent Complete: 0%
Status: Open
Authority  : tkovarik
Assigned to: tkovarik

Description: Update Plantlore homepage at plantlore.berlios.de (both english and czech version), add link to the current release, add FAQ section.

-------------------------------------------------------
For more info, visit:

http://developer.berlios.de/pm/task.php?func=detailtask&project_task_id=3143&group_id=5975&group_project_id=1512


From admin at berlios.de  Wed Nov 15 21:27:16 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 20:27:16 GMT
Subject: [Plantlore-dev] [Bug #9181] Author changes should be displayed in
	history
Message-ID: <200611152027.kAFKRGjL026365@unicorn.berlios.de>

Bug #9181, was updated on 2006-Oct-18 15:29
Here is a current snapshot of the bug.

Project: Plantlore
Category: History
Status: Closed
Resolution: None
Bug Group: RFE
Priority: 5
Submitted by: krater
Assigned to : joselada
Summary: Author changes should be displayed in history

Details: Author changes should be visible in the history of an Occurrence record.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9181&group_id=5975


From admin at berlios.de  Wed Nov 15 21:28:16 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 20:28:16 GMT
Subject: [Plantlore-dev] [Bug #9444] Description of habitat should be a
	mandatory item
Message-ID: <200611152028.kAFKSGxA026507@unicorn.berlios.de>

Bug #9444, was updated on 2006-Nov-14 02:05
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : joselada
Summary: Description of habitat should be a mandatory item

Details: Description of habitat (tHabitat.cDescription) should be a mandatory item

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9444&group_id=5975


From admin at berlios.de  Wed Nov 15 21:30:09 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:30:09 +0100 (CET)
Subject: [Plantlore-dev] [Bug #8600] Define create,
	alter and drop user for other database
Message-ID: <200611152030.kAFKU98R026783@unicorn.berlios.de>

Bug #8600, was updated on 2006-Aug-28 12:33
Here is a current snapshot of the bug.

Project: Plantlore
Category: DBLayer
Status: Open
Resolution: Wont Fix
Bug Group: None
Priority: 3
Submitted by: joselada
Assigned to : tkovarik
Summary: Define create, alter and drop user for other database

Details: Define create, alter and drop user for other database (MySQL, Oracle, ...).

Test plantlore with other database (Oracle, ...)

Follow-Ups:

Date: 2006-Sep-20 01:21
By: tkovarik

Comment:
Priority decreased since we probably won't support different databases in the near future.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=8600&group_id=5975


From admin at berlios.de  Wed Nov 15 21:31:34 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:31:34 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9179] Insert a plant using a synonym
Message-ID: <200611152031.kAFKVYHj027008@unicorn.berlios.de>

Bug #9179, was updated on 2006-Oct-18 16:24
Here is a current snapshot of the bug.

Project: Plantlore
Category: None
Status: Open
Resolution: None
Bug Group: None
Priority: 1
Submitted by: krater
Assigned to : krater
Summary: Insert a plant using a synonym

Details: The User could supply a synonym and the System should offer all plants that share that synonym. The User chooses the most suitable official name (taxon).

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9179&group_id=5975


From admin at berlios.de  Wed Nov 15 21:32:38 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:32:38 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9177] Allow range-search by Herbarium
Message-ID: <200611152032.kAFKWcJN027170@unicorn.berlios.de>

Bug #9177, was updated on 2006-Oct-18 16:19
Here is a current snapshot of the bug.

Project: Plantlore
Category: None
Status: Open
Resolution: None
Bug Group: RFE
Priority: 1
Submitted by: krater
Assigned to : fraktalek
Summary: Allow range-search by Herbarium

Details: Herbarium should allow a range search - ie. from-to search such as CB/11 ... CB/5123.

It might be achieved by spliting the herbarium column in the database.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9177&group_id=5975


From admin at berlios.de  Wed Nov 15 21:33:00 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:33:00 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9108] Make plantlore.log accessible
Message-ID: <200611152033.kAFKX0Pu027224@unicorn.berlios.de>

Bug #9108, was updated on 2006-Oct-13 19:24
Here is a current snapshot of the bug.

Project: Plantlore
Category: None
Status: Open
Resolution: None
Bug Group: None
Priority: 1
Submitted by: krater
Assigned to : tkovarik
Summary: Make plantlore.log accessible

Details: chmod g+rw plantlore.log

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9108&group_id=5975


From admin at berlios.de  Wed Nov 15 21:36:01 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:36:01 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9106] Fix the ordering of results in Overview
Message-ID: <200611152036.kAFKa1ti027690@unicorn.berlios.de>

Bug #9106, was updated on 2006-Oct-13 19:21
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview
Status: Open
Resolution: None
Bug Group: RFE
Priority: 2
Submitted by: krater
Assigned to : fraktalek
Summary: Fix the ordering of results in Overview

Details: The ordering of Occurrences (ORDER_BY) should use Occurrence.cCreateWhen.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9106&group_id=5975


From admin at berlios.de  Wed Nov 15 21:36:04 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 20:36:04 GMT
Subject: [Plantlore-dev] [Bug #9444] Description of habitat should be a
	mandatory item
Message-ID: <200611152036.kAFKa41d027700@unicorn.berlios.de>

Bug #9444, was updated on 2006-Nov-14 02:05
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : joselada
Summary: Description of habitat should be a mandatory item

Details: Description of habitat (tHabitat.cDescription) should be a mandatory item

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9444&group_id=5975


From admin at berlios.de  Wed Nov 15 21:39:50 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:39:50 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9104] Search should use substrings
Message-ID: <200611152039.kAFKdo10028373@unicorn.berlios.de>

Bug #9104, was updated on 2006-Oct-13 19:17
Here is a current snapshot of the bug.

Project: Plantlore
Category: None
Status: Open
Resolution: None
Bug Group: RFE
Priority: 1
Submitted by: krater
Assigned to : fraktalek
Summary: Search should use substrings

Details: A substring instead of a perfect match should be used in the Search dialog. (LIKE)

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9104&group_id=5975


From admin at berlios.de  Wed Nov 15 21:40:19 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:40:19 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9102] Add tooltips for coordinates
Message-ID: <200611152040.kAFKeJmf028432@unicorn.berlios.de>

Bug #9102, was updated on 2006-Oct-13 19:13
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Open
Resolution: None
Bug Group: RFE
Priority: 4
Submitted by: krater
Assigned to : fraktalek
Summary: Add tooltips for coordinates

Details: Add tooltips explaining how the current locale affects those fields.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9102&group_id=5975


From admin at berlios.de  Wed Nov 15 21:40:47 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:40:47 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9101] Rearrange some fields in the Add/Edit
	dialog
Message-ID: <200611152040.kAFKelug028517@unicorn.berlios.de>

Bug #9101, was updated on 2006-Oct-13 19:11
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Open
Resolution: None
Bug Group: RFE
Priority: 4
Submitted by: krater
Assigned to : fraktalek
Summary: Rearrange some fields in the Add/Edit dialog

Details: Rearrange the fields in the dialog so that the Country is followed by the Habitat. This way the most general specification of the locality goes first.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9101&group_id=5975


From admin at berlios.de  Wed Nov 15 21:41:51 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:41:51 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9096] Provide a reasonable description of all
	buttons
Message-ID: <200611152041.kAFKfpEG028656@unicorn.berlios.de>

Bug #9096, was updated on 2006-Oct-13 19:03
Here is a current snapshot of the bug.

Project: Plantlore
Category: None
Status: Open
Resolution: None
Bug Group: RFE
Priority: 1
Submitted by: krater
Assigned to : joselada
Summary: Provide a reasonable description of all buttons

Details: Update the captions of the default buttons (Ok, Cancel) whenever reasonable.

Follow-Ups:

Date: 2006-Nov-15 21:41
By: tkovarik

Comment:
Should be fixed, needs verification
-------------------------------------------------------

Date: 2006-Nov-14 02:33
By: tkovarik

Comment:
The captions should be "Add" and "Close". The only ones left unmodified are login.discard, export.abort and common.ok
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9096&group_id=5975


From admin at berlios.de  Wed Nov 15 21:42:10 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:42:10 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9095] Describe all components in the
	Installer more thoroughly
Message-ID: <200611152042.kAFKgAQc028715@unicorn.berlios.de>

Bug #9095, was updated on 2006-Oct-13 19:02
Here is a current snapshot of the bug.

Project: Plantlore
Category: None
Status: Open
Resolution: None
Bug Group: RFE
Priority: 1
Submitted by: krater
Assigned to : tkovarik
Summary: Describe all components in the Installer more thoroughly

Details: Someone should comment components of the installer a little bit more properly.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9095&group_id=5975


From admin at berlios.de  Wed Nov 15 21:43:07 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 20:43:07 GMT
Subject: [Plantlore-dev] [Bug #9444] Description of habitat should be a
	mandatory item
Message-ID: <200611152043.kAFKh79E028885@unicorn.berlios.de>

Bug #9444, was updated on 2006-Nov-14 02:05
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : joselada
Summary: Description of habitat should be a mandatory item

Details: Description of habitat (tHabitat.cDescription) should be a mandatory item

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9444&group_id=5975


From admin at berlios.de  Wed Nov 15 21:45:32 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:45:32 +0100 (CET)
Subject: [Plantlore-dev] [Bug #7692] Set a default button for each dialog
Message-ID: <200611152045.kAFKjWEs029278@unicorn.berlios.de>

Bug #7692, was updated on 2006-May-31 12:46
Here is a current snapshot of the bug.

Project: Plantlore
Category: None
Status: Closed
Resolution: Fixed
Bug Group: RFE
Priority: 4
Submitted by: krater
Assigned to : none
Summary: Set a default button for each dialog

Details: Every dialog should have a default button, that is, a button that will be "called" or "clicked" when the User presses Enter anywhere in the dialog. 

A perfect example is the Login-Authorization dialog: after you type a password, you hit enter and expect the Authorize button's action to be invoked.

Follow-Ups:

Date: 2006-Jun-01 11:26
By: krater

Comment:
Well, won't that be the legendary *third version* of Matisse :)?
-------------------------------------------------------

Date: 2006-May-31 22:59
By: fraktalek

Comment:
They know about it and plan  to add this function (together with other missing) in NB 6.0 :)
-------------------------------------------------------

Date: 2006-May-31 14:00
By: krater

Comment:
Each dialog (ie. xxxView.java by our convention) must have a default button. You can achieve it by adding the following line into the constructor of the dialog right after the "initComponents()":

initComponents();
getRootPane().setDefaultButton( my_default_button );

It's a shame that the default button cannot be set directly in Matisse...
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=7692&group_id=5975


From admin at berlios.de  Wed Nov 15 21:48:04 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 20:48:04 GMT
Subject: [Plantlore-dev] [Bug #9444] Description of habitat should be a
	mandatory item
Message-ID: <200611152048.kAFKm4xG029714@unicorn.berlios.de>

Bug #9444, was updated on 2006-Nov-14 02:05
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : joselada
Summary: Description of habitat should be a mandatory item

Details: Description of habitat (tHabitat.cDescription) should be a mandatory item

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9444&group_id=5975


From admin at berlios.de  Wed Nov 15 21:48:57 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:48:57 +0100 (CET)
Subject: [Plantlore-dev] [Bug #7674] Cancel should be available when
	deleting occurrences
Message-ID: <200611152048.kAFKmvaJ029879@unicorn.berlios.de>

Bug #7674, was updated on 2006-May-30 21:42
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview
Status: Open
Resolution: None
Bug Group: RFE
Priority: 1
Submitted by: tkovarik
Assigned to : fraktalek
Summary: Cancel should be available when deleting occurrences

Details: When deleting multiple occurrences in the Overview, user should have a chance to cancel the operation. Two approaches are possible:
1. Cancel the whole delete operation and rollback the transaction (no records will be deleted)
2. Commit the transaction and delete records processed so far, leave the rest of the records unchanged.

Follow-Ups:

Date: 2006-Aug-30 20:13
By: krater

Comment:
I suggest using DefaultProgressBarEx() AND monitoring the state of isCancelled() in the task!
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=7674&group_id=5975


From admin at berlios.de  Wed Nov 15 21:50:01 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 20:50:01 GMT
Subject: [Plantlore-dev] [Bug #9444] Description of habitat should be a
	mandatory item
Message-ID: <200611152050.kAFKo1Wa000062@unicorn.berlios.de>

Bug #9444, was updated on 2006-Nov-14 02:05
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : joselada
Summary: Description of habitat should be a mandatory item

Details: Description of habitat (tHabitat.cDescription) should be a mandatory item

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9444&group_id=5975


From admin at berlios.de  Wed Nov 15 21:50:50 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 20:50:50 GMT
Subject: [Plantlore-dev] [Bug #9444] Description of habitat should be a
	mandatory item
Message-ID: <200611152050.kAFKoohj000208@unicorn.berlios.de>

Bug #9444, was updated on 2006-Nov-14 02:05
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : joselada
Summary: Description of habitat should be a mandatory item

Details: Description of habitat (tHabitat.cDescription) should be a mandatory item

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9444&group_id=5975


From admin at berlios.de  Wed Nov 15 21:51:27 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:51:27 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9445] The same occurrence can be created
	accidentaly
Message-ID: <200611152051.kAFKpRUZ000326@unicorn.berlios.de>

Bug #9445, was updated on 2006-Nov-14 03:13
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: Fixed
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : fraktalek
Summary: The same occurrence can be created accidentaly

Details: Multiple clicks on the Add button in the Add dialog result in inserting multiple occurrences with the same properties to the database.

Suggested solution is to clear the Taxon after Add button is clicked (error message will be shown after Add button is clicked next time since Taxon is a mandatory item)

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9445&group_id=5975


From admin at berlios.de  Wed Nov 15 21:51:50 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:51:50 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9180] Increase the number of decimal places
Message-ID: <200611152051.kAFKpo1A000382@unicorn.berlios.de>

Bug #9180, was updated on 2006-Oct-18 16:27
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: Fixed
Bug Group: RFE
Priority: 5
Submitted by: krater
Assigned to : fraktalek
Summary: Increase the number of decimal places

Details: The coordinate's textfields should provide at least 15 valid decimal places (because 1/1000 may be 60 metres).

Follow-Ups:

Date: 2006-Nov-04 00:15
By: fraktalek

Comment:
Fixed in rev. 859.
Increased to 6 fraction digits.

-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9180&group_id=5975


From admin at berlios.de  Wed Nov 15 21:52:41 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:52:41 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9105] Implement a better duplicity check
Message-ID: <200611152052.kAFKqfS3000549@unicorn.berlios.de>

Bug #9105, was updated on 2006-Oct-13 19:18
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: Duplicate
Bug Group: RFE
Priority: 5
Submitted by: krater
Assigned to : fraktalek
Summary: Implement a better duplicity check

Details: System should prevent the User from inserting the same Occurrences twice.

Follow-Ups:

Date: 2006-Nov-04 19:54
By: fraktalek

Comment:
Implemented in rev. 861.

-------------------------------------------------------

Date: 2006-Oct-18 15:59
By: krater

Comment:
This will be achieved by erasing all plants that were inserted into the taxonArea in the Add dialog after the OK button is pressed.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9105&group_id=5975


From admin at berlios.de  Wed Nov 15 21:55:09 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:55:09 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9098] Fix the loop of focus
Message-ID: <200611152055.kAFKt9gh000907@unicorn.berlios.de>

Bug #9098, was updated on 2006-Oct-13 19:07
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Open
Resolution: None
Bug Group: Bug
Priority: 5
Submitted by: krater
Assigned to : fraktalek
Summary: Fix the loop of focus

Details: The focus gets stuck in the Coordinates pane.

Follow-Ups:

Date: 2006-Nov-04 00:09
By: fraktalek

Comment:
Fixed in rev. 858. 
However, focus doesn't cycle right from project combo to herbarium text field. I don't see why.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9098&group_id=5975


From admin at berlios.de  Wed Nov 15 21:55:35 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 20:55:35 GMT
Subject: [Plantlore-dev] [Bug #9444] Description of habitat should be a
	mandatory item
Message-ID: <200611152055.kAFKtZdF000992@unicorn.berlios.de>

Bug #9444, was updated on 2006-Nov-14 02:05
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview_Add
Status: Closed
Resolution: None
Bug Group: RFE
Priority: 3
Submitted by: tkovarik
Assigned to : joselada
Summary: Description of habitat should be a mandatory item

Details: Description of habitat (tHabitat.cDescription) should be a mandatory item

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9444&group_id=5975


From admin at berlios.de  Wed Nov 15 21:57:18 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:57:18 +0100 (CET)
Subject: [Plantlore-dev] [Bug #7765] Refresh should refresh current search
Message-ID: <200611152057.kAFKvIe5001257@unicorn.berlios.de>

Bug #7765, was updated on 2006-Jun-05 18:41
Here is a current snapshot of the bug.

Project: Plantlore
Category: Overview
Status: Open
Resolution: None
Bug Group: Bug
Priority: 4
Submitted by: fraktalek
Assigned to : krater
Summary: Refresh should refresh current search

Details: Now refresh creates default empty query - the same as is created on startup, which is perhaps not what would the user expect.


For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=7765&group_id=5975


From admin at berlios.de  Wed Nov 15 21:59:40 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 15 Nov 2006 21:59:40 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9178] Add a table with GPS values
Message-ID: <200611152059.kAFKxeI2001659@unicorn.berlios.de>

Bug #9178, was updated on 2006-Oct-18 16:22
Here is a current snapshot of the bug.

Project: Plantlore
Category: None
Status: Open
Resolution: None
Bug Group: None
Priority: 1
Submitted by: krater
Assigned to : joselada
Summary: Add a table with GPS values

Details: The Add dialog should allow the User to read the GPS from a file in the following format:

identifier, x-coord, y-coord, z-coord

The User should be able to insert the coordinates by supplying the correct identifier.

We may assume that the coordinates will be proper WGS-84

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9178&group_id=5975


From tkovarik at gmail.com  Thu Nov 23 01:04:02 2006
From: tkovarik at gmail.com (Tomas Kovarik)
Date: Thu, 23 Nov 2006 01:04:02 +0100
Subject: [Plantlore-dev] Bug #9107 - PostgreSecurity
Message-ID: <ea88f1620611221604k650f95eao6f9ce0bd578cca81@mail.gmail.com>

Caute,

pripomeniete mi prosim niekto ze ako je to s tymto bugom? Nejak to neviem
ani zreprodukovat a ani to najst v dokumentacii PostgreSQL (planovane
riesenie bolo upravit konfigurak postgre tak aby lokalne pripojenia museli
pouzivat heslo)

Diky moc

Kovo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/plantlore-dev/attachments/20061123/d5f323b9/attachment.html>

From krater at mail.berlios.de  Tue Nov 28 19:50:59 2006
From: krater at mail.berlios.de (krater at mail.berlios.de)
Date: Tue, 28 Nov 2006 19:50:59 +0100
Subject: [Plantlore-dev] r863 - in trunk/src/net/sf/plantlore: common server
	server/manager
Message-ID: <200611281850.kASIoxt9017835@sheep.berlios.de>

Author: krater
Date: 2006-11-28 19:50:58 +0100 (Tue, 28 Nov 2006)
New Revision: 863

Added:
   trunk/src/net/sf/plantlore/common/PlainProgressMonitor.java
   trunk/src/net/sf/plantlore/common/SuperDispatcher.java
Modified:
   trunk/src/net/sf/plantlore/common/Dispatcher.java
   trunk/src/net/sf/plantlore/server/ConnectionInfo.java
   trunk/src/net/sf/plantlore/server/DatabaseSettings.java
   trunk/src/net/sf/plantlore/server/Plantlore.java
   trunk/src/net/sf/plantlore/server/ServerSettings.java
   trunk/src/net/sf/plantlore/server/manager/ServerMng.java
Log:
Dispatcher.java: The method justDispatch() must have been deleted because it might have crippled the Dispatcher if used (the Dispatcher would never dispatch another task).

DatabaseSettings.java, ServerSettings.java: toString() method added (for easier debugging).

ServerMng.java: ServerMng accepts extra server settings (from an external authority). This allows us to override the settings from the configuration file (plantlore.server.xml) with settings parsed from the command line.

Server.Plantlore.java: It should be possible to control the Server from a command line now. There are several new parameters: port, timeout, connectionsTotal, connectionsPerIP, dbPort, dbEngine, dbParameter, password, host, terminate, who, nogui. All these parameters will be described in the user manual. (The administrator can have a little bit of fun writing: "java net.sf.plantlore.server.Plantlore terminate the server on port 2100 running on host 127.0.0.1 and use the password enigma" It will really stop the server :)).

SuperDispatcher.java: SuperDispatcher came into existence originally aiming to supplant the current Dispatcher. Hence the name Super Dispatcher. However, such an act would require a little bit more work on the ProgressBarManager (which doesn't satisfy me any longer). Work and time that I am not willing to invest. The most important thing is that the SuperDispatcher can dispatch so called "multitask" which is a series of two or more consecutive tasks that depend on each other - if one of the tasks ends with an exception, the remaining tasks are automatically cancelled ( = never executed). It also has a task-queue so that all tasks handed over to the dispatcher will be dispatched when their time comes. I forbid you to use the SuperDispatcher (it is used in the "Server part" only!) because both the Dispatcher and the SuperDispatcher are delicate pieces of whole program that must be used exclusively (their usage cannot be mixed).


All the new parts must be tested!

Modified: trunk/src/net/sf/plantlore/common/Dispatcher.java
===================================================================
--- trunk/src/net/sf/plantlore/common/Dispatcher.java	2006-11-13 12:34:03 UTC (rev 862)
+++ trunk/src/net/sf/plantlore/common/Dispatcher.java	2006-11-28 18:50:58 UTC (rev 863)
@@ -16,7 +16,7 @@
 
 /**
  *
- * @author fraktalek
+ * @author fraktalek, krater
  */
 public class Dispatcher {
     private Logger logger = Logger.getLogger(Dispatcher.class.getPackage().getName());
@@ -26,22 +26,12 @@
     private static Dispatcher dispatcher = new Dispatcher();
     private static ProgressBarManager pbm;
     
+    
     private Dispatcher() {
     }
     
     
-    public synchronized boolean justDispatch(Task task) {
-        if (taskRunning) {
-            logger.debug("Dispatcher: task already RUNNING, RETURNING.");
-            return false;
-        }
-        
-        taskRunning = true;
-        task.start();
-
-        return true;
-    }
- 
+   
     public synchronized boolean dispatch(Task task, JFrame parent, boolean stoppable) {
         if (taskRunning) {
             logger.debug("Dispatcher: task already RUNNING, RETURNING.");

Added: trunk/src/net/sf/plantlore/common/PlainProgressMonitor.java
===================================================================
--- trunk/src/net/sf/plantlore/common/PlainProgressMonitor.java	2006-11-13 12:34:03 UTC (rev 862)
+++ trunk/src/net/sf/plantlore/common/PlainProgressMonitor.java	2006-11-28 18:50:58 UTC (rev 863)
@@ -0,0 +1,53 @@
+/**
+ * 
+ */
+package net.sf.plantlore.common;
+
+import java.util.Observable;
+import java.util.Observer;
+
+import org.apache.log4j.Logger;
+
+/**
+ * @author yaa
+ *
+ */
+public class PlainProgressMonitor implements Observer {
+	
+	private Logger logger;
+
+	
+	/**
+	 * 
+	 */
+	public PlainProgressMonitor(Logger logger) {
+		this.logger = logger;
+	}
+	
+	public synchronized PlainProgressMonitor registerTask(Task...tasks) {
+		for( Task t : tasks)
+			t.addObserver(this);
+		return this;
+	}
+
+	public synchronized void unregisterTask(Task...tasks) {
+		for( Task t : tasks )
+			t.deleteObserver(this);
+	}
+	
+	/* (non-Javadoc)
+	 * @see java.util.Observer#update(java.util.Observable, java.lang.Object)
+	 */
+	public void update(Observable source, Object parameter) {
+		if( parameter instanceof Exception ) {
+			logger.error("Task " + source + " failed! " + ((Exception)parameter).getMessage());
+			System.out.println(((Exception)parameter).getMessage());
+		} else if( parameter instanceof Pair ) {
+            Pair p = (Pair)parameter;
+            Object first = p.getFirst();
+            if (first instanceof Task.Message && ((Task.Message)first) == Task.Message.MESSAGE_CHANGED)
+                System.out.println( p.getSecond() );
+		}
+	}
+
+}

Added: trunk/src/net/sf/plantlore/common/SuperDispatcher.java
===================================================================
--- trunk/src/net/sf/plantlore/common/SuperDispatcher.java	2006-11-13 12:34:03 UTC (rev 862)
+++ trunk/src/net/sf/plantlore/common/SuperDispatcher.java	2006-11-28 18:50:58 UTC (rev 863)
@@ -0,0 +1,146 @@
+/**
+ * 
+ */
+package net.sf.plantlore.common;
+
+import java.util.LinkedList;
+import java.util.Observable;
+import java.util.Observer;
+import java.util.Queue;
+
+import org.apache.log4j.Logger;
+
+/**
+ * @author yaa
+ *
+ */
+public class SuperDispatcher implements Observer {
+	
+	
+    private Logger logger = Logger.getLogger(SuperDispatcher.class.getPackage().getName());
+    private TaskInfo current = null;
+    private Queue<TaskInfo> taskQueue = new LinkedList<TaskInfo>();
+    
+    
+    private static SuperDispatcher dispatcher = new SuperDispatcher();
+    
+    public enum TaskStatus { Waiting, Working, Completed, Cancelled, Crashed };
+    
+    
+    private class TaskInfo {
+    	public Task task;
+    	public boolean silent;
+    	public TaskInfo followingTask;
+    	public Object result;
+    	public TaskStatus status;
+    	
+    	public TaskInfo(Task task, boolean silent) {
+    		this.task = task;
+    		this.silent = silent;
+    		followingTask = null;
+    		result = null;
+    		status = TaskStatus.Waiting;
+    	}
+    }
+
+    
+    private SuperDispatcher() { }
+    
+    
+    
+    private void dispatch(TaskInfo next) {
+    	current = next;
+    	if(current != null) {
+    		logger.info("Dispatching task " + current.task);
+    		current.status = TaskStatus.Working;
+			current.task.addObserver(this);
+			current.task.start();
+    	}
+    }
+    
+    private void dispatchNext() {
+    	if(current != null && current.followingTask != null)
+    		dispatch(current.followingTask);
+    	else
+    		dispatch( taskQueue.poll() );
+    }
+    
+    
+    private void tryToDispatchNextTask() {
+    	if( current == null ) 
+    		dispatchNext();
+    	else {
+    		switch( current.status ) {
+    		case Cancelled:
+    		case Crashed:
+    		case Completed:
+    			dispatchNext();
+    			break;
+    		}
+    	}
+    }
+    
+
+    private synchronized void enqueueNewMultitask(Task...tasks) {
+    	TaskInfo previous = null;
+    	for( Task t : tasks ) {
+    		TaskInfo info = new TaskInfo(t, true);
+    		if(previous != null)
+    			previous.followingTask = info;
+    		previous = info;
+    		taskQueue.offer(info);
+    	}
+    	logger.info("New multitask enqueued.");
+    	tryToDispatchNextTask();
+    }
+    
+    
+    private synchronized void enqueueIndependentTasks(Task...tasks) {
+    	for( Task t : tasks )
+    		taskQueue.offer( new TaskInfo(t, true) );
+    	logger.info("New tasks enqueued.");
+    	tryToDispatchNextTask();
+    }
+    
+    
+    
+	public synchronized void update(Observable task, Object msg) {
+		// The current task has crashed!
+		if( msg instanceof Exception ) {
+			current.status = TaskStatus.Crashed;
+			for( TaskInfo info = current.followingTask; info != null; info.status = TaskStatus.Cancelled, info = info.followingTask );
+			current.task.deleteObserver(this);
+			logger.info("Task " + current.task + " crashed! " + msg);
+			tryToDispatchNextTask();
+		}
+		// The current task has terminated successfully.
+		if( msg instanceof Pair) {
+	          Pair p = (Pair)msg;
+	          Object command = p.getFirst();
+	          if( command instanceof Task.Message &&  (Task.Message)command == Task.Message.STOPPING ) {
+	        	  current.task.deleteObserver(this);
+	        	  current.status = TaskStatus.Completed;
+	        	  current.result = current.task.getValue();
+	        	  logger.info("Task " + current.task + " completed! Returned value is " + current.result);
+	        	  tryToDispatchNextTask();
+	          }
+		}
+
+	}
+
+	
+	
+	
+    
+    
+    public static void enqueueMultitask(Task...tasks) {
+    	dispatcher.enqueueNewMultitask(tasks);
+    }
+    
+    
+    public static void enqueue(Task...tasks) {
+    	dispatcher.enqueueIndependentTasks(tasks);
+    }
+
+    
+}

Modified: trunk/src/net/sf/plantlore/server/ConnectionInfo.java
===================================================================
--- trunk/src/net/sf/plantlore/server/ConnectionInfo.java	2006-11-13 12:34:03 UTC (rev 862)
+++ trunk/src/net/sf/plantlore/server/ConnectionInfo.java	2006-11-28 18:50:58 UTC (rev 863)
@@ -1,7 +1,6 @@
 package net.sf.plantlore.server;
 
 import java.io.Serializable;
-import java.rmi.RemoteException;
 
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.middleware.RemoteDBLayerFactory;

Modified: trunk/src/net/sf/plantlore/server/DatabaseSettings.java
===================================================================
--- trunk/src/net/sf/plantlore/server/DatabaseSettings.java	2006-11-13 12:34:03 UTC (rev 862)
+++ trunk/src/net/sf/plantlore/server/DatabaseSettings.java	2006-11-28 18:50:58 UTC (rev 863)
@@ -17,6 +17,14 @@
 	private int port;
 	private String database;
 	
+	/* (non-Javadoc)
+	 * @see java.lang.Object#toString()
+	 */
+	@Override
+	public String toString() {
+		return connectionStringPrefix + " ~ " + connectionStringSuffix;
+	}
+	
 	/**
 	 * Create new Database settings.
 	 * 

Modified: trunk/src/net/sf/plantlore/server/Plantlore.java
===================================================================
--- trunk/src/net/sf/plantlore/server/Plantlore.java	2006-11-13 12:34:03 UTC (rev 862)
+++ trunk/src/net/sf/plantlore/server/Plantlore.java	2006-11-28 18:50:58 UTC (rev 863)
@@ -8,12 +8,16 @@
 import javax.swing.JFrame;
 import javax.swing.UIManager;
 
+import org.apache.log4j.Logger;
 import org.apache.log4j.PropertyConfigurator;
 
 import com.jgoodies.looks.plastic.PlasticXPLookAndFeel;
 
 import net.sf.plantlore.common.DefaultExceptionHandler;
+import net.sf.plantlore.common.PlainProgressMonitor;
 import net.sf.plantlore.common.PlantloreHelp;
+import net.sf.plantlore.common.SuperDispatcher;
+import net.sf.plantlore.common.Task;
 import net.sf.plantlore.common.exception.PlantloreException;
 import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.server.manager.*;
@@ -31,15 +35,86 @@
 	
 	private static final String LOGGER_PROPS = "net/sf/plantlore/config/log4j.properties";
 	
-	/**
-	 * Configure the basic components the Server will use, 
-	 * create the GUI and display it.
-	 *
-	 */
-	public void run() {
+	
+	public static boolean hasOption(String option, String[] args) {
+		for(String arg : args)
+			if(arg.equalsIgnoreCase(option) || arg.equalsIgnoreCase("-"+option) || arg.equalsIgnoreCase("--"+option))
+				return true;
+		return false;
+	}
+	
+	
+	public static String parameterValue(String parameterName, String args[]) {
+		for(int i = 0; i < args.length; i++) {
+			String arg = args[i];
+			if(arg.equalsIgnoreCase(parameterName) || arg.equalsIgnoreCase("-"+parameterName) || arg.equalsIgnoreCase("--"+parameterName)) {
+				if( i + 1 < args.length )
+					return args[i + 1]; 
+			}
+		}
+		return null;
+	}
+
+	
+	public static String replaceIfValid(String replacement, String defaultValue) {
+		return (replacement != null && replacement.length() > 0) ? replacement : defaultValue;
+	}
+	
+	
+	public static int replaceIfValid(String replacement, int defaultValue) {
+		if(replacement != null) {
+			try {
+				int value = Integer.parseInt(replacement);
+				return value;
+			} catch(NumberFormatException e) { /* Never mind, return the default value. */}
+		}
+		return defaultValue;
+	}
+	
+
+	public static void main(String[] args) {
+		/*=====================================================================
+		 * 
+		 * Process all parameters passed to the program.
+		 * 
+		 *=====================================================================*/
+        boolean
+        	stopServer = Plantlore.hasOption("terminate", args),
+        	whoIsThere = Plantlore.hasOption("who", args),
+        	noGUI = Plantlore.hasOption("nogui", args) || stopServer || whoIsThere;
+        
+        ServerSettings settings;
+		try {
+			settings = ServerMng.loadSettingsFromFile(ServerMng.settingsFileName);
+		} catch( Exception e ) {
+			settings = ServerMng.generateDefaultServerSettings();
+		}
+        int 
+        	port = replaceIfValid(parameterValue("port", args), settings.getPort()), 
+        	timeout = replaceIfValid(parameterValue("timeout", args), settings.getTimeout()), 
+        	connectionsTotal = replaceIfValid(parameterValue("connectionstotal", args), settings.getConnectionsTotal()),
+        	connectionsPerIP = replaceIfValid(parameterValue("connectionsperip", args), settings.getConnectionsPerIP()),
+        	databasePort = replaceIfValid(parameterValue("dbport", args), settings.getDatabaseSettings().getPort());
+        String
+        	databaseEngine = replaceIfValid(parameterValue("dbengine", args), settings.getDatabaseSettings().getDatabase()),
+        	databaseParameter =  replaceIfValid(parameterValue("dbparameter", args), settings.getDatabaseSettings().getConnectionStringSuffix()),
+        	password = replaceIfValid(parameterValue("password", args), ""),
+        	host = replaceIfValid(parameterValue("host", args), "localhost");
+        
+        // Prepare new Server Settings.
+        settings = new ServerSettings(port, timeout, connectionsTotal, connectionsPerIP,
+        		new DatabaseSettings(databaseEngine, databasePort, databaseParameter));
+        
+
+        /*=====================================================================
+         * 
+         * Perform the initialization ritual.
+         * 
+         *=====================================================================*/
+        
 		// Load log4j settings
 		try {
-			ClassLoader cl = this.getClass().getClassLoader();
+			ClassLoader cl = Plantlore.class.getClassLoader();
 			InputStream is = cl.getResourceAsStream(LOGGER_PROPS);
 			Properties props = new Properties();
 			props.load(is);
@@ -48,44 +123,68 @@
 		} catch (IOException ex) {
 			ex.printStackTrace();
 		}
+
+		// Get a logger so as to be able to report problems.
+		Logger logger = Logger.getLogger(Plantlore.class.getPackage().getName());
 		
-		 // Initialize Help
-        try {
-            PlantloreHelp.initialize();
-        } catch (PlantloreException e) {
-            // TODO: Display error message
+
+        /*=====================================================================
+         * 
+         * Take the requested action!
+         * 
+         *=====================================================================*/
+        
+		final ServerMng serverManager = new ServerMng(settings);
+		
+		// TERMINATE A RUNNING SERVER
+        if( stopServer ) {
+        	Task 
+        		connectToServerTask = serverManager.createConnectToRunningServerTask(host, port, password),
+        		terminateTheServerTask = serverManager.createTerminateServerTask();
+        	new PlainProgressMonitor(logger).registerTask(connectToServerTask, terminateTheServerTask);
+        	
+        	SuperDispatcher.enqueueMultitask(connectToServerTask, terminateTheServerTask);
+        	return;
         }
+
         
-        // Disable reconnect
-        DefaultExceptionHandler.disableReconnect();
-        
         // Set the hostname to make remote connections possible
         RMI.setHostName();
-
-
-        java.awt.EventQueue.invokeLater(new Runnable(){
-        	public void run() {
-        		ServerMng model = new ServerMng();
-        		ServerCreateView view = new ServerCreateView(model);
-        		new ServerCreateCtrl(model, view);
-        		view.setVisible(true);
-        	}
-        });
-       	
         
-	}
-	
+        
+        // CREATE A NEW SERVER
+        if(noGUI) {
+        	Task startNewServerTask = serverManager.createNewServerTask(password);
+        	new PlainProgressMonitor(logger).registerTask(startNewServerTask);
+        	
+        	SuperDispatcher.enqueue(startNewServerTask);
+        	return;
+        }
+        else {
+    		// Set beautiful system look & feel.
+            try { 
+                UIManager.setLookAndFeel(new PlasticXPLookAndFeel()); 
+            } catch (Exception e) { e.printStackTrace(); JFrame.setDefaultLookAndFeelDecorated(true); }
+            
+   		 	// Initialize Help
+            try {
+                PlantloreHelp.initialize();
+            } catch (PlantloreException e) {}
+            
+            // Disable reconnect
+            DefaultExceptionHandler.disableReconnect();
+            
+            // Open the Dialog
+        	java.awt.EventQueue.invokeLater(new Runnable(){
+        		public void run() {
+        			ServerCreateView view = new ServerCreateView(serverManager);
+        			new ServerCreateCtrl(serverManager, view);
+        			view.setVisible(true);
+        		}
+        	});
+        	return;
+        }
 
-	
-	public static void main(String[] args) {
-		
-		// Set beautiful system look & feel.
-        try { 
-            UIManager.setLookAndFeel(new PlasticXPLookAndFeel()); 
-        } catch (Exception e) { e.printStackTrace(); JFrame.setDefaultLookAndFeelDecorated(true); }
-		
-        new Plantlore().run();
-
 	}
 
 }

Modified: trunk/src/net/sf/plantlore/server/ServerSettings.java
===================================================================
--- trunk/src/net/sf/plantlore/server/ServerSettings.java	2006-11-13 12:34:03 UTC (rev 862)
+++ trunk/src/net/sf/plantlore/server/ServerSettings.java	2006-11-28 18:50:58 UTC (rev 863)
@@ -16,6 +16,19 @@
 	private int connectionsPerIP;
 	private DatabaseSettings databaseSettings;
 	
+	/* (non-Javadoc)
+	 * @see java.lang.Object#toString()
+	 */
+	@Override
+	public String toString() {
+		return 
+			"Port = " + port + 
+			" Timeout = " + timeout + 
+			" Connections Total = " + connectionsTotal + 
+			" Connections Per IP = " + connectionsPerIP +
+			" Database settings = " + databaseSettings;
+	}
+	
 	/**
 	 * Create new Server Settings.
 	 * 

Modified: trunk/src/net/sf/plantlore/server/manager/ServerMng.java
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerMng.java	2006-11-13 12:34:03 UTC (rev 862)
+++ trunk/src/net/sf/plantlore/server/manager/ServerMng.java	2006-11-28 18:50:58 UTC (rev 863)
@@ -4,7 +4,9 @@
 import java.io.BufferedWriter;
 import java.io.File;
 import java.io.FileInputStream;
+import java.io.FileNotFoundException;
 import java.io.FileOutputStream;
+import java.io.IOException;
 import java.io.InputStreamReader;
 import java.io.OutputStreamWriter;
 import java.io.Reader;
@@ -15,6 +17,7 @@
 
 import org.apache.log4j.Logger;
 import org.dom4j.Document;
+import org.dom4j.DocumentException;
 import org.dom4j.DocumentHelper;
 import org.dom4j.Element;
 import org.dom4j.Node;
@@ -66,7 +69,7 @@
 	
 	/** The server control interface. */
 	private Server server;
-	private ServerSettings settings;
+	private ServerSettings settings, defaultSettings;
 	
 	/** List of connected clients. */
 	private ConnectionInfo[] clients;
@@ -74,7 +77,9 @@
 	private boolean didWeCreateTheServer = false;
 	
 	private Logger logger = Logger.getLogger(this.getClass().getPackage().getName());
-	private String settingsFileName; {
+	public static final String settingsFileName;
+	
+	static {
 		String userHome = System.getProperty("user.home"),
 		osName = System.getProperty("os.name"),
 		plantloreDirName = (osName.equals("Linux") ? "." : "") + PLANTLORE, 
@@ -91,10 +96,50 @@
 	 * Create a new Server Manager.
 	 */
 	public ServerMng() {
+		this(null);
+	}
+	
+	public ServerMng(ServerSettings defaultSettings) {
+		this.defaultSettings = defaultSettings;
 		getSettings(true);
 		RMI.addToCodebase( Utils.getCodeBasePath() );
 	}
 	
+	
+	public static ServerSettings generateDefaultServerSettings() {
+		return new ServerSettings(RMIServer.DEFAULT_PORT, 3, 32, 2, 
+				new DatabaseSettings("postgresql", 5432, null));
+	}
+	
+	public static ServerSettings loadSettingsFromFile(String fileName) 
+	throws DocumentException, FileNotFoundException, IOException {
+		ServerSettings settings = null;
+		Reader reader = new BufferedReader(
+				new InputStreamReader(new FileInputStream(fileName), "UTF-8"));
+		SAXReader saxReader = new SAXReader();
+		Document document = saxReader.read( reader );
+		reader.close();
+
+		Node server = document.selectSingleNode("/config/server");
+		Number portNumber = server.numberValueOf("port"),
+		connectionsNumber = server.numberValueOf("connections"),
+		peripNumber = server.numberValueOf("perip");
+		int port = (portNumber == null) ? RMIServer.DEFAULT_PORT : portNumber.intValue(),
+				connections = (connectionsNumber == null || connectionsNumber.intValue() <= 1) ? 16 : connectionsNumber.intValue(),
+						perip = (peripNumber == null || peripNumber.intValue() <= 1) ? 2 : peripNumber.intValue();
+
+		Node database = server.selectSingleNode("database");
+
+		String databaseType = database.valueOf("engine"),
+		databaseParameter = database.valueOf("parameter");
+		Number databasePortNumber = database.numberValueOf("port");
+		int databasePort = (databasePortNumber == null) ? 0 : databasePortNumber.intValue();
+
+		settings = new ServerSettings(port, 3, connections, perip, 
+				new DatabaseSettings(databaseType, databasePort, databaseParameter));
+		return settings;
+	}
+	
 	/**
 	 * Obtain the settings of the server.
 	 * 
@@ -106,37 +151,10 @@
 			return settings;
 
 		// Create some default settings.
-		settings = new ServerSettings(RMIServer.DEFAULT_PORT, 3, 32, 2, 
-				new DatabaseSettings("postgresql", 5432, null));
-		
 		try {
-			Reader reader = new BufferedReader(
-					new InputStreamReader(new FileInputStream(settingsFileName), "UTF-8"));
-			SAXReader saxReader = new SAXReader();
-            Document document = saxReader.read( reader );
-            reader.close();
-            
-            Node server = document.selectSingleNode("/config/server");
-            Number portNumber = server.numberValueOf("port"),
-            connectionsNumber = server.numberValueOf("connections"),
-            peripNumber = server.numberValueOf("perip");
-            int port = (portNumber == null) ? RMIServer.DEFAULT_PORT : portNumber.intValue(),
-            connections = (connectionsNumber == null || connectionsNumber.intValue() <= 1) ? 16 : connectionsNumber.intValue(),
-            perip = (peripNumber == null || peripNumber.intValue() <= 1) ? 2 : peripNumber.intValue();
-            
-            Node database = server.selectSingleNode("database");
-            
-            String databaseType = database.valueOf("engine"),
-            databaseParameter = database.valueOf("parameter");
-            Number databasePortNumber = database.numberValueOf("port");
-            int databasePort = (databasePortNumber == null) ? 0 : databasePortNumber.intValue();
-            
-            settings = new ServerSettings(port, 3, connections, perip, 
-            		new DatabaseSettings(databaseType, databasePort, databaseParameter));
-            
-            
+			settings = defaultSettings != null ? defaultSettings : loadSettingsFromFile(settingsFileName);
 		} catch(Exception e) {
-			logger.error("Unable to load settings. " + e.getMessage());
+			settings = generateDefaultServerSettings();
 		}
 		return settings;
 	}



From krater at mail.berlios.de  Wed Nov 29 15:08:17 2006
From: krater at mail.berlios.de (krater at mail.berlios.de)
Date: Wed, 29 Nov 2006 15:08:17 +0100
Subject: [Plantlore-dev] r864 - in trunk/src/net/sf/plantlore: common server
	server/manager
Message-ID: <200611291408.kATE8HF0003102@sheep.berlios.de>

Author: krater
Date: 2006-11-29 15:08:16 +0100 (Wed, 29 Nov 2006)
New Revision: 864

Modified:
   trunk/src/net/sf/plantlore/common/DefaultExceptionHandler.java
   trunk/src/net/sf/plantlore/common/PlainProgressMonitor.java
   trunk/src/net/sf/plantlore/common/SuperDispatcher.java
   trunk/src/net/sf/plantlore/common/Task.java
   trunk/src/net/sf/plantlore/server/Plantlore.java
   trunk/src/net/sf/plantlore/server/manager/ServerMng.java
Log:
DefaultExceptionHandler.java: The `exception~>problem description` method created.

PlainProgressMonitor.java: Tested, fixed.

SuperDispatcher.java: Tested, fixed, improved.

Task.java: Tasks can have names now (easier task recognition).

ServerMng.java: Commented, improved.

Plantlore.java: Commented, improved, finished, tested.

Modified: trunk/src/net/sf/plantlore/common/DefaultExceptionHandler.java
===================================================================
--- trunk/src/net/sf/plantlore/common/DefaultExceptionHandler.java	2006-11-28 18:50:58 UTC (rev 863)
+++ trunk/src/net/sf/plantlore/common/DefaultExceptionHandler.java	2006-11-29 14:08:16 UTC (rev 864)
@@ -43,6 +43,98 @@
 		isReconnectDisabled = false;
 	}
 
+	/**
+	 * 
+	 * @param e	Exception to be analyzed. 
+	 * @return	Localized description of the supplied exception. Works for RemoteException & DBLayerException only.
+	 */
+	public static String problemDescription(Exception e) {
+		String problemDescription = e.getMessage();
+		
+		/*
+		 * REMOTE EXCEPTION HANDLER
+		 */
+		if( e instanceof RemoteException ) {
+			// The caller does not have permission to perform the action requested by the method call.
+			if( e instanceof AccessException )
+				problemDescription = L10n.getString("Error.Server.AccessDenied");
+			
+			// Connection is refused to the remote host for a remote method call.
+			else if( e instanceof ConnectException )
+				problemDescription = L10n.getString("Error.Server.ConnectionRefused");
+			
+			// An IOException occured while making a connection to the remote host for a remote method call.
+			else if( e instanceof ConnectIOException )
+				problemDescription = L10n.getString("Error.Server.ConnectionRefused");
+			
+			// An attempt to export a remote object failed.
+			else if( e instanceof ExportException )
+				problemDescription = L10n.getString("Error.Server.ExportFailed");
+			
+			// Occurs while marshalling the remote call header, arguments or 
+			// return value for a remote method call.
+			// Or if the receiver does not support the protocol version of the sender.
+			else if( e instanceof MarshalException )
+				problemDescription = L10n.getString("Error.Server.MarshallingFailed");
+			
+			// An attempt was made to invoke a method on an object 
+			// that no longer exists in the remote virtual machine.
+			else if( e instanceof NoSuchObjectException )
+				problemDescription = L10n.getString("Error.Server.ObjectDoesNotExistAnymore");
+			
+			// An Error was thrown while processing the invocation on the server, 
+			// either while unmarshalling the arguments, executing the remote method itself, 
+			// or marshalling the return value.
+			else if( e instanceof ServerError )
+				problemDescription = L10n.getString("Error.Server.InTrouble");
+			
+			// A RemoteException was thrown while processing the invocation on the server, 
+			// either while unmarshalling the arguments or executing the remote method itself.
+			else if( e instanceof ServerException )
+				problemDescription = L10n.getString("Error.Server.InTrouble");
+			
+			// A valid stub class could not be found for a remote object when it is exported.
+			else if( e instanceof StubNotFoundException )
+				problemDescription = L10n.getString("Error.Server.StubNotFound");
+			
+			// If the client of a remote method call receives, as a result of the call, 
+			// a checked exception that is not among the checked exception types 
+			// declared in the throws clause of the method in the remote interface.
+			else if( e instanceof UnexpectedException )
+				problemDescription = L10n.getString("Error.Server.UnexpectedProblem");
+			
+			// If a java.net.UnknownHostException occurs while creating a connection 
+			// to the remote host for a remote method call.
+			else if( e instanceof UnknownHostException )
+				problemDescription = L10n.getString("Error.Server.UnknownHost");
+			
+			// Could be thrown while unmarshalling the parameters or results of a remote method call.
+			else if( e instanceof UnmarshalException )
+				problemDescription = L10n.getString("Error.Server.UnmarshallingFailed");
+		}
+		
+		/*
+		 *	OTHER EXCEPTIONS CONNECTED WITH THE RMI 
+		 * (those exceptions that are not subclasses of the RemoteException) 
+		 */
+		else if( e instanceof AlreadyBoundException )
+			problemDescription = L10n.getString("Error.Server.AlreadyBound");
+		
+		else if( e instanceof NotBoundException )
+			problemDescription = L10n.getString("Error.Server.NotBound");
+		
+		/*
+		 * DBLAYER EXCEPTION HANDLER
+		 */
+		else if( e instanceof DBLayerException ) {
+			DBLayerException d = (DBLayerException)e;
+			if(d.getCause() instanceof JDBCException)
+				problemDescription = problemDescription + "\n"  + d.getErrorInfo();
+		}
+		
+		return problemDescription;
+	}
+	
 
 	/**
 	 * Announce the exception to the User.

Modified: trunk/src/net/sf/plantlore/common/PlainProgressMonitor.java
===================================================================
--- trunk/src/net/sf/plantlore/common/PlainProgressMonitor.java	2006-11-28 18:50:58 UTC (rev 863)
+++ trunk/src/net/sf/plantlore/common/PlainProgressMonitor.java	2006-11-29 14:08:16 UTC (rev 864)
@@ -6,48 +6,78 @@
 import java.util.Observable;
 import java.util.Observer;
 
-import org.apache.log4j.Logger;
-
 /**
- * @author yaa
+ * The Plain Progress Monitor watches all supplied tasks and prints the messages they are producing to the standard output.
+ * This may be handy if Plantlore is supposed to run without GUI - the User might find it inconvenient to scan the log
+ * for possible errors, that's why the Plain Progress Monitor mirrors all messages to the STDOUT.
+ * 
+ * Registered tasks (i.e. those that should be monitored) are unregistered automatically when the task stops
+ * (either because it has crashed or terminated normally).
+ * 
+ * @author Erik Kratochv?l
  *
  */
-public class PlainProgressMonitor implements Observer {
-	
-	private Logger logger;
+public class PlainProgressMonitor {
 
+	/*
+	 * Why do I have an inner class that implements the Observer interface 
+	 * when the PlainProgressMonitor itself could implement it?
+	 * 
+	 * The answer is simple: Objects using PlainProgressMonitor do not see the update() method
+	 * (and thus they cannot call it). This way the interface of the PlainProgressMonitor remains clean -
+	 * everybody can see only the two public synchronized methods.
+	 */
+	private class Announcer implements Observer {
+		
+		public synchronized void update(Observable source, Object parameter) {
+			if(source instanceof Task) {
+				Task t = (Task) source;
+				if( parameter instanceof Exception ) {
+					System.out.println( DefaultExceptionHandler.problemDescription((Exception)parameter) );
+					unregisterTask( t );
+				} 
+				else if( parameter instanceof Pair ) {
+					Pair p = (Pair)parameter;
+					Object first = p.getFirst();
+					
+					if( first instanceof Task.Message ) {
+						Task.Message msg = (Task.Message) first;
+						if( msg == Task.Message.MESSAGE_CHANGED )
+							System.out.println( t.getStatusMessage() );
+						else if( msg == Task.Message.STOPPING )
+							unregisterTask( t );
+					}
+				}
+			}
+		}	
+		
+	}
 	
+	private Announcer a = new Announcer();
+	
 	/**
+	 * Monitor the supplied tasks and mirror the messages they produce to the STDOUT.
+	 * Tasks are unregistered automatically.
 	 * 
+	 * @param tasks	The tasks to be monitored.
+	 * @return	itself
 	 */
-	public PlainProgressMonitor(Logger logger) {
-		this.logger = logger;
-	}
-	
 	public synchronized PlainProgressMonitor registerTask(Task...tasks) {
 		for( Task t : tasks)
-			t.addObserver(this);
+			t.addObserver(a);
 		return this;
 	}
 
+	/**
+	 * Unregister previously registered tasks.
+	 * 
+	 * @param tasks	Tasks that should no longer be monitored by this monitor.
+	 */
 	public synchronized void unregisterTask(Task...tasks) {
 		for( Task t : tasks )
-			t.deleteObserver(this);
+			t.deleteObserver(a);
 	}
 	
-	/* (non-Javadoc)
-	 * @see java.util.Observer#update(java.util.Observable, java.lang.Object)
-	 */
-	public void update(Observable source, Object parameter) {
-		if( parameter instanceof Exception ) {
-			logger.error("Task " + source + " failed! " + ((Exception)parameter).getMessage());
-			System.out.println(((Exception)parameter).getMessage());
-		} else if( parameter instanceof Pair ) {
-            Pair p = (Pair)parameter;
-            Object first = p.getFirst();
-            if (first instanceof Task.Message && ((Task.Message)first) == Task.Message.MESSAGE_CHANGED)
-                System.out.println( p.getSecond() );
-		}
-	}
+	
 
 }

Modified: trunk/src/net/sf/plantlore/common/SuperDispatcher.java
===================================================================
--- trunk/src/net/sf/plantlore/common/SuperDispatcher.java	2006-11-28 18:50:58 UTC (rev 863)
+++ trunk/src/net/sf/plantlore/common/SuperDispatcher.java	2006-11-29 14:08:16 UTC (rev 864)
@@ -33,17 +33,28 @@
     	public TaskInfo followingTask;
     	public Object result;
     	public TaskStatus status;
+    	public Exception problem;
     	
+    	public TaskInfo(Task task) {
+    		this(task, true);
+    	}
+    	
     	public TaskInfo(Task task, boolean silent) {
     		this.task = task;
     		this.silent = silent;
     		followingTask = null;
     		result = null;
     		status = TaskStatus.Waiting;
+    		problem = null;
     	}
+    	
+    	@Override
+    	public String toString() {
+    		return "<" + task.toString() + "[" + status + "]>" + (followingTask != null ? followingTask.toString() : "");
+    	}
     }
 
-    
+    // Nobody but me will be able to have an instance of this class.
     private SuperDispatcher() { }
     
     
@@ -51,30 +62,27 @@
     private void dispatch(TaskInfo next) {
     	current = next;
     	if(current != null) {
-    		logger.info("Dispatching task " + current.task);
+    		logger.info("Dispatching task " + current + "...");
     		current.status = TaskStatus.Working;
 			current.task.addObserver(this);
 			current.task.start();
     	}
     }
     
-    private void dispatchNext() {
-    	if(current != null && current.followingTask != null)
-    		dispatch(current.followingTask);
-    	else
-    		dispatch( taskQueue.poll() );
-    }
     
-    
     private void tryToDispatchNextTask() {
     	if( current == null ) 
-    		dispatchNext();
+    		dispatch( taskQueue.poll() ); // Dispatch the next independent task.
     	else {
+    		// current != null
     		switch( current.status ) {
     		case Cancelled:
     		case Crashed:
+    			dispatch( taskQueue.poll() ); // Dispatch the next independent task - the multitask has crashed!
+    			break;
     		case Completed:
-    			dispatchNext();
+    			// Continue with the multitask (if possible) or dispatch the next independent task.
+    			dispatch( current.followingTask != null ? current.followingTask : taskQueue.poll() );
     			break;
     		}
     	}
@@ -84,46 +92,65 @@
     private synchronized void enqueueNewMultitask(Task...tasks) {
     	TaskInfo previous = null;
     	for( Task t : tasks ) {
-    		TaskInfo info = new TaskInfo(t, true);
+    		TaskInfo info = new TaskInfo(t);
     		if(previous != null)
-    			previous.followingTask = info;
+    			previous.followingTask = info; // Link the tasks of the multitask.
+    		else
+    			taskQueue.offer(info); // Enqueue the first task of the multitask into the Task-Queue
     		previous = info;
-    		taskQueue.offer(info);
     	}
-    	logger.info("New multitask enqueued.");
+    	logger.debug("New multitask enqueued: " + taskQueue.peek());
     	tryToDispatchNextTask();
     }
     
     
     private synchronized void enqueueIndependentTasks(Task...tasks) {
-    	for( Task t : tasks )
-    		taskQueue.offer( new TaskInfo(t, true) );
-    	logger.info("New tasks enqueued.");
+    	for( Task t : tasks ) {
+    		TaskInfo info;
+    		taskQueue.offer( info = new TaskInfo(t) );
+    		logger.debug("New task enqueued: " + info);
+    	}
     	tryToDispatchNextTask();
     }
     
     
+    private void undispatch(TaskStatus status) {
+    	undispatch(status, null);
+    }
     
+    private void undispatch(TaskStatus status, Exception problem) {
+    	if( status == TaskStatus.Crashed || status == TaskStatus.Cancelled ) {
+    		for( TaskInfo info = current.followingTask; info != null; info.status = TaskStatus.Cancelled, info = info.followingTask );
+    		current.problem = problem;
+    	}
+    	else if( status == TaskStatus.Completed )
+    		current.result = current.task.getValue();
+    	
+    	current.status = status;
+		current.task.deleteObserver(this);
+		
+		if(problem != null) {
+			logger.error("SuperDispatcher: " + current + " crashed. " + problem.getMessage());
+			logger.error("SuperDispatcher: LocalizedMsg = \"" + DefaultExceptionHandler.problemDescription(problem) + "\"");
+		}
+		else
+			logger.debug("SuperDispatcher: " + current + " completed. Result = " + current.result);
+		
+		tryToDispatchNextTask();
+    }
+    
+    
+    // Nobody but this class will be able to call this method - because nobody else can have an instance of this class.
+    // Everyone will see only the static methods.
 	public synchronized void update(Observable task, Object msg) {
 		// The current task has crashed!
-		if( msg instanceof Exception ) {
-			current.status = TaskStatus.Crashed;
-			for( TaskInfo info = current.followingTask; info != null; info.status = TaskStatus.Cancelled, info = info.followingTask );
-			current.task.deleteObserver(this);
-			logger.info("Task " + current.task + " crashed! " + msg);
-			tryToDispatchNextTask();
-		}
+		if( msg instanceof Exception )
+			undispatch(TaskStatus.Crashed, (Exception)msg);
 		// The current task has terminated successfully.
 		if( msg instanceof Pair) {
-	          Pair p = (Pair)msg;
-	          Object command = p.getFirst();
-	          if( command instanceof Task.Message &&  (Task.Message)command == Task.Message.STOPPING ) {
-	        	  current.task.deleteObserver(this);
-	        	  current.status = TaskStatus.Completed;
-	        	  current.result = current.task.getValue();
-	        	  logger.info("Task " + current.task + " completed! Returned value is " + current.result);
-	        	  tryToDispatchNextTask();
-	          }
+	          Object command = ((Pair)msg).getFirst();
+	          if( command instanceof Task.Message &&  (Task.Message)command == Task.Message.STOPPING )
+	        	  undispatch(TaskStatus.Completed);
 		}
 
 	}

Modified: trunk/src/net/sf/plantlore/common/Task.java
===================================================================
--- trunk/src/net/sf/plantlore/common/Task.java	2006-11-28 18:50:58 UTC (rev 863)
+++ trunk/src/net/sf/plantlore/common/Task.java	2006-11-29 14:08:16 UTC (rev 864)
@@ -29,6 +29,7 @@
     private String statusMessage = "";
     private boolean determinate;
     private PostTaskAction action;
+    private String name;
     
     /** Creates new Task in determinate mode.
      */
@@ -44,6 +45,15 @@
         determinate = false;
     }
     
+    /**
+     * Create a new task with a name. This can greatly simplify identification of tasks.
+     * 
+     * @param name	The name or description of the task.
+     */
+    public Task(String name) {
+    	this.name = name;
+    }
+    
     public void setPostTaskAction(PostTaskAction action) {
         this.action = action;
     }
@@ -280,7 +290,9 @@
     }
     
     public String toString() {
-        return "Task("+this.hashCode()+")";
+    	if(name == null)
+    		return "Task("+this.hashCode()+")";
+    	return name;
     }
     
 }

Modified: trunk/src/net/sf/plantlore/server/Plantlore.java
===================================================================
--- trunk/src/net/sf/plantlore/server/Plantlore.java	2006-11-28 18:50:58 UTC (rev 863)
+++ trunk/src/net/sf/plantlore/server/Plantlore.java	2006-11-29 14:08:16 UTC (rev 864)
@@ -35,7 +35,12 @@
 	
 	private static final String LOGGER_PROPS = "net/sf/plantlore/config/log4j.properties";
 	
-	
+	/**
+	 * 
+	 * @param option	The option (parameter) to look for.
+	 * @param args	The list of arguments the program starts with.
+	 * @return true if <i>option</i> or <i>-option</i> or <i>--option</i> is among the <code>args</code>.
+	 */
 	public static boolean hasOption(String option, String[] args) {
 		for(String arg : args)
 			if(arg.equalsIgnoreCase(option) || arg.equalsIgnoreCase("-"+option) || arg.equalsIgnoreCase("--"+option))
@@ -43,7 +48,13 @@
 		return false;
 	}
 	
-	
+	/**
+	 * 
+	 * @param parameterName	The name of the parameter whose value we're interested in.
+	 * @param args	The list of arguments the program starts with.
+	 * @return	The value of the parameter. I.e. the string following right after the <code>parameterName</code> 
+	 * in the list of <code>args</code>.
+	 */
 	public static String parameterValue(String parameterName, String args[]) {
 		for(int i = 0; i < args.length; i++) {
 			String arg = args[i];
@@ -55,12 +66,23 @@
 		return null;
 	}
 
-	
+	/**
+	 * 
+	 * @param replacement	The value that is considered.
+	 * @param defaultValue	The default value.
+	 * @return <code>defaultValue</code> if <code>replacement</code> is <code>null</code> or empty.
+	 */
 	public static String replaceIfValid(String replacement, String defaultValue) {
 		return (replacement != null && replacement.length() > 0) ? replacement : defaultValue;
 	}
 	
-	
+	/**
+	 * 
+	 * 
+	 * @param replacement	The value that is considered.
+	 * @param defaultValue	The default value.
+	 * @return <code>defaultValue</code> if <code>replacement</code> is <code>null</code> or empty.
+	 */
 	public static int replaceIfValid(String replacement, int defaultValue) {
 		if(replacement != null) {
 			try {
@@ -71,6 +93,7 @@
 		return defaultValue;
 	}
 	
+	
 
 	public static void main(String[] args) {
 		/*=====================================================================
@@ -81,7 +104,8 @@
         boolean
         	stopServer = Plantlore.hasOption("terminate", args),
         	whoIsThere = Plantlore.hasOption("who", args),
-        	noGUI = Plantlore.hasOption("nogui", args) || stopServer || whoIsThere;
+        	noGUI = Plantlore.hasOption("nogui", args) || stopServer || whoIsThere,
+        	silent = Plantlore.hasOption("silent", args);
         
         ServerSettings settings;
 		try {
@@ -127,6 +151,15 @@
 		// Get a logger so as to be able to report problems.
 		Logger logger = Logger.getLogger(Plantlore.class.getPackage().getName());
 		
+		logger.info("Plantlore Server v1.0");
+		logger.debug("Initializing...");
+		logger.debug(" # parameters parsed (using stored/default values where missing)");
+		logger.debug("      Server Settings = " + settings);
+		logger.debug("      Password = " + password);
+		logger.debug("      Host = " + host);
+		logger.debug("      NoGUI = " + noGUI);
+		logger.debug("      Terminate = " + stopServer);
+		logger.debug("      Who's there = " + whoIsThere);
 
         /*=====================================================================
          * 
@@ -135,14 +168,40 @@
          *=====================================================================*/
         
 		final ServerMng serverManager = new ServerMng(settings);
+		logger.debug(" # Server Manager created");
 		
+		// PRINT THE LIST OF CONNECTED USERS
+		if( whoIsThere ) {
+			Task
+				connectToServerTask = serverManager.createConnectToRunningServerTask(host, port, password),
+				updateListOfClients = serverManager.createUpdateConnectedUsersTask(),
+				printListOfClients = new Task("Print the list of clients.") {
+					@Override
+					public Object task() throws Exception {
+						for( ConnectionInfo client : serverManager.getConnectedUsers())
+							setStatusMessage( client.toString() );
+						return null;
+					}
+				};
+			if( !silent )
+				new PlainProgressMonitor().registerTask(connectToServerTask, updateListOfClients, printListOfClients);
+			
+			logger.debug("Information about the connected clients will be printed.");
+			
+			SuperDispatcher.enqueueMultitask(connectToServerTask, updateListOfClients, printListOfClients);
+			return;
+		}
+		
 		// TERMINATE A RUNNING SERVER
         if( stopServer ) {
         	Task 
         		connectToServerTask = serverManager.createConnectToRunningServerTask(host, port, password),
         		terminateTheServerTask = serverManager.createTerminateServerTask();
-        	new PlainProgressMonitor(logger).registerTask(connectToServerTask, terminateTheServerTask);
+        	if( !silent )
+        		new PlainProgressMonitor().registerTask(connectToServerTask, terminateTheServerTask);
         	
+        	logger.debug("The Server will be terminated.");
+        	
         	SuperDispatcher.enqueueMultitask(connectToServerTask, terminateTheServerTask);
         	return;
         }
@@ -155,7 +214,10 @@
         // CREATE A NEW SERVER
         if(noGUI) {
         	Task startNewServerTask = serverManager.createNewServerTask(password);
-        	new PlainProgressMonitor(logger).registerTask(startNewServerTask);
+        	if( !silent)
+        		new PlainProgressMonitor().registerTask(startNewServerTask);
+        
+        	logger.debug("The Server will be created and started with the supplied settings.");
         	
         	SuperDispatcher.enqueue(startNewServerTask);
         	return;
@@ -163,18 +225,22 @@
         else {
     		// Set beautiful system look & feel.
             try { 
+            	logger.debug("Using different look&feel...");
                 UIManager.setLookAndFeel(new PlasticXPLookAndFeel()); 
             } catch (Exception e) { e.printStackTrace(); JFrame.setDefaultLookAndFeelDecorated(true); }
             
    		 	// Initialize Help
             try {
+            	logger.debug("Initializing help...");
                 PlantloreHelp.initialize();
             } catch (PlantloreException e) {}
             
             // Disable reconnect
+            logger.debug("Disabling reconnect for good...");
             DefaultExceptionHandler.disableReconnect();
             
             // Open the Dialog
+            logger.debug("Opening the dialog...");
         	java.awt.EventQueue.invokeLater(new Runnable(){
         		public void run() {
         			ServerCreateView view = new ServerCreateView(serverManager);

Modified: trunk/src/net/sf/plantlore/server/manager/ServerMng.java
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerMng.java	2006-11-28 18:50:58 UTC (rev 863)
+++ trunk/src/net/sf/plantlore/server/manager/ServerMng.java	2006-11-29 14:08:16 UTC (rev 864)
@@ -105,12 +105,21 @@
 		RMI.addToCodebase( Utils.getCodeBasePath() );
 	}
 	
-	
+	/**
+	 * 
+	 * @return	Generate factory settings (default values).
+	 */
 	public static ServerSettings generateDefaultServerSettings() {
 		return new ServerSettings(RMIServer.DEFAULT_PORT, 3, 32, 2, 
 				new DatabaseSettings("postgresql", 5432, null));
 	}
 	
+	/**
+	 * Obtain the previously stored settings from a file.
+	 * 
+	 * @param fileName	the name of the file where the server settings dwell
+	 * @return	The server settings revived from the supplied file.
+	 */
 	public static ServerSettings loadSettingsFromFile(String fileName) 
 	throws DocumentException, FileNotFoundException, IOException {
 		ServerSettings settings = null;
@@ -170,12 +179,12 @@
 		
 		Document document = DocumentHelper.createDocument();
 		Element config = document.addElement("config"),
-		server = config.addElement("server");
-		server.addElement("port").setText( "" + settings.getPort() );
-		server.addElement("connections").setText( "" + settings.getConnectionsTotal() );
-		server.addElement("perip").setText( "" + settings.getConnectionsPerIP() );
+		serverNode = config.addElement("server");
+		serverNode.addElement("port").setText( "" + settings.getPort() );
+		serverNode.addElement("connections").setText( "" + settings.getConnectionsTotal() );
+		serverNode.addElement("perip").setText( "" + settings.getConnectionsPerIP() );
 		
-		Element db = server.addElement("database");
+		Element db = serverNode.addElement("database");
 		db.addElement("engine").setText( settings.getDatabaseSettings().getDatabase() );
 		db.addElement("port").setText( "" + settings.getDatabaseSettings().getPort() );
 		db.addElement("parameter").setText(settings.getDatabaseSettings().getConnectionStringSuffix());
@@ -212,7 +221,7 @@
 	 * @param password	The password protecting the access to the server.
 	 */
 	public Task createNewServerTask(final String password) {
-		return new Task() {
+		return new Task("Create a new Plantlore Server and start it.") {
 			public Object task() throws Exception {
 				logger.debug("Creating a new server at localhost:" + settings.getPort());
 				setStatusMessage(L10n.getString("Server.Info.CreatingNewServer"));
@@ -246,7 +255,7 @@
 	 * @param password The password to gain the access to the server.
 	 */
 	public Task createConnectToRunningServerTask(final String host, final int port, final String password) {
-		return new Task() {
+		return new Task("Connect to a running Plantlore Server. The Server will be available via this Server Manager.") {
 			public Object task() throws Exception {
 				logger.info("Connecting to a running server at " +host+":"+port);
 				setStatusMessage(L10n.getString("Server.Info.ConnectingToServer"));
@@ -282,7 +291,7 @@
 	 * 
 	 */
 	public Task createUpdateConnectedUsersTask() {
-		return new Task() {
+		return new Task("Update the list of currently connected clients.") {
 			public Object task() throws Exception {
 				if(server == null) {
 					fireStopped(null);
@@ -319,7 +328,7 @@
 	 * @param client The client to be kicked from the server.
 	 */
 	public Task createKickTask(final ConnectionInfo client) {
-		return new Task() {
+		return new Task("Kick the selected client (" + client + ")") {
 			public Object task() throws Exception {
 				if(server == null || client == null) {
 					fireStopped(null);
@@ -349,7 +358,7 @@
 	 * <b>Warning:</b> This will immediately kick all connected clients.
 	 */
 	public Task createTerminateServerTask()  {
-		return new Task() {
+		return new Task("Terminate the server immediately.") {
 			public Object task() throws Exception {
 				
 				setStatusMessage(L10n.getString("Server.Info.TerminatingServer"));



From admin at berlios.de  Wed Nov 29 15:06:26 2006
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 29 Nov 2006 15:06:26 +0100 (CET)
Subject: [Plantlore-dev] [Bug #9446] Start server without GUI from the
	command line
Message-ID: <200611291406.kATE6QjT016074@unicorn.berlios.de>

Bug #9446, was updated on 2006-Nov-14 03:17
Here is a current snapshot of the bug.

Project: Plantlore
Category: General
Status: Closed
Resolution: Works For Me
Bug Group: RFE
Priority: 2
Submitted by: tkovarik
Assigned to : krater
Summary: Start server without GUI from the command line

Details: It should be possible to start server without displaying GUI and passing all the neccessary parameters from the command line.

Follow-Ups:

Date: 2006-Nov-29 15:06
By: krater

Comment:
The server can be started/terminated from the command line. More than that; parameters can be passed to the server from the command line (they override the saved or default settings).

Documentation will be updated a little bit later.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9446&group_id=5975


From krater at mail.berlios.de  Wed Nov 29 19:25:52 2006
From: krater at mail.berlios.de (krater at mail.berlios.de)
Date: Wed, 29 Nov 2006 19:25:52 +0100
Subject: [Plantlore-dev] r865 - in trunk/src/net/sf/plantlore/client: .
	overview synonyms
Message-ID: <200611291825.kATIPqP1014068@sheep.berlios.de>

Author: krater
Date: 2006-11-29 19:25:51 +0100 (Wed, 29 Nov 2006)
New Revision: 865

Added:
   trunk/src/net/sf/plantlore/client/synonyms/
   trunk/src/net/sf/plantlore/client/synonyms/PlantSearch.java
   trunk/src/net/sf/plantlore/client/synonyms/PlantSearchCtrl.java
   trunk/src/net/sf/plantlore/client/synonyms/PlantSearchView.form
   trunk/src/net/sf/plantlore/client/synonyms/PlantSearchView.java
Modified:
   trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java
Log:
AddEditCtrl.java: PlantSearch almost bound to the controller (the button in the view is still missing).

client/synonyms: MVC for searching plants by their synonyms/localized names. Haven't been tested. Implementing this feature turned out to be quite nasty... (Where do I get the plants (not just taxons) from? Where do I get the database layer? How do I keep being posted about changes so as to know when the plants have to be replaced with new ones?)



Ideas about how Plantlore should have been written keep popping out of my ear. Too bad there ain't gonna be a version 2.

Modified: trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java	2006-11-29 14:08:16 UTC (rev 864)
+++ trunk/src/net/sf/plantlore/client/overview/AddEditCtrl.java	2006-11-29 18:25:51 UTC (rev 865)
@@ -60,6 +60,9 @@
 
 import net.sf.plantlore.client.checklist.ChecklistCtrl;
 import net.sf.plantlore.client.checklist.ChecklistView;
+import net.sf.plantlore.client.synonyms.PlantSearch;
+import net.sf.plantlore.client.synonyms.PlantSearchCtrl;
+import net.sf.plantlore.client.synonyms.PlantSearchView;
 import net.sf.plantlore.common.AutoComboBoxNG3;
 import net.sf.plantlore.common.AutoTextArea;
 import net.sf.plantlore.common.DefaultEscapeKeyPressed;
@@ -87,6 +90,7 @@
     
     //--------------MODELS AND VIEWS THIS CONTROLLER CREATES-----------------
     private ChecklistView checklistView;
+    private PlantSearchView plantSearchView;
     
     
     /** 
@@ -141,7 +145,8 @@
         //------- Buttons --------
         view.okButton.setAction(new OkButtonAction());
         view.cancelButton.setAction(new CancelButtonAction());
-        view.checklistButton.setAction(new ChecklistAction());        
+        view.checklistButton.setAction(new ChecklistAction());
+        //TODO---->view.synonymSearchButton.setAction(new PlantSearchAction());
         view.clearLocationButton.setAction(new ClearLocationAction());
         view.clearOccurrenceButton.setAction(new ClearOccurrenceAction());
         view.calendarButton.setAction(new CalendarAction());
@@ -161,6 +166,22 @@
     }
     
     
+    
+    class PlantSearchAction extends StandardAction {
+		public PlantSearchAction() {
+			super("PlantSearch");
+		}
+		
+		public void actionPerformed(ActionEvent isUseless) {
+			if(plantSearchView == null) {
+				PlantSearch plantSearchModel = new PlantSearch( model.getDatabase() );
+				plantSearchView = new PlantSearchView(view, plantSearchModel);
+				new PlantSearchCtrl(plantSearchView, plantSearchModel, (AutoTextArea) view.taxonTextArea);
+			}
+			plantSearchView.setVisible(true);
+		}
+    }
+    
     class ChecklistAction extends AbstractAction {
     	public ChecklistAction() {
     		putValue(NAME, L10n.getString("Checklist.Title")); 

Added: trunk/src/net/sf/plantlore/client/synonyms/PlantSearch.java
===================================================================
--- trunk/src/net/sf/plantlore/client/synonyms/PlantSearch.java	2006-11-29 14:08:16 UTC (rev 864)
+++ trunk/src/net/sf/plantlore/client/synonyms/PlantSearch.java	2006-11-29 18:25:51 UTC (rev 865)
@@ -0,0 +1,106 @@
+/*
+ * SynonymSearch.java
+ *
+ * Created on 23. ??jen 2006, 16:23
+ *
+ * To change this template, choose Tools | Template Manager
+ * and open the template in the editor.
+ */
+
+package net.sf.plantlore.client.synonyms;
+
+import java.util.ArrayList;
+import java.util.Observable;
+
+import org.apache.log4j.Logger;
+
+import net.sf.plantlore.common.Pair;
+import net.sf.plantlore.common.PlantloreConstants;
+import net.sf.plantlore.common.record.Plant;
+import net.sf.plantlore.middleware.DBLayer;
+import net.sf.plantlore.middleware.SelectQuery;
+
+/**
+ *
+ * @author yaa
+ */
+public class PlantSearch extends Observable {
+
+	private Logger logger = Logger.getLogger(getClass().getPackage().getName());
+	
+    private Plant[] plants;
+    private static String[] names = { Plant.TAXON, Plant.CZECHNAME, Plant.SYNONYMS };
+    private ArrayList<Pair<String,Plant>> results;
+    private DBLayer database;
+
+
+	public PlantSearch(DBLayer database) {
+		this.database = database;
+	}
+    
+//    public void setPlants(Plant[] plants) {
+//        this.plants = plants;
+//    }
+    
+    public void loadPlantsFromDatabase() {
+    	// The good thing is that the database layer we have here is only a proxy 
+    	// and when we get notified that it is necessary to reload the plants from the database
+    	// the "correct" database layer is already there (i.e. we do not have to ask anyone for it).
+    	
+    	// Erase the old plants.
+    	plants = new Plant[] {};
+    	SelectQuery plantQuery = null;
+    	try {
+    		// Try to retrieve the plants from the database.
+    		plantQuery = database.createQuery(Plant.class);
+    		plantQuery.addOrder(PlantloreConstants.DIRECT_ASC, Plant.TAXON);
+    		Integer resultId = database.executeQuery(plantQuery);
+    		int resultCount = database.getNumRows(resultId);
+    		plants = new Plant[resultCount]; // Actually a non-trivial amount of memory!
+    		
+    		for(int i = 0; i < resultCount; i++)
+    			// This ~(Plant)((Object[])db.more()[0])[0]~ shit should have been fixed a very long time ago!
+    			// In fact, the whole database layer should have been rewritten properly in the first place!
+    			plants[i] = (Plant)((Object[])database.more( resultId, i, i )[0])[0];
+    		
+    	} catch(Exception e) {
+    		// This better not happen...
+    		logger.error("Unable to retrieve plants from the database! " + e);
+    		plants = new Plant[] {};
+    	} finally {
+    		if(plantQuery != null)
+    			try { 	database.closeQuery(plantQuery); } catch(Exception ex) {/* At least I tried.. */}
+    	}
+    }
+    
+    @SuppressWarnings("unchecked")
+	public Pair<String,Plant>[] getResults() {
+        if(results == null)
+            return null;
+        return (Pair<String,Plant>[])results.toArray();
+    }
+    
+    
+    public void findPlants(String byName) {
+        if(byName == null || "".equals(byName))
+            return;
+        
+        String byNameLC = byName.toLowerCase();
+        results = new ArrayList<Pair<String,Plant>>();
+        for(Plant p : plants) {
+            for(String column : names) {
+                Object t = p.getValue( column );
+                if( !(t instanceof String) )
+                    continue;
+                String name = (String) t;
+                if(name.toLowerCase().contains(byNameLC)) {
+                    results.add( new Pair<String,Plant>(p.toString() + " ("+column+" = "+byName+")", p) );
+                    break;
+                }
+            }
+        }
+        setChanged();
+        notifyObservers();
+    }
+    
+}

Added: trunk/src/net/sf/plantlore/client/synonyms/PlantSearchCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/synonyms/PlantSearchCtrl.java	2006-11-29 14:08:16 UTC (rev 864)
+++ trunk/src/net/sf/plantlore/client/synonyms/PlantSearchCtrl.java	2006-11-29 18:25:51 UTC (rev 865)
@@ -0,0 +1,65 @@
+/*
+ * PlantSearchCtrl.java
+ *
+ * Created on 23. ??jen 2006, 17:44
+ *
+ * To change this template, choose Tools | Template Manager
+ * and open the template in the editor.
+ */
+
+package net.sf.plantlore.client.synonyms;
+
+import java.awt.event.ActionEvent;
+import java.beans.PropertyChangeEvent;
+import java.beans.PropertyChangeListener;
+
+import net.sf.plantlore.common.AutoTextArea;
+import net.sf.plantlore.common.DefaultCancelAction;
+import net.sf.plantlore.common.Pair;
+import net.sf.plantlore.common.StandardAction;
+import net.sf.plantlore.common.record.Plant;
+
+/**
+ *
+ * @author yaa
+ */
+public class PlantSearchCtrl {
+    
+    private PlantSearchView view;
+    private PlantSearch model;
+    private AutoTextArea plantAbsorber;
+    
+    /** Creates a new instance of PlantSearchCtrl */
+    public PlantSearchCtrl(PlantSearchView searchView, PlantSearch searchModel, AutoTextArea textArea) {
+        this.view = searchView;
+        this.model = searchModel;
+        this.plantAbsorber = textArea;
+        
+        view.cancel.setAction( new DefaultCancelAction(this.view) );
+        
+        view.find.setAction( new StandardAction("PlantSearch.Find") {
+            public void actionPerformed(ActionEvent e) {
+                model.findPlants( view.pattern.getText() );
+            }
+        });
+        
+        view.insert.setAction( new StandardAction("PlantSearch.Insert") {
+            @SuppressWarnings("unchecked")
+			public void actionPerformed(ActionEvent e) {
+                Object value = view.results.getSelectedValue();
+                if(value != null)
+                    plantAbsorber.addLines(new String[] { ((Pair<String,Plant>)value).getSecond().getTaxon() } );
+            }
+        });
+        
+        plantAbsorber.addPropertyChangeListener(
+				AutoTextArea.ALLOWED_VALUES_CHANGED,
+				new PropertyChangeListener() {
+					public void propertyChange(PropertyChangeEvent arg0) {
+						model.loadPlantsFromDatabase();
+					}
+				});
+        
+    }
+    
+}

Added: trunk/src/net/sf/plantlore/client/synonyms/PlantSearchView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/synonyms/PlantSearchView.form	2006-11-29 14:08:16 UTC (rev 864)
+++ trunk/src/net/sf/plantlore/client/synonyms/PlantSearchView.form	2006-11-29 18:25:51 UTC (rev 865)
@@ -0,0 +1,126 @@
+<?xml version="1.0" encoding="UTF-8" ?>
+
+<Form version="1.3" type="org.netbeans.modules.form.forminfo.JFrameFormInfo">
+  <Properties>
+    <Property name="defaultCloseOperation" type="int" value="3"/>
+  </Properties>
+  <SyntheticProperties>
+    <SyntheticProperty name="formSizePolicy" type="int" value="1"/>
+  </SyntheticProperties>
+  <AuxValues>
+    <AuxValue name="FormSettings_generateMnemonicsCode" type="java.lang.Boolean" value="false"/>
+    <AuxValue name="FormSettings_listenerGenerationStyle" type="java.lang.Integer" value="0"/>
+    <AuxValue name="FormSettings_variablesLocal" type="java.lang.Boolean" value="false"/>
+    <AuxValue name="FormSettings_variablesModifier" type="java.lang.Integer" value="2"/>
+  </AuxValues>
+
+  <Layout>
+    <DimensionLayout dim="0">
+      <Group type="103" groupAlignment="0" attributes="0">
+          <Group type="102" alignment="1" attributes="0">
+              <EmptySpace max="-2" attributes="0"/>
+              <Group type="103" groupAlignment="1" attributes="0">
+                  <Component id="jScrollPane1" alignment="0" pref="380" max="32767" attributes="0"/>
+                  <Group type="102" alignment="0" attributes="0">
+                      <Component id="jLabel1" min="-2" max="-2" attributes="0"/>
+                      <EmptySpace max="-2" attributes="0"/>
+                      <Component id="pattern" pref="273" max="32767" attributes="0"/>
+                      <EmptySpace max="-2" attributes="0"/>
+                      <Component id="find" min="-2" max="-2" attributes="0"/>
+                  </Group>
+                  <Group type="102" alignment="1" attributes="0">
+                      <Component id="insert" linkSize="1" min="-2" max="-2" attributes="0"/>
+                      <EmptySpace max="-2" attributes="0"/>
+                      <Component id="cancel" linkSize="1" min="-2" max="-2" attributes="0"/>
+                  </Group>
+              </Group>
+              <EmptySpace max="-2" attributes="0"/>
+          </Group>
+      </Group>
+    </DimensionLayout>
+    <DimensionLayout dim="1">
+      <Group type="103" groupAlignment="0" attributes="0">
+          <Group type="102" alignment="0" attributes="0">
+              <EmptySpace max="-2" attributes="0"/>
+              <Group type="103" groupAlignment="3" attributes="0">
+                  <Component id="jLabel1" alignment="3" min="-2" max="-2" attributes="0"/>
+                  <Component id="find" alignment="3" min="-2" max="-2" attributes="0"/>
+                  <Component id="pattern" alignment="3" min="-2" max="-2" attributes="0"/>
+              </Group>
+              <EmptySpace max="-2" attributes="0"/>
+              <Component id="jScrollPane1" pref="296" max="32767" attributes="0"/>
+              <EmptySpace max="-2" attributes="0"/>
+              <Group type="103" groupAlignment="3" attributes="0">
+                  <Component id="cancel" alignment="3" min="-2" max="-2" attributes="0"/>
+                  <Component id="insert" alignment="3" min="-2" max="-2" attributes="0"/>
+              </Group>
+              <EmptySpace max="-2" attributes="0"/>
+          </Group>
+      </Group>
+    </DimensionLayout>
+  </Layout>
+  <SubComponents>
+    <Component class="javax.swing.JLabel" name="jLabel1">
+      <Properties>
+        <Property name="text" type="java.lang.String" editor="org.netbeans.modules.i18n.form.FormI18nStringEditor">
+          <ResourceString bundle="net/sf/plantlore/l10n/Plantlore.properties" key="Synonym.Synonym" replaceFormat="java.util.ResourceBundle.getBundle(&quot;{bundleNameSlashes}&quot;).getString(&quot;{key}&quot;)"/>
+        </Property>
+      </Properties>
+    </Component>
+    <Component class="javax.swing.JButton" name="find">
+      <Properties>
+        <Property name="text" type="java.lang.String" editor="org.netbeans.modules.i18n.form.FormI18nStringEditor">
+          <ResourceString bundle="net/sf/plantlore/l10n/Plantlore.properties" key="Synonym.Find" replaceFormat="java.util.ResourceBundle.getBundle(&quot;{bundleNameSlashes}&quot;).getString(&quot;{key}&quot;)"/>
+        </Property>
+      </Properties>
+      <AuxValues>
+        <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
+      </AuxValues>
+    </Component>
+    <Component class="javax.swing.JButton" name="insert">
+      <Properties>
+        <Property name="text" type="java.lang.String" editor="org.netbeans.modules.i18n.form.FormI18nStringEditor">
+          <ResourceString bundle="net/sf/plantlore/l10n/Plantlore.properties" key="Synonym.Insert" replaceFormat="java.util.ResourceBundle.getBundle(&quot;{bundleNameSlashes}&quot;).getString(&quot;{key}&quot;)"/>
+        </Property>
+      </Properties>
+      <AuxValues>
+        <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
+      </AuxValues>
+    </Component>
+    <Container class="javax.swing.JScrollPane" name="jScrollPane1">
+      <AuxValues>
+        <AuxValue name="autoScrollPane" type="java.lang.Boolean" value="true"/>
+      </AuxValues>
+
+      <Layout class="org.netbeans.modules.form.compat2.layouts.support.JScrollPaneSupportLayout"/>
+      <SubComponents>
+        <Component class="javax.swing.JList" name="results">
+          <Properties>
+            <Property name="model" type="javax.swing.ListModel" editor="org.netbeans.modules.form.editors2.ListModelEditor">
+              <StringArray count="0"/>
+            </Property>
+            <Property name="selectionMode" type="int" value="0"/>
+          </Properties>
+          <AuxValues>
+            <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
+          </AuxValues>
+        </Component>
+      </SubComponents>
+    </Container>
+    <Component class="javax.swing.JButton" name="cancel">
+      <Properties>
+        <Property name="text" type="java.lang.String" editor="org.netbeans.modules.i18n.form.FormI18nStringEditor">
+          <ResourceString bundle="net/sf/plantlore/l10n/Plantlore.properties" key="Common.Cancel" replaceFormat="java.util.ResourceBundle.getBundle(&quot;{bundleNameSlashes}&quot;).getString(&quot;{key}&quot;)"/>
+        </Property>
+      </Properties>
+      <AuxValues>
+        <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
+      </AuxValues>
+    </Component>
+    <Component class="javax.swing.JTextField" name="pattern">
+      <AuxValues>
+        <AuxValue name="JavaCodeGenerator_VariableModifier" type="java.lang.Integer" value="4"/>
+      </AuxValues>
+    </Component>
+  </SubComponents>
+</Form>

Added: trunk/src/net/sf/plantlore/client/synonyms/PlantSearchView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/synonyms/PlantSearchView.java	2006-11-29 14:08:16 UTC (rev 864)
+++ trunk/src/net/sf/plantlore/client/synonyms/PlantSearchView.java	2006-11-29 18:25:51 UTC (rev 865)
@@ -0,0 +1,134 @@
+/*
+ * SynonymSearch.java
+ *
+ * Created on 23. ??jen 2006, 16:08
+ */
+
+package net.sf.plantlore.client.synonyms;
+
+import java.util.Observable;
+import java.util.Observer;
+import net.sf.plantlore.common.DefaultEscapeKeyPressed;
+import net.sf.plantlore.common.Pair;
+import net.sf.plantlore.common.record.Plant;
+
+/**
+ *
+ * @author  yaa
+ */
+public class PlantSearchView extends javax.swing.JDialog implements Observer {
+    
+    private PlantSearch model;
+    
+    /** Creates new form SynonymSearch */
+    public PlantSearchView(javax.swing.JDialog parent, PlantSearch model) {
+        super(parent, true);
+        
+        this.model = model;
+        
+        initComponents();
+        setLocationRelativeTo(parent);
+        
+        new DefaultEscapeKeyPressed( this );
+        getRootPane().setDefaultButton( find );
+        model.addObserver(this);
+    }
+    
+    /** This method is called from within the constructor to
+     * initialize the form.
+     * WARNING: Do NOT modify this code. The content of this method is
+     * always regenerated by the Form Editor.
+     */
+    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
+    private void initComponents() {
+        jLabel1 = new javax.swing.JLabel();
+        find = new javax.swing.JButton();
+        insert = new javax.swing.JButton();
+        jScrollPane1 = new javax.swing.JScrollPane();
+        results = new javax.swing.JList();
+        cancel = new javax.swing.JButton();
+        pattern = new javax.swing.JTextField();
+
+        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
+        jLabel1.setText(java.util.ResourceBundle.getBundle("net/sf/plantlore/l10n/Plantlore").getString("Synonym.Synonym"));
+
+        find.setText(java.util.ResourceBundle.getBundle("net/sf/plantlore/l10n/Plantlore").getString("Synonym.Find"));
+
+        insert.setText(java.util.ResourceBundle.getBundle("net/sf/plantlore/l10n/Plantlore").getString("Synonym.Insert"));
+
+        results.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
+        jScrollPane1.setViewportView(results);
+
+        cancel.setText(java.util.ResourceBundle.getBundle("net/sf/plantlore/l10n/Plantlore").getString("Common.Cancel"));
+
+        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
+        getContentPane().setLayout(layout);
+        layout.setHorizontalGroup(
+            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
+                .addContainerGap()
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
+                    .add(org.jdesktop.layout.GroupLayout.LEADING, jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 380, Short.MAX_VALUE)
+                    .add(org.jdesktop.layout.GroupLayout.LEADING, layout.createSequentialGroup()
+                        .add(jLabel1)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                        .add(pattern, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 273, Short.MAX_VALUE)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                        .add(find))
+                    .add(layout.createSequentialGroup()
+                        .add(insert)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                        .add(cancel)))
+                .addContainerGap())
+        );
+
+        layout.linkSize(new java.awt.Component[] {cancel, insert}, org.jdesktop.layout.GroupLayout.HORIZONTAL);
+
+        layout.setVerticalGroup(
+            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(layout.createSequentialGroup()
+                .addContainerGap()
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel1)
+                    .add(find)
+                    .add(pattern, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 296, Short.MAX_VALUE)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(cancel)
+                    .add(insert))
+                .addContainerGap())
+        );
+        pack();
+    }// </editor-fold>//GEN-END:initComponents
+
+    
+    public void update(Observable o, Object arg) {
+        java.awt.EventQueue.invokeLater(new Runnable() {
+            public void run() {
+                Pair<String,Plant>[] plants = model.getResults();
+                if(plants != null)
+                    results.setListData( plants );
+                else
+                    results.setListData(new Object[0]);
+            }
+        });
+    }
+    
+
+    
+    
+    
+    
+    // Variables declaration - do not modify//GEN-BEGIN:variables
+    protected javax.swing.JButton cancel;
+    protected javax.swing.JButton find;
+    protected javax.swing.JButton insert;
+    private javax.swing.JLabel jLabel1;
+    private javax.swing.JScrollPane jScrollPane1;
+    protected javax.swing.JTextField pattern;
+    protected javax.swing.JList results;
+    // End of variables declaration//GEN-END:variables
+    
+}



