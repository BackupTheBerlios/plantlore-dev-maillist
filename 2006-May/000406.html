<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r356 - trunk/src/net/sf/plantlore/client/login
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-May/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r356%20-%20trunk/src/net/sf/plantlore/client/login&In-Reply-To=%3C200605261138.k4QBccwd011290%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000405.html">
   <LINK REL="Next"  HREF="000407.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r356 - trunk/src/net/sf/plantlore/client/login</H1>
    <B>krater at berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r356%20-%20trunk/src/net/sf/plantlore/client/login&In-Reply-To=%3C200605261138.k4QBccwd011290%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r356 - trunk/src/net/sf/plantlore/client/login">krater at berlios.de
       </A><BR>
    <I>Fri May 26 13:38:38 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000405.html">[Plantlore-dev] r355 - trunk/src/net/sf/plantlore/client
</A></li>
        <LI>Next message: <A HREF="000407.html">[Plantlore-dev] r357 - trunk/src/net/sf/plantlore/l10n
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#406">[ date ]</a>
              <a href="thread.html#406">[ thread ]</a>
              <a href="subject.html#406">[ subject ]</a>
              <a href="author.html#406">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: krater
Date: 2006-05-26 13:38:35 +0200 (Fri, 26 May 2006)
New Revision: 356

Modified:
   trunk/src/net/sf/plantlore/client/login/AuthCtrl.java
   trunk/src/net/sf/plantlore/client/login/AuthView.form
   trunk/src/net/sf/plantlore/client/login/AuthView.java
   trunk/src/net/sf/plantlore/client/login/ItemCtrl.java
   trunk/src/net/sf/plantlore/client/login/ItemView.form
   trunk/src/net/sf/plantlore/client/login/ItemView.java
   trunk/src/net/sf/plantlore/client/login/Login.java
   trunk/src/net/sf/plantlore/client/login/LoginCtrl.java
   trunk/src/net/sf/plantlore/client/login/LoginView.form
   trunk/src/net/sf/plantlore/client/login/LoginView.java
Log:
Repaired Login - fixed dialogs, L10n, progress notification.

Modified: trunk/src/net/sf/plantlore/client/login/AuthCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/AuthCtrl.java	2006-05-25 23:12:33 UTC (rev 355)
+++ trunk/src/net/sf/plantlore/client/login/AuthCtrl.java	2006-05-26 11:38:35 UTC (rev 356)
@@ -1,67 +1,40 @@
 package net.sf.plantlore.client.login;
 
 import java.awt.event.ActionEvent;
-import java.rmi.NotBoundException;
-import java.rmi.RemoteException;
 
 import javax.swing.AbstractAction;
 import javax.swing.JOptionPane;
 
-import org.apache.log4j.Logger;
-
 import net.sf.plantlore.l10n.L10n;
-import net.sf.plantlore.common.exception.DBLayerException;
 
+
 public class AuthCtrl {
 	
 	private AuthView view;
 	private Login model;
 	
-	private Logger logger = Logger.getLogger(this.getClass().getPackage().getName());
-	
 	public AuthCtrl(Login login, AuthView authview) {
 		this.model = login; this.view = authview;
-		view.next.addActionListener(new Next());
+		view.next.setAction(new Next());
 	}
 
 	
 	class Next extends AbstractAction {
+		public Next() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.AuthorizeTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Login.Authorize&quot;));
+		}
 		public void actionPerformed(ActionEvent arg0) {
-			try {
-				String user = (view.user.getSelectedItem() != null) ? view.user.getSelectedItem().toString() : null;
-				if(user != null) {
-					model.connectToSelected(user, new String(view.password.getPassword()));
-					view.setVisible(false);
-				}
-				else 
-					JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;warningNoUsername&quot;),
-					    L10n.getString(&quot;warningNoUsernameTitle&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-			} 
-			catch(NotBoundException e) {
-				logger.warn(&quot;The server is either not running or it is unreachable (java security policy). Details: &quot; + e);
+			String user = (view.user.getSelectedItem() != null) ? view.user.getSelectedItem().toString() : null;
+			if(user != null)
+				model.connectToSelected(user, new String(view.password.getPassword()));
+			else 
 				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;errorNotBoundException&quot;),
-					    L10n.getString(&quot;errorNotBoundExceptionTitle&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-			}
-			catch(RemoteException e) {
-				logger.warn(&quot;Either the network connection has failed or the server has crashed or gone off. Details: &quot; + e);
-				e.printStackTrace();
-				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;errorRemoteException&quot;),
-					    L10n.getString(&quot;errorRemoteExceptionTitle&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-			}
-			catch(DBLayerException e) {
-				logger.warn(&quot;Unable to initialize the database layer. Details: &quot; + e);
-				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;errorDBLayerException&quot;) + &quot;\n&quot; + e,
-					    L10n.getString(&quot;errorDBLayerExceptionTitle&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-			}
-			finally { view.password.setText(&quot;&quot;); }
+						L10n.getString(&quot;Error.MissingUsername&quot;),
+						L10n.getString(&quot;Error.Missing&quot;),
+						JOptionPane.WARNING_MESSAGE);
+			
+			view.password.setText(&quot;&quot;);
 		}
 	}
 

Modified: trunk/src/net/sf/plantlore/client/login/AuthView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/login/AuthView.form	2006-05-25 23:12:33 UTC (rev 355)
+++ trunk/src/net/sf/plantlore/client/login/AuthView.form	2006-05-26 11:38:35 UTC (rev 356)
@@ -1,8 +1,12 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
 
-&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JFrameFormInfo&quot;&gt;
+&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JDialogFormInfo&quot;&gt;
   &lt;Properties&gt;
-    &lt;Property name=&quot;defaultCloseOperation&quot; type=&quot;int&quot; value=&quot;3&quot;/&gt;
+    &lt;Property name=&quot;title&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot; postCode=&quot;setTitle(L10n.getString(&quot;Login.Authentication&quot;));&quot;&gt;
+      &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Authentication&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+    &lt;/Property&gt;
+    &lt;Property name=&quot;modal&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
+    &lt;Property name=&quot;resizable&quot; type=&quot;boolean&quot; value=&quot;false&quot;/&gt;
   &lt;/Properties&gt;
   &lt;SyntheticProperties&gt;
     &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
@@ -17,8 +21,8 @@
   &lt;Layout&gt;
     &lt;DimensionLayout dim=&quot;0&quot;&gt;
       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-          &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+          &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                   &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
@@ -27,17 +31,15 @@
                       &lt;/Group&gt;
                       &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                          &lt;Component id=&quot;password&quot; alignment=&quot;0&quot; pref=&quot;222&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;user&quot; alignment=&quot;0&quot; pref=&quot;222&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;password&quot; alignment=&quot;0&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;user&quot; alignment=&quot;0&quot; pref=&quot;223&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
-                  &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
-                      &lt;EmptySpace pref=&quot;199&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                      &lt;Component id=&quot;jButton1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;/Group&gt;
+                  &lt;Component id=&quot;next&quot; alignment=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
-              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
+          &lt;Component id=&quot;status&quot; alignment=&quot;0&quot; pref=&quot;298&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
       &lt;/Group&gt;
     &lt;/DimensionLayout&gt;
     &lt;DimensionLayout dim=&quot;1&quot;&gt;
@@ -54,8 +56,9 @@
                   &lt;Component id=&quot;password&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
               &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;jButton1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;next&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;status&quot; min=&quot;-2&quot; pref=&quot;22&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
       &lt;/Group&gt;
     &lt;/DimensionLayout&gt;
@@ -63,27 +66,60 @@
   &lt;SubComponents&gt;
     &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel1&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Username:&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.UserName&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
       &lt;/Properties&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel2&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Password:&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Password&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
       &lt;/Properties&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JComboBox&quot; name=&quot;user&quot;&gt;
       &lt;Properties&gt;
+        &lt;Property name=&quot;editable&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
         &lt;Property name=&quot;model&quot; type=&quot;javax.swing.ComboBoxModel&quot; editor=&quot;org.netbeans.modules.form.editors2.ComboBoxModelEditor&quot;&gt;
           &lt;StringArray count=&quot;0&quot;/&gt;
         &lt;/Property&gt;
       &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_CreateCodeCustom&quot; type=&quot;java.lang.String&quot; value=&quot;new AutoComboBox();&quot;/&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JPasswordField&quot; name=&quot;password&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;echoChar&quot; type=&quot;char&quot; value=&quot;&amp;#x2022;&quot;/&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
-    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;jButton1&quot;&gt;
+    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;next&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Authorize&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Authorize&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
       &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;status&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot; ...&quot;/&gt;
+        &lt;Property name=&quot;border&quot; type=&quot;javax.swing.border.Border&quot; editor=&quot;org.netbeans.modules.form.editors2.BorderEditor&quot;&gt;
+          &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.BevelBorderInfo&quot;&gt;
+            &lt;BevelBorder bevelType=&quot;1&quot;/&gt;
+          &lt;/Border&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
   &lt;/SubComponents&gt;
 &lt;/Form&gt;

Modified: trunk/src/net/sf/plantlore/client/login/AuthView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/AuthView.java	2006-05-25 23:12:33 UTC (rev 355)
+++ trunk/src/net/sf/plantlore/client/login/AuthView.java	2006-05-26 11:38:35 UTC (rev 356)
@@ -9,8 +9,11 @@
 import java.util.Observable;
 import java.util.Observer;
 
+import javax.swing.JOptionPane;
+
 import net.sf.plantlore.common.AutoComboBox;
 import net.sf.plantlore.l10n.L10n;
+import net.sf.plantlore.middleware.DBLayer;
 
 /**
  *
@@ -26,7 +29,6 @@
     	model.addObserver(this);
         initComponents();
         setLocationRelativeTo(null); // center of the screen
-        setModal(true);
     }
     
     /** This method is called from within the constructor to
@@ -41,21 +43,30 @@
         user = new AutoComboBox();
         password = new javax.swing.JPasswordField();
         next = new javax.swing.JButton();
+        status = new javax.swing.JLabel();
 
-        setDefaultCloseOperation(javax.swing.WindowConstants.HIDE_ON_CLOSE);
-        jLabel1.setText(L10n.getString(&quot;Username&quot;) + &quot;:&quot;);
+        setTitle(L10n.getString(&quot;Login.Authentication&quot;));
+        setTitle(L10n.getString(&quot;Login.Authentication&quot;));
+        setModal(true);
+        setResizable(false);
+        jLabel1.setText(L10n.getString(&quot;Login.UserName&quot;));
 
-        jLabel2.setText(L10n.getString(&quot;Password&quot;) + &quot;:&quot;);
-        
-        user.setStrict(false);
-        
-        next.setText(L10n.getString(&quot;Authorize&quot;));
+        jLabel2.setText(L10n.getString(&quot;Login.Password&quot;));
 
+        user.setEditable(true);
+
+        password.setEchoChar('\u2022');
+
+        next.setText(L10n.getString(&quot;Login.Authorize&quot;));
+
+        status.setText(&quot; ...&quot;);
+        status.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED));
+
         org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
         getContentPane().setLayout(layout);
         layout.setHorizontalGroup(
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-            .add(layout.createSequentialGroup()
+            .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
                 .addContainerGap()
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                     .add(layout.createSequentialGroup()
@@ -64,12 +75,11 @@
                             .add(jLabel2))
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                            .add(password, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 222, Short.MAX_VALUE)
-                            .add(user, 0, 222, Short.MAX_VALUE)))
-                    .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
-                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 199, Short.MAX_VALUE)
-                        .add(next)))
+                            .add(password, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 223, Short.MAX_VALUE)
+                            .add(user, 0, 223, Short.MAX_VALUE)))
+                    .add(org.jdesktop.layout.GroupLayout.TRAILING, next))
                 .addContainerGap())
+            .add(status, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 298, Short.MAX_VALUE)
         );
         layout.setVerticalGroup(
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
@@ -84,7 +94,8 @@
                     .add(password, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                 .add(next)
-                .addContainerGap())
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(status, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 22, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
         );
         pack();
     }// &lt;/editor-fold&gt;//GEN-END:initComponents
@@ -93,23 +104,35 @@
     /**
      * Reload the list of usernames according to the currently selected record.
      */
-    public void update(Observable arg0, Object arg1) {
-		DBInfo selected = model.getSelected();
-		if(selected == null) return;
-
-		user.removeAllItems();
-		user.addItems(selected.users);
-		
-		setTitle(L10n.getString(&quot;ConnectingTo&quot;) + &quot; &quot; + selected.toString());
+    public void update(Observable source, Object arg) {
+    	if(arg == null || arg instanceof DBInfo) {
+    		DBInfo selected = model.getSelected();
+    		if(selected == null) return;
+    		user.removeAllItems();
+    		((AutoComboBox)user).addItems(selected.users);
+    		setTitle(L10n.getString(&quot;Login.ConnectingTo&quot;) + &quot; &quot; + selected.toString());
+    	}
+    	// Exception! We must display the exception to the user.
+    	else if(arg instanceof Exception) {
+    		status.setText(L10n.getString(&quot;Login.Failed&quot;));
+    		JOptionPane.showMessageDialog(this, arg, L10n.getString(&quot;Error.LoginFailed&quot;), JOptionPane.ERROR_MESSAGE);
+    	}
+    	// The database layer has been created, we are no longer neccessary
+		else if(arg instanceof DBLayer)
+    		this.setVisible(false); 
+    	// Some update information - display them in the status bar.
+		else if(arg instanceof String) 
+			status.setText(&quot;  &quot; + (String)arg);
 	}
     
     
     // Variables declaration - do not modify//GEN-BEGIN:variables
+    private javax.swing.JLabel jLabel1;
+    private javax.swing.JLabel jLabel2;
     protected javax.swing.JButton next;
-    protected javax.swing.JLabel jLabel1;
-    protected javax.swing.JLabel jLabel2;
     protected javax.swing.JPasswordField password;
-    protected AutoComboBox user;
+    protected javax.swing.JLabel status;
+    protected javax.swing.JComboBox user;
     // End of variables declaration//GEN-END:variables
 
 	

Modified: trunk/src/net/sf/plantlore/client/login/ItemCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/ItemCtrl.java	2006-05-25 23:12:33 UTC (rev 355)
+++ trunk/src/net/sf/plantlore/client/login/ItemCtrl.java	2006-05-26 11:38:35 UTC (rev 356)
@@ -21,13 +21,17 @@
 		this.mode = m;
 		switch(m) {
 		case ADD:
-			view.setTitle(L10n.getString(&quot;AddTitle&quot;));
+			view.setTitle(L10n.getString(&quot;Login.AddTitle&quot;));
 			view.alias.setText(&quot;&quot;); 
 			view.host.setText(&quot;&quot;);
 			view.db.setText(&quot;&quot;);
+			view.next.setText(L10n.getString(&quot;Login.Add&quot;));
+			view.next.setToolTipText(L10n.getString(&quot;Login.AddTT&quot;));
 			break;
 		case EDIT:
-			view.setTitle(L10n.getString(&quot;EditTitle&quot;));
+			view.setTitle(L10n.getString(&quot;Login.EditTitle&quot;));
+			view.next.setText(L10n.getString(&quot;Login.Change&quot;));
+			view.next.setToolTipText(L10n.getString(&quot;Login.ChangeTT&quot;));
 			break;
 		}
 	}
@@ -35,10 +39,14 @@
 	
 	public ItemCtrl(Login login, ItemView itemview) {
 		this.model = login; this.view = itemview;
-		view.next.addActionListener(new Next());
+		view.next.setAction(new Next());
 	}
 	
 	class Next extends AbstractAction {
+		public Next() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.ChangeTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Login.Change&quot;));
+		}
 		public void actionPerformed(ActionEvent arg0) {
 			int t = view.host.getText().indexOf(':');
 			int port = (t &lt; 0) ? 1099 : Integer.parseInt(view.host.getText().substring(t));

Modified: trunk/src/net/sf/plantlore/client/login/ItemView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/login/ItemView.form	2006-05-25 23:12:33 UTC (rev 355)
+++ trunk/src/net/sf/plantlore/client/login/ItemView.form	2006-05-26 11:38:35 UTC (rev 356)
@@ -1,8 +1,12 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
 
-&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JFrameFormInfo&quot;&gt;
+&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JDialogFormInfo&quot;&gt;
   &lt;Properties&gt;
-    &lt;Property name=&quot;defaultCloseOperation&quot; type=&quot;int&quot; value=&quot;3&quot;/&gt;
+    &lt;Property name=&quot;title&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot; postCode=&quot;setTitle(L10n.getString(&quot;Login.Add&quot;));&quot;&gt;
+      &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Change&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+    &lt;/Property&gt;
+    &lt;Property name=&quot;modal&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
+    &lt;Property name=&quot;resizable&quot; type=&quot;boolean&quot; value=&quot;false&quot;/&gt;
   &lt;/Properties&gt;
   &lt;SyntheticProperties&gt;
     &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
@@ -28,12 +32,12 @@
                       &lt;/Group&gt;
                       &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                          &lt;Component id=&quot;db&quot; alignment=&quot;0&quot; pref=&quot;229&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;host&quot; alignment=&quot;0&quot; pref=&quot;229&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;alias&quot; alignment=&quot;0&quot; pref=&quot;229&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;db&quot; alignment=&quot;0&quot; pref=&quot;233&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;host&quot; alignment=&quot;0&quot; pref=&quot;233&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;alias&quot; alignment=&quot;0&quot; pref=&quot;233&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
-                  &lt;Component id=&quot;jButton1&quot; alignment=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;next&quot; alignment=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
@@ -58,7 +62,7 @@
                   &lt;Component id=&quot;db&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
               &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;jButton1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;next&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
           &lt;/Group&gt;
       &lt;/Group&gt;
@@ -67,29 +71,49 @@
   &lt;SubComponents&gt;
     &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel1&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Alias:&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Alias&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
       &lt;/Properties&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel2&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Hostname:&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.HostName&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
       &lt;/Properties&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel3&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Database:&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Database&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
       &lt;/Properties&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;alias&quot;&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;host&quot;&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;db&quot;&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
-    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;jButton1&quot;&gt;
+    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;next&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Change&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Change&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
       &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
   &lt;/SubComponents&gt;
 &lt;/Form&gt;

Modified: trunk/src/net/sf/plantlore/client/login/ItemView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/ItemView.java	2006-05-25 23:12:33 UTC (rev 355)
+++ trunk/src/net/sf/plantlore/client/login/ItemView.java	2006-05-26 11:38:35 UTC (rev 356)
@@ -25,9 +25,7 @@
 		this.model = model;
 		model.addObserver(this);
 		initComponents();
-		setResizable(false);
 		setLocationRelativeTo(null);
-		setModal(true);
     }
     
     /** This method is called from within the constructor to
@@ -45,14 +43,17 @@
         db = new javax.swing.JTextField();
         next = new javax.swing.JButton();
 
-        setDefaultCloseOperation(javax.swing.WindowConstants.HIDE_ON_CLOSE);
-        jLabel1.setText(L10n.getString(&quot;Alias&quot;) + &quot;:&quot;);
+        setTitle(L10n.getString(&quot;Login.Change&quot;));
+        setTitle(L10n.getString(&quot;Login.Add&quot;));
+        setModal(true);
+        setResizable(false);
+        jLabel1.setText(L10n.getString(&quot;Login.Alias&quot;));
 
-        jLabel2.setText(L10n.getString(&quot;Hostname&quot;) + &quot;:&quot;);
+        jLabel2.setText(L10n.getString(&quot;Login.HostName&quot;));
 
-        jLabel3.setText(L10n.getString(&quot;Database&quot;) + &quot;:&quot;);
+        jLabel3.setText(L10n.getString(&quot;Login.Database&quot;));
 
-        next.setText(L10n.getString(&quot;Change&quot;));
+        next.setText(L10n.getString(&quot;Login.Change&quot;));
 
         org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
         getContentPane().setLayout(layout);
@@ -68,9 +69,9 @@
                             .add(jLabel3))
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                            .add(db, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 229, Short.MAX_VALUE)
-                            .add(host, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 229, Short.MAX_VALUE)
-                            .add(alias, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 229, Short.MAX_VALUE)))
+                            .add(db, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 233, Short.MAX_VALUE)
+                            .add(host, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 233, Short.MAX_VALUE)
+                            .add(alias, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 233, Short.MAX_VALUE)))
                     .add(org.jdesktop.layout.GroupLayout.TRAILING, next))
                 .addContainerGap())
         );
@@ -112,10 +113,10 @@
     protected javax.swing.JTextField alias;
     protected javax.swing.JTextField db;
     protected javax.swing.JTextField host;
+    private javax.swing.JLabel jLabel1;
+    private javax.swing.JLabel jLabel2;
+    private javax.swing.JLabel jLabel3;
     protected javax.swing.JButton next;
-    protected javax.swing.JLabel jLabel1;
-    protected javax.swing.JLabel jLabel2;
-    protected javax.swing.JLabel jLabel3;
     // End of variables declaration//GEN-END:variables
     
 }

Modified: trunk/src/net/sf/plantlore/client/login/Login.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/Login.java	2006-05-25 23:12:33 UTC (rev 355)
+++ trunk/src/net/sf/plantlore/client/login/Login.java	2006-05-26 11:38:35 UTC (rev 356)
@@ -1,21 +1,21 @@
 package net.sf.plantlore.client.login;
 
-import java.rmi.NotBoundException;
 import java.rmi.RemoteException;
 import java.util.ArrayList;
 import java.util.Observable;
 import net.sf.plantlore.client.MainConfig;
+import net.sf.plantlore.common.SwingWorker;
 import net.sf.plantlore.common.record.User;
 
 import org.apache.log4j.Logger;
 
 import net.sf.plantlore.common.record.Right;
+import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.middleware.DBLayer;
 import net.sf.plantlore.middleware.DBLayerFactory;
-import net.sf.plantlore.common.exception.DBLayerException;
 
 /**
- * Login is responsible for the following:
+ * Login is responsible for the following tasks:
  * &lt;ul&gt;
  * &lt;li&gt;&lt;b&gt;management of the list of databases&lt;/b&gt; - 
  * 			adding, editing, removing records from the list, and the persistent storage of that list,&lt;/li&gt;
@@ -25,12 +25,14 @@
  * 
  * 
  * @author Erik Kratochv&#237;l (<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">discontinuum at gmail.com</A>)
+ * @author Jakub Kotowski
  * @version 1.0
  */
 public class Login extends Observable {
 	
 	/** The maximum number of usernames the System will store for each database record.*/
 	public static final int MAX_NAMES = 5;
+	public static final Object UPDATE_LIST = new Object();
 
 	/** 
 	 * The list of databases the User has accessed. This list is unique for every User
@@ -48,6 +50,8 @@
 	private DBLayer dblayer;
 	private Logger logger;
 	
+	private String username;
+	private String passcode;
 	
 	private Right accessRights;
     private User plantloreUser;
@@ -96,7 +100,9 @@
 		 // TEMPORARY CODE ENDS HERE
                                 
 		//dbinfo = mainConfig.getDBinfos();
-		this.setChanged(); this.notifyObservers();
+				System.out.println(&quot;DBUPD &quot; + UPDATE_LIST);
+				
+		this.setChanged(); this.notifyObservers(UPDATE_LIST);
 	}
 	
 	/**
@@ -127,7 +133,7 @@
 		dbinfo.add(r);
 		logger.debug(&quot;New database record has been created &quot; + r);
 		save();
-		setChanged(); notifyObservers();
+		setChanged(); notifyObservers(UPDATE_LIST);
 	}
 	
 	/**
@@ -140,7 +146,7 @@
 		logger.debug(&quot;The selected record has been removed &quot; + selected);
 		selected = null;
 		save();
-		this.setChanged(); this.notifyObservers();
+		this.setChanged(); this.notifyObservers(UPDATE_LIST);
 	}
 	
 	/**
@@ -155,7 +161,7 @@
 		if(selected == null) return;
 		selected.alias = alias; selected.host = host; selected.port = port; selected.db = db;
 		logger.debug(&quot;The selected record has been updated &quot; + selected);
-		this.setChanged(); this.notifyObservers();
+		this.setChanged(); this.notifyObservers(UPDATE_LIST);
 	}
 	
 	/**
@@ -166,6 +172,8 @@
 		return dbinfo.toArray(new DBInfo[0]);
 	}
 	
+	private int lastIndex = Integer.MIN_VALUE;
+	
 	/**
 	 * Set the selected record.
 	 * 
@@ -173,9 +181,13 @@
 	 * Negative means nothing gets selected (deselect).
 	 */
 	public void setSelected(int index) {
+		if(index == lastIndex) 
+			return;
 		if(index &gt;= 0) selected = dbinfo.get(index); 
 		else selected = null;
 		
+		lastIndex = index;
+		
 		logger.debug(&quot;Selected database is &quot; + selected);
 		this.setChanged(); 
 		/*------------------------------------------------------------
@@ -189,7 +201,7 @@
 		 *    would be called which will in turn trigger 
 		 *    ListSelectionEvent -&gt; 2.
 		 *------------------------------------------------------------*/
-		this.notifyObservers(&quot;[!] recursion won't be tolerated&quot;);
+		this.notifyObservers( selected );
 	}
 	
 	/**
@@ -210,52 +222,66 @@
 	 * 	  
 	 * @param name The account name (used to access the database).  
 	 * @param password The password to the account.
-	 * @return The created and initialized DBLayer.
-	 * @throws NotBoundException if the server is unreachable (most likely because it is not running). 
-	 * @throws RemoteException if the RMI encounters an error.  
-	 * @throws DBLayerException if the initialization of the DBLayer failed - most common reasons are:
-	 * 		wrong username or password, or incorrect database model (server and client have different versions).
 	 */
-	public DBLayer connectToSelected(String name, String password) throws NotBoundException, RemoteException, DBLayerException {
+	public void connectToSelected(String name, String password) {
+		this.username = name; this.passcode = password;
 		if(selected == null) {
 			logger.debug(&quot;The System cannot create a connection when nothing was selected!&quot;);
-			return null;
+			return;
 		}
 		
-		try {
-			logout();
-		} catch (RemoteException e) { logger.info(&quot;Unable to disconnect from the server. &quot; + e); }
-		
-		// The current username is moved to the top of the list of names :) Nice feature.
-		selected.promoteUser(name);
-		// Save the current state.
-		save();
-		
-		// Create a new database layer.
-		logger.debug(&quot;Asking the DBLayerFactory for a new DBLayer @ &quot; + selected.host + &quot;:&quot; + selected.port);
-		dblayer = factory.create(selected.host, selected.port);
-		
-		// Initialize the database layer.
-		logger.debug(&quot;Initializing that DBLayer (&quot; + selected.db + &quot;, &quot; + name + &quot;, &quot; + password + &quot;...&quot;);
-		try {
-			Object[] init = dblayer.initialize(selected.db,name, password);
-                        plantloreUser = (User)init[0];
-                        accessRights = (Right)init[1];
-		} 
-		catch (DBLayerException exception) {
-			logger.error(&quot;The initialization of the DBLayer failed! Here's why: &quot; + exception);
-                        exception.printStackTrace();
-			// If the initialization of the DBLayer failed, the uninitialized DBLayer must be destroyed!
-			// If it is not, the server's policy may not allow another connection from this client!
-			factory.destroy(dblayer);
-			throw exception; // rethrow that exception [so that the User also knows what happened]
-		}
+		 final SwingWorker worker = new SwingWorker() {
+	            public Object construct() {
+	            	
+	            	try {
+	            		logout();
+	            	} catch (RemoteException e) { logger.info(&quot;Unable to disconnect from the server. &quot; + e); }
+	            	
+	            	try {
+	            		// The current username is moved to the top of the list of names :) Nice feature.
+	            		selected.promoteUser(username);
+	            		// Save the current state.
+	            		save();
+	            		
+	            		// Create a new database layer.
+	            		logger.debug(&quot;Asking the DBLayerFactory for a new DBLayer @ &quot; + selected.host + &quot;:&quot; + selected.port);
+	            		setChanged(); notifyObservers(L10n.getString(&quot;Login.Connecting&quot;));
+	            		dblayer = factory.create(selected.host, selected.port);
+	            		
+	            		logger.debug(&quot;Connection successful.&quot;);
+	            		setChanged(); notifyObservers(L10n.getString(&quot;Login.Connected&quot;));
+	            		
+	            		// Initialize the database layer.
+	            		setChanged(); notifyObservers(L10n.getString(&quot;Login.InitializingDBLayer&quot;));
+	            		logger.debug(&quot;Initializing that DBLayer (&quot; + selected.db + &quot;, &quot; + username + &quot;, &quot; + passcode + &quot;...&quot;);
 
-		logger.debug(&quot;DBLayer initialized.&quot;);
-		
-		// Everything went fine.
-		this.setChanged(); this.notifyObservers(dblayer);
-		return dblayer;
+	            		Object[] init = dblayer.initialize(selected.db, username, passcode);
+	            		plantloreUser = (User)init[0];
+	            		accessRights = (Right)init[1];
+	            	} 
+	            	catch (Exception exception) {
+	            		logger.error(&quot;The initialization of the DBLayer failed! &quot; + exception);
+	            		// If the initialization of the DBLayer failed, the uninitialized DBLayer must be destroyed!
+	            		// If it is not, the server's policy may not allow another connection from this client!
+	            		try {
+	            			factory.destroy(dblayer);
+	            		} catch(RemoteException re) {}
+	            		setChanged();
+            			notifyObservers( exception );
+	            		return null;
+	            	}
+	            	
+	            	setChanged(); 
+	            	notifyObservers(L10n.getString(&quot;Login.DBLayerInitialized&quot;));
+	            	logger.debug(&quot;DBLayer initialized.&quot;);
+	            	
+	            	// Everything went fine.
+	            	setChanged(); notifyObservers(dblayer);
+	            	return null;
+	            }
+		 };
+		 
+		 worker.start();
 	}
 	
 	

Modified: trunk/src/net/sf/plantlore/client/login/LoginCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/LoginCtrl.java	2006-05-25 23:12:33 UTC (rev 355)
+++ trunk/src/net/sf/plantlore/client/login/LoginCtrl.java	2006-05-26 11:38:35 UTC (rev 356)
@@ -33,10 +33,10 @@
 		
 		
 		view.choice.addListSelectionListener(new ChoiceChanged());
-		view.add.addActionListener(new AddRecord());
-		view.edit.addActionListener(new EditRecord());
-		view.remove.addActionListener(new RemoveRecord());
-		view.next.addActionListener(new Next());
+		view.add.setAction(new AddRecord());
+		view.edit.setAction(new EditRecord());
+		view.remove.setAction(new RemoveRecord());
+		view.next.setAction(new Next());
 		
 		// Select something.
 		view.choice.setSelectedIndex(0);
@@ -50,13 +50,13 @@
 		}
 		
 		//UNCOMMENT THIS:      
-		//dialog.setVisible(visible);
+		dialog.setVisible(visible);
 		
-		// TEMPORARY CODE STARTS HERE
-			System.out.println(&quot;HYPERACTIVE-LOGIN&quot;);
-			authView.password.setText(&quot;masterkey&quot;);
-			authView.next.doClick(); 
-		// TEMPORARY CODE ENDS HERE
+//		// TEMPORARY CODE STARTS HERE
+//			System.out.println(&quot;HYPERACTIVE-LOGIN&quot;);
+//			authView.password.setText(&quot;masterkey&quot;);
+//			authView.next.doClick(); 
+//		// TEMPORARY CODE ENDS HERE
 	}
 	
 	
@@ -77,6 +77,10 @@
 	}
 	
 	class AddRecord extends AbstractAction {
+		public AddRecord() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.AddRecordTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Login.AddRecord&quot;));
+		}
 		public void actionPerformed(ActionEvent arg0) {
 			itemCtrl.setMode(ItemCtrl.Mode.ADD);
 			itemView.setVisible(true);
@@ -84,17 +88,25 @@
 	}
 	
 	class  RemoveRecord extends AbstractAction {
+		public RemoveRecord() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.RemoveRecordTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Login.RemoveRecord&quot;));
+		}
 		public void actionPerformed(ActionEvent arg0) {
 			model.deleteSelectedRecord();
 		}
 	}
 	
 	class EditRecord extends AbstractAction {
+		public EditRecord() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.EditRecordTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Login.EditRecord&quot;));
+		}
 		public void actionPerformed(ActionEvent arg0) {
 			if(model.getSelected() == null)
 				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;warningEmptySelection&quot;),
-					    L10n.getString(&quot;warningEmptySelectionTitle&quot;),
+						L10n.getString(&quot;Error.NothingSelected&quot;),
+					    L10n.getString(&quot;Error.Missing&quot;),
 					    JOptionPane.WARNING_MESSAGE);
 			else {
 				itemCtrl.setMode(ItemCtrl.Mode.EDIT);
@@ -104,11 +116,15 @@
 	}
 	
 	class Next extends AbstractAction {
+		public Next() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.NextTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Login.Next&quot;));
+		}
 		public void actionPerformed(ActionEvent arg0) {
 			if(model.getSelected() == null)
 				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;warningEmptySelection&quot;),
-					    L10n.getString(&quot;warningEmptySelectionTitle&quot;),
+						L10n.getString(&quot;Error.NothingSelected&quot;),
+					    L10n.getString(&quot;Error.Missing&quot;),
 					    JOptionPane.WARNING_MESSAGE);
 			else
 				authView.setVisible(true);

Modified: trunk/src/net/sf/plantlore/client/login/LoginView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/login/LoginView.form	2006-05-25 23:12:33 UTC (rev 355)
+++ trunk/src/net/sf/plantlore/client/login/LoginView.form	2006-05-26 11:38:35 UTC (rev 356)
@@ -1,6 +1,6 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
 
-&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JFrameFormInfo&quot;&gt;
+&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JDialogFormInfo&quot;&gt;
   &lt;NonVisualComponents&gt;
     &lt;Menu class=&quot;javax.swing.JPopupMenu&quot; name=&quot;popup&quot;&gt;
       &lt;Properties&gt;
@@ -9,24 +9,42 @@
       &lt;SubComponents&gt;
         &lt;MenuItem class=&quot;javax.swing.JMenuItem&quot; name=&quot;add&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Add&quot;/&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.AddRecord&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
           &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
         &lt;/MenuItem&gt;
         &lt;MenuItem class=&quot;javax.swing.JMenuItem&quot; name=&quot;edit&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Edit&quot;/&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.EditRecord&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
           &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
         &lt;/MenuItem&gt;
         &lt;MenuItem class=&quot;javax.swing.JMenuItem&quot; name=&quot;remove&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Remove&quot;/&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.RemoveRecord&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
           &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
         &lt;/MenuItem&gt;
       &lt;/SubComponents&gt;
     &lt;/Menu&gt;
   &lt;/NonVisualComponents&gt;
   &lt;Properties&gt;
-    &lt;Property name=&quot;defaultCloseOperation&quot; type=&quot;int&quot; value=&quot;3&quot;/&gt;
+    &lt;Property name=&quot;title&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot; postCode=&quot;setTitle(L10n.getString(&quot;Login.SelectDB&quot;));&quot;&gt;
+      &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.SelectDB&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+    &lt;/Property&gt;
+    &lt;Property name=&quot;modal&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
   &lt;/Properties&gt;
   &lt;SyntheticProperties&gt;
     &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
@@ -47,7 +65,7 @@
                   &lt;Component id=&quot;jScrollPane1&quot; alignment=&quot;1&quot; pref=&quot;343&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
                       &lt;Component id=&quot;remember&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace pref=&quot;157&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;151&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;next&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
               &lt;/Group&gt;
@@ -73,9 +91,14 @@
   &lt;SubComponents&gt;
     &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;next&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Continue&quot;/&gt;
-        &lt;Property name=&quot;name&quot; type=&quot;java.lang.String&quot; value=&quot;next&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Next&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+        &lt;Property name=&quot;name&quot; type=&quot;java.lang.String&quot; value=&quot;&quot;/&gt;
       &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
     &lt;Container class=&quot;javax.swing.JScrollPane&quot; name=&quot;jScrollPane1&quot;&gt;
       &lt;AuxValues&gt;
@@ -94,12 +117,17 @@
             &lt;/Property&gt;
             &lt;Property name=&quot;selectionMode&quot; type=&quot;int&quot; value=&quot;0&quot;/&gt;
           &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
         &lt;/Component&gt;
       &lt;/SubComponents&gt;
     &lt;/Container&gt;
     &lt;Component class=&quot;javax.swing.JCheckBox&quot; name=&quot;remember&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;select automatically&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.SelectAutomatically&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
         &lt;Property name=&quot;border&quot; type=&quot;javax.swing.border.Border&quot; editor=&quot;org.netbeans.modules.form.editors2.BorderEditor&quot;&gt;
           &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.EmptyBorderInfo&quot;&gt;
             &lt;EmptyBorder bottom=&quot;0&quot; left=&quot;0&quot; right=&quot;0&quot; top=&quot;0&quot;/&gt;
@@ -109,6 +137,9 @@
           &lt;Insets value=&quot;[0, 0, 0, 0]&quot;/&gt;
         &lt;/Property&gt;
       &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
   &lt;/SubComponents&gt;
 &lt;/Form&gt;

Modified: trunk/src/net/sf/plantlore/client/login/LoginView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/LoginView.java	2006-05-25 23:12:33 UTC (rev 355)
+++ trunk/src/net/sf/plantlore/client/login/LoginView.java	2006-05-26 11:38:35 UTC (rev 356)
@@ -26,10 +26,8 @@
 		model.addObserver(this);
         initComponents();
         setLocationRelativeTo(null); // center of the screen
-        
-        setModal(true);
         // See what's new.
-        update(null, null);
+        update(null, Login.UPDATE_LIST);
     }
     
     /** This method is called from within the constructor to
@@ -48,28 +46,29 @@
         choice = new javax.swing.JList();
         remember = new javax.swing.JCheckBox();
 
-        
-        add.setText(L10n.getString(&quot;loginAdd&quot;));
+        popup.setName(&quot;popup&quot;);
+        add.setText(L10n.getString(&quot;Login.AddRecord&quot;));
         popup.add(add);
 
-        edit.setText(L10n.getString(&quot;loginEdit&quot;));
+        edit.setText(L10n.getString(&quot;Login.EditRecord&quot;));
         popup.add(edit);
 
-        remove.setText(L10n.getString(&quot;loginRemove&quot;));
+        remove.setText(L10n.getString(&quot;Login.RemoveRecord&quot;));
         popup.add(remove);
 
-        setDefaultCloseOperation(javax.swing.WindowConstants.HIDE_ON_CLOSE);
-        next.setText(L10n.getString(&quot;Continue&quot;));
-        
+        setTitle(L10n.getString(&quot;Login.SelectDB&quot;));
+        setTitle(L10n.getString(&quot;Login.SelectDB&quot;));
+        setModal(true);
+        next.setText(L10n.getString(&quot;Login.Next&quot;));
+        next.setName(&quot;&quot;);
 
         choice.setComponentPopupMenu(popup);
         choice.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
         jScrollPane1.setViewportView(choice);
 
-        remember.setText(L10n.getString(&quot;AutoSelect&quot;));
+        remember.setText(L10n.getString(&quot;Login.SelectAutomatically&quot;));
         remember.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
         remember.setMargin(new java.awt.Insets(0, 0, 0, 0));
-        //remember.setSelected(true);
 
         org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
         getContentPane().setLayout(layout);
@@ -81,7 +80,7 @@
                     .add(org.jdesktop.layout.GroupLayout.TRAILING, jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 343, Short.MAX_VALUE)
                     .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
                         .add(remember)
-                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 157, Short.MAX_VALUE)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 151, Short.MAX_VALUE)
                         .add(next)))
                 .addContainerGap())
         );
@@ -106,7 +105,7 @@
      */
     public void update(Observable source, Object parameter) {
     	// Ignore setSelected() event
-    	if(parameter == null) {
+    	if(parameter == Login.UPDATE_LIST) {
     		// Every item of the list will - after being added to the list - 
     		// cause a ListSelectionEvent (valueChange) event!
     		// This is probably because every time an item is inserted 
@@ -122,9 +121,9 @@
     protected javax.swing.JMenuItem add;
     protected javax.swing.JList choice;
     protected javax.swing.JMenuItem edit;
-    protected javax.swing.JScrollPane jScrollPane1;
+    private javax.swing.JScrollPane jScrollPane1;
     protected javax.swing.JButton next;
-    protected javax.swing.JPopupMenu popup;
+    private javax.swing.JPopupMenu popup;
     protected javax.swing.JCheckBox remember;
     protected javax.swing.JMenuItem remove;
     // End of variables declaration//GEN-END:variables


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000405.html">[Plantlore-dev] r355 - trunk/src/net/sf/plantlore/client
</A></li>
	<LI>Next message: <A HREF="000407.html">[Plantlore-dev] r357 - trunk/src/net/sf/plantlore/l10n
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#406">[ date ]</a>
              <a href="thread.html#406">[ thread ]</a>
              <a href="subject.html#406">[ subject ]</a>
              <a href="author.html#406">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
