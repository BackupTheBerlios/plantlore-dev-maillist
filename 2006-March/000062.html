<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r67 - in trunk/src/net/sf/plantlore/client: . authors dblayer dblayer/query history
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-March/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r67%20-%20in%20trunk/src/net/sf/plantlore/client%3A%20.%20authors%20dblayer%20dblayer/query%20history&In-Reply-To=%3C200603242229.k2OMTSxB012238%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000061.html">
   <LINK REL="Next"  HREF="000063.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r67 - in trunk/src/net/sf/plantlore/client: . authors dblayer dblayer/query history</H1>
    <B>kovo at berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r67%20-%20in%20trunk/src/net/sf/plantlore/client%3A%20.%20authors%20dblayer%20dblayer/query%20history&In-Reply-To=%3C200603242229.k2OMTSxB012238%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r67 - in trunk/src/net/sf/plantlore/client: . authors dblayer dblayer/query history">kovo at berlios.de
       </A><BR>
    <I>Fri Mar 24 23:29:28 CET 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000061.html">[Plantlore-dev] r66 - trunk/src/net/sf/plantlore/server
</A></li>
        <LI>Next message: <A HREF="000063.html">[Plantlore-dev] r68 - trunk/src/net/sf/plantlore/server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62">[ date ]</a>
              <a href="thread.html#62">[ thread ]</a>
              <a href="subject.html#62">[ subject ]</a>
              <a href="author.html#62">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: kovo
Date: 2006-03-24 23:29:27 +0100 (Fri, 24 Mar 2006)
New Revision: 67

Removed:
   trunk/src/net/sf/plantlore/client/dblayer/DBMapping.java
Modified:
   trunk/src/net/sf/plantlore/client/AppCore.java
   trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
   trunk/src/net/sf/plantlore/client/AppCoreView.java
   trunk/src/net/sf/plantlore/client/authors/AuthorManager.java
   trunk/src/net/sf/plantlore/client/authors/AuthorManagerCtrl.java
   trunk/src/net/sf/plantlore/client/authors/AuthorManagerView.java
   trunk/src/net/sf/plantlore/client/dblayer/FirebirdDBLayer.java
   trunk/src/net/sf/plantlore/client/dblayer/query/DeleteQuery.java
   trunk/src/net/sf/plantlore/client/dblayer/query/InsertQuery.java
   trunk/src/net/sf/plantlore/client/dblayer/query/Query.java
   trunk/src/net/sf/plantlore/client/dblayer/query/SelectQuery.java
   trunk/src/net/sf/plantlore/client/dblayer/query/UpdateQuery.java
   trunk/src/net/sf/plantlore/client/history/History.java
   trunk/src/net/sf/plantlore/client/history/HistoryView.java
Log:
Make current repository revision compilable

Modified: trunk/src/net/sf/plantlore/client/AppCore.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCore.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/AppCore.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -11,9 +11,10 @@
 import java.util.prefs.Preferences;
 
 // Imports for temporary db access
-import net.sf.plantlore.client.dblayer.DBLayer;
 import net.sf.plantlore.client.dblayer.FirebirdDBLayer;
-import net.sf.plantlore.client.dblayer.DBLayerException;
+import net.sf.plantlore.server.DBLayer;
+import net.sf.plantlore.server.DBLayerException;
+import net.sf.plantlore.server.HibernateDBLayer;
 
 /** Application core model
  *
@@ -30,7 +31,8 @@
     {
         prefs = Preferences.userNodeForPackage(this.getClass());
         
-        database = new FirebirdDBLayer(&quot;localhost&quot;, &quot;3050&quot;, &quot;/mnt/data/temp/plantloreHIB.fdb&quot;, &quot;sysdba&quot;, &quot;masterkey&quot;);
+//        database = new FirebirdDBLayer(&quot;localhost&quot;, &quot;3050&quot;, &quot;/mnt/data/temp/plantloreHIB.fdb&quot;, &quot;sysdba&quot;, &quot;masterkey&quot;);
+        database = new HibernateDBLayer();
         try {
             database.initialize();
         } catch (DBLayerException e) {

Modified: trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -14,10 +14,10 @@
 import java.awt.event.WindowEvent;
 import java.util.prefs.Preferences;
 import javax.swing.AbstractAction;
-import net.sf.plantlore.client.dblayer.DBLayer;
-import net.sf.plantlore.client.dblayer.DBLayerException;
+import net.sf.plantlore.server.DBLayer;
+import net.sf.plantlore.server.DBLayerException;
 import net.sf.plantlore.client.dblayer.FirebirdDBLayer;
-import net.sf.plantlore.common.record.PlantRecord;
+import net.sf.plantlore.common.record.Plant;
 import net.sf.plantlore.client.dblayer.result.QueryResult;
 import net.sf.plantlore.client.dblayer.result.Result;
 import net.sf.plantlore.client.dblayer.query.SelectQuery;
@@ -25,11 +25,11 @@
 import net.sf.plantlore.client.authors.AuthorManager;
 import net.sf.plantlore.client.authors.AuthorManagerCtrl;
 import net.sf.plantlore.client.authors.AuthorManagerView;
-import net.sf.plantlore.client.dblayer.DBMapping;
 import net.sf.plantlore.client.history.History;
 import net.sf.plantlore.client.history.HistoryCtrl;
 import net.sf.plantlore.client.history.HistoryView;
 import net.sf.plantlore.l10n.L10n;
+import net.sf.plantlore.server.HibernateDBLayer;
 
 import org.apache.log4j.Logger;
 
@@ -106,7 +106,7 @@
         public void actionPerformed(ActionEvent actionEvent)
         {
             System.out.println(&quot;Print selected&quot;);
-            DBLayer dbl = new FirebirdDBLayer(&quot;localhost&quot;,&quot;3050&quot;,&quot;/mnt/data/temp/plantloreHIB.fdb&quot;,&quot;sysdba&quot;,&quot;augmentin&quot;);
+            DBLayer dbl = new HibernateDBLayer();
             try
             {
                 dbl.initialize();
@@ -115,13 +115,14 @@
                 System.out.println(&quot;Exception while initializing DBLayer: &quot;+ex.getMessage());
                 ex.printStackTrace();
             }
+            /*
             Query sq = new SelectQuery();
             try
             {
                 sq.setType(DBMapping.PLANTRECORD);
                 Result qr = dbl.executeQuery(sq);
                 System.out.println(&quot;There are &quot;+qr.getNumRows()+&quot; plants in the db.&quot;);
-                PlantRecord p = (PlantRecord) dbl.next(qr);
+                Plant p = (Plant) dbl.next(qr);
                 do {
                     System.out.println(&quot;-----------------&quot;);
                 System.out.println(&quot;Plant is &quot;+p.getPublishableName());
@@ -129,13 +130,14 @@
                 System.out.println(&quot;Abbrev. &quot;+p.getAbbreviation());
                 System.out.println(&quot;Adopted name &quot;+p.getAdoptedName());
                 System.out.println(&quot;Note &quot;+p.getNote());
-                p = (PlantRecord) dbl.next(qr);
+                p = (Plant) dbl.next(qr);
                 } while (p!=null);
             } catch (DBLayerException ex)
             {
                 System.out.println(&quot;Msg: &quot;+ex.getMessage());
                 ex.printStackTrace();
             }
+            */
         }
     }
     

Modified: trunk/src/net/sf/plantlore/client/AppCoreView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreView.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/AppCoreView.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -113,7 +113,7 @@
     {
         frame = new JFrame(L10n.getString(&quot;plantlore&quot;));
         frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
-        frame.setSize(640,480);
+        frame.setExtendedState(JFrame.MAXIMIZED_BOTH); 
         frame.setVisible(false);
         frame.setJMenuBar(menuBar);
         container = frame.getContentPane();

Modified: trunk/src/net/sf/plantlore/client/authors/AuthorManager.java
===================================================================
--- trunk/src/net/sf/plantlore/client/authors/AuthorManager.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/authors/AuthorManager.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -9,16 +9,17 @@
 
 import java.util.ArrayList;
 import java.util.Observable;
-import net.sf.plantlore.common.record.AuthorRecord;
-import net.sf.plantlore.client.dblayer.DBLayer;
-import net.sf.plantlore.client.dblayer.DBLayerException;
-import net.sf.plantlore.client.dblayer.DBMapping;
+import net.sf.plantlore.common.PlantloreConstants;
+import net.sf.plantlore.common.record.Author;
+import net.sf.plantlore.server.DBLayer;
+import net.sf.plantlore.server.DBLayerException;
 import net.sf.plantlore.client.dblayer.query.DeleteQuery;
 import net.sf.plantlore.client.dblayer.query.InsertQuery;
 import net.sf.plantlore.client.dblayer.query.Query;
 import net.sf.plantlore.client.dblayer.result.Result;
-import net.sf.plantlore.client.dblayer.query.SelectQuery;
+import net.sf.plantlore.server.SelectQuery;
 import net.sf.plantlore.common.SwingWorker;
+import net.sf.plantlore.common.record.Author;
 import org.apache.log4j.Logger;
 
 /**
@@ -104,26 +105,21 @@
             public Object construct() {
                 // The operation is not finished yet
                 done = false;
-                // Create new Insert query
-                InsertQuery query = new InsertQuery();
-                // Set type of data we want to insert
-                query.setType(DBMapping.AUTHORRECORD);
-                // Fill query with information about the author
-                query.addData(&quot;id&quot;, &quot;gen_id(GEN_TAUTHORS, 1)&quot;);
-                query.addData(&quot;firstname&quot;, firstName);
-                query.addData(&quot;surname&quot;, surname);        
-                query.addData(&quot;organization&quot;, organization);                
-                query.addData(&quot;role&quot;, role);
-                query.addData(&quot;address&quot;, address);        
-                query.addData(&quot;phonenumber&quot;, phoneNumber);                
-                query.addData(&quot;email&quot;, email);                
-                query.addData(&quot;url&quot;, url);                        
-                query.addData(&quot;note&quot;, note);                        
-                Result QRes = null;
+                Author author = new Author();
+                author.setFirstName(firstName);
+                author.setSurname(surname);
+                author.setOrganization(organization);
+                author.setRole(role);
+                author.setAddress(address);
+                author.setPhoneNumber(phoneNumber);
+                author.setEmail(email);
+                author.setUrl(url);
+                author.setNote(note);
                 // Execute query
+                int rowId;
                 try {
                     // Execute query
-                    QRes = database.executeQuery(query);        
+                    rowId = database.executeInsert(author);
                 } catch (DBLayerException e) {
                     // Log and set an error
                     logger.error(&quot;Saving author failed. Unable to execute insert query&quot;);
@@ -137,7 +133,7 @@
                     searchAuthor();
                 }
                 done = true;
-                return QRes;
+                return rowId;
             }
         };
         worker.start();
@@ -151,30 +147,23 @@
         final SwingWorker worker = new SwingWorker() {
             public Object construct() {
                 // Operation not finished yet
-                done = false;
-                // Create new Delete query
-                DeleteQuery query = new DeleteQuery();
-                // Set type of data we want to delete
-                query.setType(DBMapping.AUTHORRECORD);
-                // Set criteria - which authors to delete
-                query.addWhere(&quot;id&quot;, &quot;=&quot;, ((AuthorRecord)data.get(getAuthorIndex())).getID()+&quot;&quot;);
-                Result qRes = null;
+                done = false;                
                 try {
                     // Execute query
-                    qRes = database.executeQuery(query);                            
+                    database.executeDelete((Author)data.get(getAuthorIndex()));                            
                 } catch (DBLayerException e) {
                     // Log and set an error
                     logger.error(&quot;Deleting author failed. Unable to execute delete query.&quot;);
                     setError(e);
                     // Set operation state to finished                    
                     done = true;       
-                    return qRes;                                        
+                    return null;
                 }
                 // Execute author search - required in order to display up-to-date data in the table of authors
                 searchAuthor();                
                 // Set operation state to finished
                 done = true;       
-                return qRes;                    
+                return null;
             }        
         };
         worker.start();            
@@ -194,21 +183,18 @@
                 // Operation not finished yet
                 done = false;                
                 // Create new Select query
-                Query query = new SelectQuery();
-                query.setType(DBMapping.AUTHORRECORD);
-                // Set search criteria
+                SelectQuery query = database.createQuery(Author.class);
                 if (searchName != null)
-                    query.addWhere(&quot;firstname&quot;, &quot;LIKE&quot;, &quot;%&quot;+searchName+&quot;%&quot;);
+                    query.addRestriction(PlantloreConstants.RESTR_LIKE, &quot;firstName&quot;, null, &quot;%&quot;+searchName+&quot;%&quot;, null);
                 if (searchOrganization != null) 
-                    query.addWhere(&quot;organization&quot;, &quot;LIKE&quot;, &quot;%&quot;+searchOrganization+&quot;%&quot;);
+                    query.addRestriction(PlantloreConstants.RESTR_LIKE, &quot;organization&quot;, null, &quot;%&quot;+searchOrganization+&quot;%&quot;, null);
                 if (searchRole != null)
-                    query.addWhere(&quot;role&quot;, &quot;LIKE&quot;, &quot;%&quot;+searchRole+&quot;%&quot;);
+                    query.addRestriction(PlantloreConstants.RESTR_LIKE, &quot;role&quot;, null, &quot;%&quot;+searchRole+&quot;%&quot;, null);
                 if (searchEmail != null) 
-                    query.addWhere(&quot;email&quot;, &quot;LKE&quot;, &quot;%&quot;+searchEmail+&quot;%&quot;);
-                
+                    query.addRestriction(PlantloreConstants.RESTR_LIKE, &quot;email&quot;, null, &quot;%&quot;+searchEmail+&quot;%&quot;, null);                
                 String field;
                 switch (sortField) {
-                    case 1: field = &quot;firstname&quot;;
+                    case 1: field = &quot;firstName&quot;;
                             break;
                     case 2: field = &quot;organization&quot;;
                             break;
@@ -220,19 +206,18 @@
                             break;                            
                     case 6: field = &quot;url&quot;;
                             break;          
-                    default:field = &quot;firstname&quot;;
+                    default:field = &quot;firstName&quot;;
                 }
                 
                 if (sortDirection == 0) {
-                    query.addOrderby(field, &quot;ASC&quot;);                
+                    query.addOrder(PlantloreConstants.DIRECT_ASC, field);
                 } else {
-                    query.addOrderby(field, &quot;DESC&quot;);                                    
-                }                                                                        
-                
+                    query.addOrder(PlantloreConstants.DIRECT_DESC, field);                    
+                }                
                 Result qRes = null;
                 try {
-                    // Execute query
-                    qRes = database.executeQuery(query);        
+                    // Execute query                    
+                    database.executeQuery(query);        
                 } catch (DBLayerException e) {
                     // Log and set an error                   
                     logger.error(&quot;Searching authors failed. Unable to execute search query.&quot;);
@@ -244,7 +229,7 @@
                     // Save the results
                     setResult(qRes);
                     return qRes;                    
-                }      
+                } 
             }
         };
         worker.start();
@@ -273,23 +258,24 @@
      */
     public void processResults(int from, int count) {
         if (this.queryResult != null) {
-            logger.debug(&quot;Rows in the result: &quot;+this.queryResult.getNumRows());
+//            logger.debug(&quot;Rows in the result: &quot;+this.queryResult.getNumRows());
             logger.debug(&quot;Max available rows: &quot;+(from+count-1));
             // Find out how many rows we can retrieve - it cannot be more than number of rows in the result
-            int to = Math.min(this.queryResult.getNumRows(), from+count-1);
+//            int to = Math.min(this.queryResult.getNumRows(), from+count-1);
+            int to = from+count-1;
             if (to == 0) {
                 this.data = new ArrayList();                
             } else {
-                logger.debug(&quot;Retrieving query results: &quot;+from+&quot; - &quot;+to);
+                logger.debug(&quot;Retrieving query results: &quot;+from+&quot; - &quot;+to);                
                 try {
                     // Retrieve selected row interval
-                    Object[] objArray = database.more(this.queryResult, from, to);                
+                    Object[] objArray = database.more(from, to);                
                     logger.debug(&quot;Results retrieved. Count: &quot;+objArray.length);
                     // Create storage for the results
                     this.data = new ArrayList(objArray.length);
                     // Cast the results to the AuthorRecord objects
                     for (int i=0;i&lt;objArray.length;i++) {
-                        this.data.add((AuthorRecord)objArray[i]);
+                        this.data.add((Author)objArray[i]);
                     }
                 } catch (DBLayerException e) {
                     // Log and set error in case of an exception
@@ -315,7 +301,7 @@
      *  Notify observers about this change. This is used to load a form when editing authors.
      */
     public void loadAuthor() {
-        AuthorRecord selectedAuth = (AuthorRecord)data.get(this.getAuthorIndex());
+        Author selectedAuth = (Author)data.get(this.getAuthorIndex());
         this.setFirstName(selectedAuth.getFirstName());
         this.setSurname(selectedAuth.getSurname());
         this.setOrganization(selectedAuth.getOrganization());

Modified: trunk/src/net/sf/plantlore/client/authors/AuthorManagerCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/authors/AuthorManagerCtrl.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/authors/AuthorManagerCtrl.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -71,9 +71,9 @@
                     view.setDialogEnabled(true);    // Enable view dialog                
                     // Check for errors which might have occured. If none occured, tell model to process the result
                     if (model.processErrors() == false) {
-                        if (model.getResult().getNumRows() == 0) {
+//                        if (model.getResult().getNumRows() == 0) {
                             view.showSearchInfoMessage();
-                        }
+//                        }
                         model.setCurrentFirstRow(1);                                                    
                         // Display first n rows (n = model.getDisplayRows())                        
                         model.processResults(1, model.getDisplayRows());                        

Modified: trunk/src/net/sf/plantlore/client/authors/AuthorManagerView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/authors/AuthorManagerView.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/authors/AuthorManagerView.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -31,7 +31,7 @@
 import javax.swing.JScrollPane;
 import javax.swing.JTable;
 import javax.swing.table.DefaultTableModel;
-import net.sf.plantlore.common.record.AuthorRecord;
+import net.sf.plantlore.common.record.Author;
 
 /**
  *
@@ -462,12 +462,12 @@
         this.tableData = new String[results.size()][];
         for (int i=0;i&lt;results.size();i++) {            
             this.tableData[i] = new String[6];
-            this.tableData[i][0] = ((AuthorRecord)results.get(i)).getFirstName()+&quot; &quot;+((AuthorRecord)results.get(i)).getSurname();
-            this.tableData[i][1] = ((AuthorRecord)results.get(i)).getOrganization();
-            this.tableData[i][2] = ((AuthorRecord)results.get(i)).getRole();
-            this.tableData[i][3] = ((AuthorRecord)results.get(i)).getPhoneNumber();
-            this.tableData[i][4] = ((AuthorRecord)results.get(i)).getEmail();
-            this.tableData[i][5] = ((AuthorRecord)results.get(i)).getUrl();
+            this.tableData[i][0] = ((Author)results.get(i)).getFirstName()+&quot; &quot;+((Author)results.get(i)).getSurname();
+            this.tableData[i][1] = ((Author)results.get(i)).getOrganization();
+            this.tableData[i][2] = ((Author)results.get(i)).getRole();
+            this.tableData[i][3] = ((Author)results.get(i)).getPhoneNumber();
+            this.tableData[i][4] = ((Author)results.get(i)).getEmail();
+            this.tableData[i][5] = ((Author)results.get(i)).getUrl();
         }
         listTable.setModel(new DefaultTableModel(this.tableData, this.columnNames));       
         // Set total number of rows in the result

Deleted: trunk/src/net/sf/plantlore/client/dblayer/DBMapping.java
===================================================================
--- trunk/src/net/sf/plantlore/client/dblayer/DBMapping.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/dblayer/DBMapping.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -1,391 +0,0 @@
-/*
- * DBMapping.java
- *
- * Created on 15. leden 2006, 21:45
- *
- */
-
-package net.sf.plantlore.client.dblayer;
-
-import java.util.HashSet;
-import java.util.Hashtable;
-import org.apache.log4j.Logger;
-
-/**
- *  Class containing mapping of the database to the entities in the application. Not every entity is represented by a single table, therefore
- *  we need a mapping from entities to tables and columns. This class also contains list of entities (types) which can be used.
- *
- *  @author Tomas Kovarik
- *  @version 0.1, Jan 15, 2006
- */
-public class DBMapping {
-    /** Mapping of entities */
-    private Hashtable USER;
-    private Hashtable AUTHOR;
-    private Hashtable PLANT;
-    private Hashtable PUBLICATION;
-    private Hashtable METADATA;
-    private Hashtable HABITAT;
-    private Hashtable OCCURRENCE;  
-    private Hashtable HISTORY;
-    
-    public static final int USERRECORD = 1;
-    public static final int AUTHORRECORD = 2;
-    public static final int PLANTRECORD = 3;
-    public static final int PUBLICATIONRECORD = 4;
-    public static final int METADATARECORD = 5;
-    public static final int HABITATRECORD = 6;    
-    public static final int OCCURENCERECORD = 7;  
-    public static final int HISTORYRECORD = 8;
-    
-    /** List of tables for available entities*/
-    private String AUTHOR_TABLES = &quot;TAUTHORS&quot;;
-    private String USER_TABLES = &quot;TUSER, TRIGHT&quot;;
-    private String PLANT_TABLES = &quot;TPLANTS&quot;;
-    private String PUBLICATION_TABLES = &quot;TPUBLICATIONS&quot;;
-    private String METADATA_TABLES = &quot;TMETADATA&quot;;
-    private String HABITAT_TABLES = &quot;THABITATS, TVILLAGES, TPHYTOCHORIA, TTERRITORIES&quot;;
-    private String OCCURENCE_TABLES = &quot;TOCCURRENCES, TMETADATA, TPLANTS, TPUBLICATIONS, THABITATS, TUSER&quot;;
-    private String HISTORY_TABLES = &quot;THISTORY JOIN THISTORYCOLUMN JOIN THISTORYCHANGE ON (THISTORY.ccolumnid = THISTORYCOLUMN.cid) ON (THISTORY.cchangeid = THISTORYCHANGE.cid) &quot;;
-    
-    /** Instance of a logger */
-    private Logger logger;
-    
-    /**
-     * Create a new instance of DBMapping. Initialize mapping of entities.
-     */
-    public DBMapping() {
-        logger = Logger.getLogger(this.getClass().getPackage().getName());
-        initUser();
-        initAuthor();
-        initPlant();
-        initPublication();
-        initMetadata();
-        initHabitat();
-        initOccurrence();
-        initHistory();
-    }
-        
-    /**
-     *  Return list of the tables involved for the given type.
-     *
-     *  @param type type of the record (entity)
-     *  @return String representation of the tables, multiple tables are separated with a comma. Every table comes with an
-     *          alias equal to the table name
-     *  @throws DBLayerException in case no table is defined for the given type
-     */
-    public String getTableName(int type) throws DBLayerException {
-        switch (type) {
-            case USERRECORD:
-                return this.USER_TABLES;                
-            case AUTHORRECORD:
-                return this.AUTHOR_TABLES;                
-            case PLANTRECORD:
-                return this.PLANT_TABLES;                
-            case PUBLICATIONRECORD:
-                return this.PUBLICATION_TABLES;                
-            case METADATARECORD:
-                return this.METADATA_TABLES;                
-            case HABITATRECORD:
-                return this.HABITAT_TABLES;                
-            case OCCURENCERECORD:
-                return this.OCCURENCE_TABLES;  
-            case HISTORYRECORD:
-                return this.HISTORY_TABLES;
-            default:
-                logger.error(&quot;No table defined for type &quot;+type);
-                throw new DBLayerException(&quot;No table defined for type &quot;+type);                
-        }
-    }
-    
-    /**
-     *  Get the name of the database column represented by the given key in the mapping.
-     *
-     *  @param key  Key to look for in the mapping
-     *  @param type type of the record (entity)
-     *  @throws DBLayerException in case that wrong type is given or the specified key could not be found
-     */
-    public String getFieldName(String key, int type) throws DBLayerException {
-        String value;
-
-        switch (type) {
-            case USERRECORD:
-                value = getUserField(key);
-                break;
-            case AUTHORRECORD:
-                value = getAuthorField(key);
-                break;
-            case PLANTRECORD:
-                value = getPlantField(key);
-                break;
-            case PUBLICATIONRECORD:
-                value = getPublicationField(key);
-                break;
-            case METADATARECORD:
-                value = getMetadataField(key);
-                break;
-            case HABITATRECORD:
-                value = getHabitatField(key);
-                break;
-            case OCCURENCERECORD:
-                value = getOccurrenceField(key);
-                break;
-            case HISTORYRECORD:
-            	value = getHistoryField(key);
-            	break;
-            default:            
-                logger.error(&quot;No fields defined for type &quot;+type);
-                throw new DBLayerException(&quot;No fields defined for type &quot;+type);
-        }
-
-        if (value == null) {
-            logger.error(&quot;Key '&quot;+key+&quot;' not found in DB mapping for type &quot;+type);
-            throw new DBLayerException(&quot;Key '&quot;+key+&quot;' not found in DB mapping for type &quot;+type);
-        }
-        return value;
-    }
-    
-    /**
-     *  Get a specified field from user mapping.
-     *
-     *  @param key  String key representing a database column
-     *  @return     name of the database column. If the given key is not found &lt;code&gt;null&lt;/code&gt; is returned
-     */
-    private String getUserField(String key) {
-        if (USER.contains(key)) {
-            return (String)USER.get(key);
-        } else {
-            return null;
-        }
-    }
-    
-    /**
-     *  Get a specified field from author mapping.
-     *
-     *  @param key  String key representing a database column
-     *  @return     name of the database column. If the given key is not found &lt;code&gt;null&lt;/code&gt; is returned
-     */
-    private String getAuthorField(String key) {
-        if (AUTHOR.containsKey(key)) {
-            return (String)AUTHOR.get(key);
-        } else {
-            return null;
-        }
-    }
-    
-    /**
-     *  Get a specified field from plant mapping.
-     *
-     *  @param key  String key representing a database column
-     *  @return     name of the database column. If the given key is not found &lt;code&gt;null&lt;/code&gt; is returned
-     */
-    private String getPlantField(String key) {
-        if (PLANT.contains(key)) {
-            return (String)PLANT.get(key);
-        } else {
-            return null;
-        }
-    }
-    
-    /**
-     *  Get a specified field from publication mapping.
-     *
-     *  @param key  String key representing a database column
-     *  @return     name of the database column. If the given key is not found &lt;code&gt;null&lt;/code&gt; is returned
-     */
-    private String getPublicationField(String key) {
-        if (PUBLICATION.contains(key)) {
-            return (String)PUBLICATION.get(key);
-        } else {
-            return null;
-        }
-    }
-    
-    /**
-     *  Get a specified field from metadata mapping.
-     *
-     *  @param key  String key representing a database column
-     *  @return     name of the database column. If the given key is not found &lt;code&gt;null&lt;/code&gt; is returned
-     */
-    private String getMetadataField(String key) {
-        if (METADATA.contains(key)) {
-            return (String)METADATA.get(key);
-        } else {
-            return null;
-        }
-    }
-
-    /**
-     *  Get a specified field from habitat mapping.
-     *
-     *  @param key  String key representing a database column
-     *  @return     name of the database column. If the given key is not found &lt;code&gt;null&lt;/code&gt; is returned
-     */
-    private String getHabitatField(String key) {
-        if (HABITAT.contains(key)) {
-            return (String)HABITAT.get(key);
-        } else {
-            return null;
-        }
-    }
-
-    /**
-     *  Get a specified field from occurrence mapping.
-     *
-     *  @param key  String key representing a database column
-     *  @return     name of the database column. If the given key is not found &lt;code&gt;null&lt;/code&gt; is returned
-     */
-    private String getOccurrenceField(String key) {
-        if (OCCURRENCE.contains(key)) {
-            return (String)OCCURRENCE.get(key);
-        } else {
-            return null;
-        }
-    }
-
-    /**
-     *  Get a specified field from history mapping.
-     *
-     *  @param key  String key representing a database column
-     *  @return     name of the database column. If the given key is not found &lt;code&gt;null&lt;/code&gt; is returned
-     */
-    private String getHistoryField(String key) {       
-    	if (HISTORY.containsKey(key)) {
-    		System.out.println((String)HISTORY.get(key));
-            return (String)HISTORY.get(key);
-        } else {        	
-            return null;
-        }
-    }    
-    
-    /**
-     *  Initialization of the mapping of Users.
-     */
-    private void initUser() {
-        // Initialize USER hashtable
-        USER = new Hashtable(15);
-        USER.put(&quot;id&quot;, &quot;TUSER.CID&quot;);
-        USER.put(&quot;login&quot;, &quot;TUSER.CLOGIN&quot;);
-        USER.put(&quot;firstname&quot;, &quot;TUSER.CFIRSTNAME&quot;);
-        USER.put(&quot;surname&quot;, &quot;TUSER.CSURNAME&quot;);
-        USER.put(&quot;email&quot;, &quot;TUSER.CEMAIL&quot;);
-        USER.put(&quot;address&quot;, &quot;TUSER.CADDRESS&quot;);
-        USER.put(&quot;whencreated&quot;, &quot;TUSER.CWHENCREATE&quot;);
-        USER.put(&quot;whendropped&quot;, &quot;TUSER.CWHENDROP&quot;);
-        USER.put(&quot;export&quot;, &quot;TRIGHT.CEXPORT&quot;);
-        USER.put(&quot;import&quot;, &quot;TRIGHT.CIMPORT&quot;);
-        USER.put(&quot;role&quot;, &quot;TRIGHT.CROLE&quot;);
-        USER.put(&quot;note&quot;, &quot;CNOTE&quot;);
-    }
-    
-    /**
-     *  Initialization of the mapping of Authors.
-     */
-    private void initAuthor() {
-        AUTHOR = new Hashtable(15);
-        AUTHOR.put(&quot;id&quot;, &quot;TAUTHORS.CID&quot;);        
-        AUTHOR.put(&quot;firstname&quot;, &quot;TAUTHORS.CFIRSTNAME&quot;);
-        AUTHOR.put(&quot;surname&quot;, &quot;TAUTHORS.CSURNAME&quot;);
-        AUTHOR.put(&quot;wholename&quot;, &quot;TAUTHORS.CWHOLENAME&quot;);
-        AUTHOR.put(&quot;organization&quot;, &quot;TAUTHORS.CORGANIZATION&quot;);
-        AUTHOR.put(&quot;role&quot;, &quot;TAUTHORS.CROLE&quot;);
-        AUTHOR.put(&quot;address&quot;, &quot;TAUTHORS.CADDRESS&quot;);
-        AUTHOR.put(&quot;phonenumber&quot;, &quot;TAUTHORS.CPHONENUMBER&quot;);
-        AUTHOR.put(&quot;email&quot;, &quot;TAUTHORS.CEMAIL&quot;);
-        AUTHOR.put(&quot;url&quot;, &quot;TAUTHORS.CURL&quot;);
-        AUTHOR.put(&quot;note&quot;, &quot;TAUTHORS.CNOTE&quot;);
-    }
-    
-    /**
-     *  Initialization of the mapping of Plants.
-     */
-    private void initPlant() {
-        PLANT = new Hashtable(10);
-        PLANT.put(&quot;id&quot;, &quot;TPLANTS.CID&quot;);        
-        PLANT.put(&quot;adoptedname&quot;,&quot;TPLANTS.CADOPTEDNAME&quot;);
-        PLANT.put(&quot;czechname&quot;,&quot;TPLANTS.CCZECHNAME&quot;);
-        PLANT.put(&quot;publishablename&quot;,&quot;TPLANTS.CPUBLISHABLENAME&quot;);
-        PLANT.put(&quot;abbreviation&quot;,&quot;TPLANTS.CABBREVIATION&quot;);
-        PLANT.put(&quot;note&quot;,&quot;TPLANTS.CNOTE&quot;);
-    }
-    
-    /**
-     *  Initialization of the mapping of Publications.
-     */
-    private void initPublication() {
-        PUBLICATION = new Hashtable(10);
-        PUBLICATION.put(&quot;id&quot;, &quot;TPUBLICATIONS.CID&quot;);                
-        PUBLICATION.put(&quot;collectionname&quot;,&quot;TPUBLICATIONS.CCOLLECTIONNAME&quot;);
-        PUBLICATION.put(&quot;publicationyear&quot;,&quot;TPUBLICATIONS.CCOLLECTIONYEARPUBLICATION&quot;);
-        PUBLICATION.put(&quot;journalname&quot;,&quot;TPUBLICATIONS.CJOURNALNAME&quot;);
-        PUBLICATION.put(&quot;journalauthor&quot;,&quot;TPUBLICATIONS.CJOURNALAUTHORNAME&quot;);
-    }
-    
-    private void initMetadata() {
-        METADATA = new Hashtable(20);
-        METADATA.put(&quot;id&quot;,&quot;TMETADATA.CID&quot;);
-        METADATA.put(&quot;techcontactname&quot;,&quot;TMETADATA.CTECHNICALCONTACTNAME&quot;);
-        METADATA.put(&quot;techcontactemail&quot;,&quot;TMETADATA.CTECHNICALCONTACTEMAIL&quot;);
-        METADATA.put(&quot;techcontactaddress&quot;,&quot;TMETADATA.CTECHNICALCONTACTADDRESS&quot;);
-        METADATA.put(&quot;contentcontactname&quot;,&quot;TMETADATA.CCONTENTCONTACTNAME&quot;);
-        METADATA.put(&quot;contentcontactemail&quot;,&quot;TMETADATA.CCONTENTCONTACTEMAIL&quot;);
-        METADATA.put(&quot;contentcontactaddress&quot;,&quot;TMETADATA.CCONTENTCONTACTADDRESS&quot;);
-        METADATA.put(&quot;datasettitle&quot;,&quot;TMETADATA.CDATASETTITLE&quot;);
-        METADATA.put(&quot;datasetdetails&quot;,&quot;TMETADATA.CDATASETDETAILS&quot;);
-        METADATA.put(&quot;sourceinstitutionid&quot;,&quot;TMETADATA.CSOURCEINSTITUTIONID&quot;);
-        METADATA.put(&quot;sourceid&quot;,&quot;TMETADATA.CSOURCEID&quot;);
-        METADATA.put(&quot;ownerorganizationabbrev&quot;,&quot;TMETADATA.COWNERORGANIZATIONABBREV&quot;);
-        METADATA.put(&quot;datecreated&quot;,&quot;TMETADATA.CDATECREATE&quot;);
-        METADATA.put(&quot;datemodified&quot;,&quot;TMETADATA.CDATEMODIFIED&quot;);
-        METADATA.put(&quot;language&quot;,&quot;TMETADATA.CLANGUAGE&quot;);
-        METADATA.put(&quot;recordbasis&quot;,&quot;TMETADATA.CRECORDBASIS&quot;);
-    }
-    
-    private void initHabitat() {
-        HABITAT = new Hashtable(15);
-        HABITAT.put(&quot;id&quot;,&quot;THABITATS.CID&quot;);
-        HABITAT.put(&quot;quadrant&quot;,&quot;THABITATS.CQUADRANT&quot;);
-        HABITAT.put(&quot;description&quot;,&quot;THABITATS.CDESCRIPTION&quot;);
-        HABITAT.put(&quot;country&quot;,&quot;THABITATS.CCOUNTRY&quot;);
-        HABITAT.put(&quot;altitude&quot;,&quot;THABITATS.CALTITUDE&quot;);
-        HABITAT.put(&quot;latitude&quot;,&quot;THABITATS.CLATITUDE&quot;);
-        HABITAT.put(&quot;longitude&quot;,&quot;THABITATS.CLONGITUDE&quot;);
-        HABITAT.put(&quot;note&quot;,&quot;THABITATS.CNOTE&quot;);
-        HABITAT.put(&quot;village&quot;,&quot;TVILLAGES.CNAME&quot;);
-        HABITAT.put(&quot;phytochoriacode&quot;,&quot;TPHYTOCHORIA.CCODE&quot;);
-        HABITAT.put(&quot;phytochorianame&quot;,&quot;TPHYTOCHORIA.CNAME&quot;);
-        HABITAT.put(&quot;territoryname&quot;,&quot;TTERRITORIES.CNAME&quot;);
-    }
-    
-    private void initOccurrence() {
-        OCCURRENCE = new Hashtable(15);
-        OCCURRENCE.put(&quot;id&quot;,&quot;TOCCURRENCES.CID&quot;);
-        OCCURRENCE.put(&quot;unitiddb&quot;,&quot;TOCCURRENCES.CUNITIDDB&quot;);
-        OCCURRENCE.put(&quot;unitvalue&quot;,&quot;TOCCURRENCES.CUNITVALUE&quot;);
-        OCCURRENCE.put(&quot;year&quot;,&quot;TOCCURRENCES.CYEARCOLLECTED&quot;);
-        OCCURRENCE.put(&quot;month&quot;,&quot;TOCCURRENCES.CDAYCOLLECTED&quot;);
-        OCCURRENCE.put(&quot;time&quot;,&quot;TOCCURRENCES.CTIMECOLLECTED&quot;);
-        OCCURRENCE.put(&quot;isodatetimebegin&quot;,&quot;TOCCURRENCES.CISODATETIMEBEGIN&quot;);
-        OCCURRENCE.put(&quot;datesource&quot;,&quot;TOCCURRENCES.CDATESOURCE&quot;);
-        OCCURRENCE.put(&quot;herbarium&quot;,&quot;TOCCURRENCES.CHERBARIUM&quot;);
-        OCCURRENCE.put(&quot;createdwhen&quot;,&quot;TOCCURRENCES.CCREATEWHEN&quot;);
-        OCCURRENCE.put(&quot;createdwho&quot;,&quot;TOCCURRENCES.CCREATEWHO&quot;);
-        OCCURRENCE.put(&quot;updatedwhen&quot;,&quot;TOCCURRENCES.CUPDATEWHEN&quot;);
-        OCCURRENCE.put(&quot;updatedwho&quot;,&quot;TOCCURRENCES.CUPDATEWHO&quot;);
-        OCCURRENCE.put(&quot;note&quot;,&quot;TOCCURRENCES.CNOTE&quot;);                
-    }    
-    
-    private void initHistory() {
-    	HISTORY = new Hashtable(10);
-    	HISTORY.put(&quot;cid&quot;,&quot;THISOTRY.CID&quot;);
-    	HISTORY.put(&quot;oldValue&quot;,&quot;THISTORY.COLDVALUE&quot;);
-    	HISTORY.put(&quot;newValue&quot;,&quot;THISTORY.CNEWVALUE&quot;);
-    	HISTORY.put(&quot;tableName&quot;,&quot;THISTORYCOLUMN.CTABLENAME&quot;);
-    	HISTORY.put(&quot;columnName&quot;,&quot;THISTORYCOLUMN.CCOLUMNNAME&quot;);
-    	HISTORY.put(&quot;occurrenceId&quot;,&quot;THISTORYCHANGE.COCCURRENCEID&quot;);
-    	HISTORY.put(&quot;recordId&quot;,&quot;THISTORYCHANGE.CRECORDID&quot;);
-    	HISTORY.put(&quot;operation&quot;,&quot;THISTORYCHANGE.COPEREATION&quot;);
-    	HISTORY.put(&quot;when&quot;,&quot;THISTORYCHANGE.CWHEN&quot;);
-    	HISTORY.put(&quot;who&quot;,&quot;THISTORYCHANGE.CWHO&quot;);    	
-    }
-}

Modified: trunk/src/net/sf/plantlore/client/dblayer/FirebirdDBLayer.java
===================================================================
--- trunk/src/net/sf/plantlore/client/dblayer/FirebirdDBLayer.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/dblayer/FirebirdDBLayer.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -14,13 +14,14 @@
 import java.sql.SQLException;
 import java.sql.Statement;
 import java.util.Hashtable;
+import net.sf.plantlore.server.DBLayerException;
 import org.apache.log4j.Logger;
 import net.sf.plantlore.client.dblayer.result.*;
 import net.sf.plantlore.client.dblayer.query.*;
-import net.sf.plantlore.common.record.AuthorRecord;
-import net.sf.plantlore.common.record.PlantRecord;
-import net.sf.plantlore.common.record.PublicationRecord;
-import net.sf.plantlore.common.record.UserRecord;
+import net.sf.plantlore.common.record.Author;
+import net.sf.plantlore.common.record.Plant;
+import net.sf.plantlore.common.record.Publication;
+import net.sf.plantlore.common.record.User;
 
 
 /**
@@ -33,7 +34,7 @@
  * @author Tomas Kovarik
  * @version 0.1, 14.1. 2006
  */
-public class FirebirdDBLayer implements DBLayer {
+public class FirebirdDBLayer {
     /** Instance of a logger */
     private Logger logger;
     /** Address of the database server */
@@ -71,7 +72,7 @@
         // Initialize ResultSet pool
         this.results = new Hashtable();
     }
-    
+  
     /**
      * Opens the database connection using parameters specified when creating DBLayer object.
      *
@@ -103,6 +104,10 @@
     	throw new DBLayerException(&quot;Unknown query type.&quot;);
     }    
     
+    public Result executeQuery(InsertQuery query) throws DBLayerException {
+        return null;
+    }    
+    
     /**
      *  Executes SQL SELECT query.
      *
@@ -147,7 +152,7 @@
         Statement st;
         int numrows;
         
-        String sql = query.toSQL();
+/*        String sql = query.toSQL();
         try {
             // Execute query using DB connection
             st = this.conn.createStatement();
@@ -158,6 +163,8 @@
         }
         // Return query results
         return new QueryResult(0, numrows, 1, query.getType());
+ */
+        return null;
     }
     
     /**
@@ -288,7 +295,7 @@
         // Read data from the result according to the type of the result
         int type = QRes.getType();
         switch (type) {
-            case DBMapping.USERRECORD:          
+/*            case DBMapping.USERRECORD:          
                 return getUserRow(rs);
             case DBMapping.AUTHORRECORD:        
                 return getAuthorRow(rs);
@@ -298,6 +305,7 @@
                 return getPublicationRow(rs);                
             case DBMapping.OCCURENCERECORD:
                 return getOccurenceRow(rs);                                
+ */
             default:
                 return null;
         }
@@ -330,7 +338,8 @@
      *  @see        class UserRecord
      */
     private Object getUserRow(ResultSet rs) throws DBLayerException {
-        UserRecord ur = new UserRecord();
+        User ur = new User();
+/*        
         try {
             ur.setID(rs.getInt(1));
             ur.setLogin(rs.getString(2));
@@ -350,8 +359,9 @@
             logger.fatal(&quot;Database error occured&quot;);
             throw new DBLayerException(&quot;Database error occured&quot;);
         }
+ */
         return ur;
-    }
+     }
     
     /**
      *  Read information about the author from the ResultSet and store them into &lt;code&gt;AuthorRecord&lt;/code&gt; object
@@ -363,10 +373,10 @@
      *  @see        class AuthorRecord
      */
     private Object getAuthorRow(ResultSet rs) throws DBLayerException {
-        AuthorRecord ar = new AuthorRecord();
+        Author ar = new Author();
         
         try {
-            ar.setID(rs.getInt(1));
+            ar.setId(rs.getInt(1));
             ar.setFirstName(rs.getString(2));
             ar.setSurname(rs.getString(3));
             // CWHOLENAME from table TAUTHORS should be here, but we don't need it (TODO: Really?)
@@ -395,7 +405,8 @@
      *  @see        class PlantRecord
      */
     private Object getPlantRow(ResultSet rs) throws DBLayerException {
-        PlantRecord pr = new PlantRecord();
+        Plant pr = new Plant();
+/*        
         try {
             pr.setID(rs.getInt(1));
             pr.setAdoptedName(rs.getString(2));
@@ -407,7 +418,7 @@
             logger.fatal(&quot;Database error occured&quot;);
             throw new DBLayerException(&quot;Database error occured&quot;);
         }
-        
+*/        
         return pr;
     }
     
@@ -422,7 +433,8 @@
      *  @see        class PublicationRecord
      */
     private Object getPublicationRow(ResultSet rs) throws DBLayerException {
-        PublicationRecord pr = new PublicationRecord();
+        Publication pr = new Publication();
+/*        
         try {
             pr.setID(rs.getInt(1));
             pr.setCollectionName(rs.getString(2));
@@ -433,7 +445,7 @@
             logger.fatal(&quot;Database error occured&quot;);
             throw new DBLayerException(&quot;Database error occured&quot;);
         }
-        
+*/        
         return pr;
     }
     

Modified: trunk/src/net/sf/plantlore/client/dblayer/query/DeleteQuery.java
===================================================================
--- trunk/src/net/sf/plantlore/client/dblayer/query/DeleteQuery.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/dblayer/query/DeleteQuery.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -8,8 +8,7 @@
 package net.sf.plantlore.client.dblayer.query;
 
 import java.util.ArrayList;
-import net.sf.plantlore.client.dblayer.DBLayerException;
-import net.sf.plantlore.client.dblayer.DBMapping;
+import net.sf.plantlore.server.DBLayerException;
 import org.apache.log4j.Logger;
 
 /**
@@ -23,8 +22,6 @@
     private int type;
     /** List of triples for the WHERE part of the query */
     private ArrayList whereList;
-    /** Instance of DBMapping object */
-    private DBMapping dbmap;
     /** Instance of a logger */
     private Logger logger;
     
@@ -33,7 +30,7 @@
      */
     public DeleteQuery() {
         whereList = new ArrayList();
-        dbmap = new DBMapping();
+        // dbmap = new DBMapping();
         logger = Logger.getLogger(this.getClass().getPackage().getName());
     }
     
@@ -47,7 +44,7 @@
     public DeleteQuery(int type, ArrayList where) throws DBLayerException {
         this.whereList = where;
         setType(type);
-        dbmap = new DBMapping();
+        // dbmap = new DBMapping();
         logger = Logger.getLogger(this.getClass().getPackage().getName());
     }
     
@@ -98,6 +95,7 @@
         // Initialize StringBuffers
         sql = new StringBuffer();
         where = new StringBuffer();
+/*        
         // Get the name of the table from which we want to delete records
         from = dbmap.getTableName(this.type);
         // Construct the WHERE clasue
@@ -118,7 +116,7 @@
         sql.append(from);
         sql.append(&quot; WHERE &quot;);
         sql.append(where);
-        
+*/        
         logger.debug(sql.toString());
         return sql.toString();
     }

Modified: trunk/src/net/sf/plantlore/client/dblayer/query/InsertQuery.java
===================================================================
--- trunk/src/net/sf/plantlore/client/dblayer/query/InsertQuery.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/dblayer/query/InsertQuery.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -7,9 +7,9 @@
 
 package net.sf.plantlore.client.dblayer.query;
 
+import java.io.Serializable;
 import java.util.ArrayList;
-import net.sf.plantlore.client.dblayer.DBLayerException;
-import net.sf.plantlore.client.dblayer.DBMapping;
+import net.sf.plantlore.server.DBLayerException;
 import org.apache.log4j.Logger;
 
 /**
@@ -18,22 +18,19 @@
  * @author Tomas Kovarik
  * @versionm 0.1, Jan 15, 2006
  */
-public class InsertQuery implements Query {
+public class InsertQuery implements Serializable {
     /** Type of data we are working with. For the list of types see DBmapping class */
     private int type;
-    // Array of tuples containing the data we want to insert
-    private ArrayList data;
-    /** Instance of DBMapping object */
-    private DBMapping dbmap;
+    
+    private Object holder;
     /** Instance of a logger */
     private Logger logger;
     
     /**
-     * Create a new instance of InsertQuery. Initializes empty &lt;code&gt;data&lt;/code&gt; array.
+     * Create a new instance of InsertQuery.
      */
     public InsertQuery() {
-        data = new ArrayList();
-        dbmap = new DBMapping();
+        // dbmap = new DBMapping();
         logger = Logger.getLogger(this.getClass().getPackage().getName());
     }
     
@@ -44,23 +41,20 @@
      *  @param data     List of tuples containing values to insert
      *  @throws DBLayetException in case the given type was not found in the DBMapping class
      */
-    public InsertQuery(int type, ArrayList insertData) throws DBLayerException {
-        this.data = insertData;
+    public InsertQuery(int type, Object _holder) throws DBLayerException {
+        holder = _holder;
         setType(type);
-        dbmap = new DBMapping();
+        // dbmap = new DBMapping();
         logger = Logger.getLogger(this.getClass().getPackage().getName());
     }
     
-    /**
-     *  Add an item (tuple) to the list of values which will be inserted
-     *
-     *  @param field    name of the field (column)
-     *  @param value    value of the field (column)
-     */
-    public void addData(String field, String value) {
-        String[] tuple = {new String(field), new String(value) };
-        data.add(tuple);
+    public void setData(Object _holder) {
+        holder = _holder;
     }
+
+    public Object getData() {
+        return holder;
+    }
     
     /**
      *  Set the type of data we are working with. For the list of types see DBmapping class.
@@ -86,7 +80,7 @@
      *  @return String with the SQL query constructed from the data stored in the object
      *  @throws DBLayerException in case some part of the SQL query cannot be constructed
      */
-    public String toSQL() throws DBLayerException {
+/*    public String toSQL() throws DBLayerException {
         StringBuffer sql;
         StringBuffer insertFields;
         StringBuffer insertData;
@@ -128,8 +122,5 @@
         logger.debug(sql.toString());
         return sql.toString();
     }
-    
-    public void addOrderby(String field, String direction) { }        
-    
-    public void addWhere(String field, String operator, String value) { }
+*/    
 }

Modified: trunk/src/net/sf/plantlore/client/dblayer/query/Query.java
===================================================================
--- trunk/src/net/sf/plantlore/client/dblayer/query/Query.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/dblayer/query/Query.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -2,7 +2,7 @@
 
 import java.io.Serializable;
 
-import net.sf.plantlore.client.dblayer.DBLayerException;
+import net.sf.plantlore.server.DBLayerException;
 
 public interface Query extends Serializable {
 	

Modified: trunk/src/net/sf/plantlore/client/dblayer/query/SelectQuery.java
===================================================================
--- trunk/src/net/sf/plantlore/client/dblayer/query/SelectQuery.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/dblayer/query/SelectQuery.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -8,8 +8,7 @@
 package net.sf.plantlore.client.dblayer.query;
 
 import java.util.ArrayList;
-import net.sf.plantlore.client.dblayer.DBLayerException;
-import net.sf.plantlore.client.dblayer.DBMapping;
+import net.sf.plantlore.server.DBLayerException;
 import org.apache.log4j.Logger;
 
 /**
@@ -26,8 +25,6 @@
     /** List of tuples for the ORDER BY part of the query */
     private ArrayList orderbyList;
     /** Instance of DBMapping object */
-    private DBMapping dbmap;
-    /** Instance of a logger */
     private Logger logger;
     
     /**
@@ -36,7 +33,7 @@
     public SelectQuery() {
         this.whereList = new ArrayList();
         this.orderbyList = new ArrayList();
-        dbmap = new DBMapping();
+        // dbmap = new DBMapping();
         logger = Logger.getLogger(this.getClass().getPackage().getName());
     }
     
@@ -53,7 +50,7 @@
         this.whereList = where;
         this.orderbyList = orderby;
         setType(type);
-        dbmap = new DBMapping();
+        // dbmap = new DBMapping();
         logger = Logger.getLogger(this.getClass().getPackage().getName());
     }
     
@@ -112,10 +109,11 @@
         String fieldName;
         String[] triple;
         String[] tuple;
-        
+
         // Initialize StringBuffers
         where = new StringBuffer();
         sql = new StringBuffer();
+/*        
         orderby = new StringBuffer();
         // Get the table names we will be working with
         from = dbmap.getTableName(this.type);
@@ -155,9 +153,10 @@
             sql.append(&quot; &quot;);
             sql.append(orderby);
         }
-        
+*/        
         logger.debug(sql.toString());
         return sql.toString();
+
     }
     
     public void addData(String field, String value) { }

Modified: trunk/src/net/sf/plantlore/client/dblayer/query/UpdateQuery.java
===================================================================
--- trunk/src/net/sf/plantlore/client/dblayer/query/UpdateQuery.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/dblayer/query/UpdateQuery.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -8,8 +8,7 @@
 package net.sf.plantlore.client.dblayer.query;
 
 import java.util.ArrayList;
-import net.sf.plantlore.client.dblayer.DBLayerException;
-import net.sf.plantlore.client.dblayer.DBMapping;
+import net.sf.plantlore.server.DBLayerException;
 import org.apache.log4j.Logger;
 
 /**
@@ -25,8 +24,6 @@
     private ArrayList whereList;
     // Array of tuples containing the data we want to insert
     private ArrayList data;
-    /** Instance of DBMapping object */
-    private DBMapping dbmap;
     /** Instance of a logger */
     private Logger logger;
     
@@ -36,7 +33,7 @@
     public UpdateQuery() {
         whereList = new ArrayList();
         data = new ArrayList();
-        dbmap = new DBMapping();
+        // dbmap = new DBMapping();
         logger = Logger.getLogger(this.getClass().getPackage().getName());
         
     }
@@ -53,7 +50,7 @@
         this.whereList = where;
         this.data = updateData;
         setType(type);
-        dbmap = new DBMapping();
+        // dbmap = new DBMapping();
         logger = Logger.getLogger(this.getClass().getPackage().getName());
     }
     
@@ -116,6 +113,7 @@
         // Initialize StringBuffers
         where = new StringBuffer();
         sql = new StringBuffer();
+/*        
         update = new StringBuffer();
         // Get the name of the table we want to update
         table = dbmap.getTableName(this.type);
@@ -150,7 +148,7 @@
         sql.append(update);
         sql.append(&quot; &quot;);
         sql.append(where);
-        
+*/        
         logger.debug(sql.toString());
         return sql.toString();
     }

Modified: trunk/src/net/sf/plantlore/client/history/History.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/History.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/history/History.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -4,9 +4,8 @@
 package net.sf.plantlore.client.history;
 
 import java.util.Observable;
-import net.sf.plantlore.client.dblayer.DBLayer;
-import net.sf.plantlore.client.dblayer.DBLayerException;
-import net.sf.plantlore.client.dblayer.DBMapping;
+import net.sf.plantlore.server.DBLayer;
+import net.sf.plantlore.server.DBLayerException;
 import net.sf.plantlore.client.dblayer.query.Query;
 import net.sf.plantlore.client.dblayer.query.SelectQuery;
 import net.sf.plantlore.client.dblayer.result.Result;
@@ -86,7 +85,7 @@
     public void searchHistoryData(Integer idOccurrence)
     {
     	String idOcc = new String();
-    	
+/*    	
     	 // Create new Select query
         Query query = new SelectQuery();
         query.setType(DBMapping.HISTORYRECORD);
@@ -106,6 +105,7 @@
         	logger.debug(&quot;Searching history ends successfully&quot;);
             saveResult(result);                
         }      
+ */
     }
     
     /**
@@ -116,7 +116,7 @@
     	this.resultHistory = result;
     	int from = 0;
     	int to = result.getNumRows();
-    	
+/*    	
     	logger.debug(&quot;Retrieving query results.&quot;);
         try {
             // Retrieve selected row interval
@@ -130,7 +130,7 @@
             // Log and set error in case of an exception
             logger.error(&quot;Processing search results failed: &quot;+e.toString());            
         }
-    	
+  */  	
     }
     
     public Object[][] getData() {

Modified: trunk/src/net/sf/plantlore/client/history/HistoryView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/history/HistoryView.java	2006-03-24 22:27:26 UTC (rev 66)
+++ trunk/src/net/sf/plantlore/client/history/HistoryView.java	2006-03-24 22:29:27 UTC (rev 67)
@@ -26,7 +26,7 @@
 import javax.swing.JScrollPane;
 
 import net.sf.plantlore.common.ComponentAdjust;
-import net.sf.plantlore.common.record.OccurenceRecord;
+import net.sf.plantlore.common.record.Occurrence;
 import net.sf.plantlore.l10n.L10n;
 
 /**


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000061.html">[Plantlore-dev] r66 - trunk/src/net/sf/plantlore/server
</A></li>
	<LI>Next message: <A HREF="000063.html">[Plantlore-dev] r68 - trunk/src/net/sf/plantlore/server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62">[ date ]</a>
              <a href="thread.html#62">[ thread ]</a>
              <a href="subject.html#62">[ subject ]</a>
              <a href="author.html#62">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
