<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r49 - in trunk/src/biocase/DataproBioCASE: configuration/querytool/skins/plantlorePSWD www www/querytool
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-March/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r49%20-%20in%20trunk/src/biocase/DataproBioCASE%3A%20configuration/querytool/skins/plantlorePSWD%20www%20www/querytool&In-Reply-To=%3C200603131223.k2DCNdVe003172%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000036.html">
   <LINK REL="Next"  HREF="000038.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r49 - in trunk/src/biocase/DataproBioCASE: configuration/querytool/skins/plantlorePSWD www www/querytool</H1>
    <B>Lada at berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r49%20-%20in%20trunk/src/biocase/DataproBioCASE%3A%20configuration/querytool/skins/plantlorePSWD%20www%20www/querytool&In-Reply-To=%3C200603131223.k2DCNdVe003172%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r49 - in trunk/src/biocase/DataproBioCASE: configuration/querytool/skins/plantlorePSWD www www/querytool">Lada at berlios.de
       </A><BR>
    <I>Mon Mar 13 13:23:39 CET 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000036.html">[Plantlore-dev] r48 - trunk/src/net/sf/plantlore/l10n
</A></li>
        <LI>Next message: <A HREF="000038.html">[Plantlore-dev] Re: Zajem od Michal Bacak o brigadu prezentovane na JOBS.CZ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37">[ date ]</a>
              <a href="thread.html#37">[ thread ]</a>
              <a href="subject.html#37">[ subject ]</a>
              <a href="author.html#37">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: Lada
Date: 2006-03-13 13:23:37 +0100 (Mon, 13 Mar 2006)
New Revision: 49

Added:
   trunk/src/biocase/DataproBioCASE/www/index.cgi
   trunk/src/biocase/DataproBioCASE/www/indexBioCASEadmin.cgi
   trunk/src/biocase/DataproBioCASE/www/querytool/index.cgi
Modified:
   trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/ABCDRecordlist.xslt
   trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/details.html
   trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/form.html
   trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/grouping.html
   trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/recordlist.html
   trunk/src/biocase/DataproBioCASE/www/querytool/details.cgi
   trunk/src/biocase/DataproBioCASE/www/querytool/grouping.cgi
   trunk/src/biocase/DataproBioCASE/www/querytool/main.cgi
   trunk/src/biocase/DataproBioCASE/www/querytool/recordlist.cgi
Log:
Zmeny, aby se zobrazovala uvodni html stranka. Doladeni loginu.

Modified: trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/ABCDRecordlist.xslt
===================================================================
--- trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/ABCDRecordlist.xslt	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/ABCDRecordlist.xslt	2006-03-13 12:23:37 UTC (rev 49)
@@ -4,6 +4,7 @@
 	&lt;xsl:param name=&quot;wrapper_url&quot;/&gt;
 	&lt;xsl:param name=&quot;dsa&quot;/&gt;
 	&lt;xsl:param name=&quot;id&quot;/&gt;
+	&lt;xsl:param name=&quot;login&quot;/&gt;
 	&lt;xsl:template match=&quot;/&quot;&gt;
 					
 				
@@ -58,7 +59,7 @@
 											&lt;td&gt;
 												&lt;!-- to link to the unit details we have to use the SourceInstitutionCode + SourceName + UnitID as GUID. Also include the wrapper_url cause might be different from the dsa  --&gt;
 												&lt;a&gt;
-												&lt;xsl:attribute name=&quot;href&quot;&gt;details.cgi?dsa=&lt;xsl:value-of select=&quot;$dsa&quot;/&gt;&amp;id=&lt;xsl:value-of select=&quot;$id&quot;/&gt;&amp;wrapper_url=&lt;xsl:value-of select=&quot;$wrapper_url&quot;/&gt;&amp;detail=unit&amp;SourceInstitutionCode=&lt;xsl:value-of select=&quot;normalize-space(../../n1:OriginalSource/n1:SourceInstitutionCode)&quot;/&gt;&amp;SourceName=&lt;xsl:value-of select=&quot;normalize-space(../../n1:OriginalSource/n1:SourceName)&quot;/&gt;&amp;UnitID=&lt;xsl:value-of select=&quot;normalize-space(n1:UnitID)&quot;/&gt;&lt;/xsl:attribute&gt;
+												&lt;xsl:attribute name=&quot;href&quot;&gt;details.cgi?dsa=&lt;xsl:value-of select=&quot;$dsa&quot;/&gt;&amp;id=&lt;xsl:value-of select=&quot;$id&quot;/&gt;&amp;login=&lt;xsl:value-of select=&quot;$login&quot;/&gt;&amp;wrapper_url=&lt;xsl:value-of select=&quot;$wrapper_url&quot;/&gt;&amp;detail=unit&amp;SourceInstitutionCode=&lt;xsl:value-of select=&quot;normalize-space(../../n1:OriginalSource/n1:SourceInstitutionCode)&quot;/&gt;&amp;SourceName=&lt;xsl:value-of select=&quot;normalize-space(../../n1:OriginalSource/n1:SourceName)&quot;/&gt;&amp;UnitID=&lt;xsl:value-of select=&quot;normalize-space(n1:UnitID)&quot;/&gt;&lt;/xsl:attribute&gt;
 													&lt;xsl:for-each select=&quot;n1:UnitID&quot;&gt;
 														&lt;xsl:apply-templates/&gt;
 													&lt;/xsl:for-each&gt;

Modified: trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/details.html
===================================================================
--- trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/details.html	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/details.html	2006-03-13 12:23:37 UTC (rev 49)
@@ -27,6 +27,7 @@
   &lt;form name=&quot;recordlist&quot; method=&quot;post&quot; action=&quot;recordlist.cgi&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;dsa&quot; value=&quot;&lt;!--VAR:dsa--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;!--VAR:id--&gt;&quot;&gt;
+    &lt;input type=&quot;hidden&quot; name=&quot;login&quot; value=&quot;&lt;!--VAR:login--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;wrapper_url&quot; value=&quot;&lt;!--VAR:wrapper_url--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;schema&quot; value=&quot;&lt;!--VAR:schema--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;filter&quot; value=&quot;&lt;!--VAR:filter--&gt;&quot;&gt;

Modified: trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/form.html
===================================================================
--- trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/form.html	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/form.html	2006-03-13 12:23:37 UTC (rev 49)
@@ -17,6 +17,7 @@
   &lt;form action=&quot;grouping.cgi&quot; method=&quot;post&quot; name=&quot;query&quot;&gt;  
     &lt;input type=&quot;hidden&quot; name=&quot;dsa&quot; value=&quot;&lt;!--VAR:dsa--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;!--VAR:id--&gt;&quot;&gt;
+    &lt;input type=&quot;hidden&quot; name=&quot;login&quot; value=&quot;&lt;!--VAR:login--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;wrapper_url&quot; value=&quot;&lt;!--VAR:wrapper_url--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;schema&quot; value=&quot;&lt;!--VAR:schema--&gt;&quot;&gt;
     

Modified: trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/grouping.html
===================================================================
--- trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/grouping.html	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/grouping.html	2006-03-13 12:23:37 UTC (rev 49)
@@ -37,6 +37,7 @@
   &lt;form name=&quot;groupform&quot; method=&quot;post&quot; action=&quot;recordlist.cgi&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;dsa&quot; value=&quot;&lt;!--VAR:dsa--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;!--VAR:id--&gt;&quot;&gt;
+    &lt;input type=&quot;hidden&quot; name=&quot;login&quot; value=&quot;&lt;!--VAR:login--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;wrapper_url&quot; value=&quot;&lt;!--VAR:wrapper_url--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;filter&quot; value=&quot;&lt;!--VAR:filter--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;start&quot; value=&quot;0&quot;&gt;

Modified: trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/recordlist.html
===================================================================
--- trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/recordlist.html	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/configuration/querytool/skins/plantlorePSWD/recordlist.html	2006-03-13 12:23:37 UTC (rev 49)
@@ -45,6 +45,7 @@
   &lt;form name=&quot;recordlist&quot; method=&quot;post&quot; action=&quot;recordlist.cgi&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;dsa&quot; value=&quot;&lt;!--VAR:dsa--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;!--VAR:id--&gt;&quot;&gt;
+    &lt;input type=&quot;hidden&quot; name=&quot;login&quot; value=&quot;&lt;!--VAR:login--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;wrapper_url&quot; value=&quot;&lt;!--VAR:wrapper_url--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;schema&quot; value=&quot;&lt;!--VAR:schema--&gt;&quot;&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;filter&quot; value=&quot;&lt;!--VAR:filter--&gt;&quot;&gt;

Added: trunk/src/biocase/DataproBioCASE/www/index.cgi
===================================================================
--- trunk/src/biocase/DataproBioCASE/www/index.cgi	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/www/index.cgi	2006-03-13 12:23:37 UTC (rev 49)
@@ -0,0 +1,34 @@
+#!C:\PROGRA~1\Python23\python.exe
+# -*- coding: UTF-8 -*-
+
+import os, sys
+# ***** include the biocase.lib directory in the python sys path for module importing *****
+execfile( os.path.abspath(os.path.join(os.path.dirname( __file__ ), os.path.pardir, 'lib', 'biocase', 'adjustpath.py' ) ) )
+
+
+#Import some stuff-----------------------------------------
+import cgitb; cgitb.enable()
+import string
+#-----------------------------------------------------------------------------------------------------------
+import biocase.tools.templating
+import biocase.configuration
+
+
+
+# get config data
+cfg=biocase.configuration.Cfg()
+
+#------------------------------------------------------------------------------------
+
+pm = biocase.tools.templating.PageMacro('Content', biocase.tools.templating.PageMacro.KEEPMODE)
+pm.load('Content', os.path.join(cfg.wwwLocator, 'index.html'))
+
+#Print the headers	
+print 'Content-Type: text/html; charset=UTF-8'
+print # Blank line marking end of HTTP headers
+
+print pm
+
+    
+
+    

Added: trunk/src/biocase/DataproBioCASE/www/indexBioCASEadmin.cgi
===================================================================
--- trunk/src/biocase/DataproBioCASE/www/indexBioCASEadmin.cgi	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/www/indexBioCASEadmin.cgi	2006-03-13 12:23:37 UTC (rev 49)
@@ -0,0 +1,86 @@
+#!C:\PROGRA~1\Python23\python.exe
+# -*- coding: UTF-8 -*-
+
+'''
+$RCSfile: index.cgi,v $
+$Revision: 400 $
+$Author: markus $
+$Date: 2005-10-19 17:24:36 +0200 (Mi, 19 Okt 2005) $
+The deafult BioCASe provider software page
+'''
+
+
+import os, sys
+# ***** include the biocase.lib directory in the python sys path for module importing *****
+execfile( os.path.abspath(os.path.join(os.path.dirname( __file__ ), os.path.pardir, 'lib', 'biocase', 'adjustpath.py' ) ) )
+
+try:
+    #Import some stuff-----------------------------------------
+    import cgitb; cgitb.enable()
+    import string
+    #-----------------------------------------------------------------------------------------------------------
+    import biocase.tools.templating
+    import biocase.configuration
+    import biocase.datasources
+    from biocase import __version__
+    
+    
+    # get config data
+    cfg=biocase.configuration.Cfg()
+    
+    
+    #Transformaion of the metadata -----------------------------------------------------
+    xsl_path = os.path.join( cfg.xslLocator, 'service_metadata.xsl')
+    xml_path = os.path.join( cfg.configurationLocator, 'metadata.xml')
+    
+    
+    #Do the transformation of the biocase\configuration\pywrapper\metadata.xml file to HTML to present it
+    #If the necesary libraries are not installed then do not process the metadata and present a message inicating it.
+    
+    #try:
+    #	import libxml2
+    #	import libxslt
+    #
+    #	styledoc = libxml2.parseFile(xsl_path)
+    #	style = libxslt.parseStylesheetDoc(styledoc)
+    #	doc = libxml2.parseFile(xml_path)
+    #	result = style.applyStylesheet(doc, None)
+    #	metadata = style.saveResultToString(result)	# get the metadata transformed
+    #	service_name = doc.children.next.children.next.content
+    #	style.freeStylesheet()
+    #	doc.freeDoc()
+    #	result.freeDoc()
+    #	
+    #	
+    #except:
+    #	metadata = 'The metadata is not available, please check that you have the &lt;a href=&quot;utilities/testlibs.cgi&quot;&gt;libxml2 library&lt;/a&gt; installed in your system and that you have set up your metadata files.'
+    #	service_name = 'not available'	
+    service_name = 'BioCASe Provider Software 2'
+    metadata = ''
+    
+    #------------------------------------------------------------------------------------
+    
+    pm = biocase.tools.templating.PageMacro('Content', biocase.tools.templating.PageMacro.KEEPMODE)
+    pm.load('Content', os.path.join(cfg.wwwLocator, '_index.html'))
+    pm['ServiceTitle'] = service_name
+    pm['Metadata'] = metadata
+    pm['version']  = __version__
+    
+    #Now get the list of datasources available in the data provider
+    dsaListOfHash = [{'dsa':dsaObj.name} for dsaObj in biocase.datasources.getDsaList()]
+    pm.expand('Content', 'DataSourcesList', dsaListOfHash )
+    
+    
+    #Print the headers	
+    print 'Content-Type: text/html; charset=UTF-8'
+    print # Blank line marking end of HTTP headers
+    
+    print pm
+
+except ImportError:
+    # redirect to lib test page
+    print &quot;Location: utilities/testlibs.cgi&quot;
+    print
+    
+
+    

Modified: trunk/src/biocase/DataproBioCASE/www/querytool/details.cgi
===================================================================
--- trunk/src/biocase/DataproBioCASE/www/querytool/details.cgi	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/www/querytool/details.cgi	2006-03-13 12:23:37 UTC (rev 49)
@@ -38,60 +38,63 @@
 
 
 try:
-   # get the schema object being used
-   schemaObj = prefs.schemas[schema]
+    # get the schema object being used
+    schemaObj = prefs.schemas[schema]
 
-   # which detail do we need to create?
-   detail = form['detail'].value
-   detailObj = schemaObj.details[detail]
+    # which detail do we need to create?
+    detail = form['detail'].value
+    detailObj = schemaObj.details[detail]
+
+    debug + &quot;PREFS DETAILS OBJ: %s&quot;%unicode(str(detailObj), errors='replace')
+    
+    # build a new filter object from form values of the record identifiers
+    filterObj = AndClass()
+    for para, recID in detailObj.recID.items():
+        # create an equals cop for every recID
+        conObj = Concept(label=para, path=recID.path)
+        cop = EqualsClass(conObj, form.getfirst(para, None))
+        filterObj.addOperand(cop)
+    debug + &quot;FILTER OBJ: %s&quot;%unicode(str(filterObj), errors='replace')
+    
+    # generate the protocol
+    QG = QueryGenerator()
+    protocolXML = QG.getSearchProtocol(reqNS=schemaObj.NS, respNS=schemaObj.NS, count=False, filterObj=filterObj, destination=wrapper_url)
+    debug + &quot;QUERY PROTOCOL CREATED:\n%s&quot;%(protocolXML)
+    
+    # query the wrapper
+    QD = QueryDispatcher(debug)
+    recStatus = QD.sendQuery(wrapper_url, protocolXML, security_role=security_role)
+    content = QD.getContent()
+    diagnostics = QD.getDiagnostics()
+    
+    if content is None:
+        # no wrapper results found
+        debug + &quot;NO CONTENT ROOT FOUND.&quot;
+        stylesheetResult = detailObj.notAvailableMessage
+        debug.display = True
+    else:
+        debug + &quot;CONTENT ROOT %s&quot;%content.name
+        # apply stylesheet
+        stylesheetResult = transformXML(docDOM=content, xslLoc=os.path.join(templateDir, detailObj.stylesheet), debug=debug)
+    
+    # update template
+    tmpl['dsa'] = dsa
+    tmpl['id'] = MD5Passwd
+    tmpl['login'] = login
+    tmpl['schema'] = schema
+    tmpl['filter'] = str(filterObj)
+    tmpl['filter_display'] = str(filterObj).replace('_', ' ')
+    tmpl['XSL'] = stylesheetResult
+    if wrapper_url is not None:
+        tmpl['wrapper_url'] = wrapper_url
+    
+    #
+    # print HTML !
+    #
+    printOverHTTP( tmpl, debug, diagnostics )
+    
 except:
-   tmpl.load('Content', os.path.join(templateDir, 'error.html')) 
-   printOverHTTP( tmpl, debug, diagnostics )
-   sys.exit()
-
-debug + &quot;PREFS DETAILS OBJ: %s&quot;%unicode(str(detailObj), errors='replace')
-
-# build a new filter object from form values of the record identifiers
-filterObj = AndClass()
-for para, recID in detailObj.recID.items():
-    # create an equals cop for every recID
-    conObj = Concept(label=para, path=recID.path)
-    cop = EqualsClass(conObj, form.getfirst(para, None))
-    filterObj.addOperand(cop)
-debug + &quot;FILTER OBJ: %s&quot;%unicode(str(filterObj), errors='replace')
-
-# generate the protocol
-QG = QueryGenerator()
-protocolXML = QG.getSearchProtocol(reqNS=schemaObj.NS, respNS=schemaObj.NS, count=False, filterObj=filterObj, destination=wrapper_url)
-debug + &quot;QUERY PROTOCOL CREATED:\n%s&quot;%(protocolXML)
-
-# query the wrapper
-QD = QueryDispatcher(debug)
-recStatus = QD.sendQuery(wrapper_url, protocolXML, security_role=security_role)
-content = QD.getContent()
-diagnostics = QD.getDiagnostics()
-
-if content is None:
-    # no wrapper results found
-    debug + &quot;NO CONTENT ROOT FOUND.&quot;
-    stylesheetResult = detailObj.notAvailableMessage
-    debug.display = True
-else:
-    debug + &quot;CONTENT ROOT %s&quot;%content.name
-    # apply stylesheet
-    stylesheetResult = transformXML(docDOM=content, xslLoc=os.path.join(templateDir, detailObj.stylesheet), debug=debug)
-
-# update template
-tmpl['dsa'] = dsa
-tmpl['id'] = MD5Passwd
-tmpl['schema'] = schema
-tmpl['filter'] = str(filterObj)
-tmpl['filter_display'] = str(filterObj).replace('_', ' ')
-tmpl['XSL'] = stylesheetResult
-if wrapper_url is not None:
-    tmpl['wrapper_url'] = wrapper_url
-
-#
-# print HTML !
-#
-printOverHTTP( tmpl, debug, diagnostics )
+    tmpl.load('Content', os.path.join(templateDir, 'error.html')) 
+    printOverHTTP( tmpl, debug, diagnostics )
+    sys.exit()
+    

Modified: trunk/src/biocase/DataproBioCASE/www/querytool/grouping.cgi
===================================================================
--- trunk/src/biocase/DataproBioCASE/www/querytool/grouping.cgi	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/www/querytool/grouping.cgi	2006-03-13 12:23:37 UTC (rev 49)
@@ -34,53 +34,56 @@
 tmpl.load('Content', os.path.join(templateDir, 'grouping.html'))
 
 try:
-   # get the schema object being used
-   schemaObj = prefs.schemas[schema]
+    # get the schema object being used
+    schemaObj = prefs.schemas[schema]
+
+    # build a new filter object from form values
+    filterObj = createFilter(form, schemaObj)
+    debug + &quot;FILTER OBJ: %s&quot;%str(filterObj)
+    
+    # generate the protocol
+    QG = QueryGenerator()
+    groupConcept = form['groupby'].value
+    protocolXML = QG.getScanProtocol(concept=schemaObj.concepts[groupConcept].path, NS=schemaObj.NS, filterObj=filterObj)
+    debug + &quot;QUERY PROTOCOL CREATED:\n%s&quot;%escapeHtml(protocolXML)
+    
+    # update template
+    tmpl['dsa'] = dsa
+    tmpl['id'] = MD5Passwd
+    tmpl['login'] = login
+    tmpl['schema'] = schema
+    tmpl['limit'] = str(schemaObj.limit)
+    if filterObj is not None:
+        tmpl['filter'] = str(filterObj)
+    tmpl['filter_display'] = escapeHtml( str(filterObj).replace('_', ' ') )
+    tmpl['groupingCon'] = groupConcept
+    tmpl['groupby_options'] = getDropDownOptionHtml(vals=['---None---']+schemaObj.form, default='---None---')
+    if wrapper_url is not None:
+        tmpl['wrapper_url'] = wrapper_url
+    
+    # query the wrapper
+    QD = QueryDispatcher(debug)
+    recStatus = QD.sendQuery(wrapper_url, protocolXML, security_role=security_role)
+    if recStatus is None:
+    	# wrapper results:
+    	tmpl['hits'] = &quot;0&quot;
+    	debug.display = True
+    else:
+    	valuelist = QD.getScanValues()
+    	diagnostics = QD.getDiagnostics()
+    
+    	# wrapper results:
+    	tmpl['hits'] = str(recStatus.count)
+    	valueTemplateList = [{'val':v} for v in valuelist]
+    	tmpl.expand('Content', 'grouplist', valueTemplateList)
+    
+    #
+    # print HTML !
+    #
+    printOverHTTP( tmpl, debug, diagnostics )
 except:
-   tmpl.load('Content', os.path.join(templateDir, 'error.html')) 
-   printOverHTTP( tmpl, debug, diagnostics )
-   sys.exit()
+    tmpl.load('Content', os.path.join(templateDir, 'error.html')) 
+    printOverHTTP( tmpl, debug, diagnostics )
+    sys.exit()
 
-# build a new filter object from form values
-filterObj = createFilter(form, schemaObj)
-debug + &quot;FILTER OBJ: %s&quot;%str(filterObj)
-
-# generate the protocol
-QG = QueryGenerator()
-groupConcept = form['groupby'].value
-protocolXML = QG.getScanProtocol(concept=schemaObj.concepts[groupConcept].path, NS=schemaObj.NS, filterObj=filterObj)
-debug + &quot;QUERY PROTOCOL CREATED:\n%s&quot;%escapeHtml(protocolXML)
-
-# update template
-tmpl['dsa'] = dsa
-tmpl['id'] = MD5Passwd
-tmpl['schema'] = schema
-tmpl['limit'] = str(schemaObj.limit)
-if filterObj is not None:
-    tmpl['filter'] = str(filterObj)
-tmpl['filter_display'] = escapeHtml( str(filterObj).replace('_', ' ') )
-tmpl['groupingCon'] = groupConcept
-tmpl['groupby_options'] = getDropDownOptionHtml(vals=['---None---']+schemaObj.form, default='---None---')
-if wrapper_url is not None:
-    tmpl['wrapper_url'] = wrapper_url
-
-# query the wrapper
-QD = QueryDispatcher(debug)
-recStatus = QD.sendQuery(wrapper_url, protocolXML, security_role=security_role)
-if recStatus is None:
-	# wrapper results:
-	tmpl['hits'] = &quot;0&quot;
-	debug.display = True
-else:
-	valuelist = QD.getScanValues()
-	diagnostics = QD.getDiagnostics()
-
-	# wrapper results:
-	tmpl['hits'] = str(recStatus.count)
-	valueTemplateList = [{'val':v} for v in valuelist]
-	tmpl.expand('Content', 'grouplist', valueTemplateList)
-
-#
-# print HTML !
-#
-printOverHTTP( tmpl, debug, diagnostics )
+    

Added: trunk/src/biocase/DataproBioCASE/www/querytool/index.cgi
===================================================================
--- trunk/src/biocase/DataproBioCASE/www/querytool/index.cgi	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/www/querytool/index.cgi	2006-03-13 12:23:37 UTC (rev 49)
@@ -0,0 +1,24 @@
+#!C:\PROGRA~1\Python23\python.exe
+# -*- coding: UTF-8 -*-
+
+import os, sys
+# ***** include the biocase.lib directory in the python sys path for importing *****
+execfile( os.path.abspath( os.path.join( os.path.dirname( __file__ ), os.pardir, os.pardir, 'lib', 'biocase', 'adjustpath.py' ) ))
+
+from biocase.querytool.general import *
+from biocase.querytool.querydispatcher import QueryDispatcher
+from biocase.querytool.querygenerator import QueryGenerator
+
+
+############################################################################################################
+#
+#   MAIN
+#
+#===========================================================================================================
+
+
+tmpl = PageMacro('Content', PageMacro.DELMODE)
+tmpl.load('Content', os.path.join(plantloreDir, 'index.html')) 
+tmpl['dsa'] = 'plantlore'
+printOverHTTP( tmpl, debug, diagnostics )
+sys.exit()

Modified: trunk/src/biocase/DataproBioCASE/www/querytool/main.cgi
===================================================================
--- trunk/src/biocase/DataproBioCASE/www/querytool/main.cgi	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/www/querytool/main.cgi	2006-03-13 12:23:37 UTC (rev 49)
@@ -43,6 +43,7 @@
     tmpl['wrapper_url'] = wrapper_url
     tmpl['dsa'] = dsa
     tmpl['id'] = MD5Passwd
+    tmpl['login'] = login
     tmpl['schema'] = schema
     # get the relevant form fields from preferences
     concepts = []

Modified: trunk/src/biocase/DataproBioCASE/www/querytool/recordlist.cgi
===================================================================
--- trunk/src/biocase/DataproBioCASE/www/querytool/recordlist.cgi	2006-03-12 20:16:08 UTC (rev 48)
+++ trunk/src/biocase/DataproBioCASE/www/querytool/recordlist.cgi	2006-03-13 12:23:37 UTC (rev 49)
@@ -46,103 +46,106 @@
 tmpl.load('Content', os.path.join(templateDir, 'recordlist.html'))
 
 try:
-   # get the schema object being used
-   schemaObj = prefs.schemas[schema]
+    # get the schema object being used
+    schemaObj = prefs.schemas[schema]
+    
+    # build a new filter object from form values
+    filterObj = createFilter(form, schemaObj)
+    debug + &quot;FILTER OBJ: %s&quot;%unicode(filterObj)
+    
+    # process paging history and set new start/limit values
+    limit = schemaObj.limit
+    start = int( form['start'].value )
+    if form.has_key('history'):
+        history = string.split(form['history'].value, ',')
+        thisPagingIndex = len(history)+1
+    else:
+        history = []
+        thisPagingIndex = 1
+    
+    # update template
+    tmpl['dsa'] = dsa
+    tmpl['id'] = MD5Passwd
+    tmpl['login'] = login
+    tmpl['schema'] = schema
+    tmpl['filter'] = str(filterObj)
+    tmpl['filter_display'] = escapeHtml( str(filterObj).replace('_', ' ') )
+    if wrapper_url is not None:
+        tmpl['wrapper_url'] = wrapper_url
+    
+    # generate the protocol
+    QG = QueryGenerator()
+    protocolXML = QG.getSearchProtocol(reqNS=schemaObj.NS, respNS=schemaObj.NS, start=start, limit=limit, count=False, filterObj=filterObj)
+    debug + &quot;QUERY PROTOCOL CREATED:\n%s&quot;%(protocolXML)
+    
+    # query the wrapper
+    QD = QueryDispatcher(debug)
+    recStatus = QD.sendQuery(wrapper_url, protocolXML, security_role=security_role)
+    if recStatus is None:
+    	# wrapper error occured !!!
+    	debug.display = True
+    	printOverHTTP( tmpl, debug, diagnostics )
+    	sys.exit()
+    content = QD.getContent()
+    diagnostics = QD.getDiagnostics()
+    
+    
+    #
+    # calculate new paging indices, history etc
+    #
+    # new/next start index
+    nextIndex = recStatus.start + recStatus.count + recStatus.drop
+    nextNum = ''
+    pagingList1 = []
+    pagingList2 = []
+    i = 1
+    for h in history:
+        if int(h) &lt; recStatus.start:
+            pagingDict={}
+            pagingDict['label_num1']=str(i)
+            pagingDict['start_index1']=str(h)
+            pagingList1.append(pagingDict)
+        elif int(h) == recStatus.start:
+            thisPagingIndex = i
+        else:
+            pagingDict={}
+            pagingDict['label_num2']=str(i)
+            pagingDict['start_index2']=str(h)
+            pagingList2.append(pagingDict)
+        i += 1
+    # next button
+    if recStatus.total &gt; nextIndex:
+        # there are more records in the DB. Provide paging to next
+        nextNum = 'next'
+    
+    # append history list if needed
+    if len(history)==0 or int(max(history)) &lt; int(start):
+        history.append(start)
+    
+    # apply stylesheet
+    paras = {'dsa':dsa, 'wrapper_url':wrapper_url, 'id':MD5Passwd, 'login':login}
+    stylesheetResult = transformXML(docDOM=content, xslLoc=os.path.join(templateDir, schemaObj.reclistXSL), paras=paras, debug=debug)
+    
+    # update template with wrapper results
+    tmpl['result_start'] = str(recStatus.start+1)
+    tmpl['result_ende'] = str(nextIndex)
+    tmpl['result_count'] = str(recStatus.count)
+    tmpl['history'] = string.join([str(h) for h in history], ',')
+    tmpl['XSL'] = stylesheetResult
+    # paging
+    tmpl.expand('Content', 'paging_list1', pagingList1)
+    tmpl['num_this'] = str( thisPagingIndex )
+    tmpl.expand('Content', 'paging_list2', pagingList2)
+    tmpl['next_start'] = str(nextIndex)
+    tmpl['next_num'] = nextNum
+    
+    #
+    # print HTML !
+    #
+    printOverHTTP( tmpl, debug, diagnostics )
+    
 except:
-   tmpl.load('Content', os.path.join(templateDir, 'error.html')) 
-   printOverHTTP( tmpl, debug, diagnostics )
-   sys.exit()
-
-# build a new filter object from form values
-filterObj = createFilter(form, schemaObj)
-debug + &quot;FILTER OBJ: %s&quot;%unicode(filterObj)
-
-# process paging history and set new start/limit values
-limit = schemaObj.limit
-start = int( form['start'].value )
-if form.has_key('history'):
-    history = string.split(form['history'].value, ',')
-    thisPagingIndex = len(history)+1
-else:
-    history = []
-    thisPagingIndex = 1
-
-# update template
-tmpl['dsa'] = dsa
-tmpl['id'] = MD5Passwd
-tmpl['schema'] = schema
-tmpl['filter'] = str(filterObj)
-tmpl['filter_display'] = escapeHtml( str(filterObj).replace('_', ' ') )
-if wrapper_url is not None:
-    tmpl['wrapper_url'] = wrapper_url
-
-# generate the protocol
-QG = QueryGenerator()
-protocolXML = QG.getSearchProtocol(reqNS=schemaObj.NS, respNS=schemaObj.NS, start=start, limit=limit, count=False, filterObj=filterObj)
-debug + &quot;QUERY PROTOCOL CREATED:\n%s&quot;%(protocolXML)
-
-# query the wrapper
-QD = QueryDispatcher(debug)
-recStatus = QD.sendQuery(wrapper_url, protocolXML, security_role=security_role)
-if recStatus is None:
-	# wrapper error occured !!!
-	debug.display = True
-	printOverHTTP( tmpl, debug, diagnostics )
-	sys.exit()
-content = QD.getContent()
-diagnostics = QD.getDiagnostics()
-
-
-#
-# calculate new paging indices, history etc
-#
-# new/next start index
-nextIndex = recStatus.start + recStatus.count + recStatus.drop
-nextNum = ''
-pagingList1 = []
-pagingList2 = []
-i = 1
-for h in history:
-    if int(h) &lt; recStatus.start:
-        pagingDict={}
-        pagingDict['label_num1']=str(i)
-        pagingDict['start_index1']=str(h)
-        pagingList1.append(pagingDict)
-    elif int(h) == recStatus.start:
-        thisPagingIndex = i
-    else:
-        pagingDict={}
-        pagingDict['label_num2']=str(i)
-        pagingDict['start_index2']=str(h)
-        pagingList2.append(pagingDict)
-    i += 1
-# next button
-if recStatus.total &gt; nextIndex:
-    # there are more records in the DB. Provide paging to next
-    nextNum = 'next'
-
-# append history list if needed
-if len(history)==0 or int(max(history)) &lt; int(start):
-    history.append(start)
-
-# apply stylesheet
-paras = {'dsa':dsa, 'wrapper_url':wrapper_url, 'id':MD5Passwd}
-stylesheetResult = transformXML(docDOM=content, xslLoc=os.path.join(templateDir, schemaObj.reclistXSL), paras=paras, debug=debug)
-
-# update template with wrapper results
-tmpl['result_start'] = str(recStatus.start+1)
-tmpl['result_ende'] = str(nextIndex)
-tmpl['result_count'] = str(recStatus.count)
-tmpl['history'] = string.join([str(h) for h in history], ',')
-tmpl['XSL'] = stylesheetResult
-# paging
-tmpl.expand('Content', 'paging_list1', pagingList1)
-tmpl['num_this'] = str( thisPagingIndex )
-tmpl.expand('Content', 'paging_list2', pagingList2)
-tmpl['next_start'] = str(nextIndex)
-tmpl['next_num'] = nextNum
-
-#
-# print HTML !
-#
-printOverHTTP( tmpl, debug, diagnostics )
+    tmpl.load('Content', os.path.join(templateDir, 'error.html')) 
+    printOverHTTP( tmpl, debug, diagnostics )
+    sys.exit()
+        


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000036.html">[Plantlore-dev] r48 - trunk/src/net/sf/plantlore/l10n
</A></li>
	<LI>Next message: <A HREF="000038.html">[Plantlore-dev] Re: Zajem od Michal Bacak o brigadu prezentovane na JOBS.CZ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37">[ date ]</a>
              <a href="thread.html#37">[ thread ]</a>
              <a href="subject.html#37">[ subject ]</a>
              <a href="author.html#37">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
