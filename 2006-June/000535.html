<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plantlore-dev] r428 - in trunk/src/net/sf/plantlore: client client/login common/record l10n middleware server server/manager
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plantlore-dev/2006-June/index.html" >
   <LINK REL="made" HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r428%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%20client/login%20common/record%20l10n%20middleware%20server%20server/manager&In-Reply-To=%3C200606031648.k53GmWlN015947%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000534.html">
   <LINK REL="Next"  HREF="000536.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plantlore-dev] r428 - in trunk/src/net/sf/plantlore: client client/login common/record l10n middleware server server/manager</H1>
    <B>krater at berlios.de</B> 
    <A HREF="mailto:plantlore-dev%40lists.berlios.de?Subject=Re%3A%20%5BPlantlore-dev%5D%20r428%20-%20in%20trunk/src/net/sf/plantlore%3A%20client%20client/login%20common/record%20l10n%20middleware%20server%20server/manager&In-Reply-To=%3C200606031648.k53GmWlN015947%40sheep.berlios.de%3E"
       TITLE="[Plantlore-dev] r428 - in trunk/src/net/sf/plantlore: client client/login common/record l10n middleware server server/manager">krater at berlios.de
       </A><BR>
    <I>Sat Jun  3 18:48:32 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000534.html">[Plantlore-dev] Stav veci na serveru
</A></li>
        <LI>Next message: <A HREF="000536.html">[Plantlore-dev] r429 - trunk/src/net/sf/plantlore/common
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#535">[ date ]</a>
              <a href="thread.html#535">[ thread ]</a>
              <a href="subject.html#535">[ subject ]</a>
              <a href="author.html#535">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: krater
Date: 2006-06-03 18:48:24 +0200 (Sat, 03 Jun 2006)
New Revision: 428

Added:
   trunk/src/net/sf/plantlore/server/DatabaseSettings.java
   trunk/src/net/sf/plantlore/server/ServerSettings.java
   trunk/src/net/sf/plantlore/server/manager/ServerCreateCtrl.java
   trunk/src/net/sf/plantlore/server/manager/ServerCreateView.form
   trunk/src/net/sf/plantlore/server/manager/ServerCreateView.java
Modified:
   trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
   trunk/src/net/sf/plantlore/client/MainConfig.java
   trunk/src/net/sf/plantlore/client/login/AuthCtrl.java
   trunk/src/net/sf/plantlore/client/login/AuthView.java
   trunk/src/net/sf/plantlore/client/login/DBInfo.java
   trunk/src/net/sf/plantlore/client/login/ItemCtrl.java
   trunk/src/net/sf/plantlore/client/login/ItemView.form
   trunk/src/net/sf/plantlore/client/login/ItemView.java
   trunk/src/net/sf/plantlore/client/login/Login.java
   trunk/src/net/sf/plantlore/client/login/LoginCtrl.java
   trunk/src/net/sf/plantlore/client/login/LoginView.java
   trunk/src/net/sf/plantlore/common/record/Record.java
   trunk/src/net/sf/plantlore/l10n/Plantlore.properties
   trunk/src/net/sf/plantlore/middleware/DBLayer.java
   trunk/src/net/sf/plantlore/middleware/DBLayerFactory.java
   trunk/src/net/sf/plantlore/middleware/RMIDBLayerFactory.java
   trunk/src/net/sf/plantlore/server/HibernateDBLayer.java
   trunk/src/net/sf/plantlore/server/Plantlore.java
   trunk/src/net/sf/plantlore/server/RMIRemoteDBLayerFactory.java
   trunk/src/net/sf/plantlore/server/RMIServer.java
   trunk/src/net/sf/plantlore/server/RMIServerControl.java
   trunk/src/net/sf/plantlore/server/Server.java
   trunk/src/net/sf/plantlore/server/manager/ServerLoginCtrl.java
   trunk/src/net/sf/plantlore/server/manager/ServerLoginView.form
   trunk/src/net/sf/plantlore/server/manager/ServerLoginView.java
   trunk/src/net/sf/plantlore/server/manager/ServerMng.java
   trunk/src/net/sf/plantlore/server/manager/ServerMngCtrl.java
   trunk/src/net/sf/plantlore/server/manager/ServerMngView.form
   trunk/src/net/sf/plantlore/server/manager/ServerMngView.java
Log:
The moment everyone was waiting for has come. The server is here! :)

Login. A little bit modified, still freezes when an JOptionPane.showMessage() is called. This remains to be solved (although I tried to do all changes to the GUI make in the Event Dispatch Thread). Another thing that is yet to be fixed is that ItemAdd/Edit dialog is displayed incorrectly (columns have wrong sizes).

MaingConfig. Uses the new format of connection information (also known as the infamous triplets) - now referred to as DBInfo.

Middleware.DBLF&amp;RMIDBLF. Modified to use the DBInfo instead of bunch of parameters. Much more flexible!

HibernateDBLayer. Uses different information to connect to the database (using the DatabaseSettings) and to perform the login of the plantlore user.

Server. Updated. Uses EDT to make changes to the GUI, L10n, logging, extended server settings and database settings. Dialogs need to be properly tested (the server as well).


It is higly likely you will have to create your DBInfo from scratch (the previous format is longer valid). I advise you to delete &quot;$HOME/plantlore/plantlore.xml&quot; and create DBInfo using the form Add/Edit (accessible via right click in the Select Database dialog). Also please note that the Authentication dialog requires you to insert the &quot;plantlore-login&quot; (krater, *****) instead of the database engine login (sysdba, masterkey).

Modified: trunk/src/net/sf/plantlore/client/AppCoreCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/AppCoreCtrl.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -1062,10 +1062,9 @@
                 if(loginModel == null) {
                 	loginModel = new Login(new RMIDBLayerFactory(), model.getMainConfig());
                 	loginModel.addObserver(new DatabaseChange());
+                	loginView = new LoginView(loginModel);
+                	loginCtrl = new LoginCtrl(loginModel, loginView);
                 }
-                if(loginView == null) loginView = new LoginView(loginModel);
-                if(loginCtrl == null) loginCtrl = new LoginCtrl(loginModel, loginView);
-                
                 loginCtrl.setVisible(true);
         }
     }

Modified: trunk/src/net/sf/plantlore/client/MainConfig.java
===================================================================
--- trunk/src/net/sf/plantlore/client/MainConfig.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/MainConfig.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -17,6 +17,8 @@
 import java.util.Iterator;
 import java.util.List;
 import net.sf.plantlore.client.login.DBInfo;
+import net.sf.plantlore.server.RMIServer;
+
 import org.apache.log4j.Logger;
 import org.dom4j.Document;
 import org.dom4j.DocumentException;
@@ -94,31 +96,72 @@
     }
     
     public ArrayList&lt;DBInfo&gt; getDBinfos() {
-        ArrayList&lt;DBInfo&gt; result = new ArrayList&lt;DBInfo&gt;();
-
-        List columnList = document.selectNodes(&quot;//config/login/triplet&quot;);
-        Iterator it = columnList.iterator();
-        while (it.hasNext()) {
-            Node n = (Node)it.next();
-            String alias = n.valueOf(&quot;alias&quot;),
-                    host = n.valueOf(&quot;host&quot;),
-                    database = n.valueOf(&quot;database&quot;);
-            Number port = n.numberValueOf(&quot;port&quot;);
-
-            List userList = n.selectNodes(&quot;user&quot;);
-            String[] users = new String[userList.size()];
-            Node user = null;
-            Iterator it2 = userList.iterator(); int i = 0;
-            while (it2.hasNext()) {
-                user = (Node) it2.next();
-                users[i] = user.getText();
-                i++;
-            }
-                        
-            DBInfo dbi = new DBInfo(alias,host,port.intValue(),database,users);
-            result.add(dbi);
-        }
-        return result;
+    	ArrayList&lt;DBInfo&gt; result = new ArrayList&lt;DBInfo&gt;();
+    	
+    	String alias, host, databaseType, databaseIdentifier, 
+    	databaseParameter, masterUser, masterPassword;
+    	String[] users;
+    	int port, databasePort;
+    	
+    	int unnamedDatabase = 0;
+    	
+    	List columnList = document.selectNodes(&quot;//config/login/triplet&quot;);
+    	Iterator it = columnList.iterator();
+    	while (it.hasNext()) {
+    		
+    		alias = host = databaseType = databaseIdentifier = 
+    			databaseParameter = masterUser = masterPassword = &quot;&quot;;
+    		port = RMIServer.DEFAULT_PORT; databasePort = -1;
+    		
+    		Node n = (Node)it.next();
+    		// Obtain the basic characteristic.
+    		alias = n.valueOf(&quot;alias&quot;);
+    		host = n.valueOf(&quot;host&quot;);
+    		Number portNumber = n.numberValueOf(&quot;port&quot;);
+    		port = ( portNumber == null ? RMIServer.DEFAULT_PORT : portNumber.intValue() );
+    		
+    		// The database info.
+    		Node database = (Node) n.selectSingleNode(&quot;database&quot;);
+    		if(database != null) {
+    			databaseType = database.valueOf(&quot;engine&quot;);
+    			databaseIdentifier = database.valueOf(&quot;identifier&quot;);
+    			Number databasePortNumber = database.numberValueOf(&quot;port&quot;);
+    			databasePort = ( databasePortNumber == null ? -1 : databasePortNumber.intValue() );
+    			databaseParameter = database.valueOf(&quot;parameter&quot;);
+    			masterUser = database.valueOf(&quot;masteruser&quot;);
+    			masterPassword = database.valueOf(&quot;masterpassword&quot;);
+    		}
+    		else
+    			continue; // incomplete record (databaseType, databasePort, databaseIdentifier are obligatory).
+    		
+    		if(databasePort &lt; 0)
+    			continue; // corrupted record (databasePort is obligatory).
+    		
+    		if(alias == null || alias.length() == 0) {
+    			unnamedDatabase++;
+    			alias = &quot;Database &quot; + unnamedDatabase;
+    		}
+    		
+    		// The list of stored users. 
+    		List userList = n.selectNodes(&quot;user&quot;);
+    		users = new String[userList.size()];
+    		Node user = null;
+    		Iterator it2 = userList.iterator(); int i = 0;
+    		while (it2.hasNext()) {
+    			user = (Node) it2.next();
+    			users[i] = user.getText();
+    			i++;
+    		}
+    		
+    		// Create a new DBInfo ~ triplet.
+    		DBInfo dbi = new DBInfo(
+    				alias, host, port, 
+    				databaseType, databasePort, databaseIdentifier, databaseParameter, 
+    				users, masterUser, masterPassword );
+    		
+    		result.add(dbi);
+    	}
+    	return result;
     }
     
     public void setColumns(ArrayList&lt;Column&gt; columns) {
@@ -158,14 +201,32 @@
         
         for (int i = 0; i &lt; dbinfos.size(); i++) {
             DBInfo dbi = dbinfos.get(i);
+            
+            // Server settings.
             Element triplet = login.addElement(&quot;triplet&quot;);
             if (dbi.getAlias() != null)
                 triplet.addElement(&quot;alias&quot;).setText(dbi.getAlias());
             if (dbi.getHost() != null)
                 triplet.addElement(&quot;host&quot;).setText(dbi.getHost());
-            if (dbi.getDb() != null)
-                triplet.addElement(&quot;database&quot;).setText(dbi.getDb());
-            triplet.addElement(&quot;port&quot;).setText(&quot;&quot;+dbi.getPort());
+            if(dbi.getPort() &gt; 0)
+            	triplet.addElement(&quot;port&quot;).setText(&quot;&quot; + dbi.getPort());
+            
+            // Database settings.
+            Element database = triplet.addElement(&quot;database&quot;);
+            if (dbi.getDatabaseType() != null)
+                database.addElement(&quot;engine&quot;).setText(dbi.getDatabaseType());
+            if(dbi.getDatabaseIdentifier() != null)
+            	database.addElement(&quot;identifier&quot;).setText(dbi.getDatabaseIdentifier());
+            if(dbi.getDatabasePort() &gt; 0)
+            	database.addElement(&quot;port&quot;).setText(&quot;&quot; + dbi.getDatabasePort());
+            if(dbi.getDatabaseParameter() != null)
+            	database.addElement(&quot;parameter&quot;).setText(dbi.getDatabaseParameter());
+            if(dbi.getMasterUser() != null)
+            	database.addElement(&quot;masteruser&quot;).setText(dbi.getMasterUser());
+            if(dbi.getMasterPassword() != null)
+            	database.addElement(&quot;masterpassword&quot;).setText(dbi.getMasterPassword());
+            
+            // Regular users of the database.
             String[] usrs = dbi.getUsers();
             for (int u = 0; u &lt; usrs.length; u++) {
                 if (usrs[u] != null)

Modified: trunk/src/net/sf/plantlore/client/login/AuthCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/AuthCtrl.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/login/AuthCtrl.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -4,7 +4,6 @@
 import java.awt.event.ActionEvent;
 
 import javax.swing.AbstractAction;
-import javax.swing.JOptionPane;
 
 import net.sf.plantlore.l10n.L10n;
 
@@ -29,14 +28,8 @@
 			view.next.setEnabled(false);
 			view.setCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));
 			String user = (view.user.getSelectedItem() != null) ? view.user.getSelectedItem().toString() : null;
-			if(user != null)
-				model.connectToSelected(user, new String(view.password.getPassword()));
-			else 
-				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;Error.MissingUsername&quot;),
-						L10n.getString(&quot;Error.Missing&quot;),
-						JOptionPane.WARNING_MESSAGE);
-			
+
+			model.connectToSelected(user, new String(view.password.getPassword()));
 		}
 	}
 

Modified: trunk/src/net/sf/plantlore/client/login/AuthView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/AuthView.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/login/AuthView.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -22,11 +22,8 @@
  */
 public class AuthView extends javax.swing.JDialog implements Observer {
 	
-	private Login model;
-    
     /** Creates new form AuthView */
     public AuthView(Login model) {
-    	this.model = model;
     	model.addObserver(this);
         initComponents();
         getRootPane().setDefaultButton(next);
@@ -113,32 +110,36 @@
     /**
      * Reload the list of usernames according to the currently selected record.
      */
-    public void update(Observable source, Object arg) {
-    	if(arg == null || arg instanceof DBInfo) {
-    		DBInfo selected = model.getSelected();
-    		if(selected == null) return;
-    		user.removeAllItems();
-    		((AutoComboBox)user).addItems(selected.users);
-    		password.setText(&quot;&quot;);
-    		setTitle(L10n.getString(&quot;Login.ConnectingTo&quot;) + &quot; &quot; + selected.toString());
-    	}
-    	// Exception! We must display the exception to the user.
-    	else if(arg instanceof Exception) {
-    		status.setText(L10n.getString(&quot;Login.Failed&quot;));
-    		next.setEnabled(true);
-    		setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));
-    		JOptionPane.showMessageDialog(
-    				this, 
-    				((Exception)arg).getMessage(), 
-    				L10n.getString(&quot;Error.LoginFailed&quot;), 
-    				JOptionPane.ERROR_MESSAGE);
-    	}
-    	// The database layer has been created, we are no longer neccessary
-		else if(arg instanceof DBLayer)
-    		this.setVisible(false); 
-    	// Some update information - display them in the status bar.
-		else if(arg instanceof String) 
-			status.setText(&quot;  &quot; + (String)arg);
+    public void update(Observable source, final Object arg) {
+    	java.awt.EventQueue.invokeLater(new Runnable() {
+    		public void run() {
+    			if(arg == null || arg instanceof DBInfo) {
+    				DBInfo selected = (DBInfo)arg;
+    				if(selected == null) return;
+    				user.removeAllItems();
+    				((AutoComboBox)user).addItems(selected.users);
+    				password.setText(&quot;&quot;);
+    				setTitle(L10n.getString(&quot;Login.ConnectingTo&quot;) + &quot; &quot; + selected.toString());
+    			}
+    			// Exception! We must display the exception to the user.
+    			else if(arg instanceof Exception) {
+    				status.setText(L10n.getString(&quot;Login.Failed&quot;));
+    				next.setEnabled(true);
+    				setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));
+    				JOptionPane.showMessageDialog(
+    						null, 
+    						((Exception)arg).getMessage(), 
+    						L10n.getString(&quot;Error.LoginFailed&quot;), 
+    						JOptionPane.ERROR_MESSAGE);
+    			}
+    			// The database layer has been created, we are no longer neccessary
+    			else if(arg instanceof DBLayer)
+    				setVisible(false); 
+    			// Some update information - display them in the status bar.
+    			else if(arg instanceof String) 
+    				status.setText(&quot;  &quot; + (String)arg);
+    		}
+    	});
 	}
     
     

Modified: trunk/src/net/sf/plantlore/client/login/DBInfo.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/DBInfo.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/login/DBInfo.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -16,25 +16,16 @@
 public class DBInfo {
 	protected String alias;
 	protected String host;
-	protected String db;
-	protected String[] users;	
 	protected int port;
+	protected String databaseType;
+	protected int databasePort;
+	protected String databaseIdentifier;
+	protected String databaseParameter;
+	protected String[] users;
+	protected String masterUser;
+	protected String masterPassword;
 	
 	/**
-	 * Create a new record.
-	 * 
-	 * @param alias The name the user will be presented with.
-	 * @param host The hostname where the server runs.
-	 * @param port The port number where the server listens, 0 means default.
-	 * @param db The database identificator.
-	 * @param users The list of user names used lately.
-	 */
-	public DBInfo(String alias, String host, int port, String db, String[] users) {
-		this.alias = alias; this.host = host; this.port = (port &lt;= 0) ? 1099 : port; this.db = db; this.users = users;
-	}
-	
-
-	/**
 	 * Pick a user. The selected name will be moved to the start of the list.
 	 * The selected user will be at the top of the list next time.
 	 * 
@@ -55,25 +46,69 @@
 	public String toString() {
 		return alias;
 	}
+	
+	
+	public DBInfo clone() {
+		return new DBInfo(
+				alias, host, port, databaseType, databasePort, databaseIdentifier, databaseParameter,
+				users, masterUser, masterPassword );
+	}
 
-    public String getAlias() {
-        return alias;
-    }
+	public DBInfo(String alias, String host, int port, String databaseType, int databasePort, String databaseIdentifier, String databaseParameter, String[] users, String masterUser, String masterPassword) {
+		this.alias = alias;
+		this.host = host;
+		this.port = port;
+		this.databaseType = databaseType;
+		this.databasePort = databasePort;
+		this.databaseIdentifier = databaseIdentifier;
+		this.databaseParameter = databaseParameter;
+		this.users = users;
+		this.masterUser = masterUser;
+		this.masterPassword = masterPassword;
+	}
 
-    public String getHost() {
-        return host;
-    }
+	
+	public String getAlias() {
+		return alias;
+	}
 
-    public String getDb() {
-        return db;
-    }
+	public String getDatabaseIdentifier() {
+		return databaseIdentifier;
+	}
 
-    public String[] getUsers() {
-        return users;
-    }
+	public String getDatabaseParameter() {
+		return databaseParameter;
+	}
 
-    public int getPort() {
-        return port;
-    }
+	public int getDatabasePort() {
+		return databasePort;
+	}
+
+	public String getDatabaseType() {
+		return databaseType;
+	}
+
+	public String getHost() {
+		return host;
+	}
+
+	public String getMasterPassword() {
+		return masterPassword;
+	}
+
+	public String getMasterUser() {
+		return masterUser;
+	}
+
+	public int getPort() {
+		return port;
+	}
+
+	public String[] getUsers() {
+		return users;
+	}
+
+
+	
 		
 }

Modified: trunk/src/net/sf/plantlore/client/login/ItemCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/ItemCtrl.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/login/ItemCtrl.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -3,6 +3,7 @@
 import java.awt.event.ActionEvent;
 
 import javax.swing.AbstractAction;
+import javax.swing.event.ChangeEvent;
 
 import net.sf.plantlore.l10n.L10n;
 
@@ -17,21 +18,38 @@
 	
 	
 	// Switch between the ADD/EDIT behaviour
-	public void setMode(Mode m) { 
+	public void setMode(Mode m) {
 		this.mode = m;
 		switch(m) {
 		case ADD:
-			view.setTitle(L10n.getString(&quot;Login.AddTitle&quot;));
-			view.alias.setText(&quot;&quot;); 
-			view.host.setText(&quot;&quot;);
-			view.db.setText(&quot;&quot;);
-			view.next.setText(L10n.getString(&quot;Login.Add&quot;));
-			view.next.setToolTipText(L10n.getString(&quot;Login.AddTT&quot;));
+			java.awt.EventQueue.invokeLater(new Runnable() {
+				public void run() {
+					view.alias.setText(&quot;&quot;); 
+					view.host.setText(&quot;&quot;);
+					view.port.setText(&quot;&quot;);
+					((javax.swing.JTextField)view.database.getEditor().getEditorComponent()).setText(&quot;&quot;);
+					view.databaseIdentifier.setText(&quot;&quot;);
+					view.databasePort.setText(&quot;&quot;);
+					view.databaseParameter.setText(&quot;&quot;);
+					view.databaseMasterUser.setText(&quot;&quot;);
+					view.databaseMasterPassword.setText(&quot;&quot;);
+					
+					view.setTitle(L10n.getString(&quot;Login.AddTitle&quot;));
+					view.next.setText(L10n.getString(&quot;Login.Add&quot;));
+					view.next.setToolTipText(L10n.getString(&quot;Login.AddTT&quot;));
+					view.next.setEnabled(false);
+				}
+			});
 			break;
 		case EDIT:
-			view.setTitle(L10n.getString(&quot;Login.EditTitle&quot;));
-			view.next.setText(L10n.getString(&quot;Login.Change&quot;));
-			view.next.setToolTipText(L10n.getString(&quot;Login.ChangeTT&quot;));
+			java.awt.EventQueue.invokeLater(new Runnable() {
+				public void run() {
+					view.setTitle(L10n.getString(&quot;Login.EditTitle&quot;));
+					view.next.setText(L10n.getString(&quot;Login.Change&quot;));
+					view.next.setToolTipText(L10n.getString(&quot;Login.ChangeTT&quot;));
+					view.next.setEnabled(true);
+				}
+			});
 			break;
 		}
 	}
@@ -39,30 +57,102 @@
 	
 	public ItemCtrl(Login login, ItemView itemview) {
 		this.model = login; this.view = itemview;
-		view.next.setAction(new Next());
+		view.next.setAction(new NextAction());
+		view.discard.setAction(new DiscardAction());
+		//view.next.addChangeListener();
 	}
 	
-	class Next extends AbstractAction {
-		public Next() {
+	
+	
+	class ObligatoryItemsListener implements javax.swing.event.ChangeListener {
+		public void stateChanged(ChangeEvent event) {
+			boolean newState = 
+				view.alias.getText().length() &gt; 0
+				&amp;&amp;
+				((javax.swing.JTextField)view.database.getEditor().getEditorComponent()).getText().length() &gt; 0
+				&amp;&amp;
+				view.databaseIdentifier.getText().length() &gt; 0;
+			if(newState)
+				try {
+					if( Integer.parseInt(view.databasePort.getText()) &lt; 1024 )
+						newState = false;
+				} catch(Exception e) { 
+					newState = false; 
+				}
+			
+			boolean state = view.next.isEnabled();
+			
+			if( state != newState )
+				view.next.setEnabled(newState);
+		}
+	}
+	
+	
+	class NextAction extends AbstractAction {
+		public NextAction() {
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.ChangeTT&quot;));
 			putValue(NAME, L10n.getString(&quot;Login.Change&quot;));
 		}
 		public void actionPerformed(ActionEvent arg0) {
-			int t = view.host.getText().indexOf(':');
-			int port = (t &lt; 0) ? 1099 : Integer.parseInt(view.host.getText().substring(t));
-			String host = (t &lt; 0) ? view.host.getText() : view.host.getText().substring(0, t - 1);
-			String alias = view.alias.getText(), db = view.db.getText();
+			int port = 1099, databasePort = -1;
+			try {
+				port = Integer.parseInt(view.port.getText());
+			} catch(NumberFormatException e) {}
+			try {
+				databasePort = Integer.parseInt(view.databasePort.getText());
+			} catch(NumberFormatException e) {}
 			
 			switch(mode) {
 			case ADD:
-				model.createRecord(alias, host, port, db);
+				model.createRecord(
+						view.alias.getText(),
+						view.host.getText(),
+						port,
+						((javax.swing.JTextField)view.database.getEditor().getEditorComponent()).getText(),
+						databasePort,
+						view.databaseIdentifier.getText(),
+						view.databaseParameter.getText(),
+						view.databaseMasterUser.getText(),
+						new String(view.databaseMasterPassword.getPassword())
+				);
 				break;
 			case EDIT:
-				model.updateSelectedRecord(alias, host, port, db);
+				model.updateSelectedRecord(
+						view.alias.getText(),
+						view.host.getText(),
+						port,
+						((javax.swing.JTextField)view.database.getEditor().getEditorComponent()).getText(),
+						databasePort,
+						view.databaseIdentifier.getText(),
+						view.databaseParameter.getText(),
+						view.databaseMasterUser.getText(),
+						new String(view.databaseMasterPassword.getPassword())
+				);
 				break;
 			}
-			view.setVisible(false);
+			
+			java.awt.EventQueue.invokeLater(new Runnable() {
+				public void run() {
+					view.setVisible(false);
+				}
+			});
+			
+			setMode(Mode.EDIT);
 		}
 	}
+	
+	class DiscardAction extends AbstractAction {
+		public DiscardAction() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.DiscardTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Login.Discard&quot;));
+		}
+		public void actionPerformed(ActionEvent arg0) {
+			java.awt.EventQueue.invokeLater(new Runnable() {
+				public void run() {
+					view.setVisible(false);
+				}
+			});
+		}
+	}
 
 }

Modified: trunk/src/net/sf/plantlore/client/login/ItemView.form
===================================================================
--- trunk/src/net/sf/plantlore/client/login/ItemView.form	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/login/ItemView.form	2006-06-03 16:48:24 UTC (rev 428)
@@ -24,20 +24,50 @@
           &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;discard&quot; linkSize=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;next&quot; linkSize=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
+                  &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                           &lt;Component id=&quot;jLabel1&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Component id=&quot;jLabel2&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jLabel8&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;/Group&gt;
+                      &lt;EmptySpace min=&quot;-2&quot; pref=&quot;6&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Component id=&quot;host&quot; alignment=&quot;0&quot; pref=&quot;231&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;alias&quot; alignment=&quot;0&quot; pref=&quot;231&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;port&quot; alignment=&quot;0&quot; pref=&quot;231&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;/Group&gt;
+                  &lt;/Group&gt;
+                  &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                           &lt;Component id=&quot;jLabel3&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jLabel9&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
-                      &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace min=&quot;-2&quot; pref=&quot;8&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                          &lt;Component id=&quot;db&quot; alignment=&quot;0&quot; pref=&quot;233&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;host&quot; alignment=&quot;0&quot; pref=&quot;233&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;alias&quot; alignment=&quot;0&quot; pref=&quot;233&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;databaseIdentifier&quot; pref=&quot;231&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;database&quot; alignment=&quot;0&quot; pref=&quot;231&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
-                  &lt;Component id=&quot;next&quot; alignment=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Component id=&quot;jLabel4&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jLabel5&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jLabel6&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jLabel7&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;/Group&gt;
+                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Component id=&quot;databasePort&quot; alignment=&quot;0&quot; pref=&quot;231&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;databaseParameter&quot; alignment=&quot;0&quot; pref=&quot;231&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;databaseMasterUser&quot; alignment=&quot;0&quot; pref=&quot;231&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;databaseMasterPassword&quot; alignment=&quot;0&quot; pref=&quot;231&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;/Group&gt;
+                  &lt;/Group&gt;
               &lt;/Group&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
@@ -56,13 +86,46 @@
                   &lt;Component id=&quot;jLabel2&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;Component id=&quot;host&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
-              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;jLabel8&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;port&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                   &lt;Component id=&quot;jLabel3&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;db&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;database&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;jLabel9&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;databaseIdentifier&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;jLabel4&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;databasePort&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;jLabel5&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;databaseParameter&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;jLabel6&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;databaseMasterUser&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;jLabel7&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;databaseMasterPassword&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
               &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;next&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;next&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;discard&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
               &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
           &lt;/Group&gt;
       &lt;/Group&gt;
@@ -91,29 +154,165 @@
       &lt;/Properties&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;alias&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.AliasTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
       &lt;AuxValues&gt;
         &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
       &lt;/AuxValues&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;host&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.HostNameTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
       &lt;AuxValues&gt;
         &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
       &lt;/AuxValues&gt;
     &lt;/Component&gt;
-    &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;db&quot;&gt;
+    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;next&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Change&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
       &lt;AuxValues&gt;
         &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
       &lt;/AuxValues&gt;
     &lt;/Component&gt;
-    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;next&quot;&gt;
+    &lt;Component class=&quot;javax.swing.JComboBox&quot; name=&quot;database&quot;&gt;
       &lt;Properties&gt;
+        &lt;Property name=&quot;editable&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
+        &lt;Property name=&quot;model&quot; type=&quot;javax.swing.ComboBoxModel&quot; editor=&quot;org.netbeans.modules.form.editors2.ComboBoxModelEditor&quot;&gt;
+          &lt;StringArray count=&quot;4&quot;&gt;
+            &lt;StringItem index=&quot;0&quot; value=&quot;postgresql&quot;/&gt;
+            &lt;StringItem index=&quot;1&quot; value=&quot;firebirdsql&quot;/&gt;
+            &lt;StringItem index=&quot;2&quot; value=&quot;mysql&quot;/&gt;
+            &lt;StringItem index=&quot;3&quot; value=&quot;oraclesql&quot;/&gt;
+          &lt;/StringArray&gt;
+        &lt;/Property&gt;
+        &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.DatabaseTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel4&quot;&gt;
+      &lt;Properties&gt;
         &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
-          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Change&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.DatabasePort&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
         &lt;/Property&gt;
       &lt;/Properties&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;databasePort&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.DatabasePortTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
       &lt;AuxValues&gt;
         &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
       &lt;/AuxValues&gt;
     &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel5&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Parameter&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;databaseParameter&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.ParameterTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel6&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.MasterUser&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;databaseMasterUser&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.MasterUserTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel7&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.MasterPassword&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JPasswordField&quot; name=&quot;databaseMasterPassword&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.MasterPasswordTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;discard&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Discard&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel8&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.Port&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;port&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.PortTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel9&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.DatabaseIdentifier&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;databaseIdentifier&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Login.DatabaseIdentifierTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
   &lt;/SubComponents&gt;
 &lt;/Form&gt;

Modified: trunk/src/net/sf/plantlore/client/login/ItemView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/ItemView.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/login/ItemView.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -41,8 +41,21 @@
         jLabel3 = new javax.swing.JLabel();
         alias = new javax.swing.JTextField();
         host = new javax.swing.JTextField();
-        db = new javax.swing.JTextField();
         next = new javax.swing.JButton();
+        database = new javax.swing.JComboBox();
+        jLabel4 = new javax.swing.JLabel();
+        databasePort = new javax.swing.JTextField();
+        jLabel5 = new javax.swing.JLabel();
+        databaseParameter = new javax.swing.JTextField();
+        jLabel6 = new javax.swing.JLabel();
+        databaseMasterUser = new javax.swing.JTextField();
+        jLabel7 = new javax.swing.JLabel();
+        databaseMasterPassword = new javax.swing.JPasswordField();
+        discard = new javax.swing.JButton();
+        jLabel8 = new javax.swing.JLabel();
+        port = new javax.swing.JTextField();
+        jLabel9 = new javax.swing.JLabel();
+        databaseIdentifier = new javax.swing.JTextField();
 
         setTitle(L10n.getString(&quot;Login.Change&quot;));
         setTitle(L10n.getString(&quot;Login.Add&quot;));
@@ -54,8 +67,42 @@
 
         jLabel3.setText(L10n.getString(&quot;Login.Database&quot;));
 
+        alias.setToolTipText(L10n.getString(&quot;Login.AliasTT&quot;));
+
+        host.setToolTipText(L10n.getString(&quot;Login.HostNameTT&quot;));
+
         next.setText(L10n.getString(&quot;Login.Change&quot;));
 
+        database.setEditable(true);
+        database.setModel(new javax.swing.DefaultComboBoxModel(new String[] { &quot;postgresql&quot;, &quot;firebirdsql&quot;, &quot;mysql&quot;, &quot;oraclesql&quot; }));
+        database.setToolTipText(L10n.getString(&quot;Login.DatabaseTT&quot;));
+
+        jLabel4.setText(L10n.getString(&quot;Login.DatabasePort&quot;));
+
+        databasePort.setToolTipText(L10n.getString(&quot;Login.DatabasePortTT&quot;));
+
+        jLabel5.setText(L10n.getString(&quot;Login.Parameter&quot;));
+
+        databaseParameter.setToolTipText(L10n.getString(&quot;Login.ParameterTT&quot;));
+
+        jLabel6.setText(L10n.getString(&quot;Login.MasterUser&quot;));
+
+        databaseMasterUser.setToolTipText(L10n.getString(&quot;Login.MasterUserTT&quot;));
+
+        jLabel7.setText(L10n.getString(&quot;Login.MasterPassword&quot;));
+
+        databaseMasterPassword.setToolTipText(L10n.getString(&quot;Login.MasterPasswordTT&quot;));
+
+        discard.setText(L10n.getString(&quot;Login.Discard&quot;));
+
+        jLabel8.setText(L10n.getString(&quot;Login.Port&quot;));
+
+        port.setToolTipText(L10n.getString(&quot;Login.PortTT&quot;));
+
+        jLabel9.setText(L10n.getString(&quot;Login.DatabaseIdentifier&quot;));
+
+        databaseIdentifier.setToolTipText(L10n.getString(&quot;Login.DatabaseIdentifierTT&quot;));
+
         org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
         getContentPane().setLayout(layout);
         layout.setHorizontalGroup(
@@ -63,19 +110,45 @@
             .add(layout.createSequentialGroup()
                 .addContainerGap()
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                    .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
+                        .add(discard)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                        .add(next))
                     .add(layout.createSequentialGroup()
                         .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                             .add(jLabel1)
                             .add(jLabel2)
-                            .add(jLabel3))
+                            .add(jLabel8))
+                        .add(6, 6, 6)
+                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                            .add(host, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 231, Short.MAX_VALUE)
+                            .add(alias, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 231, Short.MAX_VALUE)
+                            .add(port, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 231, Short.MAX_VALUE)))
+                    .add(layout.createSequentialGroup()
+                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                            .add(jLabel3)
+                            .add(jLabel9))
+                        .add(8, 8, 8)
+                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                            .add(databaseIdentifier, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 231, Short.MAX_VALUE)
+                            .add(database, 0, 231, Short.MAX_VALUE)))
+                    .add(layout.createSequentialGroup()
+                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                            .add(jLabel4)
+                            .add(jLabel5)
+                            .add(jLabel6)
+                            .add(jLabel7))
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                            .add(db, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 233, Short.MAX_VALUE)
-                            .add(host, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 233, Short.MAX_VALUE)
-                            .add(alias, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 233, Short.MAX_VALUE)))
-                    .add(org.jdesktop.layout.GroupLayout.TRAILING, next))
+                            .add(databasePort, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 231, Short.MAX_VALUE)
+                            .add(databaseParameter, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 231, Short.MAX_VALUE)
+                            .add(databaseMasterUser, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 231, Short.MAX_VALUE)
+                            .add(databaseMasterPassword, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 231, Short.MAX_VALUE))))
                 .addContainerGap())
         );
+
+        layout.linkSize(new java.awt.Component[] {discard, next}, org.jdesktop.layout.GroupLayout.HORIZONTAL);
+
         layout.setVerticalGroup(
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(layout.createSequentialGroup()
@@ -89,10 +162,36 @@
                     .add(host, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel8)
+                    .add(port, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(jLabel3)
-                    .add(db, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                    .add(database, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel9)
+                    .add(databaseIdentifier, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel4)
+                    .add(databasePort, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel5)
+                    .add(databaseParameter, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel6)
+                    .add(databaseMasterUser, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel7)
+                    .add(databaseMasterPassword, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
-                .add(next)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(next)
+                    .add(discard))
                 .addContainerGap())
         );
         pack();
@@ -103,21 +202,45 @@
      * Fill all fields with information obtained from the currently selected record.
      */
     public void update(Observable arg0, Object arg1) {
-		DBInfo info = model.getSelected();
-		if(info == null) return;
-		alias.setText(info.alias); 
-		host.setText(info.host + ((info.port != 1099) ? &quot; : &quot; + info.port : &quot;&quot;));
-		db.setText(info.db);
+		java.awt.EventQueue.invokeLater(new Runnable() {
+			public void run() {
+				DBInfo info = model.getSelected();
+				if(info != null) {
+					alias.setText(info.alias); 
+					host.setText(info.host);
+					port.setText( Integer.toString(info.port) );
+					((javax.swing.JTextField)database.getEditor().getEditorComponent()).setText(info.databaseType);
+					databaseIdentifier.setText(info.getDatabaseIdentifier());
+					databasePort.setText( Integer.toString(info.getDatabasePort()) );
+					databaseParameter.setText(info.getDatabaseParameter());
+					databaseMasterUser.setText(info.getMasterUser());
+					databaseMasterPassword.setText(info.getMasterPassword());
+				}
+			}
+		});
 	}
     
     // Variables declaration - do not modify//GEN-BEGIN:variables
     protected javax.swing.JTextField alias;
-    protected javax.swing.JTextField db;
+    protected javax.swing.JComboBox database;
+    protected javax.swing.JTextField databaseIdentifier;
+    protected javax.swing.JPasswordField databaseMasterPassword;
+    protected javax.swing.JTextField databaseMasterUser;
+    protected javax.swing.JTextField databaseParameter;
+    protected javax.swing.JTextField databasePort;
+    protected javax.swing.JButton discard;
     protected javax.swing.JTextField host;
     private javax.swing.JLabel jLabel1;
     private javax.swing.JLabel jLabel2;
     private javax.swing.JLabel jLabel3;
+    private javax.swing.JLabel jLabel4;
+    private javax.swing.JLabel jLabel5;
+    private javax.swing.JLabel jLabel6;
+    private javax.swing.JLabel jLabel7;
+    private javax.swing.JLabel jLabel8;
+    private javax.swing.JLabel jLabel9;
     protected javax.swing.JButton next;
+    protected javax.swing.JTextField port;
     // End of variables declaration//GEN-END:variables
     
 }

Modified: trunk/src/net/sf/plantlore/client/login/Login.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/Login.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/login/Login.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -1,5 +1,6 @@
 package net.sf.plantlore.client.login;
 
+import java.io.IOException;
 import java.rmi.RemoteException;
 import java.util.ArrayList;
 import java.util.Observable;
@@ -45,16 +46,13 @@
 	
 	//private String  file = System.getProperty(&quot;user.home&quot;) + &quot;/.plantlore/db.info.xml&quot;;
 	
-        private MainConfig mainConfig = null;
+	private MainConfig mainConfig = null;
 	private DBLayerFactory factory = null;
 	private DBLayer dblayer;
-	private Logger logger;
+	private Logger logger  = Logger.getLogger(this.getClass().getPackage().getName());
 	
-	private String username;
-	private String passcode;
-	
 	private Right accessRights;
-        private User plantloreUser;
+	private User plantloreUser;
 	
 	/**
 	 * Create a new login model. The DBLayer factory will be used to produce 
@@ -64,36 +62,35 @@
 	 */
 	public Login(DBLayerFactory factory, MainConfig mainConfig) {
 		this.factory = factory;
-                this.mainConfig = mainConfig;
-		logger = Logger.getLogger(this.getClass().getPackage().getName());
+		this.mainConfig = mainConfig;
 		load();
 	}
 	
 	
 	/**
 	 * Load saved information about the database connections.
-	 * TODO: -IMPLEMENTATION MISSING-
 	 */
 	protected void load() {
 		logger.debug(&quot;Loading the stored list of databases.&quot;);
 		
-                for (DBInfo savedDBInfo: mainConfig.getDBinfos())
-                    dbinfo.add(savedDBInfo);
-                				
+		for (DBInfo savedDBInfo: mainConfig.getDBinfos())
+			dbinfo.add(savedDBInfo);
+		
 		this.setChanged(); this.notifyObservers(UPDATE_LIST);
 	}
 	
 	/**
 	 * Save the list of database connections for further usage.
-	 * TODO: -IMPLEMENTATION MISSING-
 	 */
 	protected void save() {
 		logger.debug(&quot;Saving the list of databases.&quot;);
-
-                mainConfig.setDBInfos(dbinfo);
-                
-                //ukladat uz tady?! spis ne - co kdyby se ukladani nepovedlo? bylo by divny to porad hlasit
-                //mainConfig.save();
+		
+		mainConfig.setDBInfos(dbinfo);
+		try {
+			mainConfig.save();
+		}catch(IOException e) {
+			logger.warn(&quot;Saving failed. &quot;+e.getMessage());
+		}
 	}
 	
 
@@ -101,13 +98,22 @@
 	 * Create a new record, add it to the list of connections and save that information for
 	 * the future use.
 	 * 
-	 * @param alias	Alias of the database.
-	 * @param host	Hostname of the computer where the server dwells.
-	 * @param port	Port where the server listens.
-	 * @param db		Identifier of the database to which the User wants to connect.
+	
 	 */
-	public void createRecord(String alias, String host, int port, String db) {
-		DBInfo r = new DBInfo(alias, host, port, db, new String[MAX_NAMES]);
+	synchronized public void createRecord(
+			String alias, 
+			String host, 
+			int port, 
+			String databaseType, 
+			int databasePort, 
+			String databaseIdentifier, 
+			String databaseParameter, 
+			String masterUser, 
+			String masterPassword ) {
+
+		DBInfo r = new DBInfo(
+				alias, host, port, databaseType, databasePort, databaseIdentifier, databaseParameter,
+				new String[MAX_NAMES], masterUser, masterPassword );
 		dbinfo.add(r);
 		logger.debug(&quot;New database record has been created &quot; + r);
 		save();
@@ -118,7 +124,7 @@
 	 * Delete the selected record from the list.
 	 *
 	 */
-	public void deleteSelectedRecord() {
+	synchronized public void deleteSelectedRecord() {
 		if(selected == null) return;
 		dbinfo.remove(selected);
 		logger.debug(&quot;The selected record has been removed &quot; + selected);
@@ -135,9 +141,30 @@
 	 * @param port	Port where the server listens.
 	 * @param db		Identifier of the database to which the User wants to connect.
 	 */
-	public void updateSelectedRecord(String alias, String host, int port, String db) {
+	synchronized public void updateSelectedRecord(
+			String alias, 
+			String host, 
+			int port, 
+			String databaseType, 
+			int databasePort, 
+			String databaseIdentifier, 
+			String databaseParameter, 
+			String masterUser, 
+			String masterPassword ) {
+
 		if(selected == null) return;
-		selected.alias = alias; selected.host = host; selected.port = port; selected.db = db;
+		
+		selected.alias = alias ;
+		selected.host = host; 
+		selected.port = port;
+		selected.databaseType = databaseType; 
+		selected.databasePort = databasePort ;
+		selected.databaseIdentifier = databaseIdentifier ;
+		selected.databaseParameter = databaseParameter; 
+		selected.masterUser = masterUser;
+		selected.masterPassword = masterPassword;
+		
+		save();
 		logger.debug(&quot;The selected record has been updated &quot; + selected);
 		this.setChanged(); this.notifyObservers(UPDATE_LIST);
 	}
@@ -145,7 +172,7 @@
 	/**
 	 * @return the list of all records.
 	 */
-	public DBInfo[] getRecords() {
+	synchronized public DBInfo[] getRecords() {
 		// Seeing is believing: <A HREF="http://java.sun.com/j2se/1.5.0/docs/api/java/util/Collection.html#toArray(T[">http://java.sun.com/j2se/1.5.0/docs/api/java/util/Collection.html#toArray(T[</A>])
 		return dbinfo.toArray(new DBInfo[0]);
 	}
@@ -158,34 +185,25 @@
 	 * @param index	The index of the selected record. Zero means first. 
 	 * Negative means nothing gets selected (deselect).
 	 */
-	public void setSelected(int index) {
+	synchronized public void setSelected(int index) {
 		if(index == lastIndex) 
 			return;
-		if(index &gt;= 0) selected = dbinfo.get(index); 
-		else selected = null;
+		else if(index &gt;= 0) 
+			selected = dbinfo.get(index); 
+		else 
+			selected = null;
 		
 		lastIndex = index;
 		
 		logger.debug(&quot;Selected database is &quot; + selected);
 		this.setChanged(); 
-		/*------------------------------------------------------------
-		 * The reason why a parameter is used here is simple:
-		 * 1. you select something in the choice list in the LoginView -&gt;
-		 * 2. ListSelectionEvent is fired -&gt;
-		 * 3. model.setSelected(..) is called in the handler -&gt;
-		 * 4. notifyObservers(..) is called here -&gt;
-		 * 5. loginView.update() gets involved -&gt;
-		 * 6. without proper recognition of events setList(data)
-		 *    would be called which will in turn trigger 
-		 *    ListSelectionEvent -&gt; 2.
-		 *------------------------------------------------------------*/
-		this.notifyObservers( selected );
+		this.notifyObservers( selected.clone() );
 	}
 	
 	/**
 	 * @return	The selected record.
 	 */
-	public DBInfo getSelected() {
+	synchronized public DBInfo getSelected() {
 		return selected;
 	}
 	
@@ -201,44 +219,43 @@
 	 * @param name The account name (used to access the database).  
 	 * @param password The password to the account.
 	 */
-	public void connectToSelected(String name, String password) {
-		this.username = name; this.passcode = password;
+	synchronized public void connectToSelected(final String name, final String password) {
+		
 		if(selected == null) {
 			logger.debug(&quot;The System cannot create a connection when nothing was selected!&quot;);
 			return;
 		}
 		
+		final DBInfo selectedClone = selected.clone();
+		
 		 final SwingWorker worker = new SwingWorker() {
 	            public Object construct() {
 	            	
+            		logout();
 	            	try {
-	            		logout();
-	            	} catch (RemoteException e) { logger.info(&quot;Unable to disconnect from the server. &quot; + e); }
-	            	
-	            	try {
 	            		// The current username is moved to the top of the list of names :) Nice feature.
-	            		selected.promoteUser(username);
+	            		selectedClone.promoteUser(name);
 	            		// Save the current state.
 	            		save();
 	            		
 	            		// Create a new database layer.
-	            		logger.debug(&quot;Asking the DBLayerFactory for a new DBLayer @ &quot; + selected.host + &quot;:&quot; + selected.port);
+	            		logger.debug(&quot;Asking the DBLayerFactory for a new DBLayer @ &quot; + selectedClone.host + &quot;:&quot; + selectedClone.port);
 	            		setChanged(); notifyObservers(L10n.getString(&quot;Login.Connecting&quot;));
-	            		dblayer = factory.create(selected.host, selected.port);
+	            		dblayer = factory.create( selectedClone );
 	            		
 	            		logger.debug(&quot;Connection successful.&quot;);
 	            		setChanged(); notifyObservers(L10n.getString(&quot;Login.Connected&quot;));
 	            		
 	            		// Initialize the database layer.
 	            		setChanged(); notifyObservers(L10n.getString(&quot;Login.InitializingDBLayer&quot;));
-	            		logger.debug(&quot;Initializing that DBLayer (&quot; + selected.db + &quot;, &quot; + username + &quot;, &quot; + passcode + &quot;...&quot;);
+	            		logger.debug(&quot;Initializing that DBLayer (&quot; + selectedClone.databaseType + &quot;, &quot; + name + &quot;, &quot; + password + &quot;...&quot;);
 
-	            		Object[] init = dblayer.initialize(selected.db, username, passcode);
+	            		Object[] init = dblayer.initialize(selectedClone.getDatabaseIdentifier(), name, password);
 	            		plantloreUser = (User)init[0];
 	            		accessRights = (Right)init[1];
 	            	} 
 	            	catch (Exception exception) {
-	            		logger.error(&quot;The initialization of the DBLayer failed! &quot; + exception);
+	            		logger.error(&quot;The initialization of the DBLayer failed! &quot; + exception.getMessage());
 	            		// If the initialization of the DBLayer failed, the uninitialized DBLayer must be destroyed!
 	            		// If it is not, the server's policy may not allow another connection from this client!
 	            		try {
@@ -269,27 +286,31 @@
 	 * 
 	 * @throws RemoteException if the RMI encounters an error.
 	 */
-	public void logout() throws RemoteException {
-		if(dblayer != null) {
-			factory.destroy(dblayer);
-			dblayer = null; accessRights = null; plantloreUser = null;
-			logger.info(&quot;The client disconnected itself from the server. The communication may no longer be possible.&quot;);
-			this.setChanged(); this.notifyObservers();
-		}
+	public void logout() {
+		if(dblayer != null) 
+			try {
+				factory.destroy(dblayer);
+				dblayer = null; accessRights = null; plantloreUser = null;
+				logger.info(&quot;The client disconnected itself from the server. The communication may no longer be possible.&quot;);
+			} catch(RemoteException e) {
+				logger.warn(&quot;Unable to disconnect from the server. &quot; + e.getMessage());
+				/*setChanged();
+				notifyObservers(e);*/ // Not this time, this is supposed to be silent.
+			}
 	}
 	
 		
 	/**
 	 * @return The last DBLayer that has been created.  
 	 */	
-	public DBLayer getDBLayer() { 
+	synchronized public DBLayer getDBLayer() { 
 		return dblayer; 
 	}
 	
 	/**
 	 * @return The currently logged user.
 	 */
-	public User getLoggedUser() {
+	synchronized public User getLoggedUser() {
 		return plantloreUser;
 	}
 	
@@ -297,7 +318,7 @@
 	 * @return The list of access rights as returned by the database layer
 	 * after initialization.
 	 */
-	public Right getAccessRights() {
+	synchronized public Right getAccessRights() {
 		return accessRights;
 	}
         

Modified: trunk/src/net/sf/plantlore/client/login/LoginCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/LoginCtrl.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/login/LoginCtrl.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -4,7 +4,6 @@
 
 import javax.swing.AbstractAction;
 import javax.swing.JDialog;
-import javax.swing.JOptionPane;
 import javax.swing.event.ListSelectionEvent;
 import javax.swing.event.ListSelectionListener;
 
@@ -24,71 +23,63 @@
 	
 	public LoginCtrl(Login login, LoginView loginview) {
 		this.view = loginview; this.model = login;
-		// Create Item Add/Edit dialog.
-		itemView = new ItemView(model);
-		itemCtrl = new ItemCtrl(model, itemView);
-		// Create Authorization dialog.
-		authView = new AuthView(model);
-		new AuthCtrl(model, authView);
 		
+		java.awt.EventQueue.invokeLater(new Runnable() {
+			public void run() {
+				// Create Item Add/Edit dialog.
+				itemView = new ItemView(model);
+				itemCtrl = new ItemCtrl(model, itemView);
+				// Create Authorization dialog.
+				authView = new AuthView(model);
+				new AuthCtrl(model, authView);
+			}
+		});
 		
 		view.choice.addListSelectionListener(new ChoiceChanged());
-		view.add.setAction(new AddRecord());
-		view.edit.setAction(new EditRecord());
-		view.remove.setAction(new RemoveRecord());
-		view.next.setAction(new Next());
+		view.add.setAction(new AddRecordAction());
+		view.edit.setAction(new EditRecordAction());
+		view.remove.setAction(new RemoveRecordAction());
+		view.next.setAction(new NextAction());
 		
 		// Select something.
 		view.choice.setSelectedIndex(0);
 	}
 	
 	
-	public void setVisible(boolean visible) {
-		JDialog dialog = view;
-		if( view.remember.isSelected() &amp;&amp; !view.choice.isSelectionEmpty() ) { 
-			dialog = authView;
-		}
+	public void setVisible(final boolean visible) {
+		final JDialog dialog = view.remember.isSelected() &amp;&amp; !view.choice.isSelectionEmpty() ? authView : view;
+		java.awt.EventQueue.invokeLater(new Runnable() {
+			public void run() {
+				dialog.setVisible(visible);
+			}
+		});
 		
-		//UNCOMMENT THIS:      
-		dialog.setVisible(visible);
-		
-//		// TEMPORARY CODE STARTS HERE
-//			System.out.println(&quot;HYPERACTIVE-LOGIN&quot;);
-//			authView.password.setText(&quot;masterkey&quot;);
-//			authView.next.doClick(); 
-//		// TEMPORARY CODE ENDS HERE
 	}
 	
 	
 	class ChoiceChanged implements ListSelectionListener {
 		public void valueChanged(ListSelectionEvent e) {
-			/*----------------------------------------------------------
-			 *  Well here is some nasty behaviour of the Swing
-			 *  framework: for some unknown reason 
-			 *  the ListSelectionEvent is sent twice every time 
-			 *  you select something in the list. Why?
-			 *  
-			 *  The reason will be simple: 
-			 *  mousePressed &amp; mouseReleased 
-			 *  (instead of mouseClicked).  
-			 *----------------------------------------------------------*/
 			model.setSelected( view.choice.getSelectedIndex() );
 		}	
 	}
 	
-	class AddRecord extends AbstractAction {
-		public AddRecord() {
+	class AddRecordAction extends AbstractAction {
+		public AddRecordAction() {
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.AddRecordTT&quot;));
 			putValue(NAME, L10n.getString(&quot;Login.AddRecord&quot;));
 		}
 		public void actionPerformed(ActionEvent arg0) {
 			itemCtrl.setMode(ItemCtrl.Mode.ADD);
-			itemView.setVisible(true);
+			java.awt.EventQueue.invokeLater(new Runnable() {
+				public void run() {
+					itemView.setVisible(true);
+				}
+			});
 		}
 	}
 	
-	class  RemoveRecord extends AbstractAction {
-		public RemoveRecord() {
+	class  RemoveRecordAction extends AbstractAction {
+		public RemoveRecordAction() {
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.RemoveRecordTT&quot;));
 			putValue(NAME, L10n.getString(&quot;Login.RemoveRecord&quot;));
 		}
@@ -97,37 +88,35 @@
 		}
 	}
 	
-	class EditRecord extends AbstractAction {
-		public EditRecord() {
+	class EditRecordAction extends AbstractAction {
+		public EditRecordAction() {
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.EditRecordTT&quot;));
 			putValue(NAME, L10n.getString(&quot;Login.EditRecord&quot;));
 		}
 		public void actionPerformed(ActionEvent arg0) {
-			if(model.getSelected() == null)
-				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;Error.NothingSelected&quot;),
-					    L10n.getString(&quot;Error.Missing&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-			else {
+			if(model.getSelected() != null) {
 				itemCtrl.setMode(ItemCtrl.Mode.EDIT);
-				itemView.setVisible(true);
+				java.awt.EventQueue.invokeLater(new Runnable() {
+					public void run() {
+						itemView.setVisible(true);
+					}
+				});
 			}
 		}
 	}
 	
-	class Next extends AbstractAction {
-		public Next() {
+	class NextAction extends AbstractAction {
+		public NextAction() {
 			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Login.NextTT&quot;));
 			putValue(NAME, L10n.getString(&quot;Login.Next&quot;));
 		}
 		public void actionPerformed(ActionEvent arg0) {
-			if(model.getSelected() == null)
-				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;Error.NothingSelected&quot;),
-					    L10n.getString(&quot;Error.Missing&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-			else
-				authView.setVisible(true);
+			if(model.getSelected() != null)
+				java.awt.EventQueue.invokeLater(new Runnable() {
+					public void run() {
+						authView.setVisible(true);
+					}
+				});
 		}
 	}
 

Modified: trunk/src/net/sf/plantlore/client/login/LoginView.java
===================================================================
--- trunk/src/net/sf/plantlore/client/login/LoginView.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/client/login/LoginView.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -104,17 +104,21 @@
     /**
      * Update the list of records (in case there were some changes).
      */
-    public void update(Observable source, Object parameter) {
-    	// Ignore setSelected() event
-    	if(parameter == Login.UPDATE_LIST) {
-    		// Every item of the list will - after being added to the list - 
-    		// cause a ListSelectionEvent (valueChange) event!
-    		// This is probably because every time an item is inserted 
-    		// into the list, it is also selected!
-    		choice.setListData(model.getRecords());
-    	}
-    	else if(parameter != null &amp;&amp; parameter instanceof DBLayer)
-    		this.setVisible(false); // the database layer has been created, we are no longer neccessary
+    public void update(Observable source, final Object parameter) {
+    	java.awt.EventQueue.invokeLater(new Runnable() {
+    		public void run() {
+    			// Ignore setSelected() event
+    			if(parameter == Login.UPDATE_LIST) {
+    				// Every item of the list will - after being added to the list - 
+    				// cause a ListSelectionEvent (valueChange) event!
+    				// This is probably because every time an item is inserted 
+    				// into the list, it is also selected!
+    				choice.setListData(model.getRecords());
+    			}
+    			else if(parameter != null &amp;&amp; parameter instanceof DBLayer)
+    				setVisible(false); // the database layer has been created, we are no longer neccessary
+    		}
+    	});
 	}
     
     

Modified: trunk/src/net/sf/plantlore/common/record/Record.java
===================================================================
--- trunk/src/net/sf/plantlore/common/record/Record.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/common/record/Record.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -373,7 +373,7 @@
 		StringBuilder sigma = new StringBuilder();
 		for(String property : this.getProperties())
 			sigma.append(getClass().getSimpleName()).append('.').
-			append(property).append(&quot; = &quot;).append(this.getValue(property)).append(&quot;;\n&quot;);
+			append(property).append(&quot; = &quot;).append(this.getValue(property)).append(&quot;;&quot;);
 		for(String key : getForeignKeys()) {
 			Record subrecord = (Record)getValue(key); 
 			if(subrecord != null)	sigma.append( subrecord.toString() );

Modified: trunk/src/net/sf/plantlore/l10n/Plantlore.properties
===================================================================
--- trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/l10n/Plantlore.properties	2006-06-03 16:48:24 UTC (rev 428)
@@ -379,17 +379,37 @@
 Login.RemoveRecordTT = Remove the selected record (the database won't be deleted!).
 
 Login.Alias = Alias
+Login.AliasTT = The string that will be displayed to you.
 Login.HostName = Hostname
+Login.HostNameTT = The name of the computer where the server dwells.
 Login.Database = Database
+Login.DatabaseTT = The database engine that contains the data.
+Login.DatabaseIdentifier = DB Id.
+Login.DatabaseIdentifierTT = The identifier of the database that is stored within the database engine.
+Login.DatabasePort = DB Port
+Login.DatabasePortTT = The port where the database engine listens.
+Login.Port = Port
+Login.PortTT = The port where the server listens.
+Login.Parameter = Parameter
+Login.ParameterTT = Additional information required for the connection (such as encoding).
+Login.MasterUser = User
+Login.MasterUserTT = The database account this connection shall use.
+Login.MasterPassword = Password
+Login.MasterPasswordTT = The password to the database account.
+
 Login.Next = Continue
 Login.NextTT = Proceed to the next step.
+Login.DatabaseTT=The engine that stores the data.
 
+Login.Discard=Discard
+Login.DiscardTT=Discard the record.
+
 Login.AddTitle = Add record
 Login.Add = Add
-Login.AddTT = Add the new record.
+Login.AddTT = Add this record.
 Login.EditTitle = Edit record
 Login.Change = Change
-Login.ChangeTT = Change the current record.
+Login.ChangeTT = Change this record.
 
 Login.Authentication = Authentication
 Login.UserName = User name
@@ -1134,6 +1154,62 @@
 Message.FillingDialogs=Storing data into dialogs
 Overview.MenuOccurrences=Occurrences
 
-AddEdit.PreloadAuthors=remember entered authors
 
-AddEdit.InfoPanel=Info
+
+#=============================================================
+# SERVER
+#	net.sf.plantlore.server.manager
+#=============================================================
+Server.Login=Login
+Server.Host=Host
+Server.Next = Connect
+Server.NextTT = Connect to an existing server.
+Server.Create = Create
+Server.CreateTT = Create and start a new Plantlore server.
+
+Server.ConnectionsTotal = Connections Total
+Server.ConnectionsPerIP = Connections per IP
+Server.Timeout = Timeout
+Server.Manage=Connections
+
+Server.ServerSettings=Server settings
+Server.Password=Password
+Server.PasswordTT=The password that will protect the server from being manipulated by unauthorized persons.
+Server.Port = Port
+Server.PortTT=The port where the Plantlore server should listen.
+
+
+Server.DatabaseSettings=Database settings
+Server.DatabaseUser=User
+Server.DatabaseUserTT=The power user of the database. \nThe Plantlore server will use this login \nto gain access to the database engine.
+Server.DatabasePassword=Password
+Server.DatabasePasswordTT=The password of the power-user account. \nThe Plantlore server will use this password \nto gain access to the database engine.
+Server.DatabaseParameter=Parameter
+Server.DatabaseParameterTT=Some additional parameters the Plantlore server should use \nwhen connecting to the database, such as encoding.
+Server.DatabaseType = Database
+Server.DatabaseTypeTT=The database engine that contains the data.
+Server.DatabasePort = Port
+Server.DatabasePortTT=The port where the database engine listens.
+
+
+Server.Hide=Hide
+Server.HideTT=Abandon the Plantlore server (will not terminate the server).
+Server.Refresh=Refresh
+Server.RefreshTT=Reload the list of currently conntected users.
+Server.KickUser=Kick user
+Server.KickUserTT=Disconnect the selected user from the server.
+Server.Terminate=Terminate
+Server.TerminateTT=Terminate the Plantlore server and disconnect all its clients.
+Server.ListOfUsersTT=The list of currently connected users.
+
+
+Server.SettingsLoaded = Settings loaded.
+Server.SettingsSaved = Settings saved.
+Server.Info.CreatingNewServer = Creating a new server...
+Server.Info.StartingNewServer = Starting the server...
+Server.Info.ServerUpAndRunning = Server is up and running.
+Server.Info.ConnectingToServer = Connecting to the server...
+Server.Info.ClientsObtained = The list of clients refreshed.
+Server.Info.ClientKicked = The client {0} was kicked.
+Server.Info.Terminated = Server terminated (clients disconnected).
+

Modified: trunk/src/net/sf/plantlore/middleware/DBLayer.java
===================================================================
--- trunk/src/net/sf/plantlore/middleware/DBLayer.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/middleware/DBLayer.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -22,7 +22,7 @@
  * @author Tom&#225;&#353; Kova&#345;&#237;k, Erik Kratochv&#237;l
  */
 public interface DBLayer extends Remote, Serializable {
-    
+	
     /**
      *  Initialize database connection. Authenticate user and Load rights of this user
      *

Modified: trunk/src/net/sf/plantlore/middleware/DBLayerFactory.java
===================================================================
--- trunk/src/net/sf/plantlore/middleware/DBLayerFactory.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/middleware/DBLayerFactory.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -3,6 +3,7 @@
 import java.rmi.NotBoundException;
 import java.rmi.RemoteException;
 
+import net.sf.plantlore.client.login.DBInfo;
 import net.sf.plantlore.common.exception.DBLayerException;
 
 /** 
@@ -14,12 +15,7 @@
  */
 public interface DBLayerFactory {
 	
-	/** Create a new instance of the DBLayer that will manage the connection to the local database. 
-	 * 
-	 * @return	A new instance of the DBLayer mediating the connection between the client and the local database.
-	 */
-	DBLayer create();
-	
+
 	/** 
 	 * Create a new instance of the DBLayer that will manage the connection to the remote database.
 	 *  
@@ -29,7 +25,7 @@
 	 * @throws RemoteException		If the RMI encounters a problem.
 	 * @throws NotBoundException	If the server is not running on the specified port.
 	 */
-	DBLayer create(String host, int port) throws RemoteException, NotBoundException, DBLayerException;
+	DBLayer create(DBInfo settings) throws RemoteException, NotBoundException, DBLayerException;
 	
 	/** 
 	 * Destroy the DBLayer. This is a special measure, 

Modified: trunk/src/net/sf/plantlore/middleware/RMIDBLayerFactory.java
===================================================================
--- trunk/src/net/sf/plantlore/middleware/RMIDBLayerFactory.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/middleware/RMIDBLayerFactory.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -9,6 +9,8 @@
 import org.apache.log4j.Logger;
 
 import net.sf.plantlore.server.ConnectionInfo;
+import net.sf.plantlore.server.DatabaseSettings;
+import net.sf.plantlore.client.login.DBInfo;
 import net.sf.plantlore.common.exception.DBLayerException;
 import net.sf.plantlore.server.HibernateDBLayer;
 import net.sf.plantlore.middleware.RemoteDBLayerFactory;
@@ -39,38 +41,18 @@
   */
 public class RMIDBLayerFactory implements DBLayerFactory {
 	
-	private Logger logger; 
-
+	private Logger logger = Logger.getLogger(this.getClass().getPackage().getName()); 
+	
+	
 	/** Keep information about connections to databases. */
 	private Hashtable&lt;DBLayer, ConnectionInfo&gt; client = new Hashtable&lt;DBLayer, ConnectionInfo&gt;(4);
 	
+	
 	/** Create a new instance of DBLayerFactory. */
 	public RMIDBLayerFactory() {
-		logger = Logger.getLogger(this.getClass().getPackage().getName()); 
 	}
 	
-
-	/** 
-	 * Create a new local DBLayer.
-	 * &lt;br/&gt;
-	 * This method creates purely local DBLayer. The DBLayer object lives in the local JVM. 
-	 * No RMI gets involved here. 
-	 * It is meant for connections to local database - the overhead is minimalized.
-	 * 
-	 *  @return The local DBLayer object that mediates the connection with the local database.
-	 */
-	public synchronized DBLayer create() {
-		//Create a new DBLayer and save information about that connection 
-		DBLayer db = new HibernateDBLayer();
-		ConnectionInfo info = new ConnectionInfo(null, db, null, &quot;localhost (direct connection)&quot;);
-		client.put(db, info);
-		
-		logger.info(&quot;New DBLayer created: &quot; + info);
-		
-		return db;
-	}
 	
-
 	/**
 	 * Create a new DBLayer.
 	 * &lt;br/&gt;
@@ -85,11 +67,32 @@
 	 * @return A stub of the remote object that lives on the server and mediates the connection
 	 * with the remote database.
 	 */
-	public synchronized DBLayer create(String host, int port) throws RemoteException, NotBoundException, DBLayerException {
+	public synchronized DBLayer create(DBInfo settings) 
+	throws RemoteException, NotBoundException, DBLayerException {
 		// Some exceptional cases are handled specially.
-		if(host == null || host.equals(&quot;&quot;) || host.equalsIgnoreCase(&quot;localhost&quot;))
-			return create();
+		String host = settings.getHost();
 		
+		if(host == null || host.equals(&quot;&quot;) || host.equalsIgnoreCase(&quot;localhost&quot;)) {
+			
+			DatabaseSettings dbSettings = new DatabaseSettings(
+					settings.getDatabaseType(),
+					settings.getDatabasePort(),
+					settings.getDatabaseParameter(),
+					settings.getMasterUser(),
+					settings.getMasterPassword()
+			);
+			
+			DBLayer db = new HibernateDBLayer( dbSettings );
+			ConnectionInfo info = new ConnectionInfo(null, db, null, &quot;localhost (direct connection)&quot;);
+			client.put(db, info);
+			
+			logger.info(&quot;New DBLayer created: &quot; + info);
+			
+			return db;
+		}
+		
+		int port = settings.getPort();
+		
 		logger.debug(&quot;Creating a new DBLayer using the RMI:&quot;);
 		
 		// Connect to the remote server and obtain the RemoteDBLayerFactory

Added: trunk/src/net/sf/plantlore/server/DatabaseSettings.java
===================================================================
--- trunk/src/net/sf/plantlore/server/DatabaseSettings.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/DatabaseSettings.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -0,0 +1,45 @@
+package net.sf.plantlore.server;
+
+public class DatabaseSettings {
+	
+	private String connectionStringPrefix;
+	private String connectionStringSuffix;
+	private String masterUser;
+	private String masterPassword;
+	private int port;
+	private String database;
+	
+	
+	public DatabaseSettings(String database, int port, String suffix, String masterUser, String masterPassword) {
+		this.masterUser = masterUser;
+		this.masterPassword = masterPassword;
+		this.connectionStringSuffix = suffix;
+		this.database = database;
+		this.port = port;
+		this.connectionStringPrefix = 
+			&quot;jdbc:&quot;+database+&quot;://localhost&quot; + 
+			((port &gt; 0) ? &quot;:&quot;+(new Integer(port).toString())+&quot;/&quot; : &quot;/&quot;);
+	}
+	
+	
+	public String getMasterUser() {
+		return masterUser;
+	}
+	public String getMasterPassword() {
+		return masterPassword;
+	}
+	public String getConnectionStringSuffix() {
+		return connectionStringSuffix;
+	}
+	public String getConnectionStringPrefix() {
+		return connectionStringPrefix;
+	}
+	public String getDatabase() {
+		return database;
+	}
+	public int getPort() {
+		return port;
+	}
+	
+
+}

Modified: trunk/src/net/sf/plantlore/server/HibernateDBLayer.java
===================================================================
--- trunk/src/net/sf/plantlore/server/HibernateDBLayer.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/HibernateDBLayer.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -85,38 +85,28 @@
     private static final int UPDATE = 2;
     private static final int DELETE = 3;
     
-    private String databaseConnectionPrefix;
-    private String databaseMasterUser;
-    private String databaseMasterPassword;
+    private DatabaseSettings settings;
+    private String currentlyConnectedUser = &quot;&quot;;
     
+
+    
+    public HibernateDBLayer(DatabaseSettings settings) {
+    	this(null, settings);
+    }
+   
+    
     /**
      * Creates a new instance of HibernateDBLayer.
      * 
      *  @param undertaker The object that is responsible for cleanup if the client crashes. 
      */
-    public HibernateDBLayer(Undertaker undertaker) {
-    	this(undertaker, &quot;&quot;, null, null);
-    }
-    
-    public HibernateDBLayer(String databaseConnectionPrefix) {
-    	this(null, databaseConnectionPrefix, null, null);
-    }
-    
-    public HibernateDBLayer() {
-    	this(null, &quot;&quot;, null, null);
-    }
-    
-    
-    /** Creates a new instance of HibernateDBLayer */
     public HibernateDBLayer(
     		Undertaker undertaker, 
-    		String databaseConnectionPrefix,
-    		String user,
-    		String password) {
+    		DatabaseSettings settings) {
         logger = Logger.getLogger(this.getClass().getPackage().getName());
         logger.debug(&quot;      Constructing a new HibernateDBLayer ...&quot;);
         
-        this.databaseConnectionPrefix = databaseConnectionPrefix;
+        this.settings = settings;
         
         // Initialize pool of result sets, initial capacity = INITIAL POOL SIZE
         results = new Hashtable&lt;Integer, ScrollableResults&gt;(INITIAL_POOL_SIZE); 
@@ -128,9 +118,7 @@
         sessions = new Hashtable&lt;SelectQuery, Session&gt;(INITIAL_POOL_SIZE);
         
         this.undertaker = undertaker;
-        databaseMasterUser = user;
-        databaseMasterPassword = password;
-        
+       
         logger.debug(&quot;      completed.&quot;);
     }
     
@@ -149,6 +137,8 @@
         Configuration cfg;
         int result = 0;
         
+        currentlyConnectedUser = user;
+        
         // File containing Hibernate configuration
         configFile = new File(&quot;hibernate.cfg.xml&quot;);        
         // Load Hibernate configuration
@@ -160,14 +150,15 @@
             ex.setError(ex.ERROR_LOAD_CONFIG, null);
             throw ex;
         }
-        // TODO: this should be loaded from a configuration file on the server
-        // TEMPORARY CODE STARTS HERE
-        databaseMasterUser = user;
-        databaseMasterPassword = password;
-        // TEMPORARY CODE ENDS HERE
-        cfg.setProperty(&quot;hibernate.connection.url&quot;, databaseConnectionPrefix + dbID);
-        cfg.setProperty(&quot;hibernate.connection.username&quot;, databaseMasterUser);
-        cfg.setProperty(&quot;hibernate.connection.password&quot;, databaseMasterPassword);
+
+        if( settings.getConnectionStringSuffix() == null || &quot;&quot;.equals(settings.getConnectionStringSuffix()) )
+        	cfg.setProperty(&quot;hibernate.connection.url&quot;, settings.getConnectionStringPrefix() + dbID);
+        else
+        	cfg.setProperty(&quot;hibernate.connection.url&quot;, settings.getConnectionStringPrefix() + dbID 
+        			+ &quot;?&quot; + settings.getConnectionStringSuffix());
+        
+        cfg.setProperty(&quot;hibernate.connection.username&quot;, settings.getMasterUser());
+        cfg.setProperty(&quot;hibernate.connection.password&quot;, settings.getMasterPassword());
         try {
             // Build session factory
             sessionFactory = cfg.buildSessionFactory();
@@ -1851,8 +1842,14 @@
 	 * @see java.rmi.dgc.leaseValue
 	 */
 	public void unreferenced() { 
-		if(undertaker != null) undertaker.bury(this); 
+		if(undertaker != null) 
+			undertaker.bury(this); 
 	}
 	//===============================================================
-	              
+	  
+	
+	@Override
+	public String toString() {
+		return currentlyConnectedUser ; 
+	}
 }

Modified: trunk/src/net/sf/plantlore/server/Plantlore.java
===================================================================
--- trunk/src/net/sf/plantlore/server/Plantlore.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/Plantlore.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -3,10 +3,6 @@
 
 import java.io.IOException;
 import java.io.InputStream;
-/*
-import java.rmi.registry.LocateRegistry;
-import java.rmi.registry.Registry;
-*/
 import java.util.Properties;
 
 import javax.swing.JFrame;
@@ -32,31 +28,36 @@
 	private static final String LOGGER_PROPS = &quot;net/sf/plantlore/config/log4j.properties&quot;;
 	
 	
-	public void run() {
+	public void run(final boolean connectToExisting) {
 		// Load log4j settings
-        ClassLoader cl = this.getClass().getClassLoader();
-        InputStream is = cl.getResourceAsStream(LOGGER_PROPS);
-        Properties props = new Properties();
-        //FIXME:
-        try {
-            props.load(is);
-        } catch (IOException ex) {
-            ex.printStackTrace();
-        }
-        //maybe CHANGE to configureAndWatch()
-        PropertyConfigurator.configure(props);
-        
-        try {
-            L10n.load();
-        } catch (IOException ex) {
-            ex.printStackTrace();
-        }
-			
-		ServerMng model = new ServerMng();
-        ServerLoginView view = new ServerLoginView(model);
-        /*ServerMngChooseCtrl ctrl = */new ServerLoginCtrl(model, view);
+		try {
+			ClassLoader cl = this.getClass().getClassLoader();
+			InputStream is = cl.getResourceAsStream(LOGGER_PROPS);
+			Properties props = new Properties();
+			props.load(is);
+			PropertyConfigurator.configure(props);
+			L10n.load();
+		} catch (IOException ex) {
+			ex.printStackTrace();
+		}
+
+        java.awt.EventQueue.invokeLater(new Runnable(){
+        	public void run() {
+        		ServerMng model = new ServerMng();
+        		if(connectToExisting) {
+        			ServerLoginView view = new ServerLoginView(model);
+        			/*ServerMngChooseCtrl ctrl = */new ServerLoginCtrl(model, view);
+        			view.setVisible(true);
+        		}
+        		else {
+        			ServerCreateView view = new ServerCreateView(model);
+        			/*ServerMngChooseCtrl ctrl = */new ServerCreateCtrl(model, view);
+        			view.setVisible(true);
+        		}
+        	}
+        });
        	
-        view.setVisible(true);
+        
 	}
 	
 
@@ -72,58 +73,10 @@
             UIManager.setLookAndFeel(new PlasticXPLookAndFeel()); 
         } catch (Exception e) { e.printStackTrace(); JFrame.setDefaultLookAndFeelDecorated(true); }
 		
-		new Plantlore().run();
-		
-		/* ============================================================
-		 *  THIS HERE MAY COME IN HANDY...
-		 * ============================================================
-		int m = args.length, port = RMIServer.DEFAULT_PORT, id = -1;
-		String command = &quot;start&quot;, host = null;
-		
-		// Parse the command line.
-		if(m &gt;= 1) command = args[0];
-		if(m &gt;= 2) try { int c = Integer.parseInt(args[1]); port = c; }
-			catch(NumberFormatException e) { host = args[1]; }
-		if(m &gt;= 3) port = Integer.parseInt(args[2]);
-			
-		if(command.startsWith(&quot;kick&quot;)) {
-			id = Integer.parseInt(command.substring(5));
-			command = &quot;kick&quot;;
-		}
-		 
-		// The server interface.		
-		Server server = null ;
-		
-		// Take the appropriate action.
-		try {
-			if (command.equalsIgnoreCase(&quot;start&quot;)) {
-				try { 
-					server = new RMIServer(port);
-					server.start();
-				} 
-				catch (Exception e) { System.err.println(e); server.stop(true); }
-			} 
-			else {
-				Registry registry = LocateRegistry.getRegistry(host, port);
-				Guard guard = (Guard) registry.lookup(Guard.ID);
-				server = guard.certify(getPassword());
-				if(server == null) { System.err.println(&quot;&lt;!&gt; No server on that port.&quot;); return; }
-				if(command.equalsIgnoreCase(&quot;stop&quot;)) server.stop(true);
-				else {
-					Collection&lt;ConnectionInfo&gt; clients = server.getClients();
-					int c = 0;
-					if(command.equalsIgnoreCase(&quot;who&quot;)) {
-						for(ConnectionInfo info : clients) System.out.println(&quot;(&quot; + c++ + &quot;) &quot; + info);
-					}
-					else if(command.equalsIgnoreCase(&quot;kick&quot;)) {
-						for(ConnectionInfo info : clients) if(c++ == id) { server.disconnect(info); break; }
-					}
-					else System.err.println(&quot;&lt;?&gt; Unknown command.&quot;);
-				}
-					
-			}
-		} catch(Exception e) { System.err.println(e); }
-		============================================================ */
+        if(args.length &gt; 0 &amp;&amp; args[0].equalsIgnoreCase(&quot;connect&quot;))
+        	new Plantlore().run(true);
+        else
+        	new Plantlore().run(false);
 	}
 
 }

Modified: trunk/src/net/sf/plantlore/server/RMIRemoteDBLayerFactory.java
===================================================================
--- trunk/src/net/sf/plantlore/server/RMIRemoteDBLayerFactory.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/RMIRemoteDBLayerFactory.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -35,44 +35,40 @@
  * @version 1.0  final
  */
 public class RMIRemoteDBLayerFactory extends UnicastRemoteObject
-	implements RemoteDBLayerFactory, Undertaker {
+	implements RemoteDBLayerFactory {
 	
-	private Logger logger;
+	private Logger logger  = Logger.getLogger(this.getClass().getPackage().getName());;
 	
+	private ServerSettings  settings;
+	private Undertaker undertaker;
 	
-	/** 
-	 * Maximum number of connections from one IP = maximum number of DBLayer objects 
-	 * that can be created for users from this IP address.
-	 */
-	private int maxConnectionsPerIP = 81; // TODO: Nacitat z nejakyho settings...
+	/** Keep information about all connected clients. */
+	private Hashtable&lt;DBLayer, ConnectionInfo&gt; clients; 
+		
 	
-	/** 
-	 * Maximum number of clients = the total maximum number of DBLayer objects 
-	 * that can be created by this factory. 
-	 */
-	private int maxConnectionsTotal = 81; // TODO: Nacitat z nejakyho settings...
 	
-	/** Keep information about all connected clients. */
-	private Hashtable&lt;DBLayer, ConnectionInfo&gt; client = 
-		new Hashtable&lt;DBLayer, ConnectionInfo&gt;(2*maxConnectionsTotal);
-	
 	/** 
 	 * Create a new RMIDBLayerFactory.
 	 * @throws RemoteException If the RMI encounters an error.
 	 */
-	public RMIRemoteDBLayerFactory() throws RemoteException {
-		logger = Logger.getLogger(this.getClass().getPackage().getName());
+	public RMIRemoteDBLayerFactory(ServerSettings settings) throws RemoteException {
+		this.settings = settings;
+		clients = new Hashtable&lt;DBLayer, ConnectionInfo&gt;( settings.getConnectionsTotal() );
+		undertaker = new RMIUndertaker();
 	}
 	
+	
 	/** 
 	 * Return information about connected clients.
 	 * 
 	 *  @return Collection holding information about currently connected clients.
 	 */
 	protected synchronized ConnectionInfo[] getClients() {
-		Collection&lt;ConnectionInfo&gt; clients = client.values();
-		if(clients != null) return clients.toArray(new ConnectionInfo[0]);
-		else return null;
+		Collection&lt;ConnectionInfo&gt; currentlyConnectedClients = clients.values();
+		if(currentlyConnectedClients != null) 
+			return currentlyConnectedClients.toArray(new ConnectionInfo[0]);
+		else 
+			return null;
 	}
 	
 	/**
@@ -83,12 +79,14 @@
 	 * @return	True if the connection should be allowed.
 	 */
 	private boolean allowConnection(String host) {
-		if(client.size() &gt;= maxConnectionsTotal) return false;
+		if(clients.size() &gt;= settings.getConnectionsTotal()) 
+			return false;
 		
 		int c = 0;
-		for(ConnectionInfo info : client.values())
-			if(info.getClientHost().equalsIgnoreCase(host)) c++; // HA! C++ in Java! Strange!
-		return (c &lt; maxConnectionsPerIP);
+		for(ConnectionInfo info : clients.values())
+			if(info.getClientHost().equalsIgnoreCase(host)) 
+				c++; // HA! C++ in Java! Strange!
+		return (c &lt; settings.getConnectionsPerIP());
 	}
 	
 	/**
@@ -115,13 +113,13 @@
 		
 		// Create a new DBLayer, export it, and keep the stub. Also set the Undertaker of this object.
 		logger.debug(&quot;  Creating a new HibernateDBLayer ...&quot;);
-		DBLayer database = new HibernateDBLayer(this);
+		DBLayer database = new HibernateDBLayer( undertaker, settings.getDatabaseSettings() );
 		logger.debug(&quot;   completed!&quot;);
 		DBLayer stub = (DBLayer) UnicastRemoteObject.exportObject(database);
 		
 		// Save the information about this connection.
 		ConnectionInfo info = new ConnectionInfo(null, database, stub, clientHost); // remoteFactory is null because of security reasons.
-		client.put(stub, info);
+		clients.put(stub, info);
 		
 		logger.info(&quot;New remote DBLayer created &quot; + info);
 
@@ -157,7 +155,7 @@
 	 */	
 	public synchronized void destroy(DBLayer stub) throws RemoteException {
 		if(stub == null) return;
-		ConnectionInfo info = client.remove(stub);
+		ConnectionInfo info = clients.remove(stub);
 		if(info != null) disconnect(info.getDatabase());
 		else try {
 			logger.warn(RemoteServer.getClientHost() + &quot; attempts to destroy &quot; +
@@ -169,10 +167,10 @@
 	 * Terminate the connection of all connected clients. 
 	 */
 	synchronized void disconnectAll() {
-		for (ConnectionInfo info : client.values()) 
+		for (ConnectionInfo info : clients.values()) 
 			try { disconnect(info.getDatabase()); } catch (Exception e) {}		
 		// Clear the list of opened connections - none is now opened.
-		client.clear();
+		clients.clear();
 	}
 	
 	/** 
@@ -181,17 +179,23 @@
 	 * 
 	 * @see destroy 
 	 */
-	public synchronized void bury(DBLayer database) {
-		DBLayer stub = null;
-		
-		// Find the ConnectionInfo object among the connected clients 
-		for(ConnectionInfo info : client.values())
-			if(info.getDatabase().equals(database)) { stub = info.getStub(); break; }
-		
-		// Destroy it properly
-		try { destroy(stub); } catch(RemoteException e) {}
+	private class RMIUndertaker implements Undertaker { 
+		public synchronized final void bury(DBLayer database) {
+			DBLayer stub = null;
+			
+			// Find the ConnectionInfo object among the connected clients 
+			for(ConnectionInfo info : clients.values())
+				if(info.getDatabase().equals(database)) { 
+					stub = info.getStub(); 
+					break; 
+				}
+			
+			// Destroy it properly
+			try { 
+				destroy(stub); 
+			} catch(RemoteException e) {}
+		}
 	}
-	
 
 
 }

Modified: trunk/src/net/sf/plantlore/server/RMIServer.java
===================================================================
--- trunk/src/net/sf/plantlore/server/RMIServer.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/RMIServer.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -34,25 +34,22 @@
 	
 	
 	private RMIRemoteDBLayerFactory remoteFactory = null;
-	private int port = DEFAULT_PORT;
 	private Guard guard = null;
+	private ServerSettings settings;
 	
 	private Logger logger;
 
-	/** Create a new instance of RMIServer running on the default port. */
-	public RMIServer(String password) throws RemoteException, AlreadyBoundException {
-		this(DEFAULT_PORT, password);
-	}
+
 	
 	/** Create a new instance of RMIServer running on the specified port. */
-	public RMIServer(int port, String password) throws RemoteException, AlreadyBoundException {
-		this.port = port;
-		
+	public RMIServer(ServerSettings settings, String password) 
+	throws RemoteException, AlreadyBoundException {
 		logger = Logger.getLogger(this.getClass().getPackage().getName());
+		this.settings = settings;
 		
 		// Control object that will return the server after the client passed a valid certif. information
 		guard = new RMIServerControl(this, password);
-		RMI.bind(port, guard, Guard.ID);
+		RMI.bind(settings.getPort(), guard, Guard.ID);
 	}
 	
 	/** Get the information about the connected clients. */
@@ -67,8 +64,11 @@
 	 * @param client The client to be kicked.
 	 */
 	public synchronized void disconnect(ConnectionInfo client) {
-		try { remoteFactory.destroy(client.getStub()); } 
-		catch(RemoteException e) { logger.warn(e); }
+		try { 
+			remoteFactory.destroy(client.getStub()); 
+		} catch(RemoteException e) { 
+			logger.warn(e.getMessage()); 
+		}
 	}
 	
 	/** 
@@ -79,15 +79,23 @@
 	 */
 	public synchronized void start() throws AlreadyBoundException {
 		try {
+			
+			int timeout = Math.min(Math.max(1, settings.getTimeout()), 30) * 60000;
+			System.setProperty( &quot;java.rmi.dgc.leaseValue&quot;, new Integer(timeout).toString() );
+
 			// Locate (or start) the rmiregistry on the specified port
 			Registry registry;
-			try {	registry = LocateRegistry.createRegistry(port); }
-			catch(Exception e) { registry = LocateRegistry.getRegistry(port); }
+			try {	registry = LocateRegistry.createRegistry(settings.getPort()); }
+			catch(Exception e) { registry = LocateRegistry.getRegistry(settings.getPort()); }
 			// Create a new factory or reuse an existing one.
-			if(remoteFactory == null) remoteFactory = new RMIRemoteDBLayerFactory();
+			if(remoteFactory == null) remoteFactory = new RMIRemoteDBLayerFactory( settings );
 			// Bind the factory to the rmiregistry. 
 			registry.bind(RemoteDBLayerFactory.ID, remoteFactory);
+
 			
+			// Nemel by server exportnout i sebe??
+
+			
 			logger.info(&quot;The RemoteDBLayerFactory has been bound to the rmiregistry.&quot;);
 		}
 		catch(RemoteException e) { logger.error(e); }
@@ -98,15 +106,13 @@
 	 * The rmiregistry on the specified port is &lt;b&gt;not&lt;/b&gt; stopped, because some other programs may be still
 	 * using it!&lt;br/&gt;
 	 * This will terminate the server completely.
-	 * 
-	 * @param harsh		Be harsh and disconnect every client connected to the server.
 	 */
-	public synchronized void stop(boolean harsh) {
+	public synchronized void stop() {
 		if(remoteFactory == null) return;
 		try {
 			// 1. Unbind the RemoteDBLayerFactory from the rmiregistry 
 			// -&gt; noone can obtain the stub of the remote factory anymore
-			RMI.unbind(port, RemoteDBLayerFactory.ID);
+			RMI.unbind(settings.getPort(), RemoteDBLayerFactory.ID);
 			logger.debug(&quot;The RemoteDBLayerFactory was unbound from the rmiregistry.&quot;);
 			
 			// 2. Unexport the remote factory -&gt; noone can make a remote call anymore
@@ -114,26 +120,26 @@
 			logger.debug(&quot;The RemoteDBLayerFactory was unexported. It cannot accept remote calls now.&quot;);
 			
 			// 3. Disconnect all users from the server.
-			if(harsh) {
-				remoteFactory.disconnectAll();
-				logger.info(&quot;All clients were disconnected.&quot;);
-			}
+			remoteFactory.disconnectAll();
+			logger.info(&quot;All clients were disconnected.&quot;);
 
 			// 4. Disconnect this object from the RMI -&gt;
 			UnicastRemoteObject.unexportObject(this, true);
 			logger.info(&quot;The RMIServer now stops accepting remote calls.&quot;);
 			
 			// 5. Disconnect the control guard and unexport it
-			RMI.unbind(port, Guard.ID);
+			RMI.unbind(settings.getPort(), Guard.ID);
 			RMI.unexport(guard);
 			logger.debug(&quot;The ServerProxy is now unavailable.&quot;);
 			
 			logger.info(&quot;The Server terminates. Bye.&quot;);
 		}
-		catch(Exception e) { logger.error(e); }
+		catch(Exception e) { 
+			logger.error(e.getMessage()); 
+		}
 	}
+
 	
-	
 	/** 
 	 * Initialize the codebase java.rmi.server.property to the specified directory or the
 	 * current working directory if the specified directory is null.

Modified: trunk/src/net/sf/plantlore/server/RMIServerControl.java
===================================================================
--- trunk/src/net/sf/plantlore/server/RMIServerControl.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/RMIServerControl.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -14,9 +14,9 @@
 	}
 	
 	public Server certify(String authorizationInfo) throws RemoteException, CertificationException {
-		if(authorizationInfo.equals(password)) return server;
+		if(authorizationInfo.equals(password)) 
+			return server;
 		throw new CertificationException(&quot;Wrong password.&quot;);
-		//return null;
 	}
 	
 }

Modified: trunk/src/net/sf/plantlore/server/Server.java
===================================================================
--- trunk/src/net/sf/plantlore/server/Server.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/Server.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -39,12 +39,10 @@
 	void start() throws RemoteException, AlreadyBoundException;
 	
 	/**
-	 * Terminate the server. If &lt;code&gt;harsh&lt;/code&gt; is true, the server terminates immediately,
-	 * if not, it waits, until the last client disconnects. 
+	 * Terminate the server. 
 	 * 
-	 * @param harsh Should all currently connected clients be disconnected?
 	 * @throws RemoteException if the RMI encounters an error (network/server).
 	 */
-	void stop(boolean harsh) throws RemoteException;
+	void stop() throws RemoteException;
 	
 }

Added: trunk/src/net/sf/plantlore/server/ServerSettings.java
===================================================================
--- trunk/src/net/sf/plantlore/server/ServerSettings.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/ServerSettings.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -0,0 +1,37 @@
+package net.sf.plantlore.server;
+
+public class ServerSettings {
+
+	private int port;
+	private int timeout;
+	private int connectionsTotal;
+	private int connectionsPerIP;
+	private DatabaseSettings databaseSettings;
+	
+	
+	public ServerSettings(int port, int timeout, int connectionsTotal, int connectionsPerIP, DatabaseSettings databaseSettings) {
+		this.port = port;
+		this.timeout = timeout;
+		this.connectionsTotal = connectionsTotal;
+		this.connectionsPerIP = connectionsPerIP;
+		this.databaseSettings = databaseSettings;
+	}
+
+	public int getConnectionsPerIP() {
+		return connectionsPerIP;
+	}
+	public int getConnectionsTotal() {
+		return connectionsTotal;
+	}
+	public DatabaseSettings getDatabaseSettings() {
+		return databaseSettings;
+	}
+	public int getPort() {
+		return port;
+	}
+	public int getTimeout() {
+		return timeout;
+	}
+	
+	
+}

Added: trunk/src/net/sf/plantlore/server/manager/ServerCreateCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerCreateCtrl.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/manager/ServerCreateCtrl.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -0,0 +1,98 @@
+package net.sf.plantlore.server.manager;
+
+import java.awt.event.ActionEvent;
+
+import javax.swing.AbstractAction;
+import javax.swing.ImageIcon;
+import javax.swing.JOptionPane;
+
+import net.sf.plantlore.client.resources.Resource;
+import net.sf.plantlore.l10n.L10n;
+import net.sf.plantlore.server.DatabaseSettings;
+import net.sf.plantlore.server.RMIServer;
+import net.sf.plantlore.server.ServerSettings;
+
+public class ServerCreateCtrl {
+	
+	private ServerMng model;
+	private ServerCreateView view;
+	private ServerMngView mngView;
+	
+	public ServerCreateCtrl(ServerMng model, ServerCreateView view) {
+		this.model = model;
+		this.view = view;
+		
+		view.next.setAction( new CreateServerAction() );
+	}
+	
+	private class CreateServerAction extends AbstractAction {
+		public CreateServerAction() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Server.CreateTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Server.Create&quot;));
+            ImageIcon icon = Resource.createIcon(&quot;Server.Create.gif&quot;);
+			if(icon != null) putValue(SMALL_ICON, icon);
+		}
+		public void actionPerformed(ActionEvent arg0) {
+			// Take the stored information.
+			ServerSettings settings = model.getSettings();
+			
+			// Gather the information from the dialog. 
+			try {
+				// About the server.
+				String serverPassword = new String( view.serverPassword.getPassword() );
+				int serverPort;
+				try {
+					serverPort = Integer.parseInt(view.serverPort.getText());
+				} catch(Exception e) { serverPort = RMIServer.DEFAULT_PORT; }
+				
+				// About the database.
+				String database = ((javax.swing.JTextField)view.databaseType.getEditor().getEditorComponent()).getText(),
+				databasePassword = new String( view.databasePassword.getPassword() ),
+				databaseUser = view.databaseUser.getText(),
+				suffix = view.databaseParameter.getText();
+				
+				int databasePort; 
+				databasePort = Integer.parseInt(view.databasePort.getText());
+				
+				settings = new ServerSettings(
+						serverPort, 
+						settings.getTimeout(), // use the stored values
+						settings.getConnectionsTotal(),  // use the stored values
+						settings.getConnectionsPerIP(), // use the stored values
+						new DatabaseSettings(
+								database, 
+								databasePort, 
+								suffix, 
+								databaseUser, 
+								databasePassword)
+						);
+				
+				// Save those settings.
+				model.setSettings( settings );
+				
+				// Create and run a new server.
+				if( model.startNewServer(serverPassword) ){
+					// Hide this window, create and display the ServerMngView instead.
+					view.setVisible(false);
+//					view.dispose();
+					
+					mngView = new ServerMngView(model);
+					mngView.setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
+					/*mngCtrl = */ new ServerMngCtrl(model, mngView);
+					mngView.setVisible(true);
+				}
+
+			} catch(final Exception e) {
+				java.awt.EventQueue.invokeLater(new Runnable() {
+					public void run() {
+						JOptionPane.showMessageDialog(null,
+								e.getMessage(),
+							    L10n.getString(&quot;Error.MissingInformation&quot;),
+							    JOptionPane.ERROR_MESSAGE);						
+					}
+				});
+			}
+		}
+	}
+
+}

Added: trunk/src/net/sf/plantlore/server/manager/ServerCreateView.form
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerCreateView.form	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/manager/ServerCreateView.form	2006-06-03 16:48:24 UTC (rev 428)
@@ -0,0 +1,372 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
+
+&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JFrameFormInfo&quot;&gt;
+  &lt;Properties&gt;
+    &lt;Property name=&quot;defaultCloseOperation&quot; type=&quot;int&quot; value=&quot;2&quot;/&gt;
+    &lt;Property name=&quot;title&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+      &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Create&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+    &lt;/Property&gt;
+    &lt;Property name=&quot;resizable&quot; type=&quot;boolean&quot; value=&quot;false&quot;/&gt;
+  &lt;/Properties&gt;
+  &lt;SyntheticProperties&gt;
+    &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
+  &lt;/SyntheticProperties&gt;
+  &lt;AuxValues&gt;
+    &lt;AuxValue name=&quot;FormSettings_generateMnemonicsCode&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
+    &lt;AuxValue name=&quot;FormSettings_listenerGenerationStyle&quot; type=&quot;java.lang.Integer&quot; value=&quot;0&quot;/&gt;
+    &lt;AuxValue name=&quot;FormSettings_variablesLocal&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
+    &lt;AuxValue name=&quot;FormSettings_variablesModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;2&quot;/&gt;
+  &lt;/AuxValues&gt;
+
+  &lt;Layout&gt;
+    &lt;DimensionLayout dim=&quot;0&quot;&gt;
+      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+          &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;help&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace pref=&quot;307&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;next&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+          &lt;/Group&gt;
+          &lt;Component id=&quot;status&quot; alignment=&quot;0&quot; pref=&quot;453&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;jPanel2&quot; alignment=&quot;0&quot; min=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;103&quot; alignment=&quot;0&quot; groupAlignment=&quot;1&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;jPanel1&quot; alignment=&quot;0&quot; pref=&quot;433&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                      &lt;Component id=&quot;plantloreLogo&quot; alignment=&quot;0&quot; pref=&quot;433&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+                  &lt;/Group&gt;
+              &lt;/Group&gt;
+              &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+          &lt;/Group&gt;
+      &lt;/Group&gt;
+    &lt;/DimensionLayout&gt;
+    &lt;DimensionLayout dim=&quot;1&quot;&gt;
+      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;plantloreLogo&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;jPanel1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;jPanel2&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;next&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;help&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+              &lt;EmptySpace min=&quot;-2&quot; pref=&quot;11&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;status&quot; min=&quot;-2&quot; pref=&quot;18&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+          &lt;/Group&gt;
+      &lt;/Group&gt;
+    &lt;/DimensionLayout&gt;
+  &lt;/Layout&gt;
+  &lt;SubComponents&gt;
+    &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;plantloreLogo&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;background&quot; type=&quot;java.awt.Color&quot; editor=&quot;org.netbeans.beaninfo.editors.ColorEditor&quot;&gt;
+          &lt;Color blue=&quot;0&quot; green=&quot;0&quot; red=&quot;0&quot; type=&quot;rgb&quot;/&gt;
+        &lt;/Property&gt;
+        &lt;Property name=&quot;preferredSize&quot; type=&quot;java.awt.Dimension&quot; editor=&quot;org.netbeans.beaninfo.editors.DimensionEditor&quot;&gt;
+          &lt;Dimension value=&quot;[300, 100]&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+
+      &lt;Layout&gt;
+        &lt;DimensionLayout dim=&quot;0&quot;&gt;
+          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;EmptySpace min=&quot;0&quot; pref=&quot;433&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+          &lt;/Group&gt;
+        &lt;/DimensionLayout&gt;
+        &lt;DimensionLayout dim=&quot;1&quot;&gt;
+          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;EmptySpace min=&quot;0&quot; pref=&quot;100&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+          &lt;/Group&gt;
+        &lt;/DimensionLayout&gt;
+      &lt;/Layout&gt;
+    &lt;/Container&gt;
+    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;next&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Create&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
+    &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;jPanel1&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;border&quot; type=&quot;javax.swing.border.Border&quot; editor=&quot;org.netbeans.modules.form.editors2.BorderEditor&quot;&gt;
+          &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.TitledBorderInfo&quot;&gt;
+            &lt;TitledBorder title=&quot;Server settings&quot;&gt;
+              &lt;Border PropertyName=&quot;innerBorder&quot; info=&quot;null&quot;/&gt;
+              &lt;ResourceString PropertyName=&quot;titleX&quot; bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.ServerSettings&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/TitledBorder&gt;
+          &lt;/Border&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+
+      &lt;Layout&gt;
+        &lt;DimensionLayout dim=&quot;0&quot;&gt;
+          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;Group type=&quot;102&quot; max=&quot;-2&quot; attributes=&quot;0&quot;&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;jLabel2&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;serverPassword&quot; pref=&quot;270&quot; max=&quot;32767&quot; attributes=&quot;2&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;jLabel1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;serverPort&quot; min=&quot;-2&quot; pref=&quot;50&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+          &lt;/Group&gt;
+        &lt;/DimensionLayout&gt;
+        &lt;DimensionLayout dim=&quot;1&quot;&gt;
+          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;jLabel2&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;serverPort&quot; alignment=&quot;3&quot; min=&quot;-2&quot; pref=&quot;21&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jLabel1&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;serverPassword&quot; alignment=&quot;3&quot; min=&quot;-2&quot; pref=&quot;21&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
+                  &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+          &lt;/Group&gt;
+        &lt;/DimensionLayout&gt;
+      &lt;/Layout&gt;
+      &lt;SubComponents&gt;
+        &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel2&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Password&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JPasswordField&quot; name=&quot;serverPassword&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.PasswordTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel1&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Port&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;serverPort&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;horizontalAlignment&quot; type=&quot;int&quot; value=&quot;2&quot;/&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;1099&quot;/&gt;
+            &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.PortTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
+      &lt;/SubComponents&gt;
+    &lt;/Container&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;status&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;border&quot; type=&quot;javax.swing.border.Border&quot; editor=&quot;org.netbeans.modules.form.editors2.BorderEditor&quot;&gt;
+          &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.BevelBorderInfo&quot;&gt;
+            &lt;BevelBorder bevelType=&quot;1&quot;/&gt;
+          &lt;/Border&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+    &lt;/Component&gt;
+    &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;jPanel2&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;border&quot; type=&quot;javax.swing.border.Border&quot; editor=&quot;org.netbeans.modules.form.editors2.BorderEditor&quot;&gt;
+          &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.TitledBorderInfo&quot;&gt;
+            &lt;TitledBorder title=&quot;Database settings&quot;&gt;
+              &lt;Border PropertyName=&quot;innerBorder&quot; info=&quot;null&quot;/&gt;
+              &lt;ResourceString PropertyName=&quot;titleX&quot; bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabaseSettings&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/TitledBorder&gt;
+          &lt;/Border&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+
+      &lt;Layout&gt;
+        &lt;DimensionLayout dim=&quot;0&quot;&gt;
+          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;jLabel5&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jLabel3&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jLabel7&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Component id=&quot;databaseType&quot; pref=&quot;264&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jLabel6&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;databasePort&quot; min=&quot;-2&quot; pref=&quot;51&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;/Group&gt;
+                      &lt;Component id=&quot;databaseParameter&quot; pref=&quot;343&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Component id=&quot;databaseUser&quot; pref=&quot;149&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jLabel4&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;databasePassword&quot; pref=&quot;140&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;/Group&gt;
+                  &lt;/Group&gt;
+                  &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+          &lt;/Group&gt;
+        &lt;/DimensionLayout&gt;
+        &lt;DimensionLayout dim=&quot;1&quot;&gt;
+          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+              &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;jLabel5&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;databasePort&quot; alignment=&quot;3&quot; min=&quot;-2&quot; pref=&quot;22&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jLabel6&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;databaseType&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
+                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;jLabel3&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;databaseUser&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jLabel4&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;databasePassword&quot; alignment=&quot;3&quot; min=&quot;-2&quot; pref=&quot;19&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
+                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;jLabel7&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;databaseParameter&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
+                  &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+          &lt;/Group&gt;
+        &lt;/DimensionLayout&gt;
+      &lt;/Layout&gt;
+      &lt;SubComponents&gt;
+        &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel5&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabaseType&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JComboBox&quot; name=&quot;databaseType&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;editable&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
+            &lt;Property name=&quot;model&quot; type=&quot;javax.swing.ComboBoxModel&quot; editor=&quot;org.netbeans.modules.form.editors2.ComboBoxModelEditor&quot;&gt;
+              &lt;StringArray count=&quot;4&quot;&gt;
+                &lt;StringItem index=&quot;0&quot; value=&quot;postgresql&quot;/&gt;
+                &lt;StringItem index=&quot;1&quot; value=&quot;firebirdsql&quot;/&gt;
+                &lt;StringItem index=&quot;2&quot; value=&quot;mysql&quot;/&gt;
+                &lt;StringItem index=&quot;3&quot; value=&quot;oraclesql&quot;/&gt;
+              &lt;/StringArray&gt;
+            &lt;/Property&gt;
+            &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabaseTypeTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel6&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabasePort&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;databasePort&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;horizontalAlignment&quot; type=&quot;int&quot; value=&quot;2&quot;/&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;5432&quot;/&gt;
+            &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabasePortTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel3&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabaseUser&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;databaseUser&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabaseUserTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel4&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabasePassword&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JPasswordField&quot; name=&quot;databasePassword&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabasePasswordTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel7&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabaseParameter&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+        &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;databaseParameter&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.DatabaseParameterTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
+      &lt;/SubComponents&gt;
+    &lt;/Container&gt;
+    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;help&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Common.Help&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
+  &lt;/SubComponents&gt;
+&lt;/Form&gt;

Added: trunk/src/net/sf/plantlore/server/manager/ServerCreateView.java
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerCreateView.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/manager/ServerCreateView.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -0,0 +1,289 @@
+/*
+ * ServerCreateView.java
+ *
+ * Created on 1. &#269;erven 2006, 19:21
+ */
+
+package net.sf.plantlore.server.manager;
+
+import java.util.Observable;
+import java.util.Observer;
+
+import javax.swing.JOptionPane;
+
+import net.sf.plantlore.l10n.L10n;
+import net.sf.plantlore.server.ServerSettings;
+
+/**
+ *
+ * @author  yaa
+ */
+public class ServerCreateView extends javax.swing.JFrame implements Observer {
+    
+	
+//	private ServerMng model;
+
+	
+    /** Creates new form ServerCreateView */
+    public ServerCreateView(ServerMng model) {
+    	model.addObserver(this);
+        initComponents();
+        getRootPane().setDefaultButton(next);
+        setLocationRelativeTo(null); // center of the screen
+        
+        // Initialize the components' contents.
+        ServerSettings settings = model.getSettings();
+        if(settings != null) {
+        	// Server
+        	serverPort.setText( new Integer(settings.getPort()).toString() );
+        	// Database
+        	databasePort.setText( new Integer(settings.getDatabaseSettings().getPort()).toString() );
+        	( (javax.swing.JTextField)databaseType.getEditor().getEditorComponent() )
+        	.setText( settings.getDatabaseSettings().getDatabase() );
+        	databaseUser.setText( settings.getDatabaseSettings().getMasterUser() );
+        	databasePassword.setText( settings.getDatabaseSettings().getMasterPassword() );
+        	databaseParameter.setText( settings.getDatabaseSettings().getConnectionStringSuffix() );
+        }
+    }
+    
+    /** This method is called from within the constructor to
+     * initialize the form.
+     * WARNING: Do NOT modify this code. The content of this method is
+     * always regenerated by the Form Editor.
+     */
+    // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot; Generated Code &quot;&gt;//GEN-BEGIN:initComponents
+    private void initComponents() {
+        plantloreLogo = new javax.swing.JPanel();
+        next = new javax.swing.JButton();
+        jPanel1 = new javax.swing.JPanel();
+        jLabel2 = new javax.swing.JLabel();
+        serverPassword = new javax.swing.JPasswordField();
+        jLabel1 = new javax.swing.JLabel();
+        serverPort = new javax.swing.JTextField();
+        status = new javax.swing.JLabel();
+        jPanel2 = new javax.swing.JPanel();
+        jLabel5 = new javax.swing.JLabel();
+        databaseType = new javax.swing.JComboBox();
+        jLabel6 = new javax.swing.JLabel();
+        databasePort = new javax.swing.JTextField();
+        jLabel3 = new javax.swing.JLabel();
+        databaseUser = new javax.swing.JTextField();
+        jLabel4 = new javax.swing.JLabel();
+        databasePassword = new javax.swing.JPasswordField();
+        jLabel7 = new javax.swing.JLabel();
+        databaseParameter = new javax.swing.JTextField();
+        help = new javax.swing.JButton();
+
+        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
+        setTitle(L10n.getString(&quot;Server.Create&quot;));
+        setResizable(false);
+        plantloreLogo.setBackground(new java.awt.Color(0, 0, 0));
+        plantloreLogo.setPreferredSize(new java.awt.Dimension(300, 100));
+        org.jdesktop.layout.GroupLayout plantloreLogoLayout = new org.jdesktop.layout.GroupLayout(plantloreLogo);
+        plantloreLogo.setLayout(plantloreLogoLayout);
+        plantloreLogoLayout.setHorizontalGroup(
+            plantloreLogoLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(0, 433, Short.MAX_VALUE)
+        );
+        plantloreLogoLayout.setVerticalGroup(
+            plantloreLogoLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(0, 100, Short.MAX_VALUE)
+        );
+
+        next.setText(L10n.getString(&quot;Server.Create&quot;));
+
+        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(null, L10n.getString(&quot;Server.ServerSettings&quot;)));
+        jLabel2.setText(L10n.getString(&quot;Server.Password&quot;));
+
+        serverPassword.setToolTipText(L10n.getString(&quot;Server.PasswordTT&quot;));
+
+        jLabel1.setText(L10n.getString(&quot;Server.Port&quot;));
+
+        serverPort.setHorizontalAlignment(javax.swing.JTextField.LEFT);
+        serverPort.setText(&quot;1099&quot;);
+        serverPort.setToolTipText(L10n.getString(&quot;Server.PortTT&quot;));
+
+        org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
+        jPanel1.setLayout(jPanel1Layout);
+        jPanel1Layout.setHorizontalGroup(
+            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(jPanel1Layout.createSequentialGroup()
+                .addContainerGap()
+                .add(jLabel2)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(serverPassword, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 270, Short.MAX_VALUE)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(jLabel1)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(serverPort, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 50, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                .addContainerGap())
+        );
+        jPanel1Layout.setVerticalGroup(
+            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(jPanel1Layout.createSequentialGroup()
+                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel2)
+                    .add(serverPort, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 21, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                    .add(jLabel1)
+                    .add(serverPassword, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 21, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+        );
+
+        status.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED));
+
+        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(null, L10n.getString(&quot;Server.DatabaseSettings&quot;)));
+        jLabel5.setText(L10n.getString(&quot;Server.DatabaseType&quot;));
+
+        databaseType.setEditable(true);
+        databaseType.setModel(new javax.swing.DefaultComboBoxModel(new String[] { &quot;postgresql&quot;, &quot;firebirdsql&quot;, &quot;mysql&quot;, &quot;oraclesql&quot; }));
+        databaseType.setToolTipText(L10n.getString(&quot;Server.DatabaseTypeTT&quot;));
+
+        jLabel6.setText(L10n.getString(&quot;Server.DatabasePort&quot;));
+
+        databasePort.setHorizontalAlignment(javax.swing.JTextField.LEFT);
+        databasePort.setText(&quot;5432&quot;);
+        databasePort.setToolTipText(L10n.getString(&quot;Server.DatabasePortTT&quot;));
+
+        jLabel3.setText(L10n.getString(&quot;Server.DatabaseUser&quot;));
+
+        databaseUser.setToolTipText(L10n.getString(&quot;Server.DatabaseUserTT&quot;));
+
+        jLabel4.setText(L10n.getString(&quot;Server.DatabasePassword&quot;));
+
+        databasePassword.setToolTipText(L10n.getString(&quot;Server.DatabasePasswordTT&quot;));
+
+        jLabel7.setText(L10n.getString(&quot;Server.DatabaseParameter&quot;));
+
+        databaseParameter.setToolTipText(L10n.getString(&quot;Server.DatabaseParameterTT&quot;));
+
+        org.jdesktop.layout.GroupLayout jPanel2Layout = new org.jdesktop.layout.GroupLayout(jPanel2);
+        jPanel2.setLayout(jPanel2Layout);
+        jPanel2Layout.setHorizontalGroup(
+            jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(jPanel2Layout.createSequentialGroup()
+                .addContainerGap()
+                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                    .add(jLabel5)
+                    .add(jLabel3)
+                    .add(jLabel7))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                    .add(jPanel2Layout.createSequentialGroup()
+                        .add(databaseType, 0, 264, Short.MAX_VALUE)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                        .add(jLabel6)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                        .add(databasePort, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 51, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                    .add(databaseParameter, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 343, Short.MAX_VALUE)
+                    .add(jPanel2Layout.createSequentialGroup()
+                        .add(databaseUser, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 149, Short.MAX_VALUE)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                        .add(jLabel4)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                        .add(databasePassword, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 140, Short.MAX_VALUE)))
+                .addContainerGap())
+        );
+        jPanel2Layout.setVerticalGroup(
+            jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(jPanel2Layout.createSequentialGroup()
+                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel5)
+                    .add(databasePort, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 22, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                    .add(jLabel6)
+                    .add(databaseType, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel3)
+                    .add(databaseUser, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                    .add(jLabel4)
+                    .add(databasePassword, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 19, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(jLabel7)
+                    .add(databaseParameter, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+        );
+
+        help.setText(L10n.getString(&quot;Common.Help&quot;));
+
+        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
+        getContentPane().setLayout(layout);
+        layout.setHorizontalGroup(
+            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
+                .addContainerGap()
+                .add(help)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 307, Short.MAX_VALUE)
+                .add(next)
+                .addContainerGap())
+            .add(status, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 453, Short.MAX_VALUE)
+            .add(layout.createSequentialGroup()
+                .addContainerGap()
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
+                    .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel2, 0, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                    .add(org.jdesktop.layout.GroupLayout.LEADING, layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
+                        .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 433, Short.MAX_VALUE)
+                        .add(org.jdesktop.layout.GroupLayout.LEADING, plantloreLogo, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 433, Short.MAX_VALUE)))
+                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+        );
+        layout.setVerticalGroup(
+            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(layout.createSequentialGroup()
+                .addContainerGap()
+                .add(plantloreLogo, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(jPanel2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(next)
+                    .add(help))
+                .add(11, 11, 11)
+                .add(status, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 18, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+        );
+        pack();
+    }// &lt;/editor-fold&gt;//GEN-END:initComponents
+    
+    
+    // Variables declaration - do not modify//GEN-BEGIN:variables
+    protected javax.swing.JTextField databaseParameter;
+    protected javax.swing.JPasswordField databasePassword;
+    protected javax.swing.JTextField databasePort;
+    protected javax.swing.JComboBox databaseType;
+    protected javax.swing.JTextField databaseUser;
+    protected javax.swing.JButton help;
+    private javax.swing.JLabel jLabel1;
+    private javax.swing.JLabel jLabel2;
+    private javax.swing.JLabel jLabel3;
+    private javax.swing.JLabel jLabel4;
+    private javax.swing.JLabel jLabel5;
+    private javax.swing.JLabel jLabel6;
+    private javax.swing.JLabel jLabel7;
+    private javax.swing.JPanel jPanel1;
+    private javax.swing.JPanel jPanel2;
+    protected javax.swing.JButton next;
+    protected javax.swing.JPanel plantloreLogo;
+    protected javax.swing.JPasswordField serverPassword;
+    protected javax.swing.JTextField serverPort;
+    private javax.swing.JLabel status;
+    // End of variables declaration//GEN-END:variables
+
+    
+	public void update(Observable source, final Object parameter) {
+		java.awt.EventQueue.invokeLater(new Runnable() {
+			public void run() {
+				if(parameter instanceof String)
+					status.setText( &quot; &quot; + (String)parameter );
+				else if(parameter instanceof Exception) {
+					JOptionPane.showMessageDialog(null,
+							((Exception)parameter).getMessage(),
+						    L10n.getString(&quot;Error.ServerLoginFailed&quot;),
+						    JOptionPane.ERROR_MESSAGE);
+				}
+			}
+		});
+	}
+	
+    
+}

Modified: trunk/src/net/sf/plantlore/server/manager/ServerLoginCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerLoginCtrl.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/manager/ServerLoginCtrl.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -1,30 +1,26 @@
 package net.sf.plantlore.server.manager;
 
 import java.awt.event.ActionEvent;
-import java.rmi.AlreadyBoundException;
-import java.rmi.NotBoundException;
-import java.rmi.RemoteException;
 
 import javax.swing.AbstractAction;
-import javax.swing.JOptionPane;
+import javax.swing.ImageIcon;
 
-
+import net.sf.plantlore.client.resources.Resource;
 import net.sf.plantlore.l10n.L10n;
-import net.sf.plantlore.server.CertificationException;
 
 /**
  * 
  * @author Erik Kratochv&#237;l (<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">discontinuum at gmail.com</A>)
  * @since 2006-04-21
- *
+ * @version GR-8
  */
 public class ServerLoginCtrl {
 	
 	private ServerMng model;
 	private ServerLoginView view;
 	
-	private ServerMngView serverView;
-	private ServerMngCtrl serverCtrl;
+	private ServerMngView serverMngView;
+//	private ServerMngCtrl serverMngCtrl;
 	
 	
 	
@@ -32,93 +28,39 @@
 		this.view = view;
 		this.model = model;
 		
-		view.next.addActionListener(new ConnectCreate());
-		view.connectExisting.addActionListener(new SelectExisting());
-		view.createNew.addActionListener(new SelectNew());
-		
-		serverView = new ServerMngView(model);
-		serverCtrl = new ServerMngCtrl(model, serverView);
+		view.next.setAction(new Connect());
 	}
 	
 	
-	class ConnectCreate extends AbstractAction {
-		public ConnectCreate() {
-            putValue(NAME, L10n.getString(&quot;Continue&quot;));
-            putValue(SHORT_DESCRIPTION, L10n.getString(&quot;ContinueTT&quot;));
-            putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Continue&quot;));            
-        }
+	class Connect extends AbstractAction {
+		public Connect() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Server.NextTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Server.Next&quot;));
+            ImageIcon icon = Resource.createIcon(&quot;Server.Connect.gif&quot;);
+			if(icon != null) putValue(SMALL_ICON, icon);
+		}
 		
 		public void actionPerformed(ActionEvent e) {
 			String hp = view.host.getText(), host;
-			int t = hp.indexOf(':'), port = net.sf.plantlore.server.RMIServer.DEFAULT_PORT;
-			if(t &lt; 0) host = hp;
-			else { host = hp.substring(0, t); port = Integer.parseInt(hp.substring(t + 1)); }
-			try {
+			int t = hp.indexOf(':'), 
+			port = net.sf.plantlore.server.RMIServer.DEFAULT_PORT;
+			if(t &lt; 0) 
+				host = hp;
+			else { 
+				host = hp.substring(0, t); 
+				port = Integer.parseInt(hp.substring(t + 1)); 
+			}
 				
-				model.actAsInstructed(host, port, new String(view.password.getPassword()));
+			if( model.connectToRunningServer(host, port, new String(view.password.getPassword())) ) {
+				// Everything's fine.
+				view.setVisible(false);
 				
-			} catch(RemoteException re) { 
-				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;errorRemoteException&quot;),
-					    L10n.getString(&quot;errorRemoteExceptionTitle&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-				return;
-			} catch(AlreadyBoundException abe) {
-				int response =
-				JOptionPane.showOptionDialog(view,
-					    L10n.getString(&quot;questionAlreadyBoundException&quot;),
-					    L10n.getString(&quot;questionAlreadyBoundExceptionTitle&quot;),
-					    JOptionPane.OK_CANCEL_OPTION,
-					    JOptionPane.WARNING_MESSAGE,
-					    null,
-					    null,
-					    null);
-				if(response == JOptionPane.OK_OPTION) {
-					view.connectExisting.doClick();
-					view.next.doClick();
-				}
-				return;
-			} catch(NotBoundException nbe) {
-				JOptionPane.showMessageDialog(view,
-					    L10n.getString(&quot;errorNotBoundException&quot;),
-					    L10n.getString(&quot;errorNotBoundExceptionTitle&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-				return;
+				serverMngView = new ServerMngView(model);
+				serverMngView.setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
+				/*serverMngCtrl = */new ServerMngCtrl(model, serverMngView);
+				serverMngView.setVisible(true);
 			}
-			catch(CertificationException ce) {
-				JOptionPane.showMessageDialog(view,
-					    L10n.getString(&quot;errorCertificationException&quot;),
-					    L10n.getString(&quot;errorCertificationExceptionTitle&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-				return;
-			}
-			
-			// Everything's fine in here.
-			view.setVisible(false);
-			serverView.setVisible(true);
 		}
 	}
-	
-	class SelectNew extends AbstractAction {
-		public SelectNew() {
-            putValue(NAME, L10n.getString(&quot;SelectNew&quot;));
-            putValue(SHORT_DESCRIPTION, L10n.getString(&quot;SelectNewTT&quot;));
-            putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;SelectNew&quot;));            
-        }
-		public void actionPerformed(ActionEvent e) {
-			model.setMode(ServerMng.Mode.CREATE_NEW);
-		}
-	}
-	
-	class SelectExisting extends AbstractAction {
-		public SelectExisting() {
-            putValue(NAME, L10n.getString(&quot;SelectExisting&quot;));
-            putValue(SHORT_DESCRIPTION, L10n.getString(&quot;SelectExistingTT&quot;));
-            putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;SelectExisting&quot;));            
-        }
-		public void actionPerformed(ActionEvent e) {
-			model.setMode(ServerMng.Mode.CONNECT_EXISTING);
-		}
-	}
 
 }

Modified: trunk/src/net/sf/plantlore/server/manager/ServerLoginView.form
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerLoginView.form	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/manager/ServerLoginView.form	2006-06-03 16:48:24 UTC (rev 428)
@@ -1,12 +1,12 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
 
-&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JDialogFormInfo&quot;&gt;
-  &lt;NonVisualComponents&gt;
-    &lt;Component class=&quot;javax.swing.ButtonGroup&quot; name=&quot;buttonGroup1&quot;&gt;
-    &lt;/Component&gt;
-  &lt;/NonVisualComponents&gt;
+&lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JFrameFormInfo&quot;&gt;
   &lt;Properties&gt;
-    &lt;Property name=&quot;defaultCloseOperation&quot; type=&quot;int&quot; value=&quot;3&quot;/&gt;
+    &lt;Property name=&quot;defaultCloseOperation&quot; type=&quot;int&quot; value=&quot;2&quot;/&gt;
+    &lt;Property name=&quot;title&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+      &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Login&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+    &lt;/Property&gt;
+    &lt;Property name=&quot;resizable&quot; type=&quot;boolean&quot; value=&quot;false&quot;/&gt;
   &lt;/Properties&gt;
   &lt;SyntheticProperties&gt;
     &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
@@ -24,81 +24,91 @@
           &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;Component id=&quot;imageHere&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;createNew&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;connectExisting&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;plantloreLogo&quot; alignment=&quot;0&quot; pref=&quot;397&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;help&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;279&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;next&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
                   &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                          &lt;Component id=&quot;jLabel1&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jLabel1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Component id=&quot;jLabel2&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                       &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Component id=&quot;password&quot; pref=&quot;347&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Component id=&quot;host&quot; alignment=&quot;0&quot; pref=&quot;347&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-                          &lt;Component id=&quot;password&quot; alignment=&quot;0&quot; pref=&quot;347&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
                   &lt;/Group&gt;
-                  &lt;Component id=&quot;next&quot; alignment=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
+          &lt;Component id=&quot;status&quot; alignment=&quot;0&quot; pref=&quot;417&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
       &lt;/Group&gt;
     &lt;/DimensionLayout&gt;
     &lt;DimensionLayout dim=&quot;1&quot;&gt;
       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
           &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;imageHere&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;plantloreLogo&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;createNew&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;connectExisting&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                   &lt;Component id=&quot;jLabel1&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;host&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;host&quot; alignment=&quot;3&quot; min=&quot;-2&quot; pref=&quot;20&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
                   &lt;Component id=&quot;jLabel2&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                  &lt;Component id=&quot;password&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;password&quot; alignment=&quot;3&quot; min=&quot;-2&quot; pref=&quot;18&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;/Group&gt;
+              &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;next&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;help&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;next&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;status&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
       &lt;/Group&gt;
     &lt;/DimensionLayout&gt;
   &lt;/Layout&gt;
   &lt;SubComponents&gt;
-    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel1&quot;&gt;
-      &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Host:port&quot;/&gt;
-      &lt;/Properties&gt;
-    &lt;/Component&gt;
-    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel2&quot;&gt;
-      &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Password&quot;/&gt;
-      &lt;/Properties&gt;
-    &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;host&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;localhost:1099&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;localhost&quot;/&gt;
       &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JPasswordField&quot; name=&quot;password&quot;&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;next&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;next&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Next&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
       &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
-    &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;imageHere&quot;&gt;
+    &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;plantloreLogo&quot;&gt;
       &lt;Properties&gt;
         &lt;Property name=&quot;background&quot; type=&quot;java.awt.Color&quot; editor=&quot;org.netbeans.beaninfo.editors.ColorEditor&quot;&gt;
           &lt;Color blue=&quot;0&quot; green=&quot;0&quot; red=&quot;0&quot; type=&quot;rgb&quot;/&gt;
         &lt;/Property&gt;
+        &lt;Property name=&quot;preferredSize&quot; type=&quot;java.awt.Dimension&quot; editor=&quot;org.netbeans.beaninfo.editors.DimensionEditor&quot;&gt;
+          &lt;Dimension value=&quot;[300, 100]&quot;/&gt;
+        &lt;/Property&gt;
       &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
 
       &lt;Layout&gt;
         &lt;DimensionLayout dim=&quot;0&quot;&gt;
@@ -108,42 +118,43 @@
         &lt;/DimensionLayout&gt;
         &lt;DimensionLayout dim=&quot;1&quot;&gt;
           &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace min=&quot;0&quot; pref=&quot;198&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace min=&quot;0&quot; pref=&quot;100&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
         &lt;/DimensionLayout&gt;
       &lt;/Layout&gt;
     &lt;/Container&gt;
-    &lt;Component class=&quot;javax.swing.JRadioButton&quot; name=&quot;createNew&quot;&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel1&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;buttonGroup&quot; type=&quot;javax.swing.ButtonGroup&quot; editor=&quot;org.netbeans.modules.form.RADComponent$ButtonGroupPropertyEditor&quot;&gt;
-          &lt;ComponentRef name=&quot;buttonGroup1&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Host&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
         &lt;/Property&gt;
-        &lt;Property name=&quot;selected&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Create and start a new server&quot;/&gt;
-        &lt;Property name=&quot;border&quot; type=&quot;javax.swing.border.Border&quot; editor=&quot;org.netbeans.modules.form.editors2.BorderEditor&quot;&gt;
-          &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.EmptyBorderInfo&quot;&gt;
-            &lt;EmptyBorder bottom=&quot;0&quot; left=&quot;0&quot; right=&quot;0&quot; top=&quot;0&quot;/&gt;
-          &lt;/Border&gt;
+      &lt;/Properties&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jLabel2&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Password&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
         &lt;/Property&gt;
-        &lt;Property name=&quot;margin&quot; type=&quot;java.awt.Insets&quot; editor=&quot;org.netbeans.beaninfo.editors.InsetsEditor&quot;&gt;
-          &lt;Insets value=&quot;[0, 0, 0, 0]&quot;/&gt;
+      &lt;/Properties&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;help&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Common.Help&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
         &lt;/Property&gt;
       &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
     &lt;/Component&gt;
-    &lt;Component class=&quot;javax.swing.JRadioButton&quot; name=&quot;connectExisting&quot;&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;status&quot;&gt;
       &lt;Properties&gt;
-        &lt;Property name=&quot;buttonGroup&quot; type=&quot;javax.swing.ButtonGroup&quot; editor=&quot;org.netbeans.modules.form.RADComponent$ButtonGroupPropertyEditor&quot;&gt;
-          &lt;ComponentRef name=&quot;buttonGroup1&quot;/&gt;
-        &lt;/Property&gt;
-        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Connect to a running server&quot;/&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Awaiting commands&quot;/&gt;
         &lt;Property name=&quot;border&quot; type=&quot;javax.swing.border.Border&quot; editor=&quot;org.netbeans.modules.form.editors2.BorderEditor&quot;&gt;
-          &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.EmptyBorderInfo&quot;&gt;
-            &lt;EmptyBorder bottom=&quot;0&quot; left=&quot;0&quot; right=&quot;0&quot; top=&quot;0&quot;/&gt;
+          &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.BevelBorderInfo&quot;&gt;
+            &lt;BevelBorder bevelType=&quot;1&quot;/&gt;
           &lt;/Border&gt;
         &lt;/Property&gt;
-        &lt;Property name=&quot;margin&quot; type=&quot;java.awt.Insets&quot; editor=&quot;org.netbeans.beaninfo.editors.InsetsEditor&quot;&gt;
-          &lt;Insets value=&quot;[0, 0, 0, 0]&quot;/&gt;
-        &lt;/Property&gt;
       &lt;/Properties&gt;
     &lt;/Component&gt;
   &lt;/SubComponents&gt;

Modified: trunk/src/net/sf/plantlore/server/manager/ServerLoginView.java
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerLoginView.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/manager/ServerLoginView.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -1,5 +1,10 @@
 package net.sf.plantlore.server.manager;
 
+import java.util.Observable;
+import java.util.Observer;
+
+import javax.swing.JOptionPane;
+
 import net.sf.plantlore.l10n.L10n;
 
 
@@ -7,15 +12,16 @@
  * The server connection/creation dialog.
  *
  * @author  Erik Kratochv&#237;l (<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">discontinuum at gmail.com</A>)
+ * @version GR-8
  */
-public class ServerLoginView extends javax.swing.JFrame {
+public class ServerLoginView extends javax.swing.JFrame implements Observer {
 	
-	ServerMng model;
     
     /** Creates new form ServerLoginView */
     public ServerLoginView(ServerMng model) {
-    	this.model = model;
+    	model.addObserver(this);
         initComponents();
+        getRootPane().setDefaultButton(next);
         setLocationRelativeTo(null); // center of the screen
     }
     
@@ -26,48 +32,44 @@
      */
     // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot; Generated Code &quot;&gt;//GEN-BEGIN:initComponents
     private void initComponents() {
-        buttonGroup1 = new javax.swing.ButtonGroup();
-        jLabel1 = new javax.swing.JLabel();
-        jLabel2 = new javax.swing.JLabel();
         host = new javax.swing.JTextField();
         password = new javax.swing.JPasswordField();
         next = new javax.swing.JButton();
-        imageHere = new javax.swing.JPanel();
-        createNew = new javax.swing.JRadioButton();
-        connectExisting = new javax.swing.JRadioButton();
+        plantloreLogo = new javax.swing.JPanel();
+        jLabel1 = new javax.swing.JLabel();
+        jLabel2 = new javax.swing.JLabel();
+        help = new javax.swing.JButton();
+        status = new javax.swing.JLabel();
 
         setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
-        jLabel1.setText(L10n.getString(&quot;HostPort&quot;));
+        setTitle(L10n.getString(&quot;Server.Login&quot;));
+        setResizable(false);
+        host.setText(&quot;localhost&quot;);
 
-        jLabel2.setText(L10n.getString(&quot;Password&quot;));
+        next.setText(L10n.getString(&quot;Server.Next&quot;));
 
-        host.setText(&quot;localhost:1099&quot;);
-
-        next.setText(&quot;Next&quot;);
-
-        imageHere.setBackground(new java.awt.Color(0, 0, 0));
-        org.jdesktop.layout.GroupLayout imageHereLayout = new org.jdesktop.layout.GroupLayout(imageHere);
-        imageHere.setLayout(imageHereLayout);
-        imageHereLayout.setHorizontalGroup(
-            imageHereLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+        plantloreLogo.setBackground(new java.awt.Color(0, 0, 0));
+        plantloreLogo.setPreferredSize(new java.awt.Dimension(300, 100));
+        org.jdesktop.layout.GroupLayout plantloreLogoLayout = new org.jdesktop.layout.GroupLayout(plantloreLogo);
+        plantloreLogo.setLayout(plantloreLogoLayout);
+        plantloreLogoLayout.setHorizontalGroup(
+            plantloreLogoLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(0, 397, Short.MAX_VALUE)
         );
-        imageHereLayout.setVerticalGroup(
-            imageHereLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-            .add(0, 198, Short.MAX_VALUE)
+        plantloreLogoLayout.setVerticalGroup(
+            plantloreLogoLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+            .add(0, 100, Short.MAX_VALUE)
         );
 
-        buttonGroup1.add(createNew);
-        createNew.setSelected(true);
-        createNew.setText(&quot;Create and start a new server&quot;);
-        createNew.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
-        createNew.setMargin(new java.awt.Insets(0, 0, 0, 0));
+        jLabel1.setText(L10n.getString(&quot;Server.Host&quot;));
 
-        buttonGroup1.add(connectExisting);
-        connectExisting.setText(&quot;Connect to a running server&quot;);
-        connectExisting.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
-        connectExisting.setMargin(new java.awt.Insets(0, 0, 0, 0));
+        jLabel2.setText(L10n.getString(&quot;Server.Password&quot;));
 
+        help.setText(L10n.getString(&quot;Common.Help&quot;));
+
+        status.setText(&quot;Awaiting commands&quot;);
+        status.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED));
+
         org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
         getContentPane().setLayout(layout);
         layout.setHorizontalGroup(
@@ -75,40 +77,41 @@
             .add(layout.createSequentialGroup()
                 .addContainerGap()
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                    .add(imageHere, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
-                    .add(createNew)
-                    .add(connectExisting)
+                    .add(plantloreLogo, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 397, Short.MAX_VALUE)
+                    .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
+                        .add(help)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 279, Short.MAX_VALUE)
+                        .add(next))
                     .add(layout.createSequentialGroup()
                         .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                             .add(jLabel1)
                             .add(jLabel2))
                         .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                         .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-                            .add(host, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 347, Short.MAX_VALUE)
-                            .add(password, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 347, Short.MAX_VALUE)))
-                    .add(org.jdesktop.layout.GroupLayout.TRAILING, next))
+                            .add(password, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 347, Short.MAX_VALUE)
+                            .add(host, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 347, Short.MAX_VALUE))))
                 .addContainerGap())
+            .add(status, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 417, Short.MAX_VALUE)
         );
         layout.setVerticalGroup(
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(layout.createSequentialGroup()
                 .addContainerGap()
-                .add(imageHere, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
+                .add(plantloreLogo, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                .add(createNew)
-                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                .add(connectExisting)
-                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(jLabel1)
-                    .add(host, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                    .add(host, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 20, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                 .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                     .add(jLabel2)
-                    .add(password, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                    .add(password, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 18, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(next)
+                    .add(help))
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                .add(next)
-                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                .add(status))
         );
         pack();
     }// &lt;/editor-fold&gt;//GEN-END:initComponents
@@ -116,15 +119,31 @@
     
     
     // Variables declaration - do not modify//GEN-BEGIN:variables
-    private javax.swing.ButtonGroup buttonGroup1;
-    protected javax.swing.JRadioButton connectExisting;
-    protected javax.swing.JRadioButton createNew;
+    protected javax.swing.JButton help;
     protected javax.swing.JTextField host;
-    protected javax.swing.JPanel imageHere;
     private javax.swing.JLabel jLabel1;
     private javax.swing.JLabel jLabel2;
     protected javax.swing.JButton next;
     protected javax.swing.JPasswordField password;
+    protected javax.swing.JPanel plantloreLogo;
+    private javax.swing.JLabel status;
     // End of variables declaration//GEN-END:variables
     
+    
+    public void update(Observable source, final Object parameter) {
+		java.awt.EventQueue.invokeLater(new Runnable() {
+			public void run() {
+				if(parameter instanceof String)
+					status.setText( &quot; &quot; + (String)parameter );
+				else if(parameter instanceof Exception) {
+					JOptionPane.showMessageDialog(null,
+							((Exception)parameter).getMessage(),
+						    L10n.getString(&quot;Error.ServerLoginFailed&quot;),
+						    JOptionPane.ERROR_MESSAGE);
+				}
+			}
+		});
+	}
+	
+    
 }

Modified: trunk/src/net/sf/plantlore/server/manager/ServerMng.java
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerMng.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/manager/ServerMng.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -1,5 +1,14 @@
 package net.sf.plantlore.server.manager;
 
+import java.io.BufferedReader;
+import java.io.BufferedWriter;
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileOutputStream;
+import java.io.InputStreamReader;
+import java.io.OutputStreamWriter;
+import java.io.Reader;
+import java.io.Writer;
 import java.rmi.AlreadyBoundException;
 import java.rmi.NotBoundException;
 import java.rmi.RemoteException;
@@ -8,8 +17,15 @@
 import java.util.Observable;
 
 import org.apache.log4j.Logger;
+import org.dom4j.Document;
+import org.dom4j.DocumentHelper;
+import org.dom4j.Element;
+import org.dom4j.Node;
+import org.dom4j.io.OutputFormat;
+import org.dom4j.io.SAXReader;
+import org.dom4j.io.XMLWriter;
 
-
+import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.server.*;
 
 /**
@@ -29,27 +45,117 @@
  */
 public class ServerMng extends Observable {
 	
+	public static final Object UPDATE_LIST = new Object();
+	
+	private static final String SERVER_CONFIG_NAME = &quot;plantlore.server.xml&quot;;
+	private static final String PLANTLORE = &quot;plantlore&quot;;
+	
 	/** The server control interface. */
 	private Server server;
+	private ServerSettings settings;
 	
 	/** List of connected clients. */
 	private ConnectionInfo[] clients;
 	
-	/**
-	 * CREATE_NEW will create a and start a new server
-	 * CONNECT_EXISTING will try connect to an existing server  
-	 * 
-	 * @author Erik Kratochv&#237;l (<A HREF="https://lists.berlios.de/mailman/listinfo/plantlore-dev">discontinuum at gmail.com</A>)
-	 * @since 21.4.2006
-	 */
-	public enum Mode { CREATE_NEW, CONNECT_EXISTING };
+	private Logger logger = Logger.getLogger(this.getClass().getPackage().getName());
+	private String settingsFileName; {
+		String userHome = System.getProperty(&quot;user.home&quot;),
+		osName = System.getProperty(&quot;os.name&quot;),
+		plantloreDirName = (osName.equals(&quot;Linux&quot;) ? &quot;.&quot; : &quot;&quot;) + PLANTLORE, 
+		plantloreConfDir = userHome+File.separator+plantloreDirName;
+		
+		File plantloreConfDirFile = new File(plantloreConfDir);
+		if (!plantloreConfDirFile.exists())
+			plantloreConfDirFile.mkdir();
+		
+		settingsFileName = plantloreConfDir + File.separator + SERVER_CONFIG_NAME;
+	}
 	
-	/** The current mode. */
-	private Mode mode = Mode.CREATE_NEW;
 	
-	private Logger logger = Logger.getLogger(this.getClass().getPackage().getName());
+	public ServerSettings getSettings() {
+
+		// Create some default settings.
+		settings = new ServerSettings(RMIServer.DEFAULT_PORT, 3, 32, 2, 
+				new DatabaseSettings(&quot;postgresql&quot;, 5432, null, &quot;&quot;, &quot;&quot;));
 		
+		try {
+			Reader reader = new BufferedReader(
+					new InputStreamReader(new FileInputStream(settingsFileName), &quot;UTF-8&quot;));
+			SAXReader saxReader = new SAXReader();
+            Document document = saxReader.read( reader );
+            
+            Node server = (Node)document.selectSingleNode(&quot;/config/server&quot;);
+            Number portNumber = server.numberValueOf(&quot;port&quot;)/*,
+            connectionsNumber = server.numberValueOf(&quot;connections&quot;),
+            peripNumber = server.numberValueOf(&quot;perip&quot;)*/;
+            int port = (portNumber == null) ? RMIServer.DEFAULT_PORT : portNumber.intValue()/*,
+            connections = (connectionsNumber == null) ? 16 : connectionsNumber.intValue(),
+            perip = (peripNumber == null) ? 2 : peripNumber.intValue()*/;
+            
+            Node database = (Node)server.selectSingleNode(&quot;/database&quot;);
+            
+            String databaseType = database.valueOf(&quot;engine&quot;),
+            databaseParameter = database.valueOf(&quot;parameter&quot;),
+            databaseMasterUser = database.valueOf(&quot;masteruser&quot;);
+            Number databasePortNumber = database.numberValueOf(&quot;port&quot;);
+            int databasePort = (databasePortNumber == null) ? 0 : databasePortNumber.intValue();
+            
+            settings = new ServerSettings(port, 3, 32, 2, 
+            		new DatabaseSettings(databaseType, databasePort, databaseParameter, databaseMasterUser, &quot;&quot;));
+            
+    		setChanged();
+    		notifyObservers(L10n.getString(&quot;Server.SettingsLoaded&quot;));
+            
+		} catch(Exception e) {
+			logger.error(&quot;Settings could not be loaded. &quot; + e.getMessage());
+			setChanged();
+			notifyObservers(L10n.getString(&quot;Server.SettingsNotLoaded&quot;));
+		}
+		return settings;
+	}
 	
+	
+	
+	public void setSettings(ServerSettings settings) {
+		this.settings = settings;
+		
+		Document document = DocumentHelper.createDocument();
+		Element config = document.addElement(&quot;config&quot;),
+		server = config.addElement(&quot;server&quot;);
+		server.addElement(&quot;port&quot;).setText( &quot;&quot; + settings.getPort() );
+		//server.addElement(&quot;connections&quot;).setText( &quot;&quot; + settings.getConnectionsTotal() );
+		//server.addElement(&quot;perip&quot;).setText( &quot;&quot; + settings.getConnectionsPerIP() );
+		
+		Element db = server.addElement(&quot;database&quot;);
+		db.addElement(&quot;engine&quot;).setText( settings.getDatabaseSettings().getDatabase() );
+		db.addElement(&quot;port&quot;).setText( &quot;&quot; + settings.getDatabaseSettings().getPort() );
+		db.addElement(&quot;parameter&quot;).setText(settings.getDatabaseSettings().getConnectionStringSuffix());
+		db.addElement(&quot;masteruser&quot;).setText(settings.getDatabaseSettings().getMasterUser());
+
+		try {
+			Writer outputWriter = new BufferedWriter(
+					new OutputStreamWriter(new FileOutputStream(settingsFileName), &quot;UTF-8&quot;));
+			
+			OutputFormat format = OutputFormat.createPrettyPrint();
+			XMLWriter xmlwriter = new XMLWriter( outputWriter, format );
+			xmlwriter.write( document );
+			xmlwriter.close();
+			outputWriter.close();
+			
+			setChanged();
+			notifyObservers(L10n.getString(&quot;Server.SettingsSaved&quot;));
+			
+		} catch (java.io.IOException e) {
+			logger.error(&quot;Settings could not be saved. &quot; + e.getMessage());
+			setChanged();
+			notifyObservers(L10n.getString(&quot;Server.SettingsNotSaved&quot;));
+		}
+	}
+	
+	
+	
+		
+	
 	/**
 	 * Try to create and start a new server on the specified &lt;code&gt;port&lt;/code&gt;.
 	 * The server will be protected with a &lt;code&gt;password&lt;/code&gt; so that 
@@ -63,13 +169,35 @@
 	 * @throws AlreadyBoundException if another server is already running on the specified port.
 	 * @throws RemoteException if the RMI encounters an error.
 	 */
-	public void startNewServer(int port, String password) 
-	throws AlreadyBoundException, RemoteException {
-		logger.debug(&quot;Creating a new server at localhost:&quot; + port);
-		server = new RMIServer(port, password);
-		logger.debug(&quot;Starting the server ...&quot;);
-		server.start();
-		logger.info(&quot;Server up and running (port &quot; + port + &quot;).&quot;);
+	synchronized public boolean startNewServer(String password) {
+		try {
+			logger.debug(&quot;Creating a new server at localhost:&quot; + settings.getPort());
+			setChanged();
+			notifyObservers(L10n.getString(&quot;Server.Info.CreatingNewServer&quot;));
+			// Create a new server.
+			server = new RMIServer(settings, password);
+			
+			setChanged();
+			notifyObservers(L10n.getString(&quot;Server.Info.StartingNewServer&quot;));
+			// Start the server.
+			server.start();
+			
+			logger.info(&quot;Server up and running (port &quot; + settings.getPort() + &quot;).&quot;);
+			setChanged();
+			notifyObservers(L10n.getString(&quot;Server.Info.ServerUpAndRunning&quot;));
+			
+			return true;
+			
+		} catch(AlreadyBoundException e) {
+			logger.fatal(&quot;There is another server running on the specified port (&quot;+settings.getPort()+&quot;).&quot;);
+			setChanged();
+			notifyObservers(e);
+		} catch(RemoteException e) {
+			logger.fatal(&quot;The server creation failed. &quot;+e.getMessage());
+			setChanged();
+			notifyObservers(e);
+		}
+		return false;
 	}
 
 	/**
@@ -83,41 +211,37 @@
 	 * @throws NotBoundException if there is no server running on the specified host:port. 
 	 * @throws CertificationException if the password is incorrect.
 	 */
-	public void connectToRunningServer(String host, int port, String password) 
-	throws RemoteException, NotBoundException, CertificationException {
-		logger.info(&quot;Connecting to a running server at &quot; +host+&quot;:&quot;+port);
-		Registry registry = LocateRegistry.getRegistry(host, port);
-		Guard guard = (Guard) registry.lookup(Guard.ID);
-		server = guard.certify(password);
-		
-		if(server == null) 
-			logger.warn(&quot;The connection to the server was NOT successful - certification didn't succeed!&quot;);
+	synchronized public boolean connectToRunningServer(String host, int port, String password) {
+		try {
+			logger.info(&quot;Connecting to a running server at &quot; +host+&quot;:&quot;+port);
+			setChanged();
+			notifyObservers(L10n.getString(&quot;Server.Info.ConnectingToServer&quot;));
+			// Connect to the registry and obtain the Guard.
+			Registry registry = LocateRegistry.getRegistry(host, port);
+			Guard guard = (Guard) registry.lookup(Guard.ID);
+			// Send authorization information to gain access to the server.
+			server = guard.certify(password);
+			
+			return true;
+			
+		} catch(RemoteException e) {
+			logger.fatal(&quot;Connecting to the server failed. &quot;+e.getMessage());
+			setChanged();
+			notifyObservers(e);
+		} catch(NotBoundException e) {
+			logger.fatal(&quot;There is no server running on &quot;+host+&quot;:&quot;+port+&quot;. &quot; + e.getMessage());
+			setChanged();
+			notifyObservers(e);
+		} catch(CertificationException e) {
+			logger.fatal(&quot;The certification failed. &quot;+e.getMessage());
+			setChanged();
+			notifyObservers(e);
+		}
+		return false;
 	}
 	
-	
+
 	/**
-	 * Start a new server or connect to an existing one accordingly to the current mode.
-	 * 
-	 * @param host The hostname of the computer where the server is running. 
-	 * (ignored when starting a new server). 
-	 * @param port The port where a server is listening or shall listen.
-	 * @param password The password that protects the server or shall protect the server.
-	 * @throws RemoteException if the RMI encounters an error.
-	 * @throws NotBoundException if there is no server running on the specified host:port
-	 * @throws AlreadyBoundException if there is another server already running on the specified port
-	 * @throws CertificationException if the password is incorrect and the certification failed.
-	 * 
-	 * @see connectToRunningServer
-	 * @see startNewServer
-	 * @see mode
-	 */
-	public void actAsInstructed(String host, int port, String password) 
-	throws RemoteException, NotBoundException, AlreadyBoundException, CertificationException {
-		if(mode == Mode.CREATE_NEW) startNewServer(port, password);
-		else connectToRunningServer(host, port, password);
-	}
-	
-	/**
 	 * Get the list of connected clients.
 	 * If &lt;code&gt;refresh&lt;/code&gt; is true, the server is asked and the list of clients is refreshed.
 	 * If it is false, the stored list of connected clients is returned. 
@@ -126,18 +250,25 @@
 	 * @return The (possibly not updated) list of connected clients so that you can see whom you can kick, 
 	 * 	or null if noone is connected or we are not connected (or running) to some server.   
 	 */
-	public ConnectionInfo[] getConnectedUsers(boolean refresh) {
-		if(server == null) return null;
-		if(refresh)
-			try {
-				// Get the list of clients directly from the server.
+	synchronized public ConnectionInfo[] getConnectedUsers(boolean refresh) {
+		try {
+			if(server == null) 
+				return null;
+			
+			if(refresh) {
 				clients = server.getClients();
-				logger.debug(&quot;Clients connected to the server received.&quot;);
-				setChanged(); notifyObservers(&quot;PHear me!&quot;);
-			} catch( RemoteException e) { 
-				serverIsDead();
-				logger.warn(&quot;Unable to obtain the list of connected users - network error? &quot; + e); 
+				setChanged();
+				notifyObservers(UPDATE_LIST);
 			}
+			
+			setChanged(); 
+			notifyObservers(L10n.getString(&quot;Server.Info.ClientsObtained&quot;));
+			
+		} catch( RemoteException e) { 
+			logger.fatal(&quot;Unable to obtain the list of connected users. &quot; + e.getMessage());
+			setChanged(); 
+			notifyObservers(e);
+		}
 		return clients;
 	}
 	
@@ -147,13 +278,23 @@
 	 * @param client The client to be kicked out of the server.
 	 * @throws RemoteException if the RMI has problems with this drastic task.
 	 */
-	public void kick(ConnectionInfo client) throws RemoteException {
-		if(server == null || client == null) return;
+	synchronized public void kick(ConnectionInfo client) {
 		try {
+			if(server == null || client == null) 
+				return;
+			
 			server.disconnect(client);
-		} catch(RemoteException re) { serverIsDead(); throw re; }
+			
+			logger.info(client + &quot; was kicked out of the server. Muhehee.&quot;);
+			setChanged(); 
+			notifyObservers(L10n.getFormattedString(&quot;Server.Info.ClientKicked&quot;, client));
+			
+		} catch(RemoteException e) {
+			logger.fatal(&quot;Unable to kick the user &quot;+client+&quot;. &quot; + e.getMessage());
+			setChanged(); 
+			notifyObservers(e);
+		}
 		
-		logger.info(client + &quot; was kicked out of the server. Muhehee.&quot;);
 		// Reload the list of connected users.
 		getConnectedUsers(true);
 	}
@@ -164,56 +305,23 @@
 	 * 
 	 * @throws RemoteException if the RMI has personal feelings for the server.
 	 */
-	public void terminateServer() throws RemoteException {
-		if(server != null)
-			try {
-				server.stop(true);
-			}catch(RemoteException re) { serverIsDead(); throw re; }
-		logger.info(&quot;Server terminated - all clients disconnected.&quot;);
+	synchronized public void terminateServer()  {
+		try {
+			if(server != null)
+				server.stop();
+
+			server = null;
+			
+			logger.info(&quot;Server terminated.&quot;);
+			setChanged(); 
+			notifyObservers(L10n.getString(&quot;Server.Info.Terminated&quot;));
+			
+		}catch(RemoteException e) { 
+			logger.fatal(&quot;Unable to stop the server. &quot; + e.getMessage());
+			setChanged(); 
+			notifyObservers(e);
+		}
 	}
 	
-	/**
-	 * Stop the server. The server will be terminated after the last client disconnects from it.
-	 * 
-	 * @throws RemoteException if the RMI encounters an error.
-	 */
-	@Deprecated
-	public void stopServer() throws RemoteException {
-		if(server !=null) 
-			try {
-				server.stop(false);
-			}catch(RemoteException re) { serverIsDead(); throw re; }
-		logger.debug(&quot;Server stopped - the server will terminate after the last client finishes his work.&quot;);
-	}
-	
-	/**
-	 * Set a new mode.
-	 *  
-	 * @param m The new mode.
-	 * @see Mode
-	 */
-	public void setMode(Mode m) {
-		this.mode = m;
-		logger.debug(&quot;Server mode &quot; + mode);
-		setChanged(); notifyObservers(this.mode);
-	}
-	
-	/** 
-	 * Get the current mode.
-	 * @return The current mode.
-	 * @see Mode
-	 */
-	public Mode getMode() { 
-		return this.mode; 
-	}
-	
-	/**
-	 * Notify this model, that the server is no longer accessible. 
-	 *
-	 */
-	protected void serverIsDead() {
-		server = null; clients = null;
-		logger.warn(&quot;Connection to the server has failed.&quot;);
-	}
 
 }

Modified: trunk/src/net/sf/plantlore/server/manager/ServerMngCtrl.java
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerMngCtrl.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/manager/ServerMngCtrl.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -1,11 +1,11 @@
 package net.sf.plantlore.server.manager;
 
 import java.awt.event.ActionEvent;
-import java.rmi.RemoteException;
 
 import javax.swing.AbstractAction;
-import javax.swing.JOptionPane;
+import javax.swing.ImageIcon;
 
+import net.sf.plantlore.client.resources.Resource;
 import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.server.ConnectionInfo;
 
@@ -23,81 +23,67 @@
 	public ServerMngCtrl(ServerMng model, ServerMngView view) {
 		this.model = model; this. view = view;
 		
-		view.kick.addActionListener(new KickUsers());
-		view.startstop.addActionListener(new StopServer());
-		view.terminate.addActionListener(new TerminateServer());
-		view.refresh.addActionListener(new Refresh());
+		view.kick.setAction(new KickUserAction());
+		view.terminate.setAction(new TerminateServerAction());
+		view.refresh.setAction(new RefreshAction());
+		view.hide.setAction(new HideAction());
 	}
 	
 	
-	class KickUsers extends AbstractAction {
-		public KickUsers() {
-            putValue(NAME, L10n.getString(&quot;Kick&quot;));
-            putValue(SHORT_DESCRIPTION, L10n.getString(&quot;KickTT&quot;));
-            putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Kick&quot;));            
-        }
-		
+	class KickUserAction extends AbstractAction {
+		public KickUserAction() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Server.KickUserTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Server.KickUser&quot;));
+            ImageIcon icon = Resource.createIcon(&quot;Server.KickUser.gif&quot;);
+			if(icon != null) putValue(SMALL_ICON, icon);
+		}
 		public void actionPerformed(ActionEvent ae) {
-			try {
-				Object[] bunch = view.users.getSelectedValues();
-				if(bunch == null || bunch.length == 0) return;
-
-				for(Object client : bunch)
-					if(client instanceof ConnectionInfo) model.kick((ConnectionInfo)client);
-
-			} catch(RemoteException re) { 
-				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;errorRemoteException&quot;),
-					    L10n.getString(&quot;errorRemoteExceptionTitle&quot;),
-					    JOptionPane.WARNING_MESSAGE);
+			Object client = view.users.getSelectedValue();
+			if(client == null) 
 				return;
-			}
+			else if(client instanceof ConnectionInfo) 
+				model.kick( (ConnectionInfo)client );
 		}
 	}
 	
-	class StopServer extends AbstractAction {
+	class TerminateServerAction extends AbstractAction {
+		public TerminateServerAction() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Server.TerminateTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Server.Terminate&quot;));
+            ImageIcon icon = Resource.createIcon(&quot;Server.Terminate.gif&quot;);
+			if(icon != null) putValue(SMALL_ICON, icon);
+		}
 		public void actionPerformed(ActionEvent ae) {
-			try {
-				model.stopServer();
-			} catch(RemoteException re) { 
-				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;errorRemoteException&quot;),
-					    L10n.getString(&quot;errorRemoteExceptionTitle&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-				return;
-			}
+			model.terminateServer();
+			// Disable Terminate, Refresh and Kick buttons.
+			view.terminate.setEnabled(false);
+			view.refresh.setEnabled(false);
+			view.kick.setEnabled(false);
 		}
 	}
 	
-	class TerminateServer extends AbstractAction {
-		public TerminateServer() {
-            putValue(NAME, L10n.getString(&quot;TerminateServer&quot;));
-            putValue(SHORT_DESCRIPTION, L10n.getString(&quot;TerminateServerTT&quot;));
-            putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;TerminateServer&quot;));            
-        }
-		
+	class RefreshAction extends AbstractAction {
+		public RefreshAction() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Server.RefreshTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Server.Refresh&quot;));
+            ImageIcon icon = Resource.createIcon(&quot;Server.Refresh.gif&quot;);
+			if(icon != null) putValue(SMALL_ICON, icon);
+		}
 		public void actionPerformed(ActionEvent ae) {
-			try {
-				model.terminateServer();
-			} catch(RemoteException re) { 
-				JOptionPane.showMessageDialog(view,
-						L10n.getString(&quot;errorRemoteException&quot;),
-					    L10n.getString(&quot;errorRemoteExceptionTitle&quot;),
-					    JOptionPane.WARNING_MESSAGE);
-				return;
-			}
+			model.getConnectedUsers(true);
 		}
 	}
 	
-	class Refresh extends AbstractAction {
-		public Refresh() {
-            putValue(NAME, L10n.getString(&quot;Refresh&quot;));
-            putValue(SHORT_DESCRIPTION, L10n.getString(&quot;RefreshTT&quot;));
-            putValue(MNEMONIC_KEY, L10n.getMnemonic(&quot;Refresh&quot;));            
-        }
-		
+	class HideAction extends AbstractAction {
+		public HideAction() {
+			putValue(SHORT_DESCRIPTION, L10n.getString(&quot;Server.HideTT&quot;));
+			putValue(NAME, L10n.getString(&quot;Server.Hide&quot;));
+            ImageIcon icon = Resource.createIcon(&quot;Server.Hide.gif&quot;);
+			if(icon != null) putValue(SMALL_ICON, icon);
+		}
 		public void actionPerformed(ActionEvent ae) {
-				model.getConnectedUsers(true);
+			view.setVisible(false);
+			//view.dispose();
 		}
 	}
 

Modified: trunk/src/net/sf/plantlore/server/manager/ServerMngView.form
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerMngView.form	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/manager/ServerMngView.form	2006-06-03 16:48:24 UTC (rev 428)
@@ -3,6 +3,9 @@
 &lt;Form version=&quot;1.3&quot; type=&quot;org.netbeans.modules.form.forminfo.JFrameFormInfo&quot;&gt;
   &lt;Properties&gt;
     &lt;Property name=&quot;defaultCloseOperation&quot; type=&quot;int&quot; value=&quot;3&quot;/&gt;
+    &lt;Property name=&quot;title&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+      &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Manage&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+    &lt;/Property&gt;
   &lt;/Properties&gt;
   &lt;SyntheticProperties&gt;
     &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
@@ -17,12 +20,22 @@
   &lt;Layout&gt;
     &lt;DimensionLayout dim=&quot;0&quot;&gt;
       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-          &lt;Component id=&quot;jToolBar1&quot; alignment=&quot;0&quot; pref=&quot;523&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace min=&quot;10&quot; pref=&quot;10&quot; max=&quot;10&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;jScrollPane1&quot; pref=&quot;503&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+          &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;jScrollPane1&quot; alignment=&quot;0&quot; pref=&quot;315&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;help&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;86&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;terminate&quot; linkSize=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;hide&quot; linkSize=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
+              &lt;/Group&gt;
+              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
+          &lt;Component id=&quot;status&quot; alignment=&quot;0&quot; pref=&quot;335&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+          &lt;Component id=&quot;jToolBar1&quot; alignment=&quot;0&quot; pref=&quot;335&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
       &lt;/Group&gt;
     &lt;/DimensionLayout&gt;
     &lt;DimensionLayout dim=&quot;1&quot;&gt;
@@ -30,54 +43,110 @@
           &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;Component id=&quot;jToolBar1&quot; min=&quot;-2&quot; pref=&quot;25&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;jScrollPane1&quot; pref=&quot;258&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;jScrollPane1&quot; pref=&quot;141&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;hide&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;help&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Component id=&quot;terminate&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;/Group&gt;
+              &lt;EmptySpace min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;status&quot; min=&quot;-2&quot; pref=&quot;18&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
       &lt;/Group&gt;
     &lt;/DimensionLayout&gt;
   &lt;/Layout&gt;
   &lt;SubComponents&gt;
-    &lt;Container class=&quot;javax.swing.JToolBar&quot; name=&quot;jToolBar1&quot;&gt;
+    &lt;Container class=&quot;javax.swing.JScrollPane&quot; name=&quot;jScrollPane1&quot;&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;autoScrollPane&quot; type=&quot;java.lang.Boolean&quot; value=&quot;true&quot;/&gt;
+      &lt;/AuxValues&gt;
 
-      &lt;Layout class=&quot;org.netbeans.modules.form.compat2.layouts.DesignBoxLayout&quot;/&gt;
+      &lt;Layout class=&quot;org.netbeans.modules.form.compat2.layouts.support.JScrollPaneSupportLayout&quot;/&gt;
       &lt;SubComponents&gt;
-        &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;refresh&quot;&gt;
+        &lt;Component class=&quot;javax.swing.JList&quot; name=&quot;users&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Refresh&quot;/&gt;
+            &lt;Property name=&quot;model&quot; type=&quot;javax.swing.ListModel&quot; editor=&quot;org.netbeans.modules.form.editors2.ListModelEditor&quot;&gt;
+              &lt;StringArray count=&quot;0&quot;/&gt;
+            &lt;/Property&gt;
+            &lt;Property name=&quot;toolTipText&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.ListOfUsersTT&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
           &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
         &lt;/Component&gt;
-        &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;kick&quot;&gt;
-          &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Kick users&quot;/&gt;
-          &lt;/Properties&gt;
-        &lt;/Component&gt;
-        &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;startstop&quot;&gt;
-          &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Stop server&quot;/&gt;
-          &lt;/Properties&gt;
-        &lt;/Component&gt;
-        &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;terminate&quot;&gt;
-          &lt;Properties&gt;
-            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Terminate server&quot;/&gt;
-          &lt;/Properties&gt;
-        &lt;/Component&gt;
       &lt;/SubComponents&gt;
     &lt;/Container&gt;
-    &lt;Container class=&quot;javax.swing.JScrollPane&quot; name=&quot;jScrollPane1&quot;&gt;
+    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;hide&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Hide&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
       &lt;AuxValues&gt;
-        &lt;AuxValue name=&quot;autoScrollPane&quot; type=&quot;java.lang.Boolean&quot; value=&quot;true&quot;/&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
       &lt;/AuxValues&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;help&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Common.Help&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
+    &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;status&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; value=&quot;Server up and running&quot;/&gt;
+        &lt;Property name=&quot;border&quot; type=&quot;javax.swing.border.Border&quot; editor=&quot;org.netbeans.modules.form.editors2.BorderEditor&quot;&gt;
+          &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.BevelBorderInfo&quot;&gt;
+            &lt;BevelBorder bevelType=&quot;1&quot;/&gt;
+          &lt;/Border&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+    &lt;/Component&gt;
+    &lt;Container class=&quot;javax.swing.JToolBar&quot; name=&quot;jToolBar1&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;floatable&quot; type=&quot;boolean&quot; value=&quot;false&quot;/&gt;
+      &lt;/Properties&gt;
 
-      &lt;Layout class=&quot;org.netbeans.modules.form.compat2.layouts.support.JScrollPaneSupportLayout&quot;/&gt;
+      &lt;Layout class=&quot;org.netbeans.modules.form.compat2.layouts.DesignBoxLayout&quot;/&gt;
       &lt;SubComponents&gt;
-        &lt;Component class=&quot;javax.swing.JList&quot; name=&quot;users&quot;&gt;
+        &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;refresh&quot;&gt;
           &lt;Properties&gt;
-            &lt;Property name=&quot;model&quot; type=&quot;javax.swing.ListModel&quot; editor=&quot;org.netbeans.modules.form.editors2.ListModelEditor&quot;&gt;
-              &lt;StringArray count=&quot;0&quot;/&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Refresh&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
             &lt;/Property&gt;
           &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
         &lt;/Component&gt;
+        &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;kick&quot;&gt;
+          &lt;Properties&gt;
+            &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+              &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.KickUser&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+            &lt;/Property&gt;
+          &lt;/Properties&gt;
+          &lt;AuxValues&gt;
+            &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+          &lt;/AuxValues&gt;
+        &lt;/Component&gt;
       &lt;/SubComponents&gt;
     &lt;/Container&gt;
+    &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;terminate&quot;&gt;
+      &lt;Properties&gt;
+        &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;net/sf/plantlore/l10n/Plantlore.properties&quot; key=&quot;Server.Terminate&quot; replaceFormat=&quot;L10n.getString(&quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+      &lt;/Properties&gt;
+      &lt;AuxValues&gt;
+        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;4&quot;/&gt;
+      &lt;/AuxValues&gt;
+    &lt;/Component&gt;
   &lt;/SubComponents&gt;
 &lt;/Form&gt;

Modified: trunk/src/net/sf/plantlore/server/manager/ServerMngView.java
===================================================================
--- trunk/src/net/sf/plantlore/server/manager/ServerMngView.java	2006-06-02 04:33:10 UTC (rev 427)
+++ trunk/src/net/sf/plantlore/server/manager/ServerMngView.java	2006-06-03 16:48:24 UTC (rev 428)
@@ -9,7 +9,10 @@
 import java.util.Observable;
 import java.util.Observer;
 
+import javax.swing.JOptionPane;
 
+
+import net.sf.plantlore.l10n.L10n;
 import net.sf.plantlore.server.ConnectionInfo;
 
 /**
@@ -28,6 +31,7 @@
     	model.addObserver(this);
     	
         initComponents();
+        //getRootPane().setDefaultButton(hide);
         setLocationRelativeTo(null); // center of the screen
     }
     
@@ -38,46 +42,71 @@
      */
     // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot; Generated Code &quot;&gt;//GEN-BEGIN:initComponents
     private void initComponents() {
+        jScrollPane1 = new javax.swing.JScrollPane();
+        users = new javax.swing.JList();
+        hide = new javax.swing.JButton();
+        help = new javax.swing.JButton();
+        status = new javax.swing.JLabel();
         jToolBar1 = new javax.swing.JToolBar();
         refresh = new javax.swing.JButton();
         kick = new javax.swing.JButton();
-        startstop = new javax.swing.JButton();
         terminate = new javax.swing.JButton();
-        jScrollPane1 = new javax.swing.JScrollPane();
-        users = new javax.swing.JList();
 
         setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
-        refresh.setText(&quot;Refresh&quot;);
+        setTitle(L10n.getString(&quot;Server.Manage&quot;));
+        users.setToolTipText(L10n.getString(&quot;Server.ListOfUsersTT&quot;));
+        jScrollPane1.setViewportView(users);
+
+        hide.setText(L10n.getString(&quot;Server.Hide&quot;));
+
+        help.setText(L10n.getString(&quot;Common.Help&quot;));
+
+        status.setText(&quot;Server up and running&quot;);
+        status.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED));
+
+        jToolBar1.setFloatable(false);
+        refresh.setText(L10n.getString(&quot;Server.Refresh&quot;));
         jToolBar1.add(refresh);
 
-        kick.setText(&quot;Kick users&quot;);
+        kick.setText(L10n.getString(&quot;Server.KickUser&quot;));
         jToolBar1.add(kick);
 
-        startstop.setText(&quot;Stop server&quot;);
-        jToolBar1.add(startstop);
+        terminate.setText(L10n.getString(&quot;Server.Terminate&quot;));
 
-        terminate.setText(&quot;Terminate server&quot;);
-        jToolBar1.add(terminate);
-
-        jScrollPane1.setViewportView(users);
-
         org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
         getContentPane().setLayout(layout);
         layout.setHorizontalGroup(
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
-            .add(jToolBar1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 523, Short.MAX_VALUE)
             .add(layout.createSequentialGroup()
-                .add(10, 10, 10)
-                .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 503, Short.MAX_VALUE)
+                .addContainerGap()
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
+                    .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 315, Short.MAX_VALUE)
+                    .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
+                        .add(help)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 86, Short.MAX_VALUE)
+                        .add(terminate)
+                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                        .add(hide)))
                 .addContainerGap())
+            .add(status, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 335, Short.MAX_VALUE)
+            .add(jToolBar1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 335, Short.MAX_VALUE)
         );
+
+        layout.linkSize(new java.awt.Component[] {hide, terminate}, org.jdesktop.layout.GroupLayout.HORIZONTAL);
+
         layout.setVerticalGroup(
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(layout.createSequentialGroup()
                 .add(jToolBar1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                 .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
-                .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 258, Short.MAX_VALUE)
-                .addContainerGap())
+                .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 141, Short.MAX_VALUE)
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
+                    .add(hide)
+                    .add(help)
+                    .add(terminate))
+                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
+                .add(status, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 18, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
         );
         pack();
     }// &lt;/editor-fold&gt;//GEN-END:initComponents
@@ -85,11 +114,13 @@
     
     
     // Variables declaration - do not modify//GEN-BEGIN:variables
+    protected javax.swing.JButton help;
+    protected javax.swing.JButton hide;
     private javax.swing.JScrollPane jScrollPane1;
     private javax.swing.JToolBar jToolBar1;
     protected javax.swing.JButton kick;
     protected javax.swing.JButton refresh;
-    protected javax.swing.JButton startstop;
+    private javax.swing.JLabel status;
     protected javax.swing.JButton terminate;
     protected javax.swing.JList users;
     // End of variables declaration//GEN-END:variables
@@ -98,12 +129,26 @@
     /**
      * Reload the list of the connected clients.
      */
-	public void update(Observable source, Object parameter) {
-		if(parameter != null &amp;&amp; parameter.toString().startsWith(&quot;PH&quot;)){
+	public void update(Observable source, final Object parameter) {
+		if(parameter == ServerMng.UPDATE_LIST){
 			ConnectionInfo[] clients = model.getConnectedUsers(false);
-			if(clients != null) users.setListData(clients);
-			else users.setListData(new String[] {null}); // empty selection. the setListData mustn't be null :/
-		}
+			if(clients != null) 
+				users.setListData(clients);
+			else 
+				users.setListData(new String[] {&quot;&quot;});
+		} else
+			java.awt.EventQueue.invokeLater(new Runnable(){
+				public void run() {
+					if(parameter instanceof String)
+						status.setText((String)parameter);
+					else if(parameter instanceof Exception) {
+						JOptionPane.showMessageDialog(null,
+								((Exception)parameter).getMessage(),
+							    L10n.getString(&quot;Error.ServerOperationFailed&quot;),
+							    JOptionPane.ERROR_MESSAGE);
+					}
+				}
+			});
 	}
     
 }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000534.html">[Plantlore-dev] Stav veci na serveru
</A></li>
	<LI>Next message: <A HREF="000536.html">[Plantlore-dev] r429 - trunk/src/net/sf/plantlore/common
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#535">[ date ]</a>
              <a href="thread.html#535">[ thread ]</a>
              <a href="subject.html#535">[ subject ]</a>
              <a href="author.html#535">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plantlore-dev">More information about the Plantlore-dev
mailing list</a><br>
</body></html>
